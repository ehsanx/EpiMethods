<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Advanced Epidemiological Methods - Exact Matching (CCHS)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./propensityscore2.html" rel="next">
<link href="./propensityscore0.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-CVBPG0RQMY"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-CVBPG0RQMY', { 'anonymize_ip': true});
</script><link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<meta name="twitter:title" content="Advanced Epidemiological Methods - Exact Matching (CCHS)">
<meta name="twitter:description" content="In the following code chunk, we load the necessary R libraries for our analysis.">
<meta name="twitter:card" content="summary">
</head>
<body class="nav-sidebar docked">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Exact Matching (CCHS)</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Advanced Epidemiological Methods</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle sidebar-tool" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">The Project</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./wrangling.html" class="sidebar-item-text sidebar-link">Data wrangling</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling1a.html" class="sidebar-item-text sidebar-link">R basics</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling1b.html" class="sidebar-item-text sidebar-link">Data types</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling1c.html" class="sidebar-item-text sidebar-link">Automating tasks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling2.html" class="sidebar-item-text sidebar-link">Importing dataset</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling3.html" class="sidebar-item-text sidebar-link">Data manipulation</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling4.html" class="sidebar-item-text sidebar-link">Import external data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling5.html" class="sidebar-item-text sidebar-link">Summary tables</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling6.html" class="sidebar-item-text sidebar-link">R Markdown</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wranglingF.html" class="sidebar-item-text sidebar-link">R Functions (W)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wranglingQ.html" class="sidebar-item-text sidebar-link">Quiz (W)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wranglingS.html" class="sidebar-item-text sidebar-link">App (W)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wranglingE.html" class="sidebar-item-text sidebar-link">Exercise (W)</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./accessing.html" class="sidebar-item-text sidebar-link">Accessing data</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessing0.html" class="sidebar-item-text sidebar-link">Concepts (A)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessing1.html" class="sidebar-item-text sidebar-link">Survey data sources</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessing1i.html" class="sidebar-item-text sidebar-link">Descriptions</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessing2.html" class="sidebar-item-text sidebar-link">Importing CCHS to R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessing3.html" class="sidebar-item-text sidebar-link">Importing NHANES to R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessing4.html" class="sidebar-item-text sidebar-link">Reproducing NHANES results</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessing5.html" class="sidebar-item-text sidebar-link">Importing NHIS to R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessing7.html" class="sidebar-item-text sidebar-link">Linking mortality data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessing8.html" class="sidebar-item-text sidebar-link">Replicate Data Creation</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessingF.html" class="sidebar-item-text sidebar-link">R Functions (A)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessingQ.html" class="sidebar-item-text sidebar-link">Quiz (A)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessingS.html" class="sidebar-item-text sidebar-link">App (A)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessingE.html" class="sidebar-item-text sidebar-link">Exercise 1 (A)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessingEsolution.html" class="sidebar-item-text sidebar-link">Exercise 1 Solution (A)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessingE2.html" class="sidebar-item-text sidebar-link">Exercise 2 (A)</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./researchquestion.html" class="sidebar-item-text sidebar-link">Research questions</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchquestion0.html" class="sidebar-item-text sidebar-link">Concepts (Q)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchquestion1.html" class="sidebar-item-text sidebar-link">Predictive question-1</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchquestion2a.html" class="sidebar-item-text sidebar-link">Predictive question-2a</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchquestion2b.html" class="sidebar-item-text sidebar-link">Predictive question-2b</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchquestion3.html" class="sidebar-item-text sidebar-link">Causal question-1</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchquestion4.html" class="sidebar-item-text sidebar-link">Causal question-2</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchquestionF.html" class="sidebar-item-text sidebar-link">R functions (Q)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchquestionQ.html" class="sidebar-item-text sidebar-link">Quiz (Q)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchquestionS.html" class="sidebar-item-text sidebar-link">App (Q)</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./confounding.html" class="sidebar-item-text sidebar-link">Causal roles</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confounding0.html" class="sidebar-item-text sidebar-link">Concepts (R)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confounding1.html" class="sidebar-item-text sidebar-link">Confounding</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confounding2.html" class="sidebar-item-text sidebar-link">Mediator</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confounding3.html" class="sidebar-item-text sidebar-link">Collider</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confounding3b.html" class="sidebar-item-text sidebar-link">Simpson’s Paradox</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confounding4.html" class="sidebar-item-text sidebar-link">Z-bias</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confounding5.html" class="sidebar-item-text sidebar-link">Collapsibility</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confounding6.html" class="sidebar-item-text sidebar-link">Change-in-estimate</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confoundingF.html" class="sidebar-item-text sidebar-link">R functions (R)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confoundingQ.html" class="sidebar-item-text sidebar-link">Quiz (R)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confoundingE.html" class="sidebar-item-text sidebar-link">Exercise (R)</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./predictivefactors.html" class="sidebar-item-text sidebar-link">Prediction ideas</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactors0.html" class="sidebar-item-text sidebar-link">Concepts (P)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactors1.html" class="sidebar-item-text sidebar-link">Collinear predictors</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactors2.html" class="sidebar-item-text sidebar-link">Continuous outcome</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactors3.html" class="sidebar-item-text sidebar-link">Binary outcome</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactors4.html" class="sidebar-item-text sidebar-link">Overfitting and performance</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactors5.html" class="sidebar-item-text sidebar-link">Data Splitting</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactors6.html" class="sidebar-item-text sidebar-link">Cross-validation</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactors7.html" class="sidebar-item-text sidebar-link">Bootstrap</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactorsF.html" class="sidebar-item-text sidebar-link">R functions (P)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactorsQ.html" class="sidebar-item-text sidebar-link">Quiz (P)</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./surveydata.html" class="sidebar-item-text sidebar-link">Survey data analysis</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata0.html" class="sidebar-item-text sidebar-link">Concepts (D)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata1.html" class="sidebar-item-text sidebar-link">CCHS: Revisiting PICOT</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata2.html" class="sidebar-item-text sidebar-link">CCHS: Assessing data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata3.html" class="sidebar-item-text sidebar-link">CCHS: Bivariate analysis</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata4.html" class="sidebar-item-text sidebar-link">CCHS: Regression</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata5.html" class="sidebar-item-text sidebar-link">CCHS: Performance</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata6.html" class="sidebar-item-text sidebar-link">NHANES: Blood Pressure</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata7.html" class="sidebar-item-text sidebar-link">NHANES: Cholesterol</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata8.html" class="sidebar-item-text sidebar-link">NHANES: Subsetting</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydataF.html" class="sidebar-item-text sidebar-link">R functions (D)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydataQ.html" class="sidebar-item-text sidebar-link">Quiz (D)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydataS.html" class="sidebar-item-text sidebar-link">App (D)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydataE.html" class="sidebar-item-text sidebar-link">Exercise (D)</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./missingdata.html" class="sidebar-item-text sidebar-link">Missing data analysis</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdata0.html" class="sidebar-item-text sidebar-link">Concepts (M)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdata1.html" class="sidebar-item-text sidebar-link">Imputation</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdata2.html" class="sidebar-item-text sidebar-link">Imputation in NHANES</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdata3.html" class="sidebar-item-text sidebar-link">Missing in outcome</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdata4.html" class="sidebar-item-text sidebar-link">Performance with NA</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdata5.html" class="sidebar-item-text sidebar-link">Subpopulations</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdata6.html" class="sidebar-item-text sidebar-link">MCAR tests</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdata7.html" class="sidebar-item-text sidebar-link">Effect modification</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdataF.html" class="sidebar-item-text sidebar-link">R functions (M)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdataQ.html" class="sidebar-item-text sidebar-link">Quiz (M)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdataS.html" class="sidebar-item-text sidebar-link">App (M)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdataE.html" class="sidebar-item-text sidebar-link">Exercise (M)</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./propensityscore.html" class="sidebar-item-text sidebar-link">Propensity score</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscore0.html" class="sidebar-item-text sidebar-link">Concepts (S)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscore1.html" class="sidebar-item-text sidebar-link active">Exact Matching (CCHS)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscore2.html" class="sidebar-item-text sidebar-link">PSM in OA-CVD (CCHS)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscore3.html" class="sidebar-item-text sidebar-link">PSM in OA-CVD (US)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscore4.html" class="sidebar-item-text sidebar-link">PSM in BMI-diabetes</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscore5.html" class="sidebar-item-text sidebar-link">PSM with MI</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscore6.html" class="sidebar-item-text sidebar-link">PS Weighting (US)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscore7.html" class="sidebar-item-text sidebar-link">PSM with MI in subset</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscore8.html" class="sidebar-item-text sidebar-link">PSW with MI in subset</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscore9.html" class="sidebar-item-text sidebar-link">PSW with multiple tx</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscoreF.html" class="sidebar-item-text sidebar-link">R functions (S)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscoreQ.html" class="sidebar-item-text sidebar-link">Quiz (S)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscoreS.html" class="sidebar-item-text sidebar-link">App (S)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscoreE.html" class="sidebar-item-text sidebar-link">Exercise (S)</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./machinelearning.html" class="sidebar-item-text sidebar-link">Machine learning (ML)</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning0.html" class="sidebar-item-text sidebar-link">Concepts (L)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning1.html" class="sidebar-item-text sidebar-link">Continuous outcome</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning2.html" class="sidebar-item-text sidebar-link">Data spliting</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning3.html" class="sidebar-item-text sidebar-link">Cross-validation</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning4.html" class="sidebar-item-text sidebar-link">Binary outcome</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning5.html" class="sidebar-item-text sidebar-link">Supervised learning</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning6.html" class="sidebar-item-text sidebar-link">Unsupervised learning</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning6a.html" class="sidebar-item-text sidebar-link">NHIS Example</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning6b.html" class="sidebar-item-text sidebar-link">Replicate Results</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearningQ.html" class="sidebar-item-text sidebar-link">Quiz (L)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearningF.html" class="sidebar-item-text sidebar-link">R functions (L)</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./machinelearningCausal.html" class="sidebar-item-text sidebar-link">ML in causal inference</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearningCausal0.html" class="sidebar-item-text sidebar-link">Concepts (C)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearningCausal1.html" class="sidebar-item-text sidebar-link">Motivation</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearningCausal2.html" class="sidebar-item-text sidebar-link">SuperLearner</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearningCausal3.html" class="sidebar-item-text sidebar-link">Binary Outcomes</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearningCausal4.html" class="sidebar-item-text sidebar-link">Continuous Outcomes</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearningCausal5.html" class="sidebar-item-text sidebar-link">Comparing results</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearningCausalQ.html" class="sidebar-item-text sidebar-link">Quiz (C)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearningCausalF.html" class="sidebar-item-text sidebar-link">R functions (C)</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./nonbinary.html" class="sidebar-item-text sidebar-link">Complex outcomes</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nonbinary0.html" class="sidebar-item-text sidebar-link">Concepts (N)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nonbinary1.html" class="sidebar-item-text sidebar-link">Polytomous and ordinal</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nonbinary2.html" class="sidebar-item-text sidebar-link">Survival analysis</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nonbinary2a.html" class="sidebar-item-text sidebar-link">Survival analysis: NHANES</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nonbinary3.html" class="sidebar-item-text sidebar-link">Poisson</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nonbinaryF.html" class="sidebar-item-text sidebar-link">R functions (N)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nonbinaryQ.html" class="sidebar-item-text sidebar-link">Quiz (N)</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./longitudinal.html" class="sidebar-item-text sidebar-link">Longitudinal data</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./longitudinal0.html" class="sidebar-item-text sidebar-link">Concepts (T)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./longitudinal1.html" class="sidebar-item-text sidebar-link">Mixed effects models</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./longitudinal2.html" class="sidebar-item-text sidebar-link">GEE</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./longitudinalF.html" class="sidebar-item-text sidebar-link">R functions (T)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./longitudinalQ.html" class="sidebar-item-text sidebar-link">Quiz (T)</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./mediation.html" class="sidebar-item-text sidebar-link">Mediation analysis</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-13" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mediation0.html" class="sidebar-item-text sidebar-link">Concepts (I)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mediation1.html" class="sidebar-item-text sidebar-link">Baron and Kenny</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mediation2.html" class="sidebar-item-text sidebar-link">Justification</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mediation3.html" class="sidebar-item-text sidebar-link">Mediation Example</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mediationF.html" class="sidebar-item-text sidebar-link">R functions (I)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mediationQ.html" class="sidebar-item-text sidebar-link">Quiz (I)</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./reporting.html" class="sidebar-item-text sidebar-link">Writing tools</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-14" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-14" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reporting1.html" class="sidebar-item-text sidebar-link">Collaborative Writing</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reporting2.html" class="sidebar-item-text sidebar-link">Formatting Tools</a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#load-data" id="toc-load-data" class="nav-link active" data-scroll-target="#load-data">Load data</a></li>
  <li><a href="#data-pre-pocessing" id="toc-data-pre-pocessing" class="nav-link" data-scroll-target="#data-pre-pocessing">Data pre-pocessing</a></li>
  <li><a href="#identify-subjects-with-missing" id="toc-identify-subjects-with-missing" class="nav-link" data-scroll-target="#identify-subjects-with-missing">Identify subjects with missing</a></li>
  <li><a href="#setting-design" id="toc-setting-design" class="nav-link" data-scroll-target="#setting-design">Setting Design</a></li>
  <li><a href="#preliminary-analysis" id="toc-preliminary-analysis" class="nav-link" data-scroll-target="#preliminary-analysis">Preliminary analysis</a></li>
  <li><a href="#matching-estimating-treatment-effect" id="toc-matching-estimating-treatment-effect" class="nav-link" data-scroll-target="#matching-estimating-treatment-effect">Matching: Estimating treatment effect</a></li>
  <li><a href="#treatment-effect-1" id="toc-treatment-effect-1" class="nav-link" data-scroll-target="#treatment-effect-1">Treatment effect</a></li>
  <li><a href="#matching-by-a-lot-of-variables" id="toc-matching-by-a-lot-of-variables" class="nav-link" data-scroll-target="#matching-by-a-lot-of-variables">Matching by a lot of variables</a></li>
  <li><a href="#save-data-for-later-use" id="toc-save-data-for-later-use" class="nav-link" data-scroll-target="#save-data-for-later-use">Save data for later use</a></li>
  <li><a href="#video-content-optional" id="toc-video-content-optional" class="nav-link" data-scroll-target="#video-content-optional">Video content (optional)</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title d-none d-lg-block">Exact Matching (CCHS)</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>In the following code chunk, we load the necessary R libraries for our analysis. <code>MatchIt</code> is used for matching methods to find comparable control units, <code>tableone</code> for creating Table 1 to describe baseline characteristics, <code>Publish</code> for generating readable output of regression analysis, and <code>survey</code> for analyzing complex survey samples.</p>
<div class="cell" data-hash="propensityscore1_cache/html/setup_389be1adc848ec1ead4cc6c15f4a879a">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Load required packages</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(MatchIt)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">require</span>(tableone)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">require</span>(Publish)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">require</span>(survey)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="load-data" class="level3"><h3 class="anchored" data-anchor-id="load-data">Load data</h3>
<p>In the following code chunk, we load the CCHS dataset which is related to the Canadian Community Health Survey (CCHS). We then use <code><a href="https://rdrr.io/r/base/ls.html">ls()</a></code> to list all objects in the workspace and <code>str</code> to display the structure of the data frame, providing a quick overview of the data and checking for any character variables.</p>
<div class="cell" data-hash="propensityscore1_cache/html/data_b6242cd3d8636a1bbdafd29120024f99">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">load</span>(<span class="st">"Data/propensityscore/cchs123b.RData"</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="fu">ls</span>()</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">#&gt; [1] "analytic.miss"   "analytic2"       "has_annotations"</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="fu">str</span>(analytic.miss) <span class="co"># is there any character variable?</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">#&gt; 'data.frame':    397173 obs. of  22 variables:</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co">#&gt;  $ CVD      : chr  "event" "no event" "no event" "no event" ...</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">#&gt;  $ age      : chr  "65 years and over" "65 years and over" "30-39 years" "65 years and over" ...</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">#&gt;  $ sex      : chr  "Female" "Female" "Male" "Female" ...</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">#&gt;  $ married  : chr  "single" "single" "not single" "single" ...</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co">#&gt;  $ race     : chr  "White" "White" "White" "White" ...</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">#&gt;  $ edu      : chr  "2nd grad." "Post-2nd grad." "Post-2nd grad." "Post-2nd grad." ...</span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co">#&gt;  $ income   : chr  "$29,999 or less" "$29,999 or less" "$80,000 or more" "$29,999 or less" ...</span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co">#&gt;  $ bmi      : Factor w/ 3 levels "Underweight",..: NA NA 2 NA 2 NA 3 NA 2 3 ...</span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="co">#&gt;  $ phyact   : chr  "Inactive" "Inactive" "Inactive" "Inactive" ...</span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="co">#&gt;  $ doctor   : chr  "Yes" "Yes" "Yes" "Yes" ...</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="co">#&gt;  $ stress   : chr  "Not too stressed" "Not too stressed" "stressed" "Not too stressed" ...</span></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="co">#&gt;  $ smoke    : Factor w/ 3 levels "Never smoker",..: 3 1 3 3 2 2 3 1 2 2 ...</span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="co">#&gt;  $ drink    : Factor w/ 3 levels "Never drank",..: 2 1 2 2 2 2 3 1 2 2 ...</span></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="co">#&gt;  $ fruit    : Factor w/ 3 levels "0-3 daily serving",..: 2 2 2 3 3 3 2 2 2 2 ...</span></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="co">#&gt;  $ bp       : chr  "No" "No" "No" "No" ...</span></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="co">#&gt;  $ diab     : chr  "No" "No" "No" "No" ...</span></span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="co">#&gt;  $ province : Factor w/ 2 levels "South","North": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span id="cb2-23"><a href="#cb2-23"></a><span class="co">#&gt;  $ weight   : num  142.8 71.4 168.3 71.4 196.1 ...</span></span>
<span id="cb2-24"><a href="#cb2-24"></a><span class="co">#&gt;  $ cycle    : Factor w/ 3 levels "11","21","31": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span id="cb2-25"><a href="#cb2-25"></a><span class="co">#&gt;  $ ID       : int  1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span id="cb2-26"><a href="#cb2-26"></a><span class="co">#&gt;  $ OA       : chr  "Control" "Control" "Control" "Control" ...</span></span>
<span id="cb2-27"><a href="#cb2-27"></a><span class="co">#&gt;  $ immigrate: Factor w/ 3 levels "not immigrant",..: 1 1 3 1 1 1 1 1 1 1 ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="data-pre-pocessing" class="level3"><h3 class="anchored" data-anchor-id="data-pre-pocessing">Data pre-pocessing</h3>
<p>In the following code chunk, we define a vector containing the names of variables of interest that needs to be converted to factor variables. We then convert these variables to factors, ensuring they are treated as categorical in subsequent analyses. We also <code>recode</code> the Osteoarthritis (OA) variable into a numeric binary format and display the frequency table of OA before and after the transformation.</p>
<div class="cell" data-hash="propensityscore1_cache/html/data2_b4d1fbf20c03eca84be8a2720add3dd2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>var.names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"stress"</span>, <span class="st">"married"</span>, <span class="st">"income"</span>, <span class="st">"race"</span>, </span>
<span id="cb3-2"><a href="#cb3-2"></a>               <span class="st">"bmi"</span>, <span class="st">"phyact"</span>, <span class="st">"smoke"</span>, <span class="st">"doctor"</span>, <span class="st">"drink"</span>, <span class="st">"bp"</span>, <span class="st">"province"</span>,</span>
<span id="cb3-3"><a href="#cb3-3"></a>               <span class="st">"immigrate"</span>, <span class="st">"fruit"</span>, <span class="st">"diab"</span>, <span class="st">"edu"</span>, <span class="st">"CVD"</span>, <span class="st">"OA"</span>)</span>
<span id="cb3-4"><a href="#cb3-4"></a>analytic.miss[var.names] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(analytic.miss[var.names] , factor)</span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="fu">table</span>(analytic.miss<span class="sc">$</span>OA)</span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">#&gt; </span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">#&gt; Control      OA </span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co">#&gt;  314542   40943</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>analytic.miss<span class="sc">$</span>OA <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(analytic.miss<span class="sc">$</span>OA<span class="sc">==</span><span class="st">"OA"</span>) </span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="fu">table</span>(analytic.miss<span class="sc">$</span>OA)</span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="co">#&gt; </span></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="co">#&gt;      0      1 </span></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co">#&gt; 314542  40943</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="identify-subjects-with-missing" class="level3"><h3 class="anchored" data-anchor-id="identify-subjects-with-missing">Identify subjects with missing</h3>
<p>In the following code chunk, we create a new variable <code>miss</code> and initially assign all its values to 1 in the full dataset (that contains some missing observations). We then adjust this assignment by setting miss to 0 for observations that are also present in another complete case dataset. That means any row with <code>miss</code> equal to 0 means that row has no missing observations. Finally, we display the frequency table of the miss variable to check the number of missing and non-missing observations.</p>
<div class="cell" data-hash="propensityscore1_cache/html/miss_54bffef0a0ba74b9715e77dd7455b7d6">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>analytic.miss<span class="sc">$</span>miss <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="fu">head</span>(analytic.miss<span class="sc">$</span>ID) <span class="co"># full data</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">#&gt; [1] 1 2 3 4 5 6</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="fu">head</span>(analytic2<span class="sc">$</span>ID) <span class="co"># complete case</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">#&gt; [1]  3  5  7 10 11 13</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="fu">head</span>(analytic.miss<span class="sc">$</span>ID[analytic.miss<span class="sc">$</span>ID <span class="sc">%in%</span> analytic2<span class="sc">$</span>ID])</span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">#&gt; [1]  3  5  7 10 11 13</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co"># if associated with complete case, assign miss &lt;- 0</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>analytic.miss<span class="sc">$</span>miss[analytic.miss<span class="sc">$</span>ID <span class="sc">%in%</span> analytic2<span class="sc">$</span>ID] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="fu">table</span>(analytic.miss<span class="sc">$</span>miss)</span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="co">#&gt; </span></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="co">#&gt;      0      1 </span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co">#&gt; 185613 211560</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="setting-design" class="level3"><h3 class="anchored" data-anchor-id="setting-design">Setting Design</h3>
<section id="unconditional-design" class="level4"><h4 class="anchored" data-anchor-id="unconditional-design">Unconditional design</h4>
<p>In the following code chunk, we explore the summary of the weight variable and establish an unconditional survey design object <code>w.design0</code> using the <code>svydesign</code> function, which will be used for subsequent survey-weighted analyses. We then explore the summary, standard deviation, and sum of the weights within our design object.</p>
<div class="cell" data-hash="propensityscore1_cache/html/design_8add528f321be64256c1edf07cdad333">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">summary</span>(analytic.miss<span class="sc">$</span>weight)</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co">#&gt;    1.17   65.28  126.63  200.09  243.21 7154.95</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>w.design0 <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">id=</span><span class="sc">~</span><span class="dv">1</span>, <span class="at">weights=</span><span class="sc">~</span>weight, </span>
<span id="cb5-5"><a href="#cb5-5"></a>                      <span class="at">data=</span>analytic.miss)</span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="fu">summary</span>(<span class="fu">weights</span>(w.design0))</span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co">#&gt;    1.17   65.28  126.63  200.09  243.21 7154.95</span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="fu">sd</span>(<span class="fu">weights</span>(w.design0))</span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="co">#&gt; [1] 241.0279</span></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="fu">sum</span>(<span class="fu">weights</span>(w.design0))</span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="co">#&gt; [1] 79468929</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="conditioning-the-design" class="level4"><h4 class="anchored" data-anchor-id="conditioning-the-design">Conditioning the design</h4>
<p>In the following code chunk, we create a new survey design object <code>w.design</code> by subsetting <code>w.design0</code> to only include observations without missing data <code>(miss == 0)</code>. We then explore the summary, standard deviation, and sum of the weights within this new design object.</p>
<div class="cell" data-hash="propensityscore1_cache/html/design2_5cbe08638157353fbd7f586743db7d7e">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>w.design <span class="ot">&lt;-</span> <span class="fu">subset</span>(w.design0, miss <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="fu">summary</span>(<span class="fu">weights</span>(w.design))</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co">#&gt;    1.17   71.56  137.95  214.61  261.91 7154.95</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="fu">sd</span>(<span class="fu">weights</span>(w.design))</span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">#&gt; [1] 254.9346</span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="fu">sum</span>(<span class="fu">weights</span>(w.design))</span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">#&gt; [1] 39835061</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="subset-data-more" class="level4"><h4 class="anchored" data-anchor-id="subset-data-more">Subset data (more!)</h4>
<p>We subset the data for fast results (less computation). We will only work with cycle 1.1, and the people from Northern provinces in Canada.</p>
<div class="cell" data-hash="propensityscore1_cache/html/design3_e78c0f8f5bdf4b3472fe8a45bdd27239">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>w.design1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(w.design, cycle <span class="sc">==</span> <span class="dv">11</span> <span class="sc">&amp;</span> province <span class="sc">==</span> <span class="st">"North"</span>)</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="fu">sum</span>(<span class="fu">weights</span>(w.design1))</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co">#&gt; [1] 42786.28</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="preliminary-analysis" class="level3"><h3 class="anchored" data-anchor-id="preliminary-analysis">Preliminary analysis</h3>
<section id="table-1" class="level4"><h4 class="anchored" data-anchor-id="table-1">Table 1</h4>
<p>In the following code chunk, we define a new variable vector <code>var.names</code> and create a categorical table using <code>svyCreateCatTable</code> to explore the distribution of <code>age</code> and <code>sex</code> across strata of <code>OA</code> within our subsetted design object <code>w.design1</code>. We then print the table with standardized mean differences (SMD) to assess the balance of these variables across strata.</p>
<div class="cell" data-hash="propensityscore1_cache/html/tab_a87e0ef9900a24f78aa6b427858274f3">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>var.names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"sex"</span>)</span>
<span id="cb8-2"><a href="#cb8-2"></a>tab0 <span class="ot">&lt;-</span> <span class="fu">svyCreateCatTable</span>(<span class="at">var =</span> var.names, <span class="at">strata=</span> <span class="st">"OA"</span>, <span class="at">data=</span>w.design1,<span class="at">test=</span><span class="cn">FALSE</span>)</span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="fu">print</span>(tab0, <span class="at">smd =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co">#&gt;                       Stratified by OA</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="co">#&gt;                        0               1              SMD   </span></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="co">#&gt;   n                    40691.2         2095.1               </span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="co">#&gt;   age (%)                                              1.084</span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co">#&gt;      20-29 years       10889.4 (26.8)   120.9 ( 5.8)        </span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="co">#&gt;      30-39 years       12251.7 (30.1)   237.8 (11.3)        </span></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="co">#&gt;      40-49 years       11094.0 (27.3)   572.7 (27.3)        </span></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co">#&gt;      50-59 years        5346.6 (13.1)  1092.4 (52.1)        </span></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="co">#&gt;      60-64 years        1109.4 ( 2.7)    71.4 ( 3.4)        </span></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="co">#&gt;      65 years and over     0.0 ( 0.0)     0.0 ( 0.0)        </span></span>
<span id="cb8-14"><a href="#cb8-14"></a><span class="co">#&gt;      teen                  0.0 ( 0.0)     0.0 ( 0.0)        </span></span>
<span id="cb8-15"><a href="#cb8-15"></a><span class="co">#&gt;   sex = Male (%)       20824.6 (51.2)  1050.8 (50.2)   0.020</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="treatment-effect" class="level4"><h4 class="anchored" data-anchor-id="treatment-effect">Treatment effect</h4>
<p>In the following code chunk, we fit a logistic regression model using <code>svyglm</code> to estimate the effect of <code>OA</code> and other covariates on the binary outcome <code>CVD</code> (cardiovascular disease). We then use <code>publish</code> to display the results in a readable format.</p>
<div class="cell" data-hash="propensityscore1_cache/html/tx_b768a08d6f6682d04da92a072debdf8c">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>fit.outcome <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(<span class="fu">I</span>(CVD<span class="sc">==</span><span class="st">"event"</span>) <span class="sc">~</span> OA <span class="sc">+</span> age <span class="sc">+</span> sex <span class="sc">+</span> stress <span class="sc">+</span> married <span class="sc">+</span> </span>
<span id="cb9-2"><a href="#cb9-2"></a>                         income <span class="sc">+</span> race <span class="sc">+</span> bmi <span class="sc">+</span> phyact <span class="sc">+</span> smoke <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>                         immigrate <span class="sc">+</span> fruit <span class="sc">+</span> diab <span class="sc">+</span> edu,</span>
<span id="cb9-4"><a href="#cb9-4"></a>                   <span class="at">design =</span> w.design1,</span>
<span id="cb9-5"><a href="#cb9-5"></a>                   <span class="at">family =</span> <span class="fu">binomial</span>(logit))</span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co">#&gt; Warning in eval(family$initialize): non-integer #successes in a binomial glm!</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="fu">publish</span>(fit.outcome)</span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co">#&gt;   Variable             Units OddsRatio         CI.95    p-value </span></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="co">#&gt;         OA                        0.89   [0.17;4.59]   0.887411 </span></span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="co">#&gt;        age       20-29 years       Ref                          </span></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="co">#&gt;                  30-39 years      2.62  [0.29;23.43]   0.389521 </span></span>
<span id="cb9-12"><a href="#cb9-12"></a><span class="co">#&gt;                  40-49 years      4.89  [0.59;40.73]   0.142280 </span></span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="co">#&gt;                  50-59 years     17.95 [2.59;124.68]   0.003550 </span></span>
<span id="cb9-14"><a href="#cb9-14"></a><span class="co">#&gt;                  60-64 years     23.95 [3.41;168.27]   0.001439 </span></span>
<span id="cb9-15"><a href="#cb9-15"></a><span class="co">#&gt;        sex            Female       Ref                          </span></span>
<span id="cb9-16"><a href="#cb9-16"></a><span class="co">#&gt;                         Male      1.32   [0.64;2.71]   0.456222 </span></span>
<span id="cb9-17"><a href="#cb9-17"></a><span class="co">#&gt;     stress  Not too stressed       Ref                          </span></span>
<span id="cb9-18"><a href="#cb9-18"></a><span class="co">#&gt;                     stressed      0.54   [0.21;1.39]   0.198815 </span></span>
<span id="cb9-19"><a href="#cb9-19"></a><span class="co">#&gt;    married        not single       Ref                          </span></span>
<span id="cb9-20"><a href="#cb9-20"></a><span class="co">#&gt;                       single      0.75   [0.31;1.80]   0.513807 </span></span>
<span id="cb9-21"><a href="#cb9-21"></a><span class="co">#&gt;     income   $29,999 or less       Ref                          </span></span>
<span id="cb9-22"><a href="#cb9-22"></a><span class="co">#&gt;              $30,000-$49,999      0.72   [0.24;2.16]   0.556703 </span></span>
<span id="cb9-23"><a href="#cb9-23"></a><span class="co">#&gt;              $50,000-$79,999      0.95   [0.27;3.40]   0.939104 </span></span>
<span id="cb9-24"><a href="#cb9-24"></a><span class="co">#&gt;              $80,000 or more      0.47   [0.10;2.15]   0.332557 </span></span>
<span id="cb9-25"><a href="#cb9-25"></a><span class="co">#&gt;       race         Non-white       Ref                          </span></span>
<span id="cb9-26"><a href="#cb9-26"></a><span class="co">#&gt;                        White      0.33   [0.11;0.94]   0.038131 </span></span>
<span id="cb9-27"><a href="#cb9-27"></a><span class="co">#&gt;        bmi       Underweight       Ref                          </span></span>
<span id="cb9-28"><a href="#cb9-28"></a><span class="co">#&gt;               healthy weight      0.29   [0.03;3.20]   0.310237 </span></span>
<span id="cb9-29"><a href="#cb9-29"></a><span class="co">#&gt;                   Overweight      0.44   [0.04;4.77]   0.503130 </span></span>
<span id="cb9-30"><a href="#cb9-30"></a><span class="co">#&gt;     phyact            Active       Ref                          </span></span>
<span id="cb9-31"><a href="#cb9-31"></a><span class="co">#&gt;                     Inactive      0.84   [0.30;2.40]   0.751345 </span></span>
<span id="cb9-32"><a href="#cb9-32"></a><span class="co">#&gt;                     Moderate      1.02   [0.32;3.27]   0.979528 </span></span>
<span id="cb9-33"><a href="#cb9-33"></a><span class="co">#&gt;      smoke      Never smoker       Ref                          </span></span>
<span id="cb9-34"><a href="#cb9-34"></a><span class="co">#&gt;               Current smoker      0.98   [0.26;3.76]   0.981454 </span></span>
<span id="cb9-35"><a href="#cb9-35"></a><span class="co">#&gt;                Former smoker      0.71   [0.18;2.71]   0.612518 </span></span>
<span id="cb9-36"><a href="#cb9-36"></a><span class="co">#&gt;  immigrate     not immigrant       Ref                          </span></span>
<span id="cb9-37"><a href="#cb9-37"></a><span class="co">#&gt;                   &gt; 10 years      0.14   [0.03;0.78]   0.025010 </span></span>
<span id="cb9-38"><a href="#cb9-38"></a><span class="co">#&gt;                       recent      0.00   [0.00;0.00]    &lt; 1e-04 </span></span>
<span id="cb9-39"><a href="#cb9-39"></a><span class="co">#&gt;      fruit 0-3 daily serving       Ref                          </span></span>
<span id="cb9-40"><a href="#cb9-40"></a><span class="co">#&gt;            4-6 daily serving      1.15   [0.52;2.56]   0.725722 </span></span>
<span id="cb9-41"><a href="#cb9-41"></a><span class="co">#&gt;             6+ daily serving      0.68   [0.17;2.71]   0.583752 </span></span>
<span id="cb9-42"><a href="#cb9-42"></a><span class="co">#&gt;       diab                No       Ref                          </span></span>
<span id="cb9-43"><a href="#cb9-43"></a><span class="co">#&gt;                          Yes      3.08  [0.93;10.23]   0.066677 </span></span>
<span id="cb9-44"><a href="#cb9-44"></a><span class="co">#&gt;        edu          &lt; 2ndary       Ref                          </span></span>
<span id="cb9-45"><a href="#cb9-45"></a><span class="co">#&gt;                    2nd grad.      4.12  [0.87;19.43]   0.074178 </span></span>
<span id="cb9-46"><a href="#cb9-46"></a><span class="co">#&gt;              Other 2nd grad.      3.04  [0.63;14.67]   0.167135 </span></span>
<span id="cb9-47"><a href="#cb9-47"></a><span class="co">#&gt;               Post-2nd grad.      3.00  [0.82;10.98]   0.096939</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="matching-estimating-treatment-effect" class="level3"><h3 class="anchored" data-anchor-id="matching-estimating-treatment-effect">Matching: Estimating treatment effect</h3>
<p>Going back to the data (<strong>not working on design here while matching</strong>)</p>
<p>In the following code chunk, we create a new dataset by omitting <code>NA</code> values from <code>analytic.miss</code> and converting it to a data frame. We then create a subset <code>analytic11n</code> which includes only observations from cycle 1.1 and the Northern provinces. We display the dimensions of this subset, as well as frequency tables of <code>OA</code> and a cross-tabulation of <code>OA</code> and <code>age</code> to understand the distribution of our target variable and a key covariate.</p>
<div class="cell" data-hash="propensityscore1_cache/html/effect_fb5ad33cbfbb4fc2fff2f84aa3fb196d">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Create the dataset without design features</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>analytic2 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">na.omit</span>(analytic.miss))</span>
<span id="cb10-3"><a href="#cb10-3"></a>analytic11n <span class="ot">&lt;-</span> <span class="fu">subset</span>(analytic2, cycle <span class="sc">==</span> <span class="dv">11</span> <span class="sc">&amp;</span> province <span class="sc">==</span> <span class="st">"North"</span>)</span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="fu">dim</span>(analytic11n)</span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="co">#&gt; [1] 1424   23</span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="fu">table</span>(analytic11n<span class="sc">$</span>OA)</span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="co">#&gt; </span></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="co">#&gt;    0    1 </span></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="co">#&gt; 1357   67</span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="fu">table</span>(analytic11n<span class="sc">$</span>OA,analytic11n<span class="sc">$</span>age)</span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="co">#&gt;    </span></span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="co">#&gt;     20-29 years 30-39 years 40-49 years 50-59 years 60-64 years</span></span>
<span id="cb10-13"><a href="#cb10-13"></a><span class="co">#&gt;   0         345         432         358         177          45</span></span>
<span id="cb10-14"><a href="#cb10-14"></a><span class="co">#&gt;   1           4          11          18          31           3</span></span>
<span id="cb10-15"><a href="#cb10-15"></a><span class="co">#&gt;    </span></span>
<span id="cb10-16"><a href="#cb10-16"></a><span class="co">#&gt;     65 years and over teen</span></span>
<span id="cb10-17"><a href="#cb10-17"></a><span class="co">#&gt;   0                 0    0</span></span>
<span id="cb10-18"><a href="#cb10-18"></a><span class="co">#&gt;   1                 0    0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="matching-by-1-matching-variable" class="level4"><h4 class="anchored" data-anchor-id="matching-by-1-matching-variable">Matching by 1 matching variable</h4>
<p>In the following code chunk, we perform exact matching using a single variable, <code>age</code>. We define the matching formula and apply the <code>matchit</code> function to create matched sets of treated and control units. The resulting <code>matching.obj</code> object is displayed to summarize the matching results.</p>
<div class="cell" data-hash="propensityscore1_cache/html/match1_afef3d17396fa5ad0f38cb24a13bbd5d">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>match.formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="st">"OA ~ age"</span>)</span>
<span id="cb11-2"><a href="#cb11-2"></a>matching.obj <span class="ot">&lt;-</span> <span class="fu">matchit</span>(match.formula,</span>
<span id="cb11-3"><a href="#cb11-3"></a>                        <span class="at">data =</span> analytic11n,</span>
<span id="cb11-4"><a href="#cb11-4"></a>                        <span class="at">method =</span> <span class="st">"exact"</span>)</span>
<span id="cb11-5"><a href="#cb11-5"></a>matching.obj</span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="co">#&gt; A matchit object</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="co">#&gt;  - method: Exact matching</span></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="co">#&gt;  - number of obs.: 1424 (original), 1424 (matched)</span></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="co">#&gt;  - target estimand: ATT</span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="co">#&gt;  - covariates: age</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="matching-by-2-matching-variables" class="level4"><h4 class="anchored" data-anchor-id="matching-by-2-matching-variables">Matching by 2 matching variables</h4>
<p>In the following code chunk, we extend the matching to include two variables, <code>age</code> and <code>sex</code>. We create a new variable <code>var.comb</code> that concatenates these two variables and display its frequency table and the number of unique combinations. We then perform exact matching using both variables and display the resulting object.</p>
<div class="cell" data-hash="propensityscore1_cache/html/match2_1bc4a99a512e98b34585732ae998c093">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>var.comb <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">'paste0'</span>, </span>
<span id="cb12-2"><a href="#cb12-2"></a>                    analytic11n[, <span class="fu">c</span>(<span class="st">'age'</span>, <span class="st">'sex'</span>)])</span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="fu">table</span>(var.comb)</span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="co">#&gt; var.comb</span></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="co">#&gt; 20-29 yearsFemale   20-29 yearsMale 30-39 yearsFemale   30-39 yearsMale </span></span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="co">#&gt;               184               165               220               223 </span></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="co">#&gt; 40-49 yearsFemale   40-49 yearsMale 50-59 yearsFemale   50-59 yearsMale </span></span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="co">#&gt;               187               189               101               107 </span></span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="co">#&gt; 60-64 yearsFemale   60-64 yearsMale </span></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="co">#&gt;                24                24</span></span>
<span id="cb12-11"><a href="#cb12-11"></a><span class="fu">length</span>(<span class="fu">table</span>(var.comb))</span>
<span id="cb12-12"><a href="#cb12-12"></a><span class="co">#&gt; [1] 10</span></span>
<span id="cb12-13"><a href="#cb12-13"></a>match.formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="st">"OA ~ age + sex"</span>)</span>
<span id="cb12-14"><a href="#cb12-14"></a>matching.obj <span class="ot">&lt;-</span> <span class="fu">matchit</span>(match.formula,</span>
<span id="cb12-15"><a href="#cb12-15"></a>                        <span class="at">data =</span> analytic11n,</span>
<span id="cb12-16"><a href="#cb12-16"></a>                        <span class="at">method =</span> <span class="st">"exact"</span>)</span>
<span id="cb12-17"><a href="#cb12-17"></a>matching.obj</span>
<span id="cb12-18"><a href="#cb12-18"></a><span class="co">#&gt; A matchit object</span></span>
<span id="cb12-19"><a href="#cb12-19"></a><span class="co">#&gt;  - method: Exact matching</span></span>
<span id="cb12-20"><a href="#cb12-20"></a><span class="co">#&gt;  - number of obs.: 1424 (original), 1424 (matched)</span></span>
<span id="cb12-21"><a href="#cb12-21"></a><span class="co">#&gt;  - target estimand: ATT</span></span>
<span id="cb12-22"><a href="#cb12-22"></a><span class="co">#&gt;  - covariates: age, sex</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="matching-by-3-matching-variables" class="level4"><h4 class="anchored" data-anchor-id="matching-by-3-matching-variables">Matching by 3 matching variables</h4>
<p>In the following code chunk, we further extend the matching to include three variables: <code>age</code>, <code>sex</code>, and <code>stress</code>. We explore the unique combinations of these variables and their distribution across levels of <code>OA</code>. We then perform exact matching using these three variables and display the resulting object.</p>
<div class="cell" data-hash="propensityscore1_cache/html/match3_91d16b5f7ec48601e916494aad3a243c">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>var.comb <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">'paste0'</span>, </span>
<span id="cb13-2"><a href="#cb13-2"></a>                    analytic11n[, <span class="fu">c</span>(<span class="st">'age'</span>, <span class="st">'sex'</span>, <span class="st">'stress'</span>)])</span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="fu">table</span>(var.comb)</span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="co">#&gt; var.comb</span></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="co">#&gt; 20-29 yearsFemaleNot too stressed         20-29 yearsFemalestressed </span></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="co">#&gt;                               157                                27 </span></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="co">#&gt;   20-29 yearsMaleNot too stressed           20-29 yearsMalestressed </span></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="co">#&gt;                               147                                18 </span></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="co">#&gt; 30-39 yearsFemaleNot too stressed         30-39 yearsFemalestressed </span></span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="co">#&gt;                               170                                50 </span></span>
<span id="cb13-11"><a href="#cb13-11"></a><span class="co">#&gt;   30-39 yearsMaleNot too stressed           30-39 yearsMalestressed </span></span>
<span id="cb13-12"><a href="#cb13-12"></a><span class="co">#&gt;                               183                                40 </span></span>
<span id="cb13-13"><a href="#cb13-13"></a><span class="co">#&gt; 40-49 yearsFemaleNot too stressed         40-49 yearsFemalestressed </span></span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="co">#&gt;                               142                                45 </span></span>
<span id="cb13-15"><a href="#cb13-15"></a><span class="co">#&gt;   40-49 yearsMaleNot too stressed           40-49 yearsMalestressed </span></span>
<span id="cb13-16"><a href="#cb13-16"></a><span class="co">#&gt;                               141                                48 </span></span>
<span id="cb13-17"><a href="#cb13-17"></a><span class="co">#&gt; 50-59 yearsFemaleNot too stressed         50-59 yearsFemalestressed </span></span>
<span id="cb13-18"><a href="#cb13-18"></a><span class="co">#&gt;                                72                                29 </span></span>
<span id="cb13-19"><a href="#cb13-19"></a><span class="co">#&gt;   50-59 yearsMaleNot too stressed           50-59 yearsMalestressed </span></span>
<span id="cb13-20"><a href="#cb13-20"></a><span class="co">#&gt;                                78                                29 </span></span>
<span id="cb13-21"><a href="#cb13-21"></a><span class="co">#&gt; 60-64 yearsFemaleNot too stressed         60-64 yearsFemalestressed </span></span>
<span id="cb13-22"><a href="#cb13-22"></a><span class="co">#&gt;                                18                                 6 </span></span>
<span id="cb13-23"><a href="#cb13-23"></a><span class="co">#&gt;   60-64 yearsMaleNot too stressed           60-64 yearsMalestressed </span></span>
<span id="cb13-24"><a href="#cb13-24"></a><span class="co">#&gt;                                20                                 4</span></span>
<span id="cb13-25"><a href="#cb13-25"></a><span class="fu">length</span>(<span class="fu">table</span>(var.comb))</span>
<span id="cb13-26"><a href="#cb13-26"></a><span class="co">#&gt; [1] 20</span></span>
<span id="cb13-27"><a href="#cb13-27"></a><span class="fu">table</span>(var.comb,analytic11n<span class="sc">$</span>OA)</span>
<span id="cb13-28"><a href="#cb13-28"></a><span class="co">#&gt;                                    </span></span>
<span id="cb13-29"><a href="#cb13-29"></a><span class="co">#&gt; var.comb                              0   1</span></span>
<span id="cb13-30"><a href="#cb13-30"></a><span class="co">#&gt;   20-29 yearsFemaleNot too stressed 156   1</span></span>
<span id="cb13-31"><a href="#cb13-31"></a><span class="co">#&gt;   20-29 yearsFemalestressed          27   0</span></span>
<span id="cb13-32"><a href="#cb13-32"></a><span class="co">#&gt;   20-29 yearsMaleNot too stressed   144   3</span></span>
<span id="cb13-33"><a href="#cb13-33"></a><span class="co">#&gt;   20-29 yearsMalestressed            18   0</span></span>
<span id="cb13-34"><a href="#cb13-34"></a><span class="co">#&gt;   30-39 yearsFemaleNot too stressed 168   2</span></span>
<span id="cb13-35"><a href="#cb13-35"></a><span class="co">#&gt;   30-39 yearsFemalestressed          49   1</span></span>
<span id="cb13-36"><a href="#cb13-36"></a><span class="co">#&gt;   30-39 yearsMaleNot too stressed   178   5</span></span>
<span id="cb13-37"><a href="#cb13-37"></a><span class="co">#&gt;   30-39 yearsMalestressed            37   3</span></span>
<span id="cb13-38"><a href="#cb13-38"></a><span class="co">#&gt;   40-49 yearsFemaleNot too stressed 130  12</span></span>
<span id="cb13-39"><a href="#cb13-39"></a><span class="co">#&gt;   40-49 yearsFemalestressed          42   3</span></span>
<span id="cb13-40"><a href="#cb13-40"></a><span class="co">#&gt;   40-49 yearsMaleNot too stressed   138   3</span></span>
<span id="cb13-41"><a href="#cb13-41"></a><span class="co">#&gt;   40-49 yearsMalestressed            48   0</span></span>
<span id="cb13-42"><a href="#cb13-42"></a><span class="co">#&gt;   50-59 yearsFemaleNot too stressed  65   7</span></span>
<span id="cb13-43"><a href="#cb13-43"></a><span class="co">#&gt;   50-59 yearsFemalestressed          22   7</span></span>
<span id="cb13-44"><a href="#cb13-44"></a><span class="co">#&gt;   50-59 yearsMaleNot too stressed    67  11</span></span>
<span id="cb13-45"><a href="#cb13-45"></a><span class="co">#&gt;   50-59 yearsMalestressed            23   6</span></span>
<span id="cb13-46"><a href="#cb13-46"></a><span class="co">#&gt;   60-64 yearsFemaleNot too stressed  17   1</span></span>
<span id="cb13-47"><a href="#cb13-47"></a><span class="co">#&gt;   60-64 yearsFemalestressed           5   1</span></span>
<span id="cb13-48"><a href="#cb13-48"></a><span class="co">#&gt;   60-64 yearsMaleNot too stressed    19   1</span></span>
<span id="cb13-49"><a href="#cb13-49"></a><span class="co">#&gt;   60-64 yearsMalestressed             4   0</span></span>
<span id="cb13-50"><a href="#cb13-50"></a>match.formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="st">"OA ~ age + sex + stress"</span>)</span>
<span id="cb13-51"><a href="#cb13-51"></a>matching.obj <span class="ot">&lt;-</span> <span class="fu">matchit</span>(match.formula,</span>
<span id="cb13-52"><a href="#cb13-52"></a>                        <span class="at">data =</span> analytic11n,</span>
<span id="cb13-53"><a href="#cb13-53"></a>                        <span class="at">method =</span> <span class="st">"exact"</span>)</span>
<span id="cb13-54"><a href="#cb13-54"></a>matching.obj</span>
<span id="cb13-55"><a href="#cb13-55"></a><span class="co">#&gt; A matchit object</span></span>
<span id="cb13-56"><a href="#cb13-56"></a><span class="co">#&gt;  - method: Exact matching</span></span>
<span id="cb13-57"><a href="#cb13-57"></a><span class="co">#&gt;  - number of obs.: 1424 (original), 1327 (matched)</span></span>
<span id="cb13-58"><a href="#cb13-58"></a><span class="co">#&gt;  - target estimand: ATT</span></span>
<span id="cb13-59"><a href="#cb13-59"></a><span class="co">#&gt;  - covariates: age, sex, stress</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="matching-by-4-matching-variables" class="level4"><h4 class="anchored" data-anchor-id="matching-by-4-matching-variables">Matching by 4 matching variables</h4>
<p>The process of matching by 4 variables involves creating combinations of the 4 variables, exploring their distributions, and performing exact matching.</p>
<div class="cell" data-hash="propensityscore1_cache/html/match4_b9f24e58776f9503b5d1c09ef78fba25">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>var.comb <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">'paste0'</span>, </span>
<span id="cb14-2"><a href="#cb14-2"></a>                    analytic11n[, <span class="fu">c</span>(<span class="st">'age'</span>, <span class="st">'sex'</span>,</span>
<span id="cb14-3"><a href="#cb14-3"></a>                                    <span class="st">'stress'</span>,<span class="st">'income'</span>)])</span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="co">#table(var.comb)</span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="fu">length</span>(<span class="fu">table</span>(var.comb))</span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="co">#&gt; [1] 76</span></span>
<span id="cb14-7"><a href="#cb14-7"></a>match.formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="st">"OA ~ age + sex + stress + income"</span>)</span>
<span id="cb14-8"><a href="#cb14-8"></a>matching.obj <span class="ot">&lt;-</span> <span class="fu">matchit</span>(match.formula,</span>
<span id="cb14-9"><a href="#cb14-9"></a>                        <span class="at">data =</span> analytic11n,</span>
<span id="cb14-10"><a href="#cb14-10"></a>                        <span class="at">method =</span> <span class="st">"exact"</span>)</span>
<span id="cb14-11"><a href="#cb14-11"></a>matching.obj</span>
<span id="cb14-12"><a href="#cb14-12"></a><span class="co">#&gt; A matchit object</span></span>
<span id="cb14-13"><a href="#cb14-13"></a><span class="co">#&gt;  - method: Exact matching</span></span>
<span id="cb14-14"><a href="#cb14-14"></a><span class="co">#&gt;  - number of obs.: 1424 (original), 900 (matched)</span></span>
<span id="cb14-15"><a href="#cb14-15"></a><span class="co">#&gt;  - target estimand: ATT</span></span>
<span id="cb14-16"><a href="#cb14-16"></a><span class="co">#&gt;  - covariates: age, sex, stress, income</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="matching-by-5-matching-variables" class="level4"><h4 class="anchored" data-anchor-id="matching-by-5-matching-variables">Matching by 5 matching variables</h4>
<div class="cell" data-hash="propensityscore1_cache/html/match5_ee290ef054223049251f5e5c54764bc1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>var.comb <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">'paste0'</span>, </span>
<span id="cb15-2"><a href="#cb15-2"></a>                    analytic11n[, <span class="fu">c</span>(<span class="st">'age'</span>, <span class="st">'sex'</span>,</span>
<span id="cb15-3"><a href="#cb15-3"></a>                                    <span class="st">'stress'</span>,<span class="st">'income'</span>,<span class="st">'race'</span>)])</span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="fu">length</span>(<span class="fu">table</span>(var.comb))</span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="co">#&gt; [1] 146</span></span>
<span id="cb15-6"><a href="#cb15-6"></a>match.formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="st">"OA ~ age + sex + stress + income + race"</span>)</span>
<span id="cb15-7"><a href="#cb15-7"></a>matching.obj <span class="ot">&lt;-</span> <span class="fu">matchit</span>(match.formula,</span>
<span id="cb15-8"><a href="#cb15-8"></a>                        <span class="at">data =</span> analytic11n,</span>
<span id="cb15-9"><a href="#cb15-9"></a>                        <span class="at">method =</span> <span class="st">"exact"</span>)</span>
<span id="cb15-10"><a href="#cb15-10"></a>matching.obj</span>
<span id="cb15-11"><a href="#cb15-11"></a><span class="co">#&gt; A matchit object</span></span>
<span id="cb15-12"><a href="#cb15-12"></a><span class="co">#&gt;  - method: Exact matching</span></span>
<span id="cb15-13"><a href="#cb15-13"></a><span class="co">#&gt;  - number of obs.: 1424 (original), 616 (matched)</span></span>
<span id="cb15-14"><a href="#cb15-14"></a><span class="co">#&gt;  - target estimand: ATT</span></span>
<span id="cb15-15"><a href="#cb15-15"></a><span class="co">#&gt;  - covariates: age, sex, stress, income, race</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="matching-by-6-matching-variables" class="level4"><h4 class="anchored" data-anchor-id="matching-by-6-matching-variables">Matching by 6 matching variables</h4>
<div class="cell" data-hash="propensityscore1_cache/html/match6_1cb51e3c7d3671cb8e83ffa7cd05f66d">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>var.comb <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">'paste0'</span>, </span>
<span id="cb16-2"><a href="#cb16-2"></a>                    analytic11n[, <span class="fu">c</span>(<span class="st">'age'</span>, <span class="st">'sex'</span>,</span>
<span id="cb16-3"><a href="#cb16-3"></a>                                    <span class="st">'stress'</span>,<span class="st">'income'</span>,<span class="st">'race'</span>,<span class="st">'edu'</span>)])</span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="fu">length</span>(<span class="fu">table</span>(var.comb))</span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="co">#&gt; [1] 354</span></span>
<span id="cb16-6"><a href="#cb16-6"></a>match.formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="st">"OA ~ age + sex + stress + income + race + edu"</span>)</span>
<span id="cb16-7"><a href="#cb16-7"></a>matching.obj <span class="ot">&lt;-</span> <span class="fu">matchit</span>(match.formula,</span>
<span id="cb16-8"><a href="#cb16-8"></a>                        <span class="at">data =</span> analytic11n,</span>
<span id="cb16-9"><a href="#cb16-9"></a>                        <span class="at">method =</span> <span class="st">"exact"</span>)</span>
<span id="cb16-10"><a href="#cb16-10"></a>matching.obj</span>
<span id="cb16-11"><a href="#cb16-11"></a><span class="co">#&gt; A matchit object</span></span>
<span id="cb16-12"><a href="#cb16-12"></a><span class="co">#&gt;  - method: Exact matching</span></span>
<span id="cb16-13"><a href="#cb16-13"></a><span class="co">#&gt;  - number of obs.: 1424 (original), 399 (matched)</span></span>
<span id="cb16-14"><a href="#cb16-14"></a><span class="co">#&gt;  - target estimand: ATT</span></span>
<span id="cb16-15"><a href="#cb16-15"></a><span class="co">#&gt;  - covariates: age, sex, stress, income, race, edu</span></span>
<span id="cb16-16"><a href="#cb16-16"></a>OACVD.match<span class="fl">.11</span>n <span class="ot">&lt;-</span> <span class="fu">match.data</span>(matching.obj)</span>
<span id="cb16-17"><a href="#cb16-17"></a>var.names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"stress"</span>, <span class="st">"income"</span>, <span class="st">"race"</span>, <span class="st">"edu"</span>)</span>
<span id="cb16-18"><a href="#cb16-18"></a>tab1 <span class="ot">&lt;-</span> <span class="fu">CreateCatTable</span>(<span class="at">var =</span> var.names, <span class="at">strata=</span> <span class="st">"OA"</span>, <span class="at">data=</span>OACVD.match<span class="fl">.11</span>n,<span class="at">test=</span><span class="cn">FALSE</span>)</span>
<span id="cb16-19"><a href="#cb16-19"></a><span class="fu">print</span>(tab1, <span class="at">smd =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-20"><a href="#cb16-20"></a><span class="co">#&gt;                        Stratified by OA</span></span>
<span id="cb16-21"><a href="#cb16-21"></a><span class="co">#&gt;                         0           1          SMD   </span></span>
<span id="cb16-22"><a href="#cb16-22"></a><span class="co">#&gt;   n                     337         62               </span></span>
<span id="cb16-23"><a href="#cb16-23"></a><span class="co">#&gt;   age (%)                                       0.565</span></span>
<span id="cb16-24"><a href="#cb16-24"></a><span class="co">#&gt;      20-29 years         63 (18.7)   4 ( 6.5)        </span></span>
<span id="cb16-25"><a href="#cb16-25"></a><span class="co">#&gt;      30-39 years         61 (18.1)  11 (17.7)        </span></span>
<span id="cb16-26"><a href="#cb16-26"></a><span class="co">#&gt;      40-49 years        127 (37.7)  17 (27.4)        </span></span>
<span id="cb16-27"><a href="#cb16-27"></a><span class="co">#&gt;      50-59 years         82 (24.3)  28 (45.2)        </span></span>
<span id="cb16-28"><a href="#cb16-28"></a><span class="co">#&gt;      60-64 years          4 ( 1.2)   2 ( 3.2)        </span></span>
<span id="cb16-29"><a href="#cb16-29"></a><span class="co">#&gt;      65 years and over    0 ( 0.0)   0 ( 0.0)        </span></span>
<span id="cb16-30"><a href="#cb16-30"></a><span class="co">#&gt;      teen                 0 ( 0.0)   0 ( 0.0)        </span></span>
<span id="cb16-31"><a href="#cb16-31"></a><span class="co">#&gt;   sex = Male (%)        211 (62.6)  29 (46.8)   0.322</span></span>
<span id="cb16-32"><a href="#cb16-32"></a><span class="co">#&gt;   stress = stressed (%)  42 (12.5)  17 (27.4)   0.381</span></span>
<span id="cb16-33"><a href="#cb16-33"></a><span class="co">#&gt;   income (%)                                    0.115</span></span>
<span id="cb16-34"><a href="#cb16-34"></a><span class="co">#&gt;      $29,999 or less     69 (20.5)  11 (17.7)        </span></span>
<span id="cb16-35"><a href="#cb16-35"></a><span class="co">#&gt;      $30,000-$49,999     57 (16.9)  13 (21.0)        </span></span>
<span id="cb16-36"><a href="#cb16-36"></a><span class="co">#&gt;      $50,000-$79,999     69 (20.5)  12 (19.4)        </span></span>
<span id="cb16-37"><a href="#cb16-37"></a><span class="co">#&gt;      $80,000 or more    142 (42.1)  26 (41.9)        </span></span>
<span id="cb16-38"><a href="#cb16-38"></a><span class="co">#&gt;   race = White (%)      242 (71.8)  43 (69.4)   0.054</span></span>
<span id="cb16-39"><a href="#cb16-39"></a><span class="co">#&gt;   edu (%)                                       0.146</span></span>
<span id="cb16-40"><a href="#cb16-40"></a><span class="co">#&gt;      &lt; 2ndary            73 (21.7)  11 (17.7)        </span></span>
<span id="cb16-41"><a href="#cb16-41"></a><span class="co">#&gt;      2nd grad.            5 ( 1.5)   2 ( 3.2)        </span></span>
<span id="cb16-42"><a href="#cb16-42"></a><span class="co">#&gt;      Other 2nd grad.      0 ( 0.0)   0 ( 0.0)        </span></span>
<span id="cb16-43"><a href="#cb16-43"></a><span class="co">#&gt;      Post-2nd grad.     259 (76.9)  49 (79.0)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="treatment-effect-1" class="level3"><h3 class="anchored" data-anchor-id="treatment-effect-1">Treatment effect</h3>
<section id="convert-data-to-design" class="level4"><h4 class="anchored" data-anchor-id="convert-data-to-design">Convert data to design</h4>
<p>In the following code chunk, we create a new variable matched in the <code>analytic.miss</code> dataset to indicate whether an observation was included in the matched dataset <code>OACVD.match.11n</code>. We then create a new survey design object <code>w.design.m</code> that includes only the matched observations for subsequent analyses.</p>
<div class="cell" data-hash="propensityscore1_cache/html/tx2_e66e2866179c5cc37d58b3a27f27f67a">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>analytic.miss<span class="sc">$</span>matched <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="fu">length</span>(analytic.miss<span class="sc">$</span>ID) <span class="co"># full data</span></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="co">#&gt; [1] 397173</span></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="fu">length</span>(OACVD.match<span class="fl">.11</span>n<span class="sc">$</span>ID) <span class="co"># matched data</span></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="co">#&gt; [1] 399</span></span>
<span id="cb17-6"><a href="#cb17-6"></a><span class="fu">length</span>(analytic.miss<span class="sc">$</span>ID[analytic.miss<span class="sc">$</span>ID <span class="sc">%in%</span> OACVD.match<span class="fl">.11</span>n<span class="sc">$</span>ID])</span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="co">#&gt; [1] 399</span></span>
<span id="cb17-8"><a href="#cb17-8"></a>analytic.miss<span class="sc">$</span>matched[analytic.miss<span class="sc">$</span>ID <span class="sc">%in%</span> OACVD.match<span class="fl">.11</span>n<span class="sc">$</span>ID] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb17-9"><a href="#cb17-9"></a><span class="fu">table</span>(analytic.miss<span class="sc">$</span>matched)</span>
<span id="cb17-10"><a href="#cb17-10"></a><span class="co">#&gt; </span></span>
<span id="cb17-11"><a href="#cb17-11"></a><span class="co">#&gt;      0      1 </span></span>
<span id="cb17-12"><a href="#cb17-12"></a><span class="co">#&gt; 396774    399</span></span>
<span id="cb17-13"><a href="#cb17-13"></a>w.design0 <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">id=</span><span class="sc">~</span><span class="dv">1</span>, <span class="at">weights=</span><span class="sc">~</span>weight, </span>
<span id="cb17-14"><a href="#cb17-14"></a>                      <span class="at">data=</span>analytic.miss)</span>
<span id="cb17-15"><a href="#cb17-15"></a>w.design.m <span class="ot">&lt;-</span> <span class="fu">subset</span>(w.design0, matched <span class="sc">==</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="outcome-analysis" class="level4"><h4 class="anchored" data-anchor-id="outcome-analysis">Outcome analysis</h4>
<p>The subsequent code chunks involve fitting logistic regression models to estimate the treatment effect, both in a crude and adjusted manner, respectively. The models are fitted using the matched survey design object and the results are displayed in a readable format.</p>
<section id="crude" class="level5"><h5 class="anchored" data-anchor-id="crude">Crude</h5>
<div class="cell" data-hash="propensityscore1_cache/html/est2_9fa4571e2fb6e48eba2982d4761bfde4">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>fit.outcome <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(<span class="fu">I</span>(CVD<span class="sc">==</span><span class="st">"event"</span>) <span class="sc">~</span> OA,</span>
<span id="cb18-2"><a href="#cb18-2"></a>                   <span class="at">design =</span> w.design.m,</span>
<span id="cb18-3"><a href="#cb18-3"></a>                   <span class="at">family =</span> <span class="fu">binomial</span>(logit))</span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="co">#&gt; Warning in eval(family$initialize): non-integer #successes in a binomial glm!</span></span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="fu">publish</span>(fit.outcome)</span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="co">#&gt;  Variable Units OddsRatio        CI.95  p-value </span></span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="co">#&gt;        OA            3.14 [0.80;12.40]   0.1025</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="adjusted" class="level5"><h5 class="anchored" data-anchor-id="adjusted">Adjusted</h5>
<div class="cell" data-hash="propensityscore1_cache/html/est3_5b255853590977a332345bb51961efb3">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>fit.outcome <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(<span class="fu">I</span>(CVD<span class="sc">==</span><span class="st">"event"</span>) <span class="sc">~</span> OA <span class="sc">+</span> </span>
<span id="cb19-2"><a href="#cb19-2"></a>                        age <span class="sc">+</span> sex <span class="sc">+</span> stress <span class="sc">+</span> income <span class="sc">+</span> race <span class="sc">+</span> edu,</span>
<span id="cb19-3"><a href="#cb19-3"></a>                   <span class="at">design =</span> w.design.m,</span>
<span id="cb19-4"><a href="#cb19-4"></a>                   <span class="at">family =</span> <span class="fu">binomial</span>(logit))</span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="co">#&gt; Warning in eval(family$initialize): non-integer #successes in a binomial glm!</span></span>
<span id="cb19-6"><a href="#cb19-6"></a><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="fu">publish</span>(fit.outcome)</span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="co">#&gt;  Variable            Units    OddsRatio                        CI.95   p-value </span></span>
<span id="cb19-9"><a href="#cb19-9"></a><span class="co">#&gt;        OA                          2.04                 [0.34;12.16]   0.43593 </span></span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="co">#&gt;       age      20-29 years          Ref                                        </span></span>
<span id="cb19-11"><a href="#cb19-11"></a><span class="co">#&gt;                30-39 years         0.54                  [0.08;3.51]   0.51962 </span></span>
<span id="cb19-12"><a href="#cb19-12"></a><span class="co">#&gt;                40-49 years  30148597.83    [7758796.64;117149345.85]   &lt; 1e-04 </span></span>
<span id="cb19-13"><a href="#cb19-13"></a><span class="co">#&gt;                50-59 years  63290825.92   [12589874.04;318170669.03]   &lt; 1e-04 </span></span>
<span id="cb19-14"><a href="#cb19-14"></a><span class="co">#&gt;                60-64 years         0.31                  [0.01;9.33]   0.49735 </span></span>
<span id="cb19-15"><a href="#cb19-15"></a><span class="co">#&gt;       sex           Female          Ref                                        </span></span>
<span id="cb19-16"><a href="#cb19-16"></a><span class="co">#&gt;                       Male         1.58                  [0.29;8.62]   0.59729 </span></span>
<span id="cb19-17"><a href="#cb19-17"></a><span class="co">#&gt;    stress Not too stressed          Ref                                        </span></span>
<span id="cb19-18"><a href="#cb19-18"></a><span class="co">#&gt;                   stressed         0.15                  [0.01;1.80]   0.13666 </span></span>
<span id="cb19-19"><a href="#cb19-19"></a><span class="co">#&gt;    income  $29,999 or less          Ref                                        </span></span>
<span id="cb19-20"><a href="#cb19-20"></a><span class="co">#&gt;            $30,000-$49,999         0.20                  [0.01;3.84]   0.28640 </span></span>
<span id="cb19-21"><a href="#cb19-21"></a><span class="co">#&gt;            $50,000-$79,999         0.20                  [0.02;1.95]   0.16543 </span></span>
<span id="cb19-22"><a href="#cb19-22"></a><span class="co">#&gt;            $80,000 or more         0.08                  [0.01;0.68]   0.02122 </span></span>
<span id="cb19-23"><a href="#cb19-23"></a><span class="co">#&gt;      race        Non-white          Ref                                        </span></span>
<span id="cb19-24"><a href="#cb19-24"></a><span class="co">#&gt;                      White         1.02                  [0.11;9.45]   0.98723 </span></span>
<span id="cb19-25"><a href="#cb19-25"></a><span class="co">#&gt;       edu         &lt; 2ndary          Ref                                        </span></span>
<span id="cb19-26"><a href="#cb19-26"></a><span class="co">#&gt;                  2nd grad. 845233463.16 [44642866.24;16002995941.97]   &lt; 1e-04 </span></span>
<span id="cb19-27"><a href="#cb19-27"></a><span class="co">#&gt;             Post-2nd grad.  69867459.11    [9660580.05;505296971.72]   &lt; 1e-04</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="questions-for-the-students" class="level4"><h4 class="anchored" data-anchor-id="questions-for-the-students">Questions for the students</h4>
<ul>
<li>Look at all the ORs. Some of them are VERY high. Why?</li>
<li>Look at the CI in the above table. Some of them are Inf. Why?</li>
<li>Should we match matching variables in the regression?</li>
</ul></section></section><section id="matching-by-a-lot-of-variables" class="level3"><h3 class="anchored" data-anchor-id="matching-by-a-lot-of-variables">Matching by a lot of variables</h3>
<p>The code chunks involve performing matching using a large number of variables and estimating the treatment effect using the matched data. The process involves creating matched datasets, converting them to survey design objects, and fitting logistic regression models.</p>
<section id="matching-part-in-data" class="level4"><h4 class="anchored" data-anchor-id="matching-part-in-data">Matching part in data</h4>
<div class="cell" data-hash="propensityscore1_cache/html/match10_5305d71ad4fea66ec0da9e3e01112663">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>match.formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="st">"OA ~ age + sex + stress + married + </span></span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="st">                         income + race + bmi + phyact + smoke +</span></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="st">                         immigrate + fruit + diab + edu"</span>)</span>
<span id="cb20-4"><a href="#cb20-4"></a>matching.obj2 <span class="ot">&lt;-</span> <span class="fu">matchit</span>(match.formula,</span>
<span id="cb20-5"><a href="#cb20-5"></a>                        <span class="at">data =</span> analytic11n,</span>
<span id="cb20-6"><a href="#cb20-6"></a>                        <span class="at">method =</span> <span class="st">"exact"</span>)</span>
<span id="cb20-7"><a href="#cb20-7"></a>matching.obj2</span>
<span id="cb20-8"><a href="#cb20-8"></a><span class="co">#&gt; A matchit object</span></span>
<span id="cb20-9"><a href="#cb20-9"></a><span class="co">#&gt;  - method: Exact matching</span></span>
<span id="cb20-10"><a href="#cb20-10"></a><span class="co">#&gt;  - number of obs.: 1424 (original), 22 (matched)</span></span>
<span id="cb20-11"><a href="#cb20-11"></a><span class="co">#&gt;  - target estimand: ATT</span></span>
<span id="cb20-12"><a href="#cb20-12"></a><span class="co">#&gt;  - covariates: age, sex, stress, married, income, race, bmi, phyact, smoke, immigrate, fruit, diab, edu</span></span>
<span id="cb20-13"><a href="#cb20-13"></a>OACVD.match<span class="fl">.11</span>n2 <span class="ot">&lt;-</span> <span class="fu">match.data</span>(matching.obj2)</span>
<span id="cb20-14"><a href="#cb20-14"></a>var.names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"stress"</span>, <span class="st">"married"</span>, <span class="st">"income"</span>, <span class="st">"race"</span>, </span>
<span id="cb20-15"><a href="#cb20-15"></a>               <span class="st">"bmi"</span>, <span class="st">"phyact"</span>, <span class="st">"smoke"</span>, <span class="st">"immigrate"</span>, <span class="st">"fruit"</span>, <span class="st">"diab"</span>, <span class="st">"edu"</span>)</span>
<span id="cb20-16"><a href="#cb20-16"></a>tab2 <span class="ot">&lt;-</span> <span class="fu">CreateCatTable</span>(<span class="at">var =</span> var.names, <span class="at">strata=</span> <span class="st">"OA"</span>, <span class="at">data=</span>OACVD.match<span class="fl">.11</span>n2,<span class="at">test=</span><span class="cn">FALSE</span>)</span>
<span id="cb20-17"><a href="#cb20-17"></a><span class="fu">print</span>(tab2, <span class="at">smd =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-18"><a href="#cb20-18"></a><span class="co">#&gt;                        Stratified by OA</span></span>
<span id="cb20-19"><a href="#cb20-19"></a><span class="co">#&gt;                         0          1          SMD   </span></span>
<span id="cb20-20"><a href="#cb20-20"></a><span class="co">#&gt;   n                     11         11               </span></span>
<span id="cb20-21"><a href="#cb20-21"></a><span class="co">#&gt;   age (%)                                     &lt;0.001</span></span>
<span id="cb20-22"><a href="#cb20-22"></a><span class="co">#&gt;      20-29 years         3 (27.3)   3 (27.3)        </span></span>
<span id="cb20-23"><a href="#cb20-23"></a><span class="co">#&gt;      30-39 years         1 ( 9.1)   1 ( 9.1)        </span></span>
<span id="cb20-24"><a href="#cb20-24"></a><span class="co">#&gt;      40-49 years         4 (36.4)   4 (36.4)        </span></span>
<span id="cb20-25"><a href="#cb20-25"></a><span class="co">#&gt;      50-59 years         3 (27.3)   3 (27.3)        </span></span>
<span id="cb20-26"><a href="#cb20-26"></a><span class="co">#&gt;      60-64 years         0 ( 0.0)   0 ( 0.0)        </span></span>
<span id="cb20-27"><a href="#cb20-27"></a><span class="co">#&gt;      65 years and over   0 ( 0.0)   0 ( 0.0)        </span></span>
<span id="cb20-28"><a href="#cb20-28"></a><span class="co">#&gt;      teen                0 ( 0.0)   0 ( 0.0)        </span></span>
<span id="cb20-29"><a href="#cb20-29"></a><span class="co">#&gt;   sex = Male (%)         6 (54.5)   6 (54.5)  &lt;0.001</span></span>
<span id="cb20-30"><a href="#cb20-30"></a><span class="co">#&gt;   stress = stressed (%)  1 ( 9.1)   1 ( 9.1)  &lt;0.001</span></span>
<span id="cb20-31"><a href="#cb20-31"></a><span class="co">#&gt;   married = single (%)   3 (27.3)   3 (27.3)  &lt;0.001</span></span>
<span id="cb20-32"><a href="#cb20-32"></a><span class="co">#&gt;   income (%)                                  &lt;0.001</span></span>
<span id="cb20-33"><a href="#cb20-33"></a><span class="co">#&gt;      $29,999 or less     1 ( 9.1)   1 ( 9.1)        </span></span>
<span id="cb20-34"><a href="#cb20-34"></a><span class="co">#&gt;      $30,000-$49,999     2 (18.2)   2 (18.2)        </span></span>
<span id="cb20-35"><a href="#cb20-35"></a><span class="co">#&gt;      $50,000-$79,999     2 (18.2)   2 (18.2)        </span></span>
<span id="cb20-36"><a href="#cb20-36"></a><span class="co">#&gt;      $80,000 or more     6 (54.5)   6 (54.5)        </span></span>
<span id="cb20-37"><a href="#cb20-37"></a><span class="co">#&gt;   race = White (%)      10 (90.9)  10 (90.9)  &lt;0.001</span></span>
<span id="cb20-38"><a href="#cb20-38"></a><span class="co">#&gt;   bmi (%)                                     &lt;0.001</span></span>
<span id="cb20-39"><a href="#cb20-39"></a><span class="co">#&gt;      Underweight         0 ( 0.0)   0 ( 0.0)        </span></span>
<span id="cb20-40"><a href="#cb20-40"></a><span class="co">#&gt;      healthy weight      4 (36.4)   4 (36.4)        </span></span>
<span id="cb20-41"><a href="#cb20-41"></a><span class="co">#&gt;      Overweight          7 (63.6)   7 (63.6)        </span></span>
<span id="cb20-42"><a href="#cb20-42"></a><span class="co">#&gt;   phyact (%)                                  &lt;0.001</span></span>
<span id="cb20-43"><a href="#cb20-43"></a><span class="co">#&gt;      Active              3 (27.3)   3 (27.3)        </span></span>
<span id="cb20-44"><a href="#cb20-44"></a><span class="co">#&gt;      Inactive            5 (45.5)   5 (45.5)        </span></span>
<span id="cb20-45"><a href="#cb20-45"></a><span class="co">#&gt;      Moderate            3 (27.3)   3 (27.3)        </span></span>
<span id="cb20-46"><a href="#cb20-46"></a><span class="co">#&gt;   smoke (%)                                   &lt;0.001</span></span>
<span id="cb20-47"><a href="#cb20-47"></a><span class="co">#&gt;      Never smoker        3 (27.3)   3 (27.3)        </span></span>
<span id="cb20-48"><a href="#cb20-48"></a><span class="co">#&gt;      Current smoker      2 (18.2)   2 (18.2)        </span></span>
<span id="cb20-49"><a href="#cb20-49"></a><span class="co">#&gt;      Former smoker       6 (54.5)   6 (54.5)        </span></span>
<span id="cb20-50"><a href="#cb20-50"></a><span class="co">#&gt;   immigrate (%)                               &lt;0.001</span></span>
<span id="cb20-51"><a href="#cb20-51"></a><span class="co">#&gt;      not immigrant      10 (90.9)  10 (90.9)        </span></span>
<span id="cb20-52"><a href="#cb20-52"></a><span class="co">#&gt;      &gt; 10 years          1 ( 9.1)   1 ( 9.1)        </span></span>
<span id="cb20-53"><a href="#cb20-53"></a><span class="co">#&gt;      recent              0 ( 0.0)   0 ( 0.0)        </span></span>
<span id="cb20-54"><a href="#cb20-54"></a><span class="co">#&gt;   fruit (%)                                   &lt;0.001</span></span>
<span id="cb20-55"><a href="#cb20-55"></a><span class="co">#&gt;      0-3 daily serving   3 (27.3)   3 (27.3)        </span></span>
<span id="cb20-56"><a href="#cb20-56"></a><span class="co">#&gt;      4-6 daily serving   6 (54.5)   6 (54.5)        </span></span>
<span id="cb20-57"><a href="#cb20-57"></a><span class="co">#&gt;      6+ daily serving    2 (18.2)   2 (18.2)        </span></span>
<span id="cb20-58"><a href="#cb20-58"></a><span class="co">#&gt;   diab = Yes (%)         0 ( 0.0)   0 ( 0.0)  &lt;0.001</span></span>
<span id="cb20-59"><a href="#cb20-59"></a><span class="co">#&gt;   edu (%)                                     &lt;0.001</span></span>
<span id="cb20-60"><a href="#cb20-60"></a><span class="co">#&gt;      &lt; 2ndary            1 ( 9.1)   1 ( 9.1)        </span></span>
<span id="cb20-61"><a href="#cb20-61"></a><span class="co">#&gt;      2nd grad.           0 ( 0.0)   0 ( 0.0)        </span></span>
<span id="cb20-62"><a href="#cb20-62"></a><span class="co">#&gt;      Other 2nd grad.     0 ( 0.0)   0 ( 0.0)        </span></span>
<span id="cb20-63"><a href="#cb20-63"></a><span class="co">#&gt;      Post-2nd grad.     10 (90.9)  10 (90.9)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="treatment-effect-estimation-in-design" class="level4"><h4 class="anchored" data-anchor-id="treatment-effect-estimation-in-design">Treatment effect estimation in design</h4>
<section id="create-design" class="level5"><h5 class="anchored" data-anchor-id="create-design">Create design</h5>
<div class="cell" data-hash="propensityscore1_cache/html/match11_cd2b5e4f583e3bff5366435e716794e1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>analytic.miss<span class="sc">$</span>matched2 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="fu">length</span>(analytic.miss<span class="sc">$</span>ID) <span class="co"># full data</span></span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="co">#&gt; [1] 397173</span></span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="fu">length</span>(OACVD.match<span class="fl">.11</span>n2<span class="sc">$</span>ID) <span class="co"># matched data</span></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="co">#&gt; [1] 22</span></span>
<span id="cb21-6"><a href="#cb21-6"></a><span class="fu">length</span>(analytic.miss<span class="sc">$</span>ID[analytic.miss<span class="sc">$</span>ID <span class="sc">%in%</span> OACVD.match<span class="fl">.11</span>n2<span class="sc">$</span>ID])</span>
<span id="cb21-7"><a href="#cb21-7"></a><span class="co">#&gt; [1] 22</span></span>
<span id="cb21-8"><a href="#cb21-8"></a>analytic.miss<span class="sc">$</span>matched2[analytic.miss<span class="sc">$</span>ID <span class="sc">%in%</span> OACVD.match<span class="fl">.11</span>n2<span class="sc">$</span>ID] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb21-9"><a href="#cb21-9"></a><span class="fu">table</span>(analytic.miss<span class="sc">$</span>matched2)</span>
<span id="cb21-10"><a href="#cb21-10"></a><span class="co">#&gt; </span></span>
<span id="cb21-11"><a href="#cb21-11"></a><span class="co">#&gt;      0      1 </span></span>
<span id="cb21-12"><a href="#cb21-12"></a><span class="co">#&gt; 397151     22</span></span>
<span id="cb21-13"><a href="#cb21-13"></a>w.design0 <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">id=</span><span class="sc">~</span><span class="dv">1</span>, <span class="at">weights=</span><span class="sc">~</span>weight, </span>
<span id="cb21-14"><a href="#cb21-14"></a>                      <span class="at">data=</span>analytic.miss)</span>
<span id="cb21-15"><a href="#cb21-15"></a>w.design.m2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(w.design0, matched2 <span class="sc">==</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="outcome-analysis-1" class="level5"><h5 class="anchored" data-anchor-id="outcome-analysis-1">outcome analysis</h5>
<div class="cell" data-hash="propensityscore1_cache/html/match12_592ee9ec86b4895657d4ab6696ddd2b5">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>fit.outcome <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(<span class="fu">I</span>(CVD<span class="sc">==</span><span class="st">"event"</span>) <span class="sc">~</span> OA <span class="sc">+</span> age <span class="sc">+</span> sex <span class="sc">+</span> stress <span class="sc">+</span> married <span class="sc">+</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>                         income <span class="sc">+</span> race <span class="sc">+</span> bmi <span class="sc">+</span> phyact <span class="sc">+</span> smoke <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3"></a>                         immigrate <span class="sc">+</span> fruit <span class="sc">+</span> diab <span class="sc">+</span> edu,</span>
<span id="cb22-4"><a href="#cb22-4"></a>                   <span class="at">design =</span> w.design.m2,</span>
<span id="cb22-5"><a href="#cb22-5"></a>                   <span class="at">family =</span> <span class="fu">binomial</span>(logit))</span>
<span id="cb22-6"><a href="#cb22-6"></a><span class="fu">publish</span>(fit.outcome)</span>
<span id="cb22-7"><a href="#cb22-7"></a><span class="co"># Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]) : </span></span>
<span id="cb22-8"><a href="#cb22-8"></a><span class="co">#   contrasts can be applied only to factors with 2 or more levels</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="questions-for-the-students-1" class="level5"><h5 class="anchored" data-anchor-id="questions-for-the-students-1">Questions for the students</h5>
<ul>
<li>Why the above model not fitting?</li>
</ul></section></section></section><section id="save-data-for-later-use" class="level3"><h3 class="anchored" data-anchor-id="save-data-for-later-use">Save data for later use</h3>
<div class="cell" data-hash="propensityscore1_cache/html/savedata_2325ed7e464d8f009a7dde30240d0b05">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="fu">save</span>(analytic11n, analytic2, analytic.miss, <span class="at">file=</span><span class="st">"Data/propensityscore/cchs123c.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="video-content-optional" class="level3"><h3 class="anchored" data-anchor-id="video-content-optional">Video content (optional)</h3>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>For those who prefer a video walkthrough, feel free to watch the video below, which offers a description of an earlier version of the above content.</p>
</div>
</div>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
<iframe src="https://www.youtube.com/embed/jC8g_n6RqK0" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen="">
</iframe>
</div>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./propensityscore0.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Concepts (S)</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./propensityscore2.html" class="pagination-link">
        <span class="nav-page-text">PSM in OA-CVD (CCHS)</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>