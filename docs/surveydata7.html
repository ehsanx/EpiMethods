<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>OER: Advanced Epidemiological Methods - NHANES: Cholesterol</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./surveydata8.html" rel="next">
<link href="./surveydata6.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-CVBPG0RQMY"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-CVBPG0RQMY', { 'anonymize_ip': true});
</script><link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<meta name="twitter:title" content="OER: Advanced Epidemiological Methods - NHANES: Cholesterol">
<meta name="twitter:description" content="Fit a linear regression, and report the VIFs.">
<meta name="twitter:card" content="summary">
</head>
<body class="nav-sidebar docked">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">NHANES: Cholesterol</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">OER: Advanced Epidemiological Methods</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle sidebar-tool" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">The Project</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./wrangling.html" class="sidebar-item-text sidebar-link">Data wrangling</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling1a.html" class="sidebar-item-text sidebar-link">R basics</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling1b.html" class="sidebar-item-text sidebar-link">Data types</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling1c.html" class="sidebar-item-text sidebar-link">Automating tasks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling2.html" class="sidebar-item-text sidebar-link">Importing dataset</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling3.html" class="sidebar-item-text sidebar-link">Data manipulation</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling4.html" class="sidebar-item-text sidebar-link">Import external data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling5.html" class="sidebar-item-text sidebar-link">Summary tables</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling6.html" class="sidebar-item-text sidebar-link">R Markdown</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wranglingF.html" class="sidebar-item-text sidebar-link">R Functions (W)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wranglingQ.html" class="sidebar-item-text sidebar-link">Quiz (W)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wranglingE.html" class="sidebar-item-text sidebar-link">Exercise (W)</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./accessing.html" class="sidebar-item-text sidebar-link">Data accessing</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessing1.html" class="sidebar-item-text sidebar-link">Survey data sources</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessing2.html" class="sidebar-item-text sidebar-link">Importing CCHS to R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessing3.html" class="sidebar-item-text sidebar-link">Importing NHANES to R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessing4.html" class="sidebar-item-text sidebar-link">Reproducing results</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessingF.html" class="sidebar-item-text sidebar-link">R Functions (A)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessingQ.html" class="sidebar-item-text sidebar-link">Quiz (A)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessingE.html" class="sidebar-item-text sidebar-link">Exercise (A)</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./researchquestion.html" class="sidebar-item-text sidebar-link">Research questions</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchquestion1.html" class="sidebar-item-text sidebar-link">Predictive question-1</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchquestion2a.html" class="sidebar-item-text sidebar-link">Predictive question-2a</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchquestion2b.html" class="sidebar-item-text sidebar-link">Predictive question-2b</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchquestion3.html" class="sidebar-item-text sidebar-link">Causal question-1</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchquestion4.html" class="sidebar-item-text sidebar-link">Causal question-2</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchquestionF.html" class="sidebar-item-text sidebar-link">R functions (Q)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchquestionQ.html" class="sidebar-item-text sidebar-link">Quiz (Q)</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./confounding.html" class="sidebar-item-text sidebar-link">Causal roles</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confounding1.html" class="sidebar-item-text sidebar-link">Confounding</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confounding2.html" class="sidebar-item-text sidebar-link">Mediator</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confounding3.html" class="sidebar-item-text sidebar-link">Collider</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confounding4.html" class="sidebar-item-text sidebar-link">Z-bias</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confounding5.html" class="sidebar-item-text sidebar-link">Collapsibility</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confounding6.html" class="sidebar-item-text sidebar-link">Change-in-estimate</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confoundingF.html" class="sidebar-item-text sidebar-link">R functions (R)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confoundingQ.html" class="sidebar-item-text sidebar-link">Quiz (R)</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./predictivefactors.html" class="sidebar-item-text sidebar-link">Prediction ideas</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactors1.html" class="sidebar-item-text sidebar-link">Collinear predictors</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactors2.html" class="sidebar-item-text sidebar-link">Continuous outcome</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactors3.html" class="sidebar-item-text sidebar-link">Binary outcome</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactors4.html" class="sidebar-item-text sidebar-link">Overfitting and performance</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactors5.html" class="sidebar-item-text sidebar-link">Data spliting</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactors6.html" class="sidebar-item-text sidebar-link">Cross-validation</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactors7.html" class="sidebar-item-text sidebar-link">Bootstrap</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactorsF.html" class="sidebar-item-text sidebar-link">R functions (P)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactorsQ.html" class="sidebar-item-text sidebar-link">Quiz (P)</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./surveydata.html" class="sidebar-item-text sidebar-link">Survey data analysis</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata1.html" class="sidebar-item-text sidebar-link">CCHS: Revisiting PICOT</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata2.html" class="sidebar-item-text sidebar-link">CCHS: Assessing data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata3.html" class="sidebar-item-text sidebar-link">CCHS: Bivariate analysis</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata4.html" class="sidebar-item-text sidebar-link">CCHS: Regression</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata5.html" class="sidebar-item-text sidebar-link">CCHS: Performance</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata6.html" class="sidebar-item-text sidebar-link">NHANES: Blood Pressure</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata7.html" class="sidebar-item-text sidebar-link active">NHANES: Cholesterol</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata8.html" class="sidebar-item-text sidebar-link">NHANES: Subsetting</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydataF.html" class="sidebar-item-text sidebar-link">R functions (D)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydataQ.html" class="sidebar-item-text sidebar-link">Quiz (D)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydataE.html" class="sidebar-item-text sidebar-link">Exercise (D)</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./missingdata.html" class="sidebar-item-text sidebar-link">Missing data analysis</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdata1.html" class="sidebar-item-text sidebar-link">Imputation</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdata2.html" class="sidebar-item-text sidebar-link">Imputation in NHANES</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdata3.html" class="sidebar-item-text sidebar-link">Missing in outcome</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdata4.html" class="sidebar-item-text sidebar-link">Performance with NA</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdata5.html" class="sidebar-item-text sidebar-link">Subpopulations</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdata6.html" class="sidebar-item-text sidebar-link">MCAR tests</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdata7.html" class="sidebar-item-text sidebar-link">Effect modification</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdataF.html" class="sidebar-item-text sidebar-link">R functions (M)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdataQ.html" class="sidebar-item-text sidebar-link">Quiz (M)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdataE.html" class="sidebar-item-text sidebar-link">Exercise (M)</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./propensityscore.html" class="sidebar-item-text sidebar-link">Propensity score</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscore1.html" class="sidebar-item-text sidebar-link">Exact Matching (CCHS)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscore2.html" class="sidebar-item-text sidebar-link">PSM in OA-CVD (CCHS)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscore3.html" class="sidebar-item-text sidebar-link">PSM in OA-CVD (US)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscore4.html" class="sidebar-item-text sidebar-link">PSM in BMI-diabetes</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscore5.html" class="sidebar-item-text sidebar-link">PSM with MI</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscoreF.html" class="sidebar-item-text sidebar-link">R functions (S)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscoreQ.html" class="sidebar-item-text sidebar-link">Quiz (S)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscoreE.html" class="sidebar-item-text sidebar-link">Exercise (S)</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./machinelearning.html" class="sidebar-item-text sidebar-link">Machine learning</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning1.html" class="sidebar-item-text sidebar-link">Continuous outcome</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning2.html" class="sidebar-item-text sidebar-link">Data spliting</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning3.html" class="sidebar-item-text sidebar-link">Cross-validation</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning4.html" class="sidebar-item-text sidebar-link">Binary outcome</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning5.html" class="sidebar-item-text sidebar-link">Supervised learning</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning6.html" class="sidebar-item-text sidebar-link">Unsupervised learning</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearningF.html" class="sidebar-item-text sidebar-link">R functions (L)</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./machinelearningCausal.html" class="sidebar-item-text sidebar-link">ML in causal inference</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearningCausalF.html" class="sidebar-item-text sidebar-link">R functions (C)</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./reporting.html" class="sidebar-item-text sidebar-link">Writing Tools</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reporting1.html" class="sidebar-item-text sidebar-link">Collaborative Writing</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reporting2.html" class="sidebar-item-text sidebar-link">Formatting Tools</a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#preprocessing" id="toc-preprocessing" class="nav-link active" data-scroll-target="#preprocessing">Preprocessing</a></li>
  <li><a href="#linear-regression-when-cholesterol-is-continuous" id="toc-linear-regression-when-cholesterol-is-continuous" class="nav-link" data-scroll-target="#linear-regression-when-cholesterol-is-continuous">Linear regression when cholesterol is continuous</a></li>
  <li><a href="#test-of-association-when-cholesterol-is-binary" id="toc-test-of-association-when-cholesterol-is-binary" class="nav-link" data-scroll-target="#test-of-association-when-cholesterol-is-binary">Test of association when cholesterol is binary</a></li>
  <li><a href="#table-1-1" id="toc-table-1-1" class="nav-link" data-scroll-target="#table-1-1">Table 1</a></li>
  <li><a href="#logistic-regression-model" id="toc-logistic-regression-model" class="nav-link" data-scroll-target="#logistic-regression-model">Logistic regression model</a></li>
  <li><a href="#wald-test-survey-version" id="toc-wald-test-survey-version" class="nav-link" data-scroll-target="#wald-test-survey-version">Wald test (survey version)</a></li>
  <li><a href="#backward-elimination" id="toc-backward-elimination" class="nav-link" data-scroll-target="#backward-elimination">Backward elimination</a></li>
  <li><a href="#interaction-terms" id="toc-interaction-terms" class="nav-link" data-scroll-target="#interaction-terms">Interaction terms</a></li>
  <li><a href="#auc" id="toc-auc" class="nav-link" data-scroll-target="#auc">AUC</a></li>
  <li><a href="#archer-lemeshow-goodness-of-fit" id="toc-archer-lemeshow-goodness-of-fit" class="nav-link" data-scroll-target="#archer-lemeshow-goodness-of-fit">Archer-Lemeshow Goodness of fit</a></li>
  <li><a href="#add-age-as-a-predictor-for-linear-regression" id="toc-add-age-as-a-predictor-for-linear-regression" class="nav-link" data-scroll-target="#add-age-as-a-predictor-for-linear-regression">Add <code>age</code> as a predictor for linear regression</a></li>
  <li><a href="#comparing-with-previous-model-fit" id="toc-comparing-with-previous-model-fit" class="nav-link" data-scroll-target="#comparing-with-previous-model-fit">Comparing with previous model fit</a></li>
  <li><a href="#video-content-optional" id="toc-video-content-optional" class="nav-link" data-scroll-target="#video-content-optional">Video content (optional)</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">NHANES: Cholesterol</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i></button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><div class="cell" data-hash="surveydata7_cache/html/setup_301d12ef8fbddc52cb4972aa2821de2b">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Load required packages</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(survey)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(Publish)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(tableone)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(ROCR)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">library</span>(WeightedROC)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="fu">library</span>(jtools)</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="preprocessing" class="level3"><h3 class="anchored" data-anchor-id="preprocessing">Preprocessing</h3>
<section id="analytic-data-set" class="level4"><h4 class="anchored" data-anchor-id="analytic-data-set">Analytic data set</h4>
<p>We will use <code>cholesterolNHANES15part1.RData</code> in this prediction goal question (predicting cholesterol in adults).</p>
<p>For this exercise, we are assuming that:</p>
<ul>
<li><p>outcome: cholesterol</p></li>
<li>
<p>predictors:</p>
<ul>
<li>gender</li>
<li>whether born in US</li>
<li>race</li>
<li>education</li>
<li>whether married</li>
<li>income level</li>
<li>BMI</li>
<li>whether has diabetes</li>
</ul>
</li>
<li>
<p>survey features:</p>
<ul>
<li>survey weights</li>
<li>strata</li>
<li>cluster/PSU; where strata is nested within clusters</li>
</ul>
<p>– restrict to those participants who are of 18 years of age or older</p>
</li>
</ul>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">load</span>(<span class="st">"Data/surveydata/cholesterolNHANES15part1.rdata"</span>) <span class="co">#Loading the dataset</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="fu">ls</span>()</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">#&gt;  [1] "analytic"           "analytic.with.miss" "analytic1"         </span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">#&gt;  [4] "analytic2"          "analytic2b"         "analytic3"         </span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">#&gt;  [7] "collinearity"       "correlationMatrix"  "diff.boot"         </span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co">#&gt; [10] "extract.boot.fun"   "extract.fit"        "extract.lm.fun"    </span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">#&gt; [13] "fictitious.data"    "fit0"               "fit1"              </span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">#&gt; [16] "fit2"               "fit3"               "fit4"              </span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">#&gt; [19] "fit5"               "formula0"           "formula1"          </span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co">#&gt; [22] "formula2"           "formula3"           "formula4"          </span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">#&gt; [25] "formula5"           "k.folds"            "numeric.names"     </span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co">#&gt; [28] "perform"            "pred.y"             "rocobj"            </span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co">#&gt; [31] "sel.names"          "var.cluster"        "var.summ"          </span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="co">#&gt; [34] "var.summ2"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="retaining-only-useful-variables" class="level4"><h4 class="anchored" data-anchor-id="retaining-only-useful-variables">Retaining only useful variables</h4>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Data dimensions</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">dim</span>(analytic)</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co">#&gt; [1] 1267   33</span></span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co"># Variable names</span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="fu">names</span>(analytic)</span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">#&gt;  [1] "ID"                    "gender"                "age"                  </span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co">#&gt;  [4] "born"                  "race"                  "education"            </span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co">#&gt;  [7] "married"               "income"                "weight"               </span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co">#&gt; [10] "psu"                   "strata"                "diastolicBP"          </span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="co">#&gt; [13] "systolicBP"            "bodyweight"            "bodyheight"           </span></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="co">#&gt; [16] "bmi"                   "waist"                 "smoke"                </span></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co">#&gt; [19] "alcohol"               "cholesterol"           "cholesterolM2"        </span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="co">#&gt; [22] "triglycerides"         "uric.acid"             "protein"              </span></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="co">#&gt; [25] "bilirubin"             "phosphorus"            "sodium"               </span></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="co">#&gt; [28] "potassium"             "globulin"              "calcium"              </span></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="co">#&gt; [31] "physical.work"         "physical.recreational" "diabetes"</span></span>
<span id="cb3-18"><a href="#cb3-18"></a></span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="co">#Subsetting dataset with variables needed:</span></span>
<span id="cb3-20"><a href="#cb3-20"></a><span class="fu">require</span>(dplyr)</span>
<span id="cb3-21"><a href="#cb3-21"></a>anadata <span class="ot">&lt;-</span> <span class="fu">select</span>(analytic, </span>
<span id="cb3-22"><a href="#cb3-22"></a>                  cholesterol, <span class="co">#outcome</span></span>
<span id="cb3-23"><a href="#cb3-23"></a>                  gender, age, born, race, education, married, income, bmi, diabetes, <span class="co">#predictors</span></span>
<span id="cb3-24"><a href="#cb3-24"></a>                  weight, psu, strata) <span class="co">#survey features</span></span>
<span id="cb3-25"><a href="#cb3-25"></a></span>
<span id="cb3-26"><a href="#cb3-26"></a><span class="co"># new data sizes</span></span>
<span id="cb3-27"><a href="#cb3-27"></a><span class="fu">dim</span>(anadata)</span>
<span id="cb3-28"><a href="#cb3-28"></a><span class="co">#&gt; [1] 1267   13</span></span>
<span id="cb3-29"><a href="#cb3-29"></a></span>
<span id="cb3-30"><a href="#cb3-30"></a><span class="co"># retained variable names</span></span>
<span id="cb3-31"><a href="#cb3-31"></a><span class="fu">names</span>(anadata)</span>
<span id="cb3-32"><a href="#cb3-32"></a><span class="co">#&gt;  [1] "cholesterol" "gender"      "age"         "born"        "race"       </span></span>
<span id="cb3-33"><a href="#cb3-33"></a><span class="co">#&gt;  [6] "education"   "married"     "income"      "bmi"         "diabetes"   </span></span>
<span id="cb3-34"><a href="#cb3-34"></a><span class="co">#&gt; [11] "weight"      "psu"         "strata"</span></span>
<span id="cb3-35"><a href="#cb3-35"></a></span>
<span id="cb3-36"><a href="#cb3-36"></a><span class="co">#Restricting to participants who are 18 or older</span></span>
<span id="cb3-37"><a href="#cb3-37"></a><span class="fu">summary</span>(anadata<span class="sc">$</span>age) <span class="co">#The age range is already 20-80</span></span>
<span id="cb3-38"><a href="#cb3-38"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb3-39"><a href="#cb3-39"></a><span class="co">#&gt;   20.00   36.00   51.00   49.91   63.00   80.00</span></span>
<span id="cb3-40"><a href="#cb3-40"></a></span>
<span id="cb3-41"><a href="#cb3-41"></a><span class="co">#Recoding the born variable</span></span>
<span id="cb3-42"><a href="#cb3-42"></a><span class="fu">table</span>(anadata<span class="sc">$</span>born, <span class="at">useNA =</span> <span class="st">"always"</span>)</span>
<span id="cb3-43"><a href="#cb3-43"></a><span class="co">#&gt; </span></span>
<span id="cb3-44"><a href="#cb3-44"></a><span class="co">#&gt; Born in 50 US states or Washingt                           Others </span></span>
<span id="cb3-45"><a href="#cb3-45"></a><span class="co">#&gt;                              991                              276 </span></span>
<span id="cb3-46"><a href="#cb3-46"></a><span class="co">#&gt;                             &lt;NA&gt; </span></span>
<span id="cb3-47"><a href="#cb3-47"></a><span class="co">#&gt;                                0</span></span>
<span id="cb3-48"><a href="#cb3-48"></a><span class="fu">levels</span>(anadata<span class="sc">$</span>born)</span>
<span id="cb3-49"><a href="#cb3-49"></a><span class="co">#&gt; NULL</span></span>
<span id="cb3-50"><a href="#cb3-50"></a>anadata<span class="sc">$</span>born <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">recode</span>(anadata<span class="sc">$</span>born,</span>
<span id="cb3-51"><a href="#cb3-51"></a>                            <span class="st">"'Born in 50 US states or Washingt' = 'Born.in.US';</span></span>
<span id="cb3-52"><a href="#cb3-52"></a><span class="st">                            'Others' = 'Others';</span></span>
<span id="cb3-53"><a href="#cb3-53"></a><span class="st">                            else=NA"</span>)</span>
<span id="cb3-54"><a href="#cb3-54"></a><span class="fu">table</span>(anadata<span class="sc">$</span>born, <span class="at">useNA =</span> <span class="st">"always"</span>)</span>
<span id="cb3-55"><a href="#cb3-55"></a><span class="co">#&gt; </span></span>
<span id="cb3-56"><a href="#cb3-56"></a><span class="co">#&gt; Born.in.US     Others       &lt;NA&gt; </span></span>
<span id="cb3-57"><a href="#cb3-57"></a><span class="co">#&gt;        991        276          0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="checking-the-data-for-missing" class="level4"><h4 class="anchored" data-anchor-id="checking-the-data-for-missing">Checking the data for missing</h4>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">require</span>(DataExplorer)</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="fu">plot_missing</span>(anadata) <span class="co">#no missing data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="surveydata7_files/figure-html/miss0-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="preparing-factor-and-continuous-variables-appropriately" class="level4"><h4 class="anchored" data-anchor-id="preparing-factor-and-continuous-variables-appropriately">Preparing factor and continuous variables appropriately</h4>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>vars <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"cholesterol"</span>, <span class="st">"gender"</span>, <span class="st">"born"</span>, <span class="st">"race"</span>, <span class="st">"education"</span>, </span>
<span id="cb5-2"><a href="#cb5-2"></a>         <span class="st">"married"</span>, <span class="st">"income"</span>, <span class="st">"bmi"</span>, <span class="st">"diabetes"</span>)</span>
<span id="cb5-3"><a href="#cb5-3"></a>numeric.names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"cholesterol"</span>, <span class="st">"bmi"</span>)</span>
<span id="cb5-4"><a href="#cb5-4"></a>factor.names <span class="ot">&lt;-</span> vars[<span class="sc">!</span>vars <span class="sc">%in%</span> numeric.names] </span>
<span id="cb5-5"><a href="#cb5-5"></a></span>
<span id="cb5-6"><a href="#cb5-6"></a>anadata[factor.names] <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="at">X =</span> anadata[factor.names],</span>
<span id="cb5-7"><a href="#cb5-7"></a>                               <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> as.factor)</span>
<span id="cb5-8"><a href="#cb5-8"></a></span>
<span id="cb5-9"><a href="#cb5-9"></a>anadata[numeric.names] <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="at">X =</span> anadata[numeric.names],</span>
<span id="cb5-10"><a href="#cb5-10"></a>                                <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span><span class="cf">function</span> (x) </span>
<span id="cb5-11"><a href="#cb5-11"></a>                                  <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="table-1" class="level4"><h4 class="anchored" data-anchor-id="table-1">Table 1</h4>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">library</span>(tableone)</span>
<span id="cb6-2"><a href="#cb6-2"></a>tab1 <span class="ot">&lt;-</span> <span class="fu">CreateTableOne</span>(<span class="at">data =</span> anadata, <span class="at">includeNA =</span> <span class="cn">TRUE</span>, <span class="at">vars =</span> vars)</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="fu">print</span>(tab1, <span class="at">showAllLevels =</span> <span class="cn">TRUE</span>,  <span class="at">varLabels =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co">#&gt;                          </span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co">#&gt;                           level              Overall       </span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">#&gt;   n                                            1267        </span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co">#&gt;   cholesterol (mean (SD))                    193.10 (43.22)</span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">#&gt;   gender (%)              Female                496 (39.1) </span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">#&gt;                           Male                  771 (60.9) </span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">#&gt;   born (%)                Born.in.US            991 (78.2) </span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co">#&gt;                           Others                276 (21.8) </span></span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="co">#&gt;   race (%)                Black                 246 (19.4) </span></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="co">#&gt;                           Hispanic              337 (26.6) </span></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="co">#&gt;                           Other                 132 (10.4) </span></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="co">#&gt;                           White                 552 (43.6) </span></span>
<span id="cb6-16"><a href="#cb6-16"></a><span class="co">#&gt;   education (%)           College               648 (51.1) </span></span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="co">#&gt;                           High.School           523 (41.3) </span></span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="co">#&gt;                           School                 96 ( 7.6) </span></span>
<span id="cb6-19"><a href="#cb6-19"></a><span class="co">#&gt;   married (%)             Married               751 (59.3) </span></span>
<span id="cb6-20"><a href="#cb6-20"></a><span class="co">#&gt;                           Never.married         226 (17.8) </span></span>
<span id="cb6-21"><a href="#cb6-21"></a><span class="co">#&gt;                           Previously.married    290 (22.9) </span></span>
<span id="cb6-22"><a href="#cb6-22"></a><span class="co">#&gt;   income (%)              &lt;25k                  344 (27.2) </span></span>
<span id="cb6-23"><a href="#cb6-23"></a><span class="co">#&gt;                           Between.25kto54k      435 (34.3) </span></span>
<span id="cb6-24"><a href="#cb6-24"></a><span class="co">#&gt;                           Between.55kto99k      297 (23.4) </span></span>
<span id="cb6-25"><a href="#cb6-25"></a><span class="co">#&gt;                           Over100k              191 (15.1) </span></span>
<span id="cb6-26"><a href="#cb6-26"></a><span class="co">#&gt;   bmi (mean (SD))                             29.58 (6.84) </span></span>
<span id="cb6-27"><a href="#cb6-27"></a><span class="co">#&gt;   diabetes (%)            No                   1064 (84.0) </span></span>
<span id="cb6-28"><a href="#cb6-28"></a><span class="co">#&gt;                           Yes                   203 (16.0)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="linear-regression-when-cholesterol-is-continuous" class="level3"><h3 class="anchored" data-anchor-id="linear-regression-when-cholesterol-is-continuous">Linear regression when cholesterol is continuous</h3>
<p>Fit a linear regression, and report the VIFs.</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co">#Fitting initial regression</span></span>
<span id="cb7-2"><a href="#cb7-2"></a></span>
<span id="cb7-3"><a href="#cb7-3"></a>fit0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(cholesterol <span class="sc">~</span> gender <span class="sc">+</span> born <span class="sc">+</span> race <span class="sc">+</span> education <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>              married <span class="sc">+</span> income <span class="sc">+</span> bmi <span class="sc">+</span> diabetes,</span>
<span id="cb7-5"><a href="#cb7-5"></a>            <span class="at">data =</span> anadata)</span>
<span id="cb7-6"><a href="#cb7-6"></a></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="fu">library</span>(Publish)</span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="fu">publish</span>(fit0)</span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co">#&gt;     Variable              Units Coefficient           CI.95    p-value </span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="co">#&gt;  (Intercept)                         198.90 [184.82;212.97]    &lt; 1e-04 </span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="co">#&gt;       gender             Female         Ref                            </span></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="co">#&gt;                            Male       -6.82  [-11.76;-1.89]   0.006854 </span></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="co">#&gt;         born         Born.in.US         Ref                            </span></span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="co">#&gt;                          Others       15.65    [8.54;22.75]    &lt; 1e-04 </span></span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="co">#&gt;         race              Black         Ref                            </span></span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="co">#&gt;                        Hispanic       -2.75   [-10.61;5.10]   0.492333 </span></span>
<span id="cb7-17"><a href="#cb7-17"></a><span class="co">#&gt;                           Other       -3.95   [-13.61;5.72]   0.423740 </span></span>
<span id="cb7-18"><a href="#cb7-18"></a><span class="co">#&gt;                           White        5.36   [-1.20;11.92]   0.109403 </span></span>
<span id="cb7-19"><a href="#cb7-19"></a><span class="co">#&gt;    education            College         Ref                            </span></span>
<span id="cb7-20"><a href="#cb7-20"></a><span class="co">#&gt;                     High.School        3.51    [-1.61;8.63]   0.179871 </span></span>
<span id="cb7-21"><a href="#cb7-21"></a><span class="co">#&gt;                          School        0.31   [-9.63;10.24]   0.951841 </span></span>
<span id="cb7-22"><a href="#cb7-22"></a><span class="co">#&gt;      married            Married         Ref                            </span></span>
<span id="cb7-23"><a href="#cb7-23"></a><span class="co">#&gt;                   Never.married      -11.05  [-17.67;-4.44]   0.001082 </span></span>
<span id="cb7-24"><a href="#cb7-24"></a><span class="co">#&gt;              Previously.married        4.72   [-1.43;10.86]   0.132468 </span></span>
<span id="cb7-25"><a href="#cb7-25"></a><span class="co">#&gt;       income               &lt;25k         Ref                            </span></span>
<span id="cb7-26"><a href="#cb7-26"></a><span class="co">#&gt;                Between.25kto54k       -0.48    [-6.72;5.75]   0.879480 </span></span>
<span id="cb7-27"><a href="#cb7-27"></a><span class="co">#&gt;                Between.55kto99k        3.41   [-3.60;10.43]   0.340491 </span></span>
<span id="cb7-28"><a href="#cb7-28"></a><span class="co">#&gt;                        Over100k        2.24   [-6.02;10.51]   0.595131 </span></span>
<span id="cb7-29"><a href="#cb7-29"></a><span class="co">#&gt;          bmi                          -0.21    [-0.56;0.15]   0.257105 </span></span>
<span id="cb7-30"><a href="#cb7-30"></a><span class="co">#&gt;     diabetes                 No         Ref                            </span></span>
<span id="cb7-31"><a href="#cb7-31"></a><span class="co">#&gt;                             Yes      -10.61  [-17.21;-4.02]   0.001652</span></span>
<span id="cb7-32"><a href="#cb7-32"></a></span>
<span id="cb7-33"><a href="#cb7-33"></a><span class="co">#Checking VIFs</span></span>
<span id="cb7-34"><a href="#cb7-34"></a>car<span class="sc">::</span><span class="fu">vif</span>(fit0) </span>
<span id="cb7-35"><a href="#cb7-35"></a><span class="co">#&gt;               GVIF Df GVIF^(1/(2*Df))</span></span>
<span id="cb7-36"><a href="#cb7-36"></a><span class="co">#&gt; gender    1.065810  1        1.032381</span></span>
<span id="cb7-37"><a href="#cb7-37"></a><span class="co">#&gt; born      1.578258  1        1.256288</span></span>
<span id="cb7-38"><a href="#cb7-38"></a><span class="co">#&gt; race      1.684064  3        1.090753</span></span>
<span id="cb7-39"><a href="#cb7-39"></a><span class="co">#&gt; education 1.280113  2        1.063683</span></span>
<span id="cb7-40"><a href="#cb7-40"></a><span class="co">#&gt; married   1.225520  2        1.052156</span></span>
<span id="cb7-41"><a href="#cb7-41"></a><span class="co">#&gt; income    1.277005  3        1.041595</span></span>
<span id="cb7-42"><a href="#cb7-42"></a><span class="co">#&gt; bmi       1.086953  1        1.042570</span></span>
<span id="cb7-43"><a href="#cb7-43"></a><span class="co">#&gt; diabetes  1.073619  1        1.036156</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>All VIFs are small.</p>
</section><section id="test-of-association-when-cholesterol-is-binary" class="level3"><h3 class="anchored" data-anchor-id="test-of-association-when-cholesterol-is-binary">Test of association when cholesterol is binary</h3>
<p>Dichotomize the outcome such that cholesterol&lt;200 is labeled as ‘healthy’; otherwise label it as ‘unhealthy’, and name it ‘cholesterol.bin’. Test the association between this binary variable and gender.</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co">#Creating binary variable for cholesterol</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>anadata<span class="sc">$</span>cholesterol.bin <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(anadata<span class="sc">$</span>cholesterol <span class="sc">&lt;</span><span class="dv">200</span>, <span class="st">"healthy"</span>, <span class="st">"unhealthy"</span>)</span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co">#If cholesterol is &lt;200, then "healthy", if not, "unhealthy"</span></span>
<span id="cb8-4"><a href="#cb8-4"></a></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="fu">table</span>(anadata<span class="sc">$</span>cholesterol.bin)</span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="co">#&gt; </span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="co">#&gt;   healthy unhealthy </span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co">#&gt;       738       529</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>anadata<span class="sc">$</span>cholesterol.bin <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(anadata<span class="sc">$</span>cholesterol.bin)</span>
<span id="cb8-10"><a href="#cb8-10"></a>anadata<span class="sc">$</span>cholesterol.bin <span class="ot">&lt;-</span> <span class="fu">relevel</span>(anadata<span class="sc">$</span>cholesterol.bin, <span class="at">ref =</span> <span class="st">"unhealthy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="test-of-association-between-cholesterol-and-gender-no-survey-features" class="level4"><h4 class="anchored" data-anchor-id="test-of-association-between-cholesterol-and-gender-no-survey-features">Test of association between cholesterol and gender (no survey features)</h4>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Simple Chi-square testing</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>chisq.chol.gen <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(anadata<span class="sc">$</span>cholesterol.bin, anadata<span class="sc">$</span>gender)</span>
<span id="cb9-3"><a href="#cb9-3"></a>chisq.chol.gen</span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co">#&gt; </span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co">#&gt;  Pearson's Chi-squared test with Yates' continuity correction</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co">#&gt; </span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co">#&gt; data:  anadata$cholesterol.bin and anadata$gender</span></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co">#&gt; X-squared = 5.1321, df = 1, p-value = 0.02349</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="setting-up-survey-design" class="level4"><h4 class="anchored" data-anchor-id="setting-up-survey-design">Setting up survey design</h4>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">require</span>(survey)</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="fu">summary</span>(anadata<span class="sc">$</span>weight)</span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="co">#&gt;    5470   19540   30335   48904   63822  224892</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>w.design <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">id =</span> <span class="sc">~</span>psu, <span class="at">weights =</span> <span class="sc">~</span>weight, <span class="at">strata =</span> <span class="sc">~</span>strata,</span>
<span id="cb10-6"><a href="#cb10-6"></a>                      <span class="at">nest =</span> <span class="cn">TRUE</span>, <span class="at">data =</span> anadata)</span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="fu">summary</span>(<span class="fu">weights</span>(w.design))</span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="co">#&gt;    5470   19540   30335   48904   63822  224892</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="test-of-association-accounting-for-survey-design" class="level4"><h4 class="anchored" data-anchor-id="test-of-association-accounting-for-survey-design">Test of association accounting for survey design</h4>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co">#Rao-Scott modifications (chi-sq)</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="fu">svychisq</span>(<span class="sc">~</span>cholesterol.bin <span class="sc">+</span> gender, <span class="at">design =</span> w.design, <span class="at">statistic =</span> <span class="st">"Chisq"</span>)</span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="co">#&gt; </span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co">#&gt;  Pearson's X^2: Rao &amp; Scott adjustment</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="co">#&gt; </span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="co">#&gt; data:  svychisq(~cholesterol.bin + gender, design = w.design, statistic = "Chisq")</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="co">#&gt; X-squared = 11.092, df = 1, p-value = 0.02365</span></span>
<span id="cb11-8"><a href="#cb11-8"></a></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="co">#Thomas-Rao modifications (F)</span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="fu">svychisq</span>(<span class="sc">~</span>cholesterol.bin <span class="sc">+</span> gender, <span class="at">design =</span> w.design, <span class="at">statistic =</span> <span class="st">"F"</span>) </span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="co">#&gt; </span></span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="co">#&gt;  Pearson's X^2: Rao &amp; Scott adjustment</span></span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="co">#&gt; </span></span>
<span id="cb11-14"><a href="#cb11-14"></a><span class="co">#&gt; data:  svychisq(~cholesterol.bin + gender, design = w.design, statistic = "F")</span></span>
<span id="cb11-15"><a href="#cb11-15"></a><span class="co">#&gt; F = 5.1205, ndf = 1, ddf = 15, p-value = 0.03891</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>All three tests indicate strong evidence to reject the H0. There seems to be an association between gender and cholesterol level (healthy/unhealthy)</p>
</section></section><section id="table-1-1" class="level3"><h3 class="anchored" data-anchor-id="table-1-1">Table 1</h3>
<p>Create a Table 1 (summarizing the covariates) stratified by the binary outcome: cholesterol.bin, utilizing the above survey features.</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Creating Table 1 stratified by binary outcome (cholesterol)</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="co"># Using the survey features</span></span>
<span id="cb12-3"><a href="#cb12-3"></a></span>
<span id="cb12-4"><a href="#cb12-4"></a>vars2 <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"gender"</span>, <span class="st">"born"</span>, <span class="st">"race"</span>, <span class="st">"education"</span>, </span>
<span id="cb12-5"><a href="#cb12-5"></a>         <span class="st">"married"</span>, <span class="st">"income"</span>, <span class="st">"bmi"</span>, <span class="st">"diabetes"</span>)</span>
<span id="cb12-6"><a href="#cb12-6"></a></span>
<span id="cb12-7"><a href="#cb12-7"></a></span>
<span id="cb12-8"><a href="#cb12-8"></a>kableone <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) {</span>
<span id="cb12-9"><a href="#cb12-9"></a>  <span class="fu">capture.output</span>(x <span class="ot">&lt;-</span> <span class="fu">print</span>(x, <span class="at">showAllLevels=</span> <span class="cn">TRUE</span>, <span class="at">padColnames =</span> <span class="cn">TRUE</span>, <span class="at">insertLevel =</span> <span class="cn">TRUE</span>))</span>
<span id="cb12-10"><a href="#cb12-10"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(x, ...)</span>
<span id="cb12-11"><a href="#cb12-11"></a>}</span>
<span id="cb12-12"><a href="#cb12-12"></a><span class="fu">kableone</span>(<span class="fu">svyCreateTableOne</span>(<span class="at">var =</span> vars2, <span class="at">strata=</span> <span class="st">"cholesterol.bin"</span>, <span class="at">data=</span>w.design, <span class="at">test =</span> <span class="cn">TRUE</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 19%">
<col style="width: 23%">
<col style="width: 21%">
<col style="width: 21%">
<col style="width: 7%">
<col style="width: 6%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">level</th>
<th style="text-align: left;">unhealthy</th>
<th style="text-align: left;">healthy</th>
<th style="text-align: left;">p</th>
<th style="text-align: left;">test</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">n</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">27369732.3</td>
<td style="text-align: left;">34591444.0</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">gender (%)</td>
<td style="text-align: left;">Female</td>
<td style="text-align: left;">13573865.5 (49.6)</td>
<td style="text-align: left;">13917447.5 (40.2)</td>
<td style="text-align: left;">0.039</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">13795866.8 (50.4)</td>
<td style="text-align: left;">20673996.5 (59.8)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">born (%)</td>
<td style="text-align: left;">Born.in.US</td>
<td style="text-align: left;">23772751.7 (86.9)</td>
<td style="text-align: left;">31532673.3 (91.2)</td>
<td style="text-align: left;">0.028</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Others</td>
<td style="text-align: left;">3596980.6 (13.1)</td>
<td style="text-align: left;">3058770.7 ( 8.8)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">race (%)</td>
<td style="text-align: left;">Black</td>
<td style="text-align: left;">1832118.3 ( 6.7)</td>
<td style="text-align: left;">3696893.4 (10.7)</td>
<td style="text-align: left;">0.015</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Hispanic</td>
<td style="text-align: left;">3263992.3 (11.9)</td>
<td style="text-align: left;">3921344.6 (11.3)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Other</td>
<td style="text-align: left;">1887156.6 ( 6.9)</td>
<td style="text-align: left;">2601870.3 ( 7.5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">20386465.2 (74.5)</td>
<td style="text-align: left;">24371335.7 (70.5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">education (%)</td>
<td style="text-align: left;">College</td>
<td style="text-align: left;">15855712.5 (57.9)</td>
<td style="text-align: left;">20945710.7 (60.6)</td>
<td style="text-align: left;">0.522</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">High.School</td>
<td style="text-align: left;">10615218.7 (38.8)</td>
<td style="text-align: left;">12434827.2 (35.9)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">School</td>
<td style="text-align: left;">898801.1 ( 3.3)</td>
<td style="text-align: left;">1210906.1 ( 3.5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">married (%)</td>
<td style="text-align: left;">Married</td>
<td style="text-align: left;">17489306.2 (63.9)</td>
<td style="text-align: left;">21170020.0 (61.2)</td>
<td style="text-align: left;">0.005</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Never.married</td>
<td style="text-align: left;">3086474.4 (11.3)</td>
<td style="text-align: left;">7175237.2 (20.7)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Previously.married</td>
<td style="text-align: left;">6793951.8 (24.8)</td>
<td style="text-align: left;">6246186.8 (18.1)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">income (%)</td>
<td style="text-align: left;">&lt;25k</td>
<td style="text-align: left;">4760281.8 (17.4)</td>
<td style="text-align: left;">6364208.6 (18.4)</td>
<td style="text-align: left;">0.915</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Between.25kto54k</td>
<td style="text-align: left;">8682481.6 (31.7)</td>
<td style="text-align: left;">10786198.6 (31.2)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Between.55kto99k</td>
<td style="text-align: left;">6939847.0 (25.4)</td>
<td style="text-align: left;">9190388.2 (26.6)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Over100k</td>
<td style="text-align: left;">6987121.9 (25.5)</td>
<td style="text-align: left;">8250648.6 (23.9)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">bmi (mean (SD))</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">29.35 (6.13)</td>
<td style="text-align: left;">29.64 (7.05)</td>
<td style="text-align: left;">0.593</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">diabetes (%)</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">25080412.0 (91.6)</td>
<td style="text-align: left;">30006523.6 (86.7)</td>
<td style="text-align: left;">0.012</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">2289320.3 ( 8.4)</td>
<td style="text-align: left;">4584920.4 (13.3)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
</div>
</section><section id="logistic-regression-model" class="level3"><h3 class="anchored" data-anchor-id="logistic-regression-model">Logistic regression model</h3>
<p>Run a logistic regression model using the same variables, utilizing the survey features. Report the corresponding odds ratios and the 95% confidence intervals.</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>formula1 <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">I</span>(cholesterol.bin<span class="sc">==</span><span class="st">"unhealthy"</span>) <span class="sc">~</span> gender <span class="sc">+</span> born <span class="sc">+</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>                         race <span class="sc">+</span> education <span class="sc">+</span> married <span class="sc">+</span> income <span class="sc">+</span> bmi <span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>                         diabetes)</span>
<span id="cb13-4"><a href="#cb13-4"></a></span>
<span id="cb13-5"><a href="#cb13-5"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(formula1,</span>
<span id="cb13-6"><a href="#cb13-6"></a>               <span class="at">design =</span> w.design, </span>
<span id="cb13-7"><a href="#cb13-7"></a>               <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb13-8"><a href="#cb13-8"></a></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="fu">publish</span>(fit1)</span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="co">#&gt;   Variable              Units OddsRatio       CI.95  p-value </span></span>
<span id="cb13-11"><a href="#cb13-11"></a><span class="co">#&gt;     gender             Female       Ref                      </span></span>
<span id="cb13-12"><a href="#cb13-12"></a><span class="co">#&gt;                          Male      0.70 [0.49;0.98]   0.2866 </span></span>
<span id="cb13-13"><a href="#cb13-13"></a><span class="co">#&gt;       born         Born.in.US       Ref                      </span></span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="co">#&gt;                        Others      2.10 [1.41;3.13]   0.1707 </span></span>
<span id="cb13-15"><a href="#cb13-15"></a><span class="co">#&gt;       race              Black       Ref                      </span></span>
<span id="cb13-16"><a href="#cb13-16"></a><span class="co">#&gt;                      Hispanic      1.15 [0.80;1.67]   0.5871 </span></span>
<span id="cb13-17"><a href="#cb13-17"></a><span class="co">#&gt;                         Other      1.11 [0.69;1.80]   0.7406 </span></span>
<span id="cb13-18"><a href="#cb13-18"></a><span class="co">#&gt;                         White      1.46 [1.00;2.14]   0.3003 </span></span>
<span id="cb13-19"><a href="#cb13-19"></a><span class="co">#&gt;  education            College       Ref                      </span></span>
<span id="cb13-20"><a href="#cb13-20"></a><span class="co">#&gt;                   High.School      1.21 [0.96;1.52]   0.3563 </span></span>
<span id="cb13-21"><a href="#cb13-21"></a><span class="co">#&gt;                        School      0.86 [0.52;1.43]   0.6712 </span></span>
<span id="cb13-22"><a href="#cb13-22"></a><span class="co">#&gt;    married            Married       Ref                      </span></span>
<span id="cb13-23"><a href="#cb13-23"></a><span class="co">#&gt;                 Never.married      0.54 [0.32;0.90]   0.2526 </span></span>
<span id="cb13-24"><a href="#cb13-24"></a><span class="co">#&gt;            Previously.married      1.31 [0.92;1.87]   0.3704 </span></span>
<span id="cb13-25"><a href="#cb13-25"></a><span class="co">#&gt;     income               &lt;25k       Ref                      </span></span>
<span id="cb13-26"><a href="#cb13-26"></a><span class="co">#&gt;              Between.25kto54k      1.03 [0.61;1.73]   0.9408 </span></span>
<span id="cb13-27"><a href="#cb13-27"></a><span class="co">#&gt;              Between.55kto99k      1.02 [0.66;1.56]   0.9525 </span></span>
<span id="cb13-28"><a href="#cb13-28"></a><span class="co">#&gt;                      Over100k      1.12 [0.73;1.72]   0.6920 </span></span>
<span id="cb13-29"><a href="#cb13-29"></a><span class="co">#&gt;        bmi                         1.00 [0.97;1.03]   0.9361 </span></span>
<span id="cb13-30"><a href="#cb13-30"></a><span class="co">#&gt;   diabetes                 No       Ref                      </span></span>
<span id="cb13-31"><a href="#cb13-31"></a><span class="co">#&gt;                           Yes      0.62 [0.41;0.95]   0.2720</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="wald-test-survey-version" class="level3"><h3 class="anchored" data-anchor-id="wald-test-survey-version">Wald test (survey version)</h3>
<p>Perform a Wald test (survey version) to test the null hypothesis that all coefficients associated with the income variable are zero, and interpret.</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co">#Testing the H0 that all coefficients associated with the income variable are zero</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="fu">regTermTest</span>(fit1, <span class="sc">~</span>income)</span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="co">#&gt; Wald test for income</span></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="co">#&gt;  in svyglm(formula = formula1, design = w.design, family = binomial(link = "logit"))</span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="co">#&gt; F =  0.1050099  on  3  and  1  df: p= 0.94611</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The Wald test here gives a large p-value; We do not have evidence to reject the H0 of coefficient being 0. If the coefficient for income variable is 0, this means that the outcome in the model (cholesterol) is not affected by income. This suggests that removing income from the model does not statistically improve the model fit. So we can remove income variable from the model.</p>
</section><section id="backward-elimination" class="level3"><h3 class="anchored" data-anchor-id="backward-elimination">Backward elimination</h3>
<p>Run a backward elimination (using the AIC criteria) on the above logistic regression fit (keeping important variables gender, race, bmi, diabetes in the model), and report the odds ratios and the 95% confidence intervals from the resulting final logistic regression fit.</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co">#Running backward elimination based on AIC</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="fu">require</span>(MASS)</span>
<span id="cb15-3"><a href="#cb15-3"></a>scope <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">upper =</span> <span class="sc">~</span> gender <span class="sc">+</span> born <span class="sc">+</span> race <span class="sc">+</span> education <span class="sc">+</span> </span>
<span id="cb15-4"><a href="#cb15-4"></a>                married <span class="sc">+</span> income <span class="sc">+</span> bmi <span class="sc">+</span> diabetes,</span>
<span id="cb15-5"><a href="#cb15-5"></a>              <span class="at">lower =</span> <span class="sc">~</span> gender <span class="sc">+</span> race <span class="sc">+</span> bmi <span class="sc">+</span> diabetes)</span>
<span id="cb15-6"><a href="#cb15-6"></a></span>
<span id="cb15-7"><a href="#cb15-7"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">step</span>(fit1, <span class="at">scope =</span> scope, <span class="at">trace =</span> <span class="cn">FALSE</span>,</span>
<span id="cb15-8"><a href="#cb15-8"></a>                <span class="at">k =</span> <span class="dv">2</span>, <span class="at">direction =</span> <span class="st">"backward"</span>)</span>
<span id="cb15-9"><a href="#cb15-9"></a></span>
<span id="cb15-10"><a href="#cb15-10"></a><span class="co">#Odds Ratios</span></span>
<span id="cb15-11"><a href="#cb15-11"></a><span class="fu">publish</span>(fit3)</span>
<span id="cb15-12"><a href="#cb15-12"></a><span class="co">#&gt;  Variable              Units OddsRatio       CI.95   p-value </span></span>
<span id="cb15-13"><a href="#cb15-13"></a><span class="co">#&gt;    gender             Female       Ref                       </span></span>
<span id="cb15-14"><a href="#cb15-14"></a><span class="co">#&gt;                         Male      0.71 [0.51;0.98]   0.08558 </span></span>
<span id="cb15-15"><a href="#cb15-15"></a><span class="co">#&gt;      born         Born.in.US       Ref                       </span></span>
<span id="cb15-16"><a href="#cb15-16"></a><span class="co">#&gt;                       Others      2.01 [1.37;2.96]   0.01184 </span></span>
<span id="cb15-17"><a href="#cb15-17"></a><span class="co">#&gt;      race              Black       Ref                       </span></span>
<span id="cb15-18"><a href="#cb15-18"></a><span class="co">#&gt;                     Hispanic      1.15 [0.81;1.65]   0.46785 </span></span>
<span id="cb15-19"><a href="#cb15-19"></a><span class="co">#&gt;                        Other      1.11 [0.68;1.81]   0.69539 </span></span>
<span id="cb15-20"><a href="#cb15-20"></a><span class="co">#&gt;                        White      1.46 [0.99;2.17]   0.10469 </span></span>
<span id="cb15-21"><a href="#cb15-21"></a><span class="co">#&gt;   married            Married       Ref                       </span></span>
<span id="cb15-22"><a href="#cb15-22"></a><span class="co">#&gt;                Never.married      0.54 [0.32;0.90]   0.05770 </span></span>
<span id="cb15-23"><a href="#cb15-23"></a><span class="co">#&gt;           Previously.married      1.30 [0.93;1.80]   0.17125 </span></span>
<span id="cb15-24"><a href="#cb15-24"></a><span class="co">#&gt;       bmi                         1.00 [0.97;1.03]   0.95146 </span></span>
<span id="cb15-25"><a href="#cb15-25"></a><span class="co">#&gt;  diabetes                 No       Ref                       </span></span>
<span id="cb15-26"><a href="#cb15-26"></a><span class="co">#&gt;                          Yes      0.61 [0.40;0.91]   0.05445</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Born and married are also found to be useful on top of gender + race + bmi + diabetes.</p>
</section><section id="interaction-terms" class="level3"><h3 class="anchored" data-anchor-id="interaction-terms">Interaction terms</h3>
<p>Checking interaction terms</p>
<p>– gender and whether married</p>
<p>– gender and whether born in the US</p>
<p>– gender and diabetes</p>
<p>– whether married and diabetes</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co">#gender and married</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>fit4 <span class="ot">&lt;-</span> <span class="fu">update</span>(fit3, .<span class="sc">~</span>. <span class="sc">+</span> <span class="fu">interaction</span>(gender, married))</span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="fu">anova</span>(fit3, fit4)</span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="co">#&gt; Working (Rao-Scott+F) LRT for interaction(gender, married)</span></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="co">#&gt;  in svyglm(formula = I(cholesterol.bin == "unhealthy") ~ gender + </span></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="co">#&gt;     born + race + married + bmi + diabetes + interaction(gender, </span></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="co">#&gt;     married), design = w.design, family = binomial(link = "logit"))</span></span>
<span id="cb16-8"><a href="#cb16-8"></a><span class="co">#&gt; Working 2logLR =  0.7461308 p= 0.70903 </span></span>
<span id="cb16-9"><a href="#cb16-9"></a><span class="co">#&gt; (scale factors:  1.1 0.93 );  denominator df= 4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Do not include interaction term</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co">#gender and born in us</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>fit5 <span class="ot">&lt;-</span> <span class="fu">update</span>(fit3, .<span class="sc">~</span>. <span class="sc">+</span> <span class="fu">interaction</span>(gender, born))</span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="fu">anova</span>(fit3, fit5)</span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="co">#&gt; Working (Rao-Scott+F) LRT for interaction(gender, born)</span></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="co">#&gt;  in svyglm(formula = I(cholesterol.bin == "unhealthy") ~ gender + </span></span>
<span id="cb17-6"><a href="#cb17-6"></a><span class="co">#&gt;     born + race + married + bmi + diabetes + interaction(gender, </span></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="co">#&gt;     born), design = w.design, family = binomial(link = "logit"))</span></span>
<span id="cb17-8"><a href="#cb17-8"></a><span class="co">#&gt; Working 2logLR =  0.4635299 p= 0.52441 </span></span>
<span id="cb17-9"><a href="#cb17-9"></a><span class="co">#&gt; df=1;  denominator df= 5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Do not include interaction term</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co">#gender and diabetes</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>fit6 <span class="ot">&lt;-</span> <span class="fu">update</span>(fit3, .<span class="sc">~</span>. <span class="sc">+</span> <span class="fu">interaction</span>(gender, diabetes))</span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="fu">anova</span>(fit3, fit6)</span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="co">#&gt; Working (Rao-Scott+F) LRT for interaction(gender, diabetes)</span></span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="co">#&gt;  in svyglm(formula = I(cholesterol.bin == "unhealthy") ~ gender + </span></span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="co">#&gt;     born + race + married + bmi + diabetes + interaction(gender, </span></span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="co">#&gt;     diabetes), design = w.design, family = binomial(link = "logit"))</span></span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="co">#&gt; Working 2logLR =  1.222596 p= 0.32211 </span></span>
<span id="cb18-9"><a href="#cb18-9"></a><span class="co">#&gt; df=1;  denominator df= 5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Do not include interaction term</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co">#married and diabetes</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>fit7 <span class="ot">&lt;-</span> <span class="fu">update</span>(fit3, .<span class="sc">~</span>. <span class="sc">+</span> <span class="fu">interaction</span>(married, diabetes))</span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="fu">anova</span>(fit3, fit7)</span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="co">#&gt; Working (Rao-Scott+F) LRT for interaction(married, diabetes)</span></span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="co">#&gt;  in svyglm(formula = I(cholesterol.bin == "unhealthy") ~ gender + </span></span>
<span id="cb19-6"><a href="#cb19-6"></a><span class="co">#&gt;     born + race + married + bmi + diabetes + interaction(married, </span></span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="co">#&gt;     diabetes), design = w.design, family = binomial(link = "logit"))</span></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="co">#&gt; Working 2logLR =  0.3207507 p= 0.84547 </span></span>
<span id="cb19-9"><a href="#cb19-9"></a><span class="co">#&gt; (scale factors:  1.4 0.62 );  denominator df= 4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Do not include interaction term</p>
<p>None of the interaction terms are improving the model fit.</p>
</section><section id="auc" class="level3"><h3 class="anchored" data-anchor-id="auc">AUC</h3>
<p>Report AUC of the final model (only using weight argument) and interpret.</p>
<p>AUC of the final model (only using weight argument) and interpret</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu">require</span>(ROCR)</span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="co"># WeightedROC may not be on cran for all R versions</span></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="co"># devtools::install_github("tdhock/WeightedROC")</span></span>
<span id="cb20-4"><a href="#cb20-4"></a></span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="fu">library</span>(WeightedROC)</span>
<span id="cb20-6"><a href="#cb20-6"></a>svyROCw <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">fit =</span> fit3, <span class="at">outcome =</span> anadata<span class="sc">$</span>cholesterol.bin <span class="sc">==</span> <span class="st">"unhealthy"</span>, <span class="at">weight =</span> anadata<span class="sc">$</span>weight){</span>
<span id="cb20-7"><a href="#cb20-7"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(weight)){ <span class="co"># require(ROCR)</span></span>
<span id="cb20-8"><a href="#cb20-8"></a>    prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb20-9"><a href="#cb20-9"></a>  pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(<span class="fu">as.vector</span>(prob), outcome)</span>
<span id="cb20-10"><a href="#cb20-10"></a>  perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="st">"tpr"</span>, <span class="st">"fpr"</span>)</span>
<span id="cb20-11"><a href="#cb20-11"></a>  auc <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="at">measure =</span> <span class="st">"auc"</span>)</span>
<span id="cb20-12"><a href="#cb20-12"></a>  auc <span class="ot">&lt;-</span> auc<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb20-13"><a href="#cb20-13"></a>  roc.data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">fpr =</span> <span class="fu">unlist</span>(perf<span class="sc">@</span>x.values), <span class="at">tpr =</span> <span class="fu">unlist</span>(perf<span class="sc">@</span>y.values), </span>
<span id="cb20-14"><a href="#cb20-14"></a>      <span class="at">model =</span> <span class="st">"Logistic"</span>)</span>
<span id="cb20-15"><a href="#cb20-15"></a>  <span class="fu">with</span>(<span class="at">data =</span> roc.data,<span class="fu">plot</span>(fpr, tpr, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">lwd=</span><span class="dv">1</span>,</span>
<span id="cb20-16"><a href="#cb20-16"></a>     <span class="at">xlab=</span><span class="st">"1 - specificity"</span>, <span class="at">ylab=</span><span class="st">"Sensitivity"</span>,</span>
<span id="cb20-17"><a href="#cb20-17"></a>     <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"AUC = "</span>, <span class="fu">round</span>(auc,<span class="dv">3</span>))))</span>
<span id="cb20-18"><a href="#cb20-18"></a>  <span class="fu">mtext</span>(<span class="st">"Unweighted ROC"</span>)</span>
<span id="cb20-19"><a href="#cb20-19"></a>  <span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb20-20"><a href="#cb20-20"></a>  } <span class="cf">else</span> { </span>
<span id="cb20-21"><a href="#cb20-21"></a>    outcome <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(outcome)</span>
<span id="cb20-22"><a href="#cb20-22"></a>  pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb20-23"><a href="#cb20-23"></a>  tp.fp <span class="ot">&lt;-</span> <span class="fu">WeightedROC</span>(pred, outcome, weight)</span>
<span id="cb20-24"><a href="#cb20-24"></a>  auc <span class="ot">&lt;-</span> <span class="fu">WeightedAUC</span>(tp.fp)</span>
<span id="cb20-25"><a href="#cb20-25"></a>  <span class="fu">with</span>(<span class="at">data =</span> tp.fp,<span class="fu">plot</span>(FPR, TPR, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">lwd=</span><span class="dv">1</span>,</span>
<span id="cb20-26"><a href="#cb20-26"></a>     <span class="at">xlab=</span><span class="st">"1 - specificity"</span>, <span class="at">ylab=</span><span class="st">"Sensitivity"</span>,</span>
<span id="cb20-27"><a href="#cb20-27"></a>     <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"AUC = "</span>, <span class="fu">round</span>(auc,<span class="dv">3</span>))))</span>
<span id="cb20-28"><a href="#cb20-28"></a>  <span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb20-29"><a href="#cb20-29"></a>  <span class="fu">mtext</span>(<span class="st">"Weighted ROC"</span>)</span>
<span id="cb20-30"><a href="#cb20-30"></a>  }</span>
<span id="cb20-31"><a href="#cb20-31"></a>}</span>
<span id="cb20-32"><a href="#cb20-32"></a><span class="fu">svyROCw</span>(<span class="at">fit =</span> fit3, <span class="at">outcome =</span> anadata<span class="sc">$</span>cholesterol.bin <span class="sc">==</span> <span class="st">"unhealthy"</span>, <span class="at">weight =</span> anadata<span class="sc">$</span>weight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="surveydata7_files/figure-html/auc-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The area under the curve in the final model is 0.611, using the survey weighted ROC. The AUC of 0.611 indicates that this model has poor discrimination.</p>
</section><section id="archer-lemeshow-goodness-of-fit" class="level3"><h3 class="anchored" data-anchor-id="archer-lemeshow-goodness-of-fit">Archer-Lemeshow Goodness of fit</h3>
<p>Report Archer-Lemeshow Goodness of fit test and interpret (utilizing all the survey features).</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co">#Archer-Lemeshow Goodness of fit test utilizing all survey features</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>AL.gof2 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">fit =</span> fit3, <span class="at">data =</span> anadata, </span>
<span id="cb21-3"><a href="#cb21-3"></a>                   <span class="at">weight =</span> <span class="st">"weight"</span>, <span class="at">psu =</span> <span class="st">"psu"</span>, <span class="at">strata =</span> <span class="st">"strata"</span>){</span>
<span id="cb21-4"><a href="#cb21-4"></a>  r <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit, <span class="at">type =</span> <span class="st">"response"</span>) </span>
<span id="cb21-5"><a href="#cb21-5"></a>  f<span class="ot">&lt;-</span><span class="fu">fitted</span>(fit) </span>
<span id="cb21-6"><a href="#cb21-6"></a>  breaks.g <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="fu">quantile</span>(f, (<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>)<span class="sc">/</span><span class="dv">10</span>), <span class="cn">Inf</span>)</span>
<span id="cb21-7"><a href="#cb21-7"></a>  breaks.g <span class="ot">&lt;-</span> breaks.g <span class="sc">+</span> <span class="fu">seq_along</span>(breaks.g) <span class="sc">*</span> .Machine<span class="sc">$</span>double.eps</span>
<span id="cb21-8"><a href="#cb21-8"></a>  g<span class="ot">&lt;-</span> <span class="fu">cut</span>(f, breaks.g)</span>
<span id="cb21-9"><a href="#cb21-9"></a>  data2g <span class="ot">&lt;-</span> <span class="fu">cbind</span>(data,r,g)</span>
<span id="cb21-10"><a href="#cb21-10"></a>  newdesign <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">id=</span><span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~"</span>,psu)),</span>
<span id="cb21-11"><a href="#cb21-11"></a>                         <span class="at">strata=</span><span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~"</span>,strata)),</span>
<span id="cb21-12"><a href="#cb21-12"></a>                         <span class="at">weights=</span><span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~"</span>,weight)), </span>
<span id="cb21-13"><a href="#cb21-13"></a>                         <span class="at">data=</span>data2g, <span class="at">nest =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-14"><a href="#cb21-14"></a>  decilemodel <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(r<span class="sc">~</span>g, <span class="at">design=</span>newdesign) </span>
<span id="cb21-15"><a href="#cb21-15"></a>  res <span class="ot">&lt;-</span> <span class="fu">regTermTest</span>(decilemodel, <span class="sc">~</span>g)</span>
<span id="cb21-16"><a href="#cb21-16"></a>  <span class="fu">return</span>(res) </span>
<span id="cb21-17"><a href="#cb21-17"></a>}</span>
<span id="cb21-18"><a href="#cb21-18"></a></span>
<span id="cb21-19"><a href="#cb21-19"></a><span class="fu">AL.gof2</span>(fit3, anadata, <span class="at">weight =</span> <span class="st">"weight"</span>, <span class="at">psu =</span> <span class="st">"psu"</span>, <span class="at">strata =</span> <span class="st">"strata"</span>)</span>
<span id="cb21-20"><a href="#cb21-20"></a><span class="co">#&gt; Wald test for g</span></span>
<span id="cb21-21"><a href="#cb21-21"></a><span class="co">#&gt;  in svyglm(formula = r ~ g, design = newdesign)</span></span>
<span id="cb21-22"><a href="#cb21-22"></a><span class="co">#&gt; F =  0.7569326  on  9  and  6  df: p= 0.66075</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Archer and Lemeshow GoF test was used to test the fit of this model. The p-value of 0.3043, which is greater than 0.05. This means that there is no evidence of lack of fit to this model.</p>
</section><section id="add-age-as-a-predictor-for-linear-regression" class="level3"><h3 class="anchored" data-anchor-id="add-age-as-a-predictor-for-linear-regression">Add <code>age</code> as a predictor for linear regression</h3>
<p>Fit another logistic regression (similar to Q1) with the above-mentioned predictors (as obtained in Q7) and age, utilizing the survey features. What difference do you see from the previous fit results?</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>aic.int.model <span class="ot">&lt;-</span> <span class="fu">eval</span>(fit3<span class="sc">$</span>call[[<span class="dv">2</span>]])</span>
<span id="cb22-2"><a href="#cb22-2"></a>aic.int.model</span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="co">#&gt; I(cholesterol.bin == "unhealthy") ~ gender + born + race + married + </span></span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="co">#&gt;     bmi + diabetes</span></span>
<span id="cb22-5"><a href="#cb22-5"></a></span>
<span id="cb22-6"><a href="#cb22-6"></a>formula3 <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(cholesterol.bin <span class="sc">~</span> gender <span class="sc">+</span> born <span class="sc">+</span> race <span class="sc">+</span> married <span class="sc">+</span> bmi <span class="sc">+</span> diabetes <span class="sc">+</span> age)</span>
<span id="cb22-7"><a href="#cb22-7"></a>fit9 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(formula3,</span>
<span id="cb22-8"><a href="#cb22-8"></a>               <span class="at">design =</span> w.design,</span>
<span id="cb22-9"><a href="#cb22-9"></a>               <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"logit"</span>))</span>
<span id="cb22-10"><a href="#cb22-10"></a><span class="fu">summary</span>(fit9)</span>
<span id="cb22-11"><a href="#cb22-11"></a><span class="co">#&gt; </span></span>
<span id="cb22-12"><a href="#cb22-12"></a><span class="co">#&gt; Call:</span></span>
<span id="cb22-13"><a href="#cb22-13"></a><span class="co">#&gt; svyglm(formula = formula3, design = w.design, family = binomial(link = "logit"))</span></span>
<span id="cb22-14"><a href="#cb22-14"></a><span class="co">#&gt; </span></span>
<span id="cb22-15"><a href="#cb22-15"></a><span class="co">#&gt; Survey design:</span></span>
<span id="cb22-16"><a href="#cb22-16"></a><span class="co">#&gt; svydesign(id = ~psu, weights = ~weight, strata = ~strata, nest = TRUE, </span></span>
<span id="cb22-17"><a href="#cb22-17"></a><span class="co">#&gt;     data = anadata)</span></span>
<span id="cb22-18"><a href="#cb22-18"></a><span class="co">#&gt; </span></span>
<span id="cb22-19"><a href="#cb22-19"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb22-20"><a href="#cb22-20"></a><span class="co">#&gt;                             Estimate Std. Error t value Pr(&gt;|t|)  </span></span>
<span id="cb22-21"><a href="#cb22-21"></a><span class="co">#&gt; (Intercept)                1.0657919  0.6260889   1.702   0.1494  </span></span>
<span id="cb22-22"><a href="#cb22-22"></a><span class="co">#&gt; genderMale                 0.3821902  0.1703394   2.244   0.0749 .</span></span>
<span id="cb22-23"><a href="#cb22-23"></a><span class="co">#&gt; bornOthers                -0.6912102  0.2026407  -3.411   0.0190 *</span></span>
<span id="cb22-24"><a href="#cb22-24"></a><span class="co">#&gt; raceHispanic              -0.2442019  0.1823190  -1.339   0.2381  </span></span>
<span id="cb22-25"><a href="#cb22-25"></a><span class="co">#&gt; raceOther                 -0.1570271  0.2306208  -0.681   0.5262  </span></span>
<span id="cb22-26"><a href="#cb22-26"></a><span class="co">#&gt; raceWhite                 -0.3638735  0.2029676  -1.793   0.1330  </span></span>
<span id="cb22-27"><a href="#cb22-27"></a><span class="co">#&gt; marriedNever.married       0.4029107  0.2637962   1.527   0.1872  </span></span>
<span id="cb22-28"><a href="#cb22-28"></a><span class="co">#&gt; marriedPreviously.married -0.2096009  0.1620478  -1.293   0.2524  </span></span>
<span id="cb22-29"><a href="#cb22-29"></a><span class="co">#&gt; bmi                       -0.0002237  0.0134117  -0.017   0.9873  </span></span>
<span id="cb22-30"><a href="#cb22-30"></a><span class="co">#&gt; diabetesYes                0.6534019  0.2456333   2.660   0.0449 *</span></span>
<span id="cb22-31"><a href="#cb22-31"></a><span class="co">#&gt; age                       -0.0151364  0.0042038  -3.601   0.0155 *</span></span>
<span id="cb22-32"><a href="#cb22-32"></a><span class="co">#&gt; ---</span></span>
<span id="cb22-33"><a href="#cb22-33"></a><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span id="cb22-34"><a href="#cb22-34"></a><span class="co">#&gt; </span></span>
<span id="cb22-35"><a href="#cb22-35"></a><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1.000456)</span></span>
<span id="cb22-36"><a href="#cb22-36"></a><span class="co">#&gt; </span></span>
<span id="cb22-37"><a href="#cb22-37"></a><span class="co">#&gt; Number of Fisher Scoring iterations: 4</span></span>
<span id="cb22-38"><a href="#cb22-38"></a><span class="fu">publish</span>(fit9)</span>
<span id="cb22-39"><a href="#cb22-39"></a><span class="co">#&gt;  Variable              Units OddsRatio       CI.95   p-value </span></span>
<span id="cb22-40"><a href="#cb22-40"></a><span class="co">#&gt;    gender             Female       Ref                       </span></span>
<span id="cb22-41"><a href="#cb22-41"></a><span class="co">#&gt;                         Male      1.47 [1.05;2.05]   0.07487 </span></span>
<span id="cb22-42"><a href="#cb22-42"></a><span class="co">#&gt;      born         Born.in.US       Ref                       </span></span>
<span id="cb22-43"><a href="#cb22-43"></a><span class="co">#&gt;                       Others      0.50 [0.34;0.75]   0.01902 </span></span>
<span id="cb22-44"><a href="#cb22-44"></a><span class="co">#&gt;      race              Black       Ref                       </span></span>
<span id="cb22-45"><a href="#cb22-45"></a><span class="co">#&gt;                     Hispanic      0.78 [0.55;1.12]   0.23809 </span></span>
<span id="cb22-46"><a href="#cb22-46"></a><span class="co">#&gt;                        Other      0.85 [0.54;1.34]   0.52619 </span></span>
<span id="cb22-47"><a href="#cb22-47"></a><span class="co">#&gt;                        White      0.69 [0.47;1.03]   0.13299 </span></span>
<span id="cb22-48"><a href="#cb22-48"></a><span class="co">#&gt;   married            Married       Ref                       </span></span>
<span id="cb22-49"><a href="#cb22-49"></a><span class="co">#&gt;                Never.married      1.50 [0.89;2.51]   0.18721 </span></span>
<span id="cb22-50"><a href="#cb22-50"></a><span class="co">#&gt;           Previously.married      0.81 [0.59;1.11]   0.25238 </span></span>
<span id="cb22-51"><a href="#cb22-51"></a><span class="co">#&gt;       bmi                         1.00 [0.97;1.03]   0.98734 </span></span>
<span id="cb22-52"><a href="#cb22-52"></a><span class="co">#&gt;  diabetes                 No       Ref                       </span></span>
<span id="cb22-53"><a href="#cb22-53"></a><span class="co">#&gt;                          Yes      1.92 [1.19;3.11]   0.04488 </span></span>
<span id="cb22-54"><a href="#cb22-54"></a><span class="co">#&gt;       age                         0.98 [0.98;0.99]   0.01553</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="comparing-with-previous-model-fit" class="level3"><h3 class="anchored" data-anchor-id="comparing-with-previous-model-fit">Comparing with previous model fit</h3>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="fu">publish</span>(fit3)</span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="co">#&gt;  Variable              Units OddsRatio       CI.95   p-value </span></span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="co">#&gt;    gender             Female       Ref                       </span></span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="co">#&gt;                         Male      0.71 [0.51;0.98]   0.08558 </span></span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="co">#&gt;      born         Born.in.US       Ref                       </span></span>
<span id="cb23-6"><a href="#cb23-6"></a><span class="co">#&gt;                       Others      2.01 [1.37;2.96]   0.01184 </span></span>
<span id="cb23-7"><a href="#cb23-7"></a><span class="co">#&gt;      race              Black       Ref                       </span></span>
<span id="cb23-8"><a href="#cb23-8"></a><span class="co">#&gt;                     Hispanic      1.15 [0.81;1.65]   0.46785 </span></span>
<span id="cb23-9"><a href="#cb23-9"></a><span class="co">#&gt;                        Other      1.11 [0.68;1.81]   0.69539 </span></span>
<span id="cb23-10"><a href="#cb23-10"></a><span class="co">#&gt;                        White      1.46 [0.99;2.17]   0.10469 </span></span>
<span id="cb23-11"><a href="#cb23-11"></a><span class="co">#&gt;   married            Married       Ref                       </span></span>
<span id="cb23-12"><a href="#cb23-12"></a><span class="co">#&gt;                Never.married      0.54 [0.32;0.90]   0.05770 </span></span>
<span id="cb23-13"><a href="#cb23-13"></a><span class="co">#&gt;           Previously.married      1.30 [0.93;1.80]   0.17125 </span></span>
<span id="cb23-14"><a href="#cb23-14"></a><span class="co">#&gt;       bmi                         1.00 [0.97;1.03]   0.95146 </span></span>
<span id="cb23-15"><a href="#cb23-15"></a><span class="co">#&gt;  diabetes                 No       Ref                       </span></span>
<span id="cb23-16"><a href="#cb23-16"></a><span class="co">#&gt;                          Yes      0.61 [0.40;0.91]   0.05445</span></span>
<span id="cb23-17"><a href="#cb23-17"></a><span class="fu">publish</span>(fit9)</span>
<span id="cb23-18"><a href="#cb23-18"></a><span class="co">#&gt;  Variable              Units OddsRatio       CI.95   p-value </span></span>
<span id="cb23-19"><a href="#cb23-19"></a><span class="co">#&gt;    gender             Female       Ref                       </span></span>
<span id="cb23-20"><a href="#cb23-20"></a><span class="co">#&gt;                         Male      1.47 [1.05;2.05]   0.07487 </span></span>
<span id="cb23-21"><a href="#cb23-21"></a><span class="co">#&gt;      born         Born.in.US       Ref                       </span></span>
<span id="cb23-22"><a href="#cb23-22"></a><span class="co">#&gt;                       Others      0.50 [0.34;0.75]   0.01902 </span></span>
<span id="cb23-23"><a href="#cb23-23"></a><span class="co">#&gt;      race              Black       Ref                       </span></span>
<span id="cb23-24"><a href="#cb23-24"></a><span class="co">#&gt;                     Hispanic      0.78 [0.55;1.12]   0.23809 </span></span>
<span id="cb23-25"><a href="#cb23-25"></a><span class="co">#&gt;                        Other      0.85 [0.54;1.34]   0.52619 </span></span>
<span id="cb23-26"><a href="#cb23-26"></a><span class="co">#&gt;                        White      0.69 [0.47;1.03]   0.13299 </span></span>
<span id="cb23-27"><a href="#cb23-27"></a><span class="co">#&gt;   married            Married       Ref                       </span></span>
<span id="cb23-28"><a href="#cb23-28"></a><span class="co">#&gt;                Never.married      1.50 [0.89;2.51]   0.18721 </span></span>
<span id="cb23-29"><a href="#cb23-29"></a><span class="co">#&gt;           Previously.married      0.81 [0.59;1.11]   0.25238 </span></span>
<span id="cb23-30"><a href="#cb23-30"></a><span class="co">#&gt;       bmi                         1.00 [0.97;1.03]   0.98734 </span></span>
<span id="cb23-31"><a href="#cb23-31"></a><span class="co">#&gt;  diabetes                 No       Ref                       </span></span>
<span id="cb23-32"><a href="#cb23-32"></a><span class="co">#&gt;                          Yes      1.92 [1.19;3.11]   0.04488 </span></span>
<span id="cb23-33"><a href="#cb23-33"></a><span class="co">#&gt;       age                         0.98 [0.98;0.99]   0.01553</span></span>
<span id="cb23-34"><a href="#cb23-34"></a><span class="fu">AIC</span>(fit3)</span>
<span id="cb23-35"><a href="#cb23-35"></a><span class="co">#&gt;       eff.p         AIC    deltabar </span></span>
<span id="cb23-36"><a href="#cb23-36"></a><span class="co">#&gt;   11.121795 1706.792543    1.235755</span></span>
<span id="cb23-37"><a href="#cb23-37"></a><span class="fu">AIC</span>(fit9)</span>
<span id="cb23-38"><a href="#cb23-38"></a><span class="co">#&gt;      eff.p        AIC   deltabar </span></span>
<span id="cb23-39"><a href="#cb23-39"></a><span class="co">#&gt;   12.14310 1694.15974    1.21431</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="video-content-optional" class="level3"><h3 class="anchored" data-anchor-id="video-content-optional">Video content (optional)</h3>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>For those who prefer a video walkthrough, feel free to watch the video below, which offers a description of an earlier version of the above content.</p>
</div>
</div>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
<iframe src="https://www.youtube.com/embed/78EHsUZDePc" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen="">
</iframe>
</div>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./surveydata6.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">NHANES: Blood Pressure</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./surveydata8.html" class="pagination-link">
        <span class="nav-page-text">NHANES: Subsetting</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb24" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb24-1"><a href="#cb24-1"></a><span class="fu">## NHANES: Cholesterol {.unnumbered}</span></span>
<span id="cb24-2"><a href="#cb24-2"></a></span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="in">```{r setup, warning=FALSE, message=FALSE, cache=TRUE}</span></span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="co"># Load required packages</span></span>
<span id="cb24-5"><a href="#cb24-5"></a><span class="fu">library</span>(survey)</span>
<span id="cb24-6"><a href="#cb24-6"></a><span class="fu">library</span>(Publish)</span>
<span id="cb24-7"><a href="#cb24-7"></a><span class="fu">library</span>(tableone)</span>
<span id="cb24-8"><a href="#cb24-8"></a><span class="fu">library</span>(ROCR)</span>
<span id="cb24-9"><a href="#cb24-9"></a><span class="fu">library</span>(WeightedROC)</span>
<span id="cb24-10"><a href="#cb24-10"></a><span class="fu">library</span>(jtools)</span>
<span id="cb24-11"><a href="#cb24-11"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb24-12"><a href="#cb24-12"></a><span class="in">```</span></span>
<span id="cb24-13"><a href="#cb24-13"></a></span>
<span id="cb24-14"><a href="#cb24-14"></a><span class="fu">### Preprocessing</span></span>
<span id="cb24-15"><a href="#cb24-15"></a></span>
<span id="cb24-16"><a href="#cb24-16"></a><span class="fu">#### Analytic data set</span></span>
<span id="cb24-17"><a href="#cb24-17"></a></span>
<span id="cb24-18"><a href="#cb24-18"></a>We will use <span class="in">`cholesterolNHANES15part1.RData`</span> in this prediction goal question (predicting cholesterol in adults).</span>
<span id="cb24-19"><a href="#cb24-19"></a></span>
<span id="cb24-20"><a href="#cb24-20"></a>For this exercise, we are assuming that:</span>
<span id="cb24-21"><a href="#cb24-21"></a></span>
<span id="cb24-22"><a href="#cb24-22"></a><span class="ss">-   </span>outcome: cholesterol</span>
<span id="cb24-23"><a href="#cb24-23"></a></span>
<span id="cb24-24"><a href="#cb24-24"></a><span class="ss">-   </span>predictors:</span>
<span id="cb24-25"><a href="#cb24-25"></a></span>
<span id="cb24-26"><a href="#cb24-26"></a><span class="ss">    -   </span>gender</span>
<span id="cb24-27"><a href="#cb24-27"></a><span class="ss">    -   </span>whether born in US</span>
<span id="cb24-28"><a href="#cb24-28"></a><span class="ss">    -   </span>race</span>
<span id="cb24-29"><a href="#cb24-29"></a><span class="ss">    -   </span>education</span>
<span id="cb24-30"><a href="#cb24-30"></a><span class="ss">    -   </span>whether married</span>
<span id="cb24-31"><a href="#cb24-31"></a><span class="ss">    -   </span>income level</span>
<span id="cb24-32"><a href="#cb24-32"></a><span class="ss">    -   </span>BMI</span>
<span id="cb24-33"><a href="#cb24-33"></a><span class="ss">    -   </span>whether has diabetes</span>
<span id="cb24-34"><a href="#cb24-34"></a></span>
<span id="cb24-35"><a href="#cb24-35"></a><span class="ss">-   </span>survey features:</span>
<span id="cb24-36"><a href="#cb24-36"></a></span>
<span id="cb24-37"><a href="#cb24-37"></a><span class="ss">    -   </span>survey weights</span>
<span id="cb24-38"><a href="#cb24-38"></a><span class="ss">    -   </span>strata</span>
<span id="cb24-39"><a href="#cb24-39"></a><span class="ss">    -   </span>cluster/PSU; where strata is nested within clusters</span>
<span id="cb24-40"><a href="#cb24-40"></a></span>
<span id="cb24-41"><a href="#cb24-41"></a>    -- restrict to those participants who are of 18 years of age or older</span>
<span id="cb24-42"><a href="#cb24-42"></a></span>
<span id="cb24-43"><a href="#cb24-43"></a><span class="in">```{r load, message=FALSE, warning=FALSE}</span></span>
<span id="cb24-44"><a href="#cb24-44"></a><span class="fu">load</span>(<span class="st">"Data/surveydata/cholesterolNHANES15part1.rdata"</span>) <span class="co">#Loading the dataset</span></span>
<span id="cb24-45"><a href="#cb24-45"></a><span class="fu">ls</span>()</span>
<span id="cb24-46"><a href="#cb24-46"></a><span class="in">```</span></span>
<span id="cb24-47"><a href="#cb24-47"></a></span>
<span id="cb24-48"><a href="#cb24-48"></a><span class="fu">#### Retaining only useful variables</span></span>
<span id="cb24-49"><a href="#cb24-49"></a></span>
<span id="cb24-50"><a href="#cb24-50"></a><span class="in">```{r retain, message=FALSE, warning=FALSE}</span></span>
<span id="cb24-51"><a href="#cb24-51"></a><span class="co"># Data dimensions</span></span>
<span id="cb24-52"><a href="#cb24-52"></a><span class="fu">dim</span>(analytic)</span>
<span id="cb24-53"><a href="#cb24-53"></a></span>
<span id="cb24-54"><a href="#cb24-54"></a><span class="co"># Variable names</span></span>
<span id="cb24-55"><a href="#cb24-55"></a><span class="fu">names</span>(analytic)</span>
<span id="cb24-56"><a href="#cb24-56"></a></span>
<span id="cb24-57"><a href="#cb24-57"></a><span class="co">#Subsetting dataset with variables needed:</span></span>
<span id="cb24-58"><a href="#cb24-58"></a><span class="fu">require</span>(dplyr)</span>
<span id="cb24-59"><a href="#cb24-59"></a>anadata <span class="ot">&lt;-</span> <span class="fu">select</span>(analytic, </span>
<span id="cb24-60"><a href="#cb24-60"></a>                  cholesterol, <span class="co">#outcome</span></span>
<span id="cb24-61"><a href="#cb24-61"></a>                  gender, age, born, race, education, married, income, bmi, diabetes, <span class="co">#predictors</span></span>
<span id="cb24-62"><a href="#cb24-62"></a>                  weight, psu, strata) <span class="co">#survey features</span></span>
<span id="cb24-63"><a href="#cb24-63"></a></span>
<span id="cb24-64"><a href="#cb24-64"></a><span class="co"># new data sizes</span></span>
<span id="cb24-65"><a href="#cb24-65"></a><span class="fu">dim</span>(anadata)</span>
<span id="cb24-66"><a href="#cb24-66"></a></span>
<span id="cb24-67"><a href="#cb24-67"></a><span class="co"># retained variable names</span></span>
<span id="cb24-68"><a href="#cb24-68"></a><span class="fu">names</span>(anadata)</span>
<span id="cb24-69"><a href="#cb24-69"></a></span>
<span id="cb24-70"><a href="#cb24-70"></a><span class="co">#Restricting to participants who are 18 or older</span></span>
<span id="cb24-71"><a href="#cb24-71"></a><span class="fu">summary</span>(anadata<span class="sc">$</span>age) <span class="co">#The age range is already 20-80</span></span>
<span id="cb24-72"><a href="#cb24-72"></a></span>
<span id="cb24-73"><a href="#cb24-73"></a><span class="co">#Recoding the born variable</span></span>
<span id="cb24-74"><a href="#cb24-74"></a><span class="fu">table</span>(anadata<span class="sc">$</span>born, <span class="at">useNA =</span> <span class="st">"always"</span>)</span>
<span id="cb24-75"><a href="#cb24-75"></a><span class="fu">levels</span>(anadata<span class="sc">$</span>born)</span>
<span id="cb24-76"><a href="#cb24-76"></a>anadata<span class="sc">$</span>born <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">recode</span>(anadata<span class="sc">$</span>born,</span>
<span id="cb24-77"><a href="#cb24-77"></a>                            <span class="st">"'Born in 50 US states or Washingt' = 'Born.in.US';</span></span>
<span id="cb24-78"><a href="#cb24-78"></a><span class="st">                            'Others' = 'Others';</span></span>
<span id="cb24-79"><a href="#cb24-79"></a><span class="st">                            else=NA"</span>)</span>
<span id="cb24-80"><a href="#cb24-80"></a><span class="fu">table</span>(anadata<span class="sc">$</span>born, <span class="at">useNA =</span> <span class="st">"always"</span>)</span>
<span id="cb24-81"><a href="#cb24-81"></a><span class="in">```</span></span>
<span id="cb24-82"><a href="#cb24-82"></a></span>
<span id="cb24-83"><a href="#cb24-83"></a><span class="fu">#### Checking the data for missing</span></span>
<span id="cb24-84"><a href="#cb24-84"></a></span>
<span id="cb24-85"><a href="#cb24-85"></a><span class="in">```{r miss0, message=FALSE, warning=FALSE}</span></span>
<span id="cb24-86"><a href="#cb24-86"></a><span class="fu">require</span>(DataExplorer)</span>
<span id="cb24-87"><a href="#cb24-87"></a><span class="fu">plot_missing</span>(anadata) <span class="co">#no missing data</span></span>
<span id="cb24-88"><a href="#cb24-88"></a><span class="in">```</span></span>
<span id="cb24-89"><a href="#cb24-89"></a></span>
<span id="cb24-90"><a href="#cb24-90"></a><span class="fu">#### Preparing factor and continuous variables appropriately</span></span>
<span id="cb24-91"><a href="#cb24-91"></a></span>
<span id="cb24-92"><a href="#cb24-92"></a><span class="in">```{r vars, message=FALSE, warning=FALSE}</span></span>
<span id="cb24-93"><a href="#cb24-93"></a>vars <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"cholesterol"</span>, <span class="st">"gender"</span>, <span class="st">"born"</span>, <span class="st">"race"</span>, <span class="st">"education"</span>, </span>
<span id="cb24-94"><a href="#cb24-94"></a>         <span class="st">"married"</span>, <span class="st">"income"</span>, <span class="st">"bmi"</span>, <span class="st">"diabetes"</span>)</span>
<span id="cb24-95"><a href="#cb24-95"></a>numeric.names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"cholesterol"</span>, <span class="st">"bmi"</span>)</span>
<span id="cb24-96"><a href="#cb24-96"></a>factor.names <span class="ot">&lt;-</span> vars[<span class="sc">!</span>vars <span class="sc">%in%</span> numeric.names] </span>
<span id="cb24-97"><a href="#cb24-97"></a></span>
<span id="cb24-98"><a href="#cb24-98"></a>anadata[factor.names] <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="at">X =</span> anadata[factor.names],</span>
<span id="cb24-99"><a href="#cb24-99"></a>                               <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> as.factor)</span>
<span id="cb24-100"><a href="#cb24-100"></a></span>
<span id="cb24-101"><a href="#cb24-101"></a>anadata[numeric.names] <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="at">X =</span> anadata[numeric.names],</span>
<span id="cb24-102"><a href="#cb24-102"></a>                                <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span><span class="cf">function</span> (x) </span>
<span id="cb24-103"><a href="#cb24-103"></a>                                  <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(x)))</span>
<span id="cb24-104"><a href="#cb24-104"></a><span class="in">```</span></span>
<span id="cb24-105"><a href="#cb24-105"></a></span>
<span id="cb24-106"><a href="#cb24-106"></a><span class="fu">#### Table 1</span></span>
<span id="cb24-107"><a href="#cb24-107"></a></span>
<span id="cb24-108"><a href="#cb24-108"></a><span class="in">```{r tab1, message=FALSE, warning=FALSE}</span></span>
<span id="cb24-109"><a href="#cb24-109"></a><span class="fu">library</span>(tableone)</span>
<span id="cb24-110"><a href="#cb24-110"></a>tab1 <span class="ot">&lt;-</span> <span class="fu">CreateTableOne</span>(<span class="at">data =</span> anadata, <span class="at">includeNA =</span> <span class="cn">TRUE</span>, <span class="at">vars =</span> vars)</span>
<span id="cb24-111"><a href="#cb24-111"></a><span class="fu">print</span>(tab1, <span class="at">showAllLevels =</span> <span class="cn">TRUE</span>,  <span class="at">varLabels =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-112"><a href="#cb24-112"></a><span class="in">```</span></span>
<span id="cb24-113"><a href="#cb24-113"></a></span>
<span id="cb24-114"><a href="#cb24-114"></a><span class="fu">### Linear regression when cholesterol is continuous</span></span>
<span id="cb24-115"><a href="#cb24-115"></a></span>
<span id="cb24-116"><a href="#cb24-116"></a>Fit a linear regression, and report the VIFs.</span>
<span id="cb24-117"><a href="#cb24-117"></a></span>
<span id="cb24-118"><a href="#cb24-118"></a><span class="in">```{r lm, message=FALSE, warning=FALSE}</span></span>
<span id="cb24-119"><a href="#cb24-119"></a><span class="co">#Fitting initial regression</span></span>
<span id="cb24-120"><a href="#cb24-120"></a></span>
<span id="cb24-121"><a href="#cb24-121"></a>fit0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(cholesterol <span class="sc">~</span> gender <span class="sc">+</span> born <span class="sc">+</span> race <span class="sc">+</span> education <span class="sc">+</span></span>
<span id="cb24-122"><a href="#cb24-122"></a>              married <span class="sc">+</span> income <span class="sc">+</span> bmi <span class="sc">+</span> diabetes,</span>
<span id="cb24-123"><a href="#cb24-123"></a>            <span class="at">data =</span> anadata)</span>
<span id="cb24-124"><a href="#cb24-124"></a></span>
<span id="cb24-125"><a href="#cb24-125"></a><span class="fu">library</span>(Publish)</span>
<span id="cb24-126"><a href="#cb24-126"></a><span class="fu">publish</span>(fit0)</span>
<span id="cb24-127"><a href="#cb24-127"></a></span>
<span id="cb24-128"><a href="#cb24-128"></a><span class="co">#Checking VIFs</span></span>
<span id="cb24-129"><a href="#cb24-129"></a>car<span class="sc">::</span><span class="fu">vif</span>(fit0) </span>
<span id="cb24-130"><a href="#cb24-130"></a><span class="in">```</span></span>
<span id="cb24-131"><a href="#cb24-131"></a></span>
<span id="cb24-132"><a href="#cb24-132"></a>All VIFs are small.</span>
<span id="cb24-133"><a href="#cb24-133"></a></span>
<span id="cb24-134"><a href="#cb24-134"></a><span class="fu">### Test of association when cholesterol is binary</span></span>
<span id="cb24-135"><a href="#cb24-135"></a></span>
<span id="cb24-136"><a href="#cb24-136"></a>Dichotomize the outcome such that cholesterol<span class="sc">\&lt;</span>200 is labeled as 'healthy'; otherwise label it as 'unhealthy', and name it 'cholesterol.bin'. Test the association between this binary variable and gender.</span>
<span id="cb24-137"><a href="#cb24-137"></a></span>
<span id="cb24-138"><a href="#cb24-138"></a><span class="in">```{r binary, message=FALSE, warning=FALSE}</span></span>
<span id="cb24-139"><a href="#cb24-139"></a><span class="co">#Creating binary variable for cholesterol</span></span>
<span id="cb24-140"><a href="#cb24-140"></a>anadata<span class="sc">$</span>cholesterol.bin <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(anadata<span class="sc">$</span>cholesterol <span class="sc">&lt;</span><span class="dv">200</span>, <span class="st">"healthy"</span>, <span class="st">"unhealthy"</span>)</span>
<span id="cb24-141"><a href="#cb24-141"></a><span class="co">#If cholesterol is &lt;200, then "healthy", if not, "unhealthy"</span></span>
<span id="cb24-142"><a href="#cb24-142"></a></span>
<span id="cb24-143"><a href="#cb24-143"></a><span class="fu">table</span>(anadata<span class="sc">$</span>cholesterol.bin)</span>
<span id="cb24-144"><a href="#cb24-144"></a>anadata<span class="sc">$</span>cholesterol.bin <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(anadata<span class="sc">$</span>cholesterol.bin)</span>
<span id="cb24-145"><a href="#cb24-145"></a>anadata<span class="sc">$</span>cholesterol.bin <span class="ot">&lt;-</span> <span class="fu">relevel</span>(anadata<span class="sc">$</span>cholesterol.bin, <span class="at">ref =</span> <span class="st">"unhealthy"</span>)</span>
<span id="cb24-146"><a href="#cb24-146"></a><span class="in">```</span></span>
<span id="cb24-147"><a href="#cb24-147"></a></span>
<span id="cb24-148"><a href="#cb24-148"></a><span class="fu">#### Test of association between cholesterol and gender (no survey features)</span></span>
<span id="cb24-149"><a href="#cb24-149"></a></span>
<span id="cb24-150"><a href="#cb24-150"></a><span class="in">```{r test, message=FALSE, warning=FALSE}</span></span>
<span id="cb24-151"><a href="#cb24-151"></a><span class="co"># Simple Chi-square testing</span></span>
<span id="cb24-152"><a href="#cb24-152"></a>chisq.chol.gen <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(anadata<span class="sc">$</span>cholesterol.bin, anadata<span class="sc">$</span>gender)</span>
<span id="cb24-153"><a href="#cb24-153"></a>chisq.chol.gen</span>
<span id="cb24-154"><a href="#cb24-154"></a><span class="in">```</span></span>
<span id="cb24-155"><a href="#cb24-155"></a></span>
<span id="cb24-156"><a href="#cb24-156"></a><span class="fu">#### Setting up survey design</span></span>
<span id="cb24-157"><a href="#cb24-157"></a></span>
<span id="cb24-158"><a href="#cb24-158"></a><span class="in">```{r design, message=FALSE, warning=FALSE}</span></span>
<span id="cb24-159"><a href="#cb24-159"></a><span class="fu">require</span>(survey)</span>
<span id="cb24-160"><a href="#cb24-160"></a><span class="fu">summary</span>(anadata<span class="sc">$</span>weight)</span>
<span id="cb24-161"><a href="#cb24-161"></a>w.design <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">id =</span> <span class="sc">~</span>psu, <span class="at">weights =</span> <span class="sc">~</span>weight, <span class="at">strata =</span> <span class="sc">~</span>strata,</span>
<span id="cb24-162"><a href="#cb24-162"></a>                      <span class="at">nest =</span> <span class="cn">TRUE</span>, <span class="at">data =</span> anadata)</span>
<span id="cb24-163"><a href="#cb24-163"></a><span class="fu">summary</span>(<span class="fu">weights</span>(w.design))</span>
<span id="cb24-164"><a href="#cb24-164"></a><span class="in">```</span></span>
<span id="cb24-165"><a href="#cb24-165"></a></span>
<span id="cb24-166"><a href="#cb24-166"></a><span class="fu">#### Test of association accounting for survey design</span></span>
<span id="cb24-167"><a href="#cb24-167"></a></span>
<span id="cb24-168"><a href="#cb24-168"></a><span class="in">```{r raotest, message=FALSE, warning=FALSE}</span></span>
<span id="cb24-169"><a href="#cb24-169"></a><span class="co">#Rao-Scott modifications (chi-sq)</span></span>
<span id="cb24-170"><a href="#cb24-170"></a><span class="fu">svychisq</span>(<span class="sc">~</span>cholesterol.bin <span class="sc">+</span> gender, <span class="at">design =</span> w.design, <span class="at">statistic =</span> <span class="st">"Chisq"</span>)</span>
<span id="cb24-171"><a href="#cb24-171"></a></span>
<span id="cb24-172"><a href="#cb24-172"></a><span class="co">#Thomas-Rao modifications (F)</span></span>
<span id="cb24-173"><a href="#cb24-173"></a><span class="fu">svychisq</span>(<span class="sc">~</span>cholesterol.bin <span class="sc">+</span> gender, <span class="at">design =</span> w.design, <span class="at">statistic =</span> <span class="st">"F"</span>) </span>
<span id="cb24-174"><a href="#cb24-174"></a><span class="in">```</span></span>
<span id="cb24-175"><a href="#cb24-175"></a></span>
<span id="cb24-176"><a href="#cb24-176"></a>All three tests indicate strong evidence to reject the H0. There seems to be an association between gender and cholesterol level (healthy/unhealthy)</span>
<span id="cb24-177"><a href="#cb24-177"></a></span>
<span id="cb24-178"><a href="#cb24-178"></a><span class="fu">### Table 1</span></span>
<span id="cb24-179"><a href="#cb24-179"></a></span>
<span id="cb24-180"><a href="#cb24-180"></a>Create a Table 1 (summarizing the covariates) stratified by the binary outcome: cholesterol.bin, utilizing the above survey features.</span>
<span id="cb24-181"><a href="#cb24-181"></a></span>
<span id="cb24-182"><a href="#cb24-182"></a><span class="in">```{r tab11, message=FALSE, warning=FALSE}</span></span>
<span id="cb24-183"><a href="#cb24-183"></a><span class="co"># Creating Table 1 stratified by binary outcome (cholesterol)</span></span>
<span id="cb24-184"><a href="#cb24-184"></a><span class="co"># Using the survey features</span></span>
<span id="cb24-185"><a href="#cb24-185"></a></span>
<span id="cb24-186"><a href="#cb24-186"></a>vars2 <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"gender"</span>, <span class="st">"born"</span>, <span class="st">"race"</span>, <span class="st">"education"</span>, </span>
<span id="cb24-187"><a href="#cb24-187"></a>         <span class="st">"married"</span>, <span class="st">"income"</span>, <span class="st">"bmi"</span>, <span class="st">"diabetes"</span>)</span>
<span id="cb24-188"><a href="#cb24-188"></a></span>
<span id="cb24-189"><a href="#cb24-189"></a></span>
<span id="cb24-190"><a href="#cb24-190"></a>kableone <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) {</span>
<span id="cb24-191"><a href="#cb24-191"></a>  <span class="fu">capture.output</span>(x <span class="ot">&lt;-</span> <span class="fu">print</span>(x, <span class="at">showAllLevels=</span> <span class="cn">TRUE</span>, <span class="at">padColnames =</span> <span class="cn">TRUE</span>, <span class="at">insertLevel =</span> <span class="cn">TRUE</span>))</span>
<span id="cb24-192"><a href="#cb24-192"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(x, ...)</span>
<span id="cb24-193"><a href="#cb24-193"></a>}</span>
<span id="cb24-194"><a href="#cb24-194"></a><span class="fu">kableone</span>(<span class="fu">svyCreateTableOne</span>(<span class="at">var =</span> vars2, <span class="at">strata=</span> <span class="st">"cholesterol.bin"</span>, <span class="at">data=</span>w.design, <span class="at">test =</span> <span class="cn">TRUE</span>)) </span>
<span id="cb24-195"><a href="#cb24-195"></a><span class="in">```</span></span>
<span id="cb24-196"><a href="#cb24-196"></a></span>
<span id="cb24-197"><a href="#cb24-197"></a><span class="fu">### Logistic regression model</span></span>
<span id="cb24-198"><a href="#cb24-198"></a></span>
<span id="cb24-199"><a href="#cb24-199"></a>Run a logistic regression model using the same variables, utilizing the survey features. Report the corresponding odds ratios and the 95% confidence intervals.</span>
<span id="cb24-200"><a href="#cb24-200"></a></span>
<span id="cb24-201"><a href="#cb24-201"></a><span class="in">```{r logistic, message=FALSE, warning=FALSE}</span></span>
<span id="cb24-202"><a href="#cb24-202"></a>formula1 <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">I</span>(cholesterol.bin<span class="sc">==</span><span class="st">"unhealthy"</span>) <span class="sc">~</span> gender <span class="sc">+</span> born <span class="sc">+</span></span>
<span id="cb24-203"><a href="#cb24-203"></a>                         race <span class="sc">+</span> education <span class="sc">+</span> married <span class="sc">+</span> income <span class="sc">+</span> bmi <span class="sc">+</span></span>
<span id="cb24-204"><a href="#cb24-204"></a>                         diabetes)</span>
<span id="cb24-205"><a href="#cb24-205"></a></span>
<span id="cb24-206"><a href="#cb24-206"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(formula1,</span>
<span id="cb24-207"><a href="#cb24-207"></a>               <span class="at">design =</span> w.design, </span>
<span id="cb24-208"><a href="#cb24-208"></a>               <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb24-209"><a href="#cb24-209"></a></span>
<span id="cb24-210"><a href="#cb24-210"></a><span class="fu">publish</span>(fit1)</span>
<span id="cb24-211"><a href="#cb24-211"></a><span class="in">```</span></span>
<span id="cb24-212"><a href="#cb24-212"></a></span>
<span id="cb24-213"><a href="#cb24-213"></a><span class="fu">### Wald test (survey version)</span></span>
<span id="cb24-214"><a href="#cb24-214"></a></span>
<span id="cb24-215"><a href="#cb24-215"></a>Perform a Wald test (survey version) to test the null hypothesis that all coefficients associated with the income variable are zero, and interpret.</span>
<span id="cb24-216"><a href="#cb24-216"></a></span>
<span id="cb24-217"><a href="#cb24-217"></a><span class="in">```{r wald, message=FALSE, warning=FALSE}</span></span>
<span id="cb24-218"><a href="#cb24-218"></a><span class="co">#Testing the H0 that all coefficients associated with the income variable are zero</span></span>
<span id="cb24-219"><a href="#cb24-219"></a><span class="fu">regTermTest</span>(fit1, <span class="sc">~</span>income)</span>
<span id="cb24-220"><a href="#cb24-220"></a><span class="in">```</span></span>
<span id="cb24-221"><a href="#cb24-221"></a></span>
<span id="cb24-222"><a href="#cb24-222"></a>The Wald test here gives a large p-value; We do not have evidence to reject the H0 of coefficient being 0. If the coefficient for income variable is 0, this means that the outcome in the model (cholesterol) is not affected by income. This suggests that removing income from the model does not statistically improve the model fit. So we can remove income variable from the model.</span>
<span id="cb24-223"><a href="#cb24-223"></a></span>
<span id="cb24-224"><a href="#cb24-224"></a><span class="fu">### Backward elimination</span></span>
<span id="cb24-225"><a href="#cb24-225"></a></span>
<span id="cb24-226"><a href="#cb24-226"></a>Run a backward elimination (using the AIC criteria) on the above logistic regression fit (keeping important variables gender, race, bmi, diabetes in the model), and report the odds ratios and the 95% confidence intervals from the resulting final logistic regression fit.</span>
<span id="cb24-227"><a href="#cb24-227"></a></span>
<span id="cb24-228"><a href="#cb24-228"></a><span class="in">```{r backward, message=FALSE, warning=FALSE}</span></span>
<span id="cb24-229"><a href="#cb24-229"></a><span class="co">#Running backward elimination based on AIC</span></span>
<span id="cb24-230"><a href="#cb24-230"></a><span class="fu">require</span>(MASS)</span>
<span id="cb24-231"><a href="#cb24-231"></a>scope <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">upper =</span> <span class="sc">~</span> gender <span class="sc">+</span> born <span class="sc">+</span> race <span class="sc">+</span> education <span class="sc">+</span> </span>
<span id="cb24-232"><a href="#cb24-232"></a>                married <span class="sc">+</span> income <span class="sc">+</span> bmi <span class="sc">+</span> diabetes,</span>
<span id="cb24-233"><a href="#cb24-233"></a>              <span class="at">lower =</span> <span class="sc">~</span> gender <span class="sc">+</span> race <span class="sc">+</span> bmi <span class="sc">+</span> diabetes)</span>
<span id="cb24-234"><a href="#cb24-234"></a></span>
<span id="cb24-235"><a href="#cb24-235"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">step</span>(fit1, <span class="at">scope =</span> scope, <span class="at">trace =</span> <span class="cn">FALSE</span>,</span>
<span id="cb24-236"><a href="#cb24-236"></a>                <span class="at">k =</span> <span class="dv">2</span>, <span class="at">direction =</span> <span class="st">"backward"</span>)</span>
<span id="cb24-237"><a href="#cb24-237"></a></span>
<span id="cb24-238"><a href="#cb24-238"></a><span class="co">#Odds Ratios</span></span>
<span id="cb24-239"><a href="#cb24-239"></a><span class="fu">publish</span>(fit3)</span>
<span id="cb24-240"><a href="#cb24-240"></a><span class="in">```</span></span>
<span id="cb24-241"><a href="#cb24-241"></a></span>
<span id="cb24-242"><a href="#cb24-242"></a>Born and married are also found to be useful on top of gender + race + bmi + diabetes.</span>
<span id="cb24-243"><a href="#cb24-243"></a></span>
<span id="cb24-244"><a href="#cb24-244"></a><span class="fu">### Interaction terms</span></span>
<span id="cb24-245"><a href="#cb24-245"></a></span>
<span id="cb24-246"><a href="#cb24-246"></a>Checking interaction terms</span>
<span id="cb24-247"><a href="#cb24-247"></a></span>
<span id="cb24-248"><a href="#cb24-248"></a>-- gender and whether married</span>
<span id="cb24-249"><a href="#cb24-249"></a></span>
<span id="cb24-250"><a href="#cb24-250"></a>-- gender and whether born in the US</span>
<span id="cb24-251"><a href="#cb24-251"></a></span>
<span id="cb24-252"><a href="#cb24-252"></a>-- gender and diabetes</span>
<span id="cb24-253"><a href="#cb24-253"></a></span>
<span id="cb24-254"><a href="#cb24-254"></a>-- whether married and diabetes</span>
<span id="cb24-255"><a href="#cb24-255"></a></span>
<span id="cb24-256"><a href="#cb24-256"></a><span class="in">```{r int4, message=FALSE, warning=FALSE}</span></span>
<span id="cb24-257"><a href="#cb24-257"></a><span class="co">#gender and married</span></span>
<span id="cb24-258"><a href="#cb24-258"></a>fit4 <span class="ot">&lt;-</span> <span class="fu">update</span>(fit3, .<span class="sc">~</span>. <span class="sc">+</span> <span class="fu">interaction</span>(gender, married))</span>
<span id="cb24-259"><a href="#cb24-259"></a><span class="fu">anova</span>(fit3, fit4)</span>
<span id="cb24-260"><a href="#cb24-260"></a><span class="in">```</span></span>
<span id="cb24-261"><a href="#cb24-261"></a></span>
<span id="cb24-262"><a href="#cb24-262"></a>Do not include interaction term</span>
<span id="cb24-263"><a href="#cb24-263"></a></span>
<span id="cb24-264"><a href="#cb24-264"></a><span class="in">```{r int3, message=FALSE, warning=FALSE}</span></span>
<span id="cb24-265"><a href="#cb24-265"></a><span class="co">#gender and born in us</span></span>
<span id="cb24-266"><a href="#cb24-266"></a>fit5 <span class="ot">&lt;-</span> <span class="fu">update</span>(fit3, .<span class="sc">~</span>. <span class="sc">+</span> <span class="fu">interaction</span>(gender, born))</span>
<span id="cb24-267"><a href="#cb24-267"></a><span class="fu">anova</span>(fit3, fit5)</span>
<span id="cb24-268"><a href="#cb24-268"></a><span class="in">```</span></span>
<span id="cb24-269"><a href="#cb24-269"></a></span>
<span id="cb24-270"><a href="#cb24-270"></a>Do not include interaction term</span>
<span id="cb24-271"><a href="#cb24-271"></a></span>
<span id="cb24-272"><a href="#cb24-272"></a><span class="in">```{r int2, message=FALSE, warning=FALSE}</span></span>
<span id="cb24-273"><a href="#cb24-273"></a><span class="co">#gender and diabetes</span></span>
<span id="cb24-274"><a href="#cb24-274"></a>fit6 <span class="ot">&lt;-</span> <span class="fu">update</span>(fit3, .<span class="sc">~</span>. <span class="sc">+</span> <span class="fu">interaction</span>(gender, diabetes))</span>
<span id="cb24-275"><a href="#cb24-275"></a><span class="fu">anova</span>(fit3, fit6)</span>
<span id="cb24-276"><a href="#cb24-276"></a><span class="in">```</span></span>
<span id="cb24-277"><a href="#cb24-277"></a></span>
<span id="cb24-278"><a href="#cb24-278"></a>Do not include interaction term</span>
<span id="cb24-279"><a href="#cb24-279"></a></span>
<span id="cb24-280"><a href="#cb24-280"></a><span class="in">```{r int1, message=FALSE, warning=FALSE}</span></span>
<span id="cb24-281"><a href="#cb24-281"></a><span class="co">#married and diabetes</span></span>
<span id="cb24-282"><a href="#cb24-282"></a>fit7 <span class="ot">&lt;-</span> <span class="fu">update</span>(fit3, .<span class="sc">~</span>. <span class="sc">+</span> <span class="fu">interaction</span>(married, diabetes))</span>
<span id="cb24-283"><a href="#cb24-283"></a><span class="fu">anova</span>(fit3, fit7)</span>
<span id="cb24-284"><a href="#cb24-284"></a><span class="in">```</span></span>
<span id="cb24-285"><a href="#cb24-285"></a></span>
<span id="cb24-286"><a href="#cb24-286"></a>Do not include interaction term</span>
<span id="cb24-287"><a href="#cb24-287"></a></span>
<span id="cb24-288"><a href="#cb24-288"></a>None of the interaction terms are improving the model fit.</span>
<span id="cb24-289"><a href="#cb24-289"></a></span>
<span id="cb24-290"><a href="#cb24-290"></a><span class="fu">### AUC</span></span>
<span id="cb24-291"><a href="#cb24-291"></a></span>
<span id="cb24-292"><a href="#cb24-292"></a>Report AUC of the final model (only using weight argument) and interpret.</span>
<span id="cb24-293"><a href="#cb24-293"></a></span>
<span id="cb24-294"><a href="#cb24-294"></a>AUC of the final model (only using weight argument) and interpret</span>
<span id="cb24-295"><a href="#cb24-295"></a></span>
<span id="cb24-296"><a href="#cb24-296"></a><span class="in">```{r auc, message=FALSE, warning=FALSE}</span></span>
<span id="cb24-297"><a href="#cb24-297"></a><span class="fu">require</span>(ROCR)</span>
<span id="cb24-298"><a href="#cb24-298"></a><span class="co"># WeightedROC may not be on cran for all R versions</span></span>
<span id="cb24-299"><a href="#cb24-299"></a><span class="co"># devtools::install_github("tdhock/WeightedROC")</span></span>
<span id="cb24-300"><a href="#cb24-300"></a></span>
<span id="cb24-301"><a href="#cb24-301"></a><span class="fu">library</span>(WeightedROC)</span>
<span id="cb24-302"><a href="#cb24-302"></a>svyROCw <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">fit =</span> fit3, <span class="at">outcome =</span> anadata<span class="sc">$</span>cholesterol.bin <span class="sc">==</span> <span class="st">"unhealthy"</span>, <span class="at">weight =</span> anadata<span class="sc">$</span>weight){</span>
<span id="cb24-303"><a href="#cb24-303"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(weight)){ <span class="co"># require(ROCR)</span></span>
<span id="cb24-304"><a href="#cb24-304"></a>    prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb24-305"><a href="#cb24-305"></a>  pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(<span class="fu">as.vector</span>(prob), outcome)</span>
<span id="cb24-306"><a href="#cb24-306"></a>  perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="st">"tpr"</span>, <span class="st">"fpr"</span>)</span>
<span id="cb24-307"><a href="#cb24-307"></a>  auc <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="at">measure =</span> <span class="st">"auc"</span>)</span>
<span id="cb24-308"><a href="#cb24-308"></a>  auc <span class="ot">&lt;-</span> auc<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb24-309"><a href="#cb24-309"></a>  roc.data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">fpr =</span> <span class="fu">unlist</span>(perf<span class="sc">@</span>x.values), <span class="at">tpr =</span> <span class="fu">unlist</span>(perf<span class="sc">@</span>y.values), </span>
<span id="cb24-310"><a href="#cb24-310"></a>      <span class="at">model =</span> <span class="st">"Logistic"</span>)</span>
<span id="cb24-311"><a href="#cb24-311"></a>  <span class="fu">with</span>(<span class="at">data =</span> roc.data,<span class="fu">plot</span>(fpr, tpr, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">lwd=</span><span class="dv">1</span>,</span>
<span id="cb24-312"><a href="#cb24-312"></a>     <span class="at">xlab=</span><span class="st">"1 - specificity"</span>, <span class="at">ylab=</span><span class="st">"Sensitivity"</span>,</span>
<span id="cb24-313"><a href="#cb24-313"></a>     <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"AUC = "</span>, <span class="fu">round</span>(auc,<span class="dv">3</span>))))</span>
<span id="cb24-314"><a href="#cb24-314"></a>  <span class="fu">mtext</span>(<span class="st">"Unweighted ROC"</span>)</span>
<span id="cb24-315"><a href="#cb24-315"></a>  <span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb24-316"><a href="#cb24-316"></a>  } <span class="cf">else</span> { </span>
<span id="cb24-317"><a href="#cb24-317"></a>    outcome <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(outcome)</span>
<span id="cb24-318"><a href="#cb24-318"></a>  pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb24-319"><a href="#cb24-319"></a>  tp.fp <span class="ot">&lt;-</span> <span class="fu">WeightedROC</span>(pred, outcome, weight)</span>
<span id="cb24-320"><a href="#cb24-320"></a>  auc <span class="ot">&lt;-</span> <span class="fu">WeightedAUC</span>(tp.fp)</span>
<span id="cb24-321"><a href="#cb24-321"></a>  <span class="fu">with</span>(<span class="at">data =</span> tp.fp,<span class="fu">plot</span>(FPR, TPR, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">lwd=</span><span class="dv">1</span>,</span>
<span id="cb24-322"><a href="#cb24-322"></a>     <span class="at">xlab=</span><span class="st">"1 - specificity"</span>, <span class="at">ylab=</span><span class="st">"Sensitivity"</span>,</span>
<span id="cb24-323"><a href="#cb24-323"></a>     <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"AUC = "</span>, <span class="fu">round</span>(auc,<span class="dv">3</span>))))</span>
<span id="cb24-324"><a href="#cb24-324"></a>  <span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb24-325"><a href="#cb24-325"></a>  <span class="fu">mtext</span>(<span class="st">"Weighted ROC"</span>)</span>
<span id="cb24-326"><a href="#cb24-326"></a>  }</span>
<span id="cb24-327"><a href="#cb24-327"></a>}</span>
<span id="cb24-328"><a href="#cb24-328"></a><span class="fu">svyROCw</span>(<span class="at">fit =</span> fit3, <span class="at">outcome =</span> anadata<span class="sc">$</span>cholesterol.bin <span class="sc">==</span> <span class="st">"unhealthy"</span>, <span class="at">weight =</span> anadata<span class="sc">$</span>weight)</span>
<span id="cb24-329"><a href="#cb24-329"></a><span class="in">```</span></span>
<span id="cb24-330"><a href="#cb24-330"></a></span>
<span id="cb24-331"><a href="#cb24-331"></a>The area under the curve in the final model is 0.611, using the survey weighted ROC. The AUC of 0.611 indicates that this model has poor discrimination.</span>
<span id="cb24-332"><a href="#cb24-332"></a></span>
<span id="cb24-333"><a href="#cb24-333"></a><span class="fu">### Archer-Lemeshow Goodness of fit</span></span>
<span id="cb24-334"><a href="#cb24-334"></a></span>
<span id="cb24-335"><a href="#cb24-335"></a>Report Archer-Lemeshow Goodness of fit test and interpret (utilizing all the survey features).</span>
<span id="cb24-336"><a href="#cb24-336"></a></span>
<span id="cb24-337"><a href="#cb24-337"></a><span class="in">```{r gof, message=FALSE, warning=FALSE}</span></span>
<span id="cb24-338"><a href="#cb24-338"></a><span class="co">#Archer-Lemeshow Goodness of fit test utilizing all survey features</span></span>
<span id="cb24-339"><a href="#cb24-339"></a>AL.gof2 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">fit =</span> fit3, <span class="at">data =</span> anadata, </span>
<span id="cb24-340"><a href="#cb24-340"></a>                   <span class="at">weight =</span> <span class="st">"weight"</span>, <span class="at">psu =</span> <span class="st">"psu"</span>, <span class="at">strata =</span> <span class="st">"strata"</span>){</span>
<span id="cb24-341"><a href="#cb24-341"></a>  r <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit, <span class="at">type =</span> <span class="st">"response"</span>) </span>
<span id="cb24-342"><a href="#cb24-342"></a>  f<span class="ot">&lt;-</span><span class="fu">fitted</span>(fit) </span>
<span id="cb24-343"><a href="#cb24-343"></a>  breaks.g <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="fu">quantile</span>(f, (<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>)<span class="sc">/</span><span class="dv">10</span>), <span class="cn">Inf</span>)</span>
<span id="cb24-344"><a href="#cb24-344"></a>  breaks.g <span class="ot">&lt;-</span> breaks.g <span class="sc">+</span> <span class="fu">seq_along</span>(breaks.g) <span class="sc">*</span> .Machine<span class="sc">$</span>double.eps</span>
<span id="cb24-345"><a href="#cb24-345"></a>  g<span class="ot">&lt;-</span> <span class="fu">cut</span>(f, breaks.g)</span>
<span id="cb24-346"><a href="#cb24-346"></a>  data2g <span class="ot">&lt;-</span> <span class="fu">cbind</span>(data,r,g)</span>
<span id="cb24-347"><a href="#cb24-347"></a>  newdesign <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">id=</span><span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~"</span>,psu)),</span>
<span id="cb24-348"><a href="#cb24-348"></a>                         <span class="at">strata=</span><span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~"</span>,strata)),</span>
<span id="cb24-349"><a href="#cb24-349"></a>                         <span class="at">weights=</span><span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~"</span>,weight)), </span>
<span id="cb24-350"><a href="#cb24-350"></a>                         <span class="at">data=</span>data2g, <span class="at">nest =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-351"><a href="#cb24-351"></a>  decilemodel <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(r<span class="sc">~</span>g, <span class="at">design=</span>newdesign) </span>
<span id="cb24-352"><a href="#cb24-352"></a>  res <span class="ot">&lt;-</span> <span class="fu">regTermTest</span>(decilemodel, <span class="sc">~</span>g)</span>
<span id="cb24-353"><a href="#cb24-353"></a>  <span class="fu">return</span>(res) </span>
<span id="cb24-354"><a href="#cb24-354"></a>}</span>
<span id="cb24-355"><a href="#cb24-355"></a></span>
<span id="cb24-356"><a href="#cb24-356"></a><span class="fu">AL.gof2</span>(fit3, anadata, <span class="at">weight =</span> <span class="st">"weight"</span>, <span class="at">psu =</span> <span class="st">"psu"</span>, <span class="at">strata =</span> <span class="st">"strata"</span>)</span>
<span id="cb24-357"><a href="#cb24-357"></a><span class="in">```</span></span>
<span id="cb24-358"><a href="#cb24-358"></a></span>
<span id="cb24-359"><a href="#cb24-359"></a>Archer and Lemeshow GoF test was used to test the fit of this model. The p-value of 0.3043, which is greater than 0.05. This means that there is no evidence of lack of fit to this model.</span>
<span id="cb24-360"><a href="#cb24-360"></a></span>
<span id="cb24-361"><a href="#cb24-361"></a><span class="fu">### Add `age` as a predictor for linear regression</span></span>
<span id="cb24-362"><a href="#cb24-362"></a></span>
<span id="cb24-363"><a href="#cb24-363"></a>Fit another logistic regression (similar to Q1) with the above-mentioned predictors (as obtained in Q7) and age, utilizing the survey features. What difference do you see from the previous fit results?</span>
<span id="cb24-364"><a href="#cb24-364"></a></span>
<span id="cb24-365"><a href="#cb24-365"></a><span class="in">```{r lin0, message=FALSE, warning=FALSE}</span></span>
<span id="cb24-366"><a href="#cb24-366"></a>aic.int.model <span class="ot">&lt;-</span> <span class="fu">eval</span>(fit3<span class="sc">$</span>call[[<span class="dv">2</span>]])</span>
<span id="cb24-367"><a href="#cb24-367"></a>aic.int.model</span>
<span id="cb24-368"><a href="#cb24-368"></a></span>
<span id="cb24-369"><a href="#cb24-369"></a>formula3 <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(cholesterol.bin <span class="sc">~</span> gender <span class="sc">+</span> born <span class="sc">+</span> race <span class="sc">+</span> married <span class="sc">+</span> bmi <span class="sc">+</span> diabetes <span class="sc">+</span> age)</span>
<span id="cb24-370"><a href="#cb24-370"></a>fit9 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(formula3,</span>
<span id="cb24-371"><a href="#cb24-371"></a>               <span class="at">design =</span> w.design,</span>
<span id="cb24-372"><a href="#cb24-372"></a>               <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"logit"</span>))</span>
<span id="cb24-373"><a href="#cb24-373"></a><span class="fu">summary</span>(fit9)</span>
<span id="cb24-374"><a href="#cb24-374"></a><span class="fu">publish</span>(fit9)</span>
<span id="cb24-375"><a href="#cb24-375"></a><span class="in">```</span></span>
<span id="cb24-376"><a href="#cb24-376"></a></span>
<span id="cb24-377"><a href="#cb24-377"></a><span class="fu">### Comparing with previous model fit</span></span>
<span id="cb24-378"><a href="#cb24-378"></a></span>
<span id="cb24-379"><a href="#cb24-379"></a><span class="in">```{r lin, message=FALSE, warning=FALSE}</span></span>
<span id="cb24-380"><a href="#cb24-380"></a><span class="fu">publish</span>(fit3)</span>
<span id="cb24-381"><a href="#cb24-381"></a><span class="fu">publish</span>(fit9)</span>
<span id="cb24-382"><a href="#cb24-382"></a><span class="fu">AIC</span>(fit3)</span>
<span id="cb24-383"><a href="#cb24-383"></a><span class="fu">AIC</span>(fit9)</span>
<span id="cb24-384"><a href="#cb24-384"></a><span class="in">```</span></span>
<span id="cb24-385"><a href="#cb24-385"></a></span>
<span id="cb24-386"><a href="#cb24-386"></a><span class="fu">### Video content (optional)</span></span>
<span id="cb24-387"><a href="#cb24-387"></a></span>
<span id="cb24-388"><a href="#cb24-388"></a>::: callout-tip</span>
<span id="cb24-389"><a href="#cb24-389"></a>For those who prefer a video walkthrough, feel free to watch the video below, which offers a description of an earlier version of the above content.</span>
<span id="cb24-390"><a href="#cb24-390"></a>:::</span>
<span id="cb24-391"><a href="#cb24-391"></a></span>
<span id="cb24-392"><a href="#cb24-392"></a>::: {style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;"}</span>
<span id="cb24-393"><a href="#cb24-393"></a><span class="kw">&lt;iframe</span> <span class="er">src</span><span class="ot">=</span><span class="st">"https://www.youtube.com/embed/78EHsUZDePc"</span> <span class="er">style</span><span class="ot">=</span><span class="st">"position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;"</span> <span class="er">allowfullscreen</span><span class="kw">&gt;</span></span>
<span id="cb24-394"><a href="#cb24-394"></a></span>
<span id="cb24-395"><a href="#cb24-395"></a><span class="kw">&lt;/iframe&gt;</span></span>
<span id="cb24-396"><a href="#cb24-396"></a>:::</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>