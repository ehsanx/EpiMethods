<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Advanced Epidemiological Methods - Simpson’s Paradox</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./confounding4.html" rel="next">
<link href="./confounding3.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-CVBPG0RQMY"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-CVBPG0RQMY', { 'anonymize_ip': true});
</script><script src="site_libs/kePrint-0.0.1/kePrint.js"></script><link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<meta name="twitter:title" content="Advanced Epidemiological Methods - Simpson’s Paradox">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
</head>
<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./confounding.html">Causal roles</a></li><li class="breadcrumb-item"><a href="./confounding3b.html">Simpson’s Paradox</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Advanced Epidemiological Methods</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Project</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data wrangling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling1a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R basics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling1b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data types</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling1c.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automating tasks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Importing dataset</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data manipulation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Import external data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary tables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R Markdown</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wranglingF.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R Functions (W)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wranglingQ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quiz (W)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wranglingS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">App (W)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wranglingE.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise (W)</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./accessing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Accessing data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessing0.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Concepts (A)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessing1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Survey data sources</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessing1i.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Descriptions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessing2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Importing CCHS to R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessing3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Importing NHANES to R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessing4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reproducing NHANES results</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessing5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Importing NHIS to R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessing7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linking mortality data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessing8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Replicate Data Creation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessingF.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R Functions (A)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessingQ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quiz (A)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessingS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">App (A)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessingE.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 1 (A)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessingEsolution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 1 Solution (A)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessingE2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 2 (A)</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./researchquestion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Research questions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchquestion0.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Concepts (Q)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchquestion1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Predictive question-1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchquestion2a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Predictive question-2a</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchquestion2b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Predictive question-2b</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchquestion3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Causal question-1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchquestion4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Causal question-2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchquestionF.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R functions (Q)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchquestionQ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quiz (Q)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchquestionS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">App (Q)</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./confounding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Causal roles</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confounding0.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Concepts (R)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confounding1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Confounding</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confounding2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mediator</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confounding3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Collider</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confounding3b.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Simpson’s Paradox</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confounding4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Z-bias</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confounding5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Collapsibility</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confounding6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Change-in-estimate</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confoundingF.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R functions (R)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confoundingQ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quiz (R)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confoundingE.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 1 (R)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confoundingE2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 2 (R)</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./predictivefactors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prediction ideas</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactors0.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Concepts (P)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactors1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Collinear predictors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactors2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Continuous outcome</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactors3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Binary outcome</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactors4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overfitting and performance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactors5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Splitting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactors6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cross-validation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactors7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bootstrap</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactorsF.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R functions (P)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predictivefactorsQ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quiz (P)</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./surveydata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Survey data analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata0.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Concepts (D)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CCHS: Revisiting PICOT</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CCHS: Assessing data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CCHS: Bivariate analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CCHS: Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CCHS: Performance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NHANES: Blood Pressure</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NHANES: Cholesterol</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydata8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NHANES: Subsetting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydataF.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R functions (D)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydataQ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quiz (D)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydataS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">App (D)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surveydataE.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise (D)</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./missingdata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Missing data analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdata0.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Concepts (M)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdata1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Imputation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdata2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Imputation in NHANES</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdata3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Missing in outcome</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdata4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance with NA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdata5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Subpopulations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdata6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MCAR tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdata7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Effect modification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdataF.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R functions (M)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdataQ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quiz (M)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdataS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">App (M)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missingdataE.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise (M)</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./propensityscore.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Propensity score</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscore0.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Concepts (S)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscore1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exact Matching (CCHS)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscore2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PSM in OA-CVD (CCHS)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscore3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PSM in OA-CVD (US)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscore4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PSM in BMI-diabetes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscore5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PSM with MI</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscore6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PS Weighting (US)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscore7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PSM with MI in subset</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscore8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PSW with MI in subset</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscore9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PSW with multiple tx</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscoreF.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R functions (S)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscoreQ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quiz (S)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscoreS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">App (S)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./propensityscoreE.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise (S)</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./machinelearning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Machine learning (ML)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning0.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Concepts (L)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Continuous outcome</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data spliting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cross-validation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Binary outcome</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Supervised learning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unsupervised learning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning6a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NHIS Example</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning6b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Replicate Results</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearningQ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quiz (L)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearningF.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R functions (L)</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./machinelearningCausal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ML in causal inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearningCausal0.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Concepts (C)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearningCausal1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Motivation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearningCausal2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SuperLearner</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearningCausal3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Binary Outcomes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearningCausal4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Continuous Outcomes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearningCausal5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Comparing results</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearningCausalQ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quiz (C)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearningCausalF.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R functions (C)</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./nonbinary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Complex outcomes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nonbinary0.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Concepts (N)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nonbinary1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Polytomous and ordinal</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nonbinary2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Survival analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nonbinary2a.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Survival analysis: NHANES</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nonbinary3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Poisson</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nonbinaryF.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R functions (N)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nonbinaryQ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quiz (N)</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./longitudinal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Longitudinal data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./longitudinal0.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Concepts (T)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./longitudinal1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mixed effects models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./longitudinal2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GEE</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./longitudinalF.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R functions (T)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./longitudinalQ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quiz (T)</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./mediation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mediation analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-13" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mediation0.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Concepts (I)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mediation1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Baron and Kenny</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mediation2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Justification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mediation3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mediation Example</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mediationF.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R functions (I)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mediationQ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quiz (I)</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./reporting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Writing tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-14" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-14" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reporting1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Collaborative Writing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reporting2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Formatting Tools</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#birth-weight-paradox" id="toc-birth-weight-paradox" class="nav-link" data-scroll-target="#birth-weight-paradox">Birth Weight Paradox</a></li>
  <li><a href="#data-generation" id="toc-data-generation" class="nav-link" data-scroll-target="#data-generation">Data Generation</a></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis">Analysis</a></li>
  <li><a href="#simpsons-paradox-in-the-current-example" id="toc-simpsons-paradox-in-the-current-example" class="nav-link" data-scroll-target="#simpsons-paradox-in-the-current-example">Simpson’s Paradox in the Current Example</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./confounding.html">Causal roles</a></li><li class="breadcrumb-item"><a href="./confounding3b.html">Simpson’s Paradox</a></li></ol></nav><div class="quarto-title">
<h1 class="title">Simpson’s Paradox</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="introduction" class="level3"><h3 class="anchored" data-anchor-id="introduction">Introduction</h3>
<p>In this tutorial, we will use <strong>simcausal</strong> in R to simulate data and demonstrate how <strong>Simpson’s Paradox</strong> arises in a birthweight example similar to the “Birthweight Paradox” discussed by <a href="https://doi.org/10.1093/aje/kwj275">Hernández-Díaz et al.&nbsp;(2006)</a>. The paradox arises when adjusting for birthweight, leading to misleading conclusions about the relationship between maternal smoking and infant mortality. We will show how improper adjustment for birthweight, a collider in this context, can lead to biased estimates, and how to correct for this.</p>
</section><section id="birth-weight-paradox" class="level3"><h3 class="anchored" data-anchor-id="birth-weight-paradox">Birth Weight Paradox</h3>
<p>Studies showed that while maternal smoking increased the risk of low birth weight (LBW) and infant mortality, among LBW infants, <a href="https://doi.org/10.1093/oxfordjournals.aje.a121278">those born to smokers had lower infant mortality than LBW infants born to non-smokers</a>. This seemingly paradoxical finding suggests that smoking could be “protective” for LBW infants, contradicting the established harmful effects of smoking during pregnancy.</p>
<p>This paradox is a classic example of <strong>Simpson’s Paradox</strong>, where stratifying by or conditioning on a variable (in this case, birthweight) can lead to paradoxical conclusions if the variable is a collider.</p>
</section><section id="data-generation" class="level3"><h3 class="anchored" data-anchor-id="data-generation">Data Generation</h3>
<section id="setup" class="level4"><h4 class="anchored" data-anchor-id="setup">Setup</h4>
<p>We will use the following R packages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(simcausal)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(Publish)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">library</span>(kableExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="data-generation-1" class="level4"><h4 class="anchored" data-anchor-id="data-generation-1">Data Generation</h4>
<p>We will generate data to simulate the birthweight paradox. We assume that:</p>
<ul>
<li>
<strong>Smoking</strong> influences <strong>Birthweight</strong> (low birth weight).</li>
<li>
<strong>Birthweight</strong> influences <strong>Infant Mortality</strong>.</li>
<li>There are unmeasured factors (e.g., birth defects) that also influence both birthweight and infant mortality.</li>
</ul>
<p>We will set up this data generating process using <strong>simcausal</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>D <span class="ot">&lt;-</span> <span class="fu">DAG.empty</span>()</span>
<span id="cb2-2"><a href="#cb2-2"></a>D <span class="ot">&lt;-</span> D <span class="sc">+</span> </span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="fu">node</span>(<span class="st">"Smoking"</span>, <span class="at">distr =</span> <span class="st">"rbern"</span>, <span class="at">prob =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>  <span class="fu">node</span>(<span class="st">"Unmeasured"</span>, <span class="at">distr =</span> <span class="st">"rbern"</span>, <span class="at">prob =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>  <span class="fu">node</span>(<span class="st">"LowBirthweight"</span>, <span class="at">distr =</span> <span class="st">"rbern"</span>, <span class="at">prob =</span> <span class="fu">plogis</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> <span class="fl">1.5</span><span class="sc">*</span>Smoking <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>Unmeasured)) <span class="sc">+</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>  <span class="fu">node</span>(<span class="st">"Mortality"</span>, <span class="at">distr =</span> <span class="st">"rbern"</span>, <span class="at">prob =</span> <span class="fu">plogis</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">4</span><span class="sc">*</span>LowBirthweight <span class="sc">+</span> <span class="dv">4</span><span class="sc">*</span>Unmeasured))</span>
<span id="cb2-7"><a href="#cb2-7"></a></span>
<span id="cb2-8"><a href="#cb2-8"></a>Dset <span class="ot">&lt;-</span> <span class="fu">set.DAG</span>(D)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="visualizing-the-dag" class="level4"><h4 class="anchored" data-anchor-id="visualizing-the-dag">Visualizing the DAG</h4>
<p>Let’s plot the DAG to see how these variables are related:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">plotDAG</span>(Dset, <span class="at">xjitter =</span> <span class="fl">0.1</span>, <span class="at">yjitter =</span> <span class="fl">0.1</span>, </span>
<span id="cb3-2"><a href="#cb3-2"></a>        <span class="at">edge_attrs =</span> <span class="fu">list</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">arrow.width =</span> <span class="dv">1</span>, <span class="at">arrow.size =</span> <span class="dv">1</span>),</span>
<span id="cb3-3"><a href="#cb3-3"></a>        <span class="at">vertex_attrs =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">15</span>, <span class="at">label.cex =</span> <span class="fl">0.8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="confounding3b_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This DAG represents the relationships between maternal smoking, low birth weight, and mortality, with an unmeasured confounder affecting both birthweight and mortality. Low birth weight is a <strong>collider</strong> because it has two incoming arrows from both <strong>Smoking</strong> and <strong>Birth Defect (Unmeasured)</strong>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Images/confounding/dag0.png" class="img-fluid figure-img"></p>
<figcaption>DAG Plot</figcaption></figure>
</div>
</section><section id="understanding-collider-role" class="level4"><h4 class="anchored" data-anchor-id="understanding-collider-role">Understanding Collider Role</h4>
<p>A <a href="confounding3.html">collider</a> is a variable that has two or more incoming arrows from other variables in a DAG. In simpler terms, a collider is influenced by two or more variables. When you condition on a collider (by adjusting for it in your analysis), you can introduce bias known as collider bias because you open a path between the variables that influence the collider, which might otherwise be independent.</p>
<p>A variable is a collider if it has two or more incoming arrows. In your DAG, low birth weight has two incoming arrows:</p>
<ul>
<li>One from Smoking.</li>
<li>One from Unmeasured factors (e.g., birth defects).</li>
</ul>
<p>Therefore, low birth weight is a collider in this DAG. Specifically, it is a collider between Smoking and Unmeasured factors.</p>
</section><section id="understanding-mediating-role" class="level4"><h4 class="anchored" data-anchor-id="understanding-mediating-role">Understanding Mediating Role</h4>
<p>A <a href="confounding2.html">mediator</a> is a variable that lies on the causal path between two other variables (a topic for a different <a href="mediation.html">chapter</a>). It transmits the effect of an independent variable on a dependent variable. Mediators are important because they explain part of the causal relationship between the independent and dependent variables. Adjusting for mediators can help understand indirect effects.</p>
<p>In this pathway, LowBirthweight is a mediator because it transmits the effect of Smoking on Mortality. In this context, LowBirthweight explains part of the mechanism by which Smoking increases the risk of Mortality (through its effect on birthweight). However, we would not be able to fully decompose the direct and indirect effects of Smoking on Mortality in the presence of the unmeasured variable (e.g., birth defects or another unobserved confounder), because this unmeasured variable creates confounding that affects both LowBirthweight and Mortality.</p>
</section><section id="simulate-data" class="level4"><h4 class="anchored" data-anchor-id="simulate-data">Simulate Data</h4>
<p>We now simulate data based on the DAG structure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>sim_data <span class="ot">&lt;-</span> <span class="fu">sim</span>(Dset, <span class="at">n =</span> <span class="dv">10000</span>, <span class="at">rndseed =</span> <span class="dv">123</span>)</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co">#&gt; simulating observed dataset from the DAG object</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="fu">head</span>(sim_data) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="fu">kable</span>(<span class="st">"html"</span>, <span class="at">caption =</span> <span class="st">"First 6 Rows of Simulated Data"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>, <span class="st">"responsive"</span>), </span>
<span id="cb4-6"><a href="#cb4-6"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb4-7"><a href="#cb4-7"></a>                <span class="at">position =</span> <span class="st">"center"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>First 6 Rows of Simulated Data</caption>
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">ID</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Smoking</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Unmeasured</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LowBirthweight</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mortality</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</section><section id="visualizing-hypothetical-distributions" class="level4"><h4 class="anchored" data-anchor-id="visualizing-hypothetical-distributions">Visualizing Hypothetical Distributions</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Simulate continuous birth weight based on binary LowBirthweight variable</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb5-3"><a href="#cb5-3"></a>sim_data<span class="sc">$</span>BirthWeight <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(sim_data<span class="sc">$</span>LowBirthweight <span class="sc">==</span> <span class="dv">1</span>, </span>
<span id="cb5-4"><a href="#cb5-4"></a>                               <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">sum</span>(sim_data<span class="sc">$</span>LowBirthweight <span class="sc">==</span> <span class="dv">1</span>), </span>
<span id="cb5-5"><a href="#cb5-5"></a>                                     <span class="at">mean =</span> <span class="dv">2200</span>, <span class="at">sd =</span> <span class="dv">300</span>),  <span class="co"># Low birthweight</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>                               <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">sum</span>(sim_data<span class="sc">$</span>LowBirthweight <span class="sc">==</span> <span class="dv">0</span>), </span>
<span id="cb5-7"><a href="#cb5-7"></a>                                     <span class="at">mean =</span> <span class="dv">3300</span>, <span class="at">sd =</span> <span class="dv">500</span>))  <span class="co"># Normal birthweight</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>sim_data<span class="sc">$</span>Smoking <span class="ot">&lt;-</span> <span class="fu">factor</span>(sim_data<span class="sc">$</span>Smoking, </span>
<span id="cb5-9"><a href="#cb5-9"></a>                           <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb5-10"><a href="#cb5-10"></a>                           <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Non-smoking"</span>, <span class="st">"Smoking"</span>))</span>
<span id="cb5-11"><a href="#cb5-11"></a>sim_data<span class="sc">$</span>LowBirthweight <span class="ot">&lt;-</span> <span class="fu">factor</span>(sim_data<span class="sc">$</span>LowBirthweight, </span>
<span id="cb5-12"><a href="#cb5-12"></a>                                  <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb5-13"><a href="#cb5-13"></a>                                  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Normal Birthweight"</span>, <span class="st">"Low Birthweight"</span>))</span>
<span id="cb5-14"><a href="#cb5-14"></a><span class="co"># Create a density plot for birth weight distribution by smoking status</span></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="fu">ggplot</span>(sim_data, <span class="fu">aes</span>(<span class="at">x =</span> BirthWeight, <span class="at">fill =</span> Smoking, <span class="at">color =</span> Smoking)) <span class="sc">+</span></span>
<span id="cb5-16"><a href="#cb5-16"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb5-17"><a href="#cb5-17"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2500</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb5-18"><a href="#cb5-18"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Smoking"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Non-smoking"</span> <span class="ot">=</span> <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb5-19"><a href="#cb5-19"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Smoking"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Non-smoking"</span> <span class="ot">=</span> <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb5-20"><a href="#cb5-20"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Birth Weights by Smoking Status"</span>,</span>
<span id="cb5-21"><a href="#cb5-21"></a>    <span class="at">subtitle =</span> <span class="st">"Low Birth Weight (LBW) is typically defined as a birth weight of less than 2,500 grams"</span>,</span>
<span id="cb5-22"><a href="#cb5-22"></a>       <span class="at">x =</span> <span class="st">"Birth Weight (g)"</span>, </span>
<span id="cb5-23"><a href="#cb5-23"></a>       <span class="at">y =</span> <span class="st">"Density"</span>,</span>
<span id="cb5-24"><a href="#cb5-24"></a>       <span class="at">fill =</span> <span class="st">"Smoking Status"</span>,</span>
<span id="cb5-25"><a href="#cb5-25"></a>       <span class="at">color =</span> <span class="st">"Smoking Status"</span>) <span class="sc">+</span></span>
<span id="cb5-26"><a href="#cb5-26"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb5-27"><a href="#cb5-27"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="confounding3b_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="analysis" class="level3"><h3 class="anchored" data-anchor-id="analysis">Analysis</h3>
<section id="crude-bivariate-relationships" class="level4"><h4 class="anchored" data-anchor-id="crude-bivariate-relationships">Crude Bivariate Relationships</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Calculate the summary statistics (mean birth weight, LBW prevalence, and mortality prevalence) by smoking status</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>summary_stats <span class="ot">&lt;-</span> sim_data <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="fu">group_by</span>(Smoking) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="fu">summarise</span>(</span>
<span id="cb6-5"><a href="#cb6-5"></a>    <span class="at">mean_birthweight =</span> <span class="fu">mean</span>(BirthWeight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),  <span class="co"># Mean birth weight</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>    <span class="at">prevalence_LBW =</span> <span class="fu">mean</span>(LowBirthweight <span class="sc">==</span> <span class="st">"Low Birthweight"</span>) <span class="sc">*</span> <span class="dv">100</span>,  <span class="co"># Prevalence of LBW in percentage</span></span>
<span id="cb6-7"><a href="#cb6-7"></a>    <span class="at">prevalence_mortality =</span> <span class="fu">mean</span>(Mortality) <span class="sc">*</span> <span class="dv">100</span>  <span class="co"># Prevalence of mortality in percentage</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-10"><a href="#cb6-10"></a>    <span class="at">mean_birthweight =</span> <span class="fu">format</span>(<span class="fu">round</span>(mean_birthweight, <span class="dv">1</span>), <span class="at">big.mark =</span> <span class="st">","</span>),  <span class="co"># Round and format birth weight</span></span>
<span id="cb6-11"><a href="#cb6-11"></a>    <span class="at">prevalence_LBW =</span> <span class="fu">round</span>(prevalence_LBW, <span class="dv">1</span>),  <span class="co"># Round LBW prevalence to 1 decimal place</span></span>
<span id="cb6-12"><a href="#cb6-12"></a>    <span class="at">prevalence_mortality =</span> <span class="fu">round</span>(prevalence_mortality, <span class="dv">1</span>)  <span class="co"># Round mortality prevalence to 1 decimal place</span></span>
<span id="cb6-13"><a href="#cb6-13"></a>  )</span>
<span id="cb6-14"><a href="#cb6-14"></a></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="co"># Display the formatted table with kable</span></span>
<span id="cb6-16"><a href="#cb6-16"></a>summary_stats <span class="sc">%&gt;%</span></span>
<span id="cb6-17"><a href="#cb6-17"></a>  <span class="fu">kable</span>(<span class="st">"html"</span>, <span class="at">caption =</span> <span class="st">"Summary Statistics: Mean Birth Weight, LowBirthWeight (LBW) Prevalence, and Mortality Prevalence"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-18"><a href="#cb6-18"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>, <span class="st">"responsive"</span>), </span>
<span id="cb6-19"><a href="#cb6-19"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb6-20"><a href="#cb6-20"></a>                <span class="at">position =</span> <span class="st">"center"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>Summary Statistics: Mean Birth Weight, LowBirthWeight (LBW) Prevalence, and Mortality Prevalence</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Smoking</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">mean_birthweight</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">prevalence_LBW</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">prevalence_mortality</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Non-smoking</td>
<td style="text-align: left;">2,895.1</td>
<td style="text-align: right;">36.6</td>
<td style="text-align: right;">45.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">Smoking</td>
<td style="text-align: left;">2,552.5</td>
<td style="text-align: right;">67.9</td>
<td style="text-align: right;">66.2</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</section><section id="incorrect-adjustment-conditioning-on-a-collider" class="level4"><h4 class="anchored" data-anchor-id="incorrect-adjustment-conditioning-on-a-collider">Incorrect Adjustment: Conditioning on a Collider</h4>
<p>We now show what happens when we adjust for <strong>LowBirthweight</strong>, which acts as a collider.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Model adjusted for LowBirthweight (incorrect adjustment)</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>fit_incorrect <span class="ot">&lt;-</span> <span class="fu">glm</span>(Mortality <span class="sc">~</span> Smoking <span class="sc">+</span> LowBirthweight, <span class="at">family =</span> <span class="fu">binomial</span>(), <span class="at">data =</span> sim_data)</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="fu">publish</span>(fit_incorrect, <span class="at">print =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>regressionTable <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="fu">kable</span>(<span class="st">"html"</span>, <span class="at">caption =</span> <span class="st">"Adjusted Model Regression Table"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>, <span class="st">"responsive"</span>), </span>
<span id="cb7-6"><a href="#cb7-6"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb7-7"><a href="#cb7-7"></a>                <span class="at">position =</span> <span class="st">"center"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>Adjusted Model Regression Table</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Units</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">OddsRatio</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">CI.95</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">p-value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Smoking</td>
<td style="text-align: left;">Non-smoking</td>
<td style="text-align: left;">Ref</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Smoking</td>
<td style="text-align: left;">0.73</td>
<td style="text-align: left;">[0.63;0.84]</td>
<td style="text-align: left;">&lt;1e-04</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LowBirthweight</td>
<td style="text-align: left;">Normal Birthweight</td>
<td style="text-align: left;">Ref</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Low Birthweight</td>
<td style="text-align: left;">59.40</td>
<td style="text-align: left;">[51.75;68.18]</td>
<td style="text-align: left;">&lt;1e-04</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p><strong>Explanation</strong>: Adjusting for the collider (Low Birthweight) leads to biased estimates of the effect of smoking on mortality. By conditioning on this collider, we are introducing a spurious association between <strong>Smoking</strong> and <strong>Birth Defect (Unmeasured)</strong>.</p>
</section><section id="stratification" class="level4"><h4 class="anchored" data-anchor-id="stratification">Stratification</h4>
<p>We will now stratify the data by <strong>Low Birthweight</strong> and calculate the effect of smoking on mortality separately for <strong>low birthweight</strong> and <strong>normal birthweight</strong> infants.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Subset for low birthweight</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>fit_stratified_LBW <span class="ot">&lt;-</span> <span class="fu">glm</span>(Mortality <span class="sc">~</span> Smoking, <span class="at">family =</span> <span class="fu">binomial</span>(), <span class="at">data =</span> <span class="fu">subset</span>(sim_data, LowBirthweight <span class="sc">==</span> <span class="st">"Low Birthweight"</span>))</span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="fu">publish</span>(fit_stratified_LBW, <span class="at">print =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>regressionTable <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="fu">kable</span>(<span class="st">"html"</span>, <span class="at">caption =</span> <span class="st">"Stratified Model Regression Table"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>, <span class="st">"responsive"</span>), </span>
<span id="cb8-6"><a href="#cb8-6"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb8-7"><a href="#cb8-7"></a>                <span class="at">position =</span> <span class="st">"center"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>Stratified Model Regression Table</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Units</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">OddsRatio</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">CI.95</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">p-value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Smoking</td>
<td style="text-align: left;">Non-smoking</td>
<td style="text-align: left;">Ref</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Smoking</td>
<td style="text-align: left;">0.69</td>
<td style="text-align: left;">[0.55;0.85]</td>
<td style="text-align: left;">0.000565</td>
</tr>
</tbody>
</table>
</div>


</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="co"># Subset for normal birthweight</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>fit_stratified_NBW <span class="ot">&lt;-</span> <span class="fu">glm</span>(Mortality <span class="sc">~</span> Smoking, <span class="at">family =</span> <span class="fu">binomial</span>(), <span class="at">data =</span> <span class="fu">subset</span>(sim_data, LowBirthweight <span class="sc">==</span> <span class="st">"Normal Birthweight"</span>))</span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="fu">publish</span>(fit_stratified_NBW, <span class="at">print =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>regressionTable <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>  <span class="fu">kable</span>(<span class="st">"html"</span>, <span class="at">caption =</span> <span class="st">"Stratified Model Regression Table"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>, <span class="st">"responsive"</span>), </span>
<span id="cb9-7"><a href="#cb9-7"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb9-8"><a href="#cb9-8"></a>                <span class="at">position =</span> <span class="st">"center"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>Stratified Model Regression Table</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Units</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">OddsRatio</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">CI.95</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">p-value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Smoking</td>
<td style="text-align: left;">Non-smoking</td>
<td style="text-align: left;">Ref</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Smoking</td>
<td style="text-align: left;">0.77</td>
<td style="text-align: left;">[0.63;0.93]</td>
<td style="text-align: left;">0.007758</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</section><section id="interaction-approach" class="level4"><h4 class="anchored" data-anchor-id="interaction-approach">Interaction Approach</h4>
<p>We include an interaction term between <strong>Smoking</strong> and <strong>LowBirthweight</strong> to test whether the effect of smoking on mortality differs by birthweight status.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>fit_interaction <span class="ot">&lt;-</span> <span class="fu">glm</span>(Mortality <span class="sc">~</span> Smoking <span class="sc">*</span> LowBirthweight, <span class="at">family =</span> <span class="fu">binomial</span>(), <span class="at">data =</span> sim_data)</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="fu">publish</span>(fit_interaction, <span class="at">print =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>regressionTable <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="fu">kable</span>(<span class="st">"html"</span>, <span class="at">caption =</span> <span class="st">"Interaction Model Regression Table"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>, <span class="st">"responsive"</span>), </span>
<span id="cb10-5"><a href="#cb10-5"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb10-6"><a href="#cb10-6"></a>                <span class="at">position =</span> <span class="st">"center"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>Interaction Model Regression Table</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Units</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">OddsRatio</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">CI.95</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">p-value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Smoking(Non-smoking): LowBirthweight(Low Birthweight vs Normal Birthweight)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">61.73</td>
<td style="text-align: left;">[52.00;73.28]</td>
<td style="text-align: left;">&lt; 1e-04</td>
</tr>
<tr class="even">
<td style="text-align: left;">Smoking(Smoking): LowBirthweight(Low Birthweight vs Normal Birthweight)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">55.21</td>
<td style="text-align: left;">[43.70;69.74]</td>
<td style="text-align: left;">&lt; 1e-04</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LowBirthweight(Normal Birthweight): Smoking(Smoking vs Non-smoking)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.77</td>
<td style="text-align: left;">[0.63;0.93]</td>
<td style="text-align: left;">0.007758</td>
</tr>
<tr class="even">
<td style="text-align: left;">LowBirthweight(Low Birthweight): Smoking(Smoking vs Non-smoking)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.69</td>
<td style="text-align: left;">[0.55;0.85]</td>
<td style="text-align: left;">0.000565</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</section><section id="correct-approach-no-adjustment-for-lowbirthweight" class="level4"><h4 class="anchored" data-anchor-id="correct-approach-no-adjustment-for-lowbirthweight">Correct Approach: No Adjustment for LowBirthweight</h4>
<p>Here, we show the correct approach, which is to avoid adjusting for the collider (<strong>LowBirthweight</strong>). This avoids the introduction of collider bias.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Correct model (no adjustment for LowBirthweight)</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>fit_correct <span class="ot">&lt;-</span> <span class="fu">glm</span>(Mortality <span class="sc">~</span> Smoking, <span class="at">family =</span> <span class="fu">binomial</span>(), <span class="at">data =</span> sim_data)</span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="fu">publish</span>(fit_correct, <span class="at">print =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>regressionTable <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>  <span class="fu">kable</span>(<span class="st">"html"</span>, <span class="at">caption =</span> <span class="st">"Unadjusted Model Regression Table"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>, <span class="st">"responsive"</span>), </span>
<span id="cb11-6"><a href="#cb11-6"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb11-7"><a href="#cb11-7"></a>                <span class="at">position =</span> <span class="st">"center"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>Unadjusted Model Regression Table</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Units</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">OddsRatio</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">CI.95</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">p-value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Smoking</td>
<td style="text-align: left;">Non-smoking</td>
<td style="text-align: left;">Ref</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Smoking</td>
<td style="text-align: left;">2.31</td>
<td style="text-align: left;">[2.12;2.53]</td>
<td style="text-align: left;">&lt;1e-04</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</section><section id="comparing-estimates" class="level4"><h4 class="anchored" data-anchor-id="comparing-estimates">Comparing Estimates</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Extract ORs from publish output for each model</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>or_incorrect <span class="ot">&lt;-</span> <span class="fu">publish</span>(fit_incorrect, <span class="at">print =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>regressionTable[<span class="dv">2</span>, <span class="st">"OddsRatio"</span>]</span>
<span id="cb12-3"><a href="#cb12-3"></a>or_stratified_LBW <span class="ot">&lt;-</span> <span class="fu">publish</span>(fit_stratified_LBW, <span class="at">print =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>regressionTable[<span class="dv">2</span>, <span class="st">"OddsRatio"</span>]</span>
<span id="cb12-4"><a href="#cb12-4"></a>or_stratified_NBW <span class="ot">&lt;-</span> <span class="fu">publish</span>(fit_stratified_NBW, <span class="at">print =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>regressionTable[<span class="dv">2</span>, <span class="st">"OddsRatio"</span>]</span>
<span id="cb12-5"><a href="#cb12-5"></a>or_interaction1 <span class="ot">&lt;-</span> <span class="fu">publish</span>(fit_interaction, <span class="at">print =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>regressionTable[<span class="dv">3</span>, <span class="st">"OddsRatio"</span>]</span>
<span id="cb12-6"><a href="#cb12-6"></a>or_interaction2 <span class="ot">&lt;-</span> <span class="fu">publish</span>(fit_interaction, <span class="at">print =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>regressionTable[<span class="dv">4</span>, <span class="st">"OddsRatio"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Images/confounding/daginc.png" class="img-fluid figure-img"></p>
<figcaption>DAG plot with incorrect adjustment</figcaption></figure>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># Extract ORs from publish output for correct model</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>or_correct <span class="ot">&lt;-</span> <span class="fu">publish</span>(fit_correct, <span class="at">print =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>regressionTable[<span class="dv">2</span>, <span class="st">"OddsRatio"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Images/confounding/dag.png" class="img-fluid figure-img"></p>
<figcaption>DAG plot with no adjustment</figcaption></figure>
</div>
<p>Now we compare the estimates from:</p>
<ul>
<li>The incorrect model (adjusted for LowBirthweight), with an OR of 0.73.</li>
<li>The stratified model
<ul>
<li>for <strong>low birthweight</strong> infants, with an OR of 0.69.</li>
<li>for <strong>normal birthweight</strong> infants, with an OR of 0.77.</li>
</ul>
</li>
<li>The interaction model, where the OR for <strong>smokers</strong> is
<ul>
<li>0.69 (Low Birthweight),</li>
<li>0.77 (Normal Birthweight).</li>
</ul>
</li>
<li>The correct model (unadjusted for LowBirthweight), with an OR of 2.31.</li>
</ul>
<p>These comparisons highlight how adjusting for a collider (Low Birthweight) introduces bias, while avoiding this adjustment gives an unbiased estimate of the effect of <strong>Smoking</strong> on <strong>Mortality</strong>.</p>
</section><section id="visualizing-estimates" class="level4"><h4 class="anchored" data-anchor-id="visualizing-estimates">Visualizing Estimates</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Helper function to clean and convert ORs and CIs</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>extract_or_ci <span class="ot">&lt;-</span> <span class="cf">function</span>(or_str, ci_str) {</span>
<span id="cb14-3"><a href="#cb14-3"></a>  or_val <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(or_str <span class="sc">==</span> <span class="st">"Ref"</span>, <span class="cn">NA</span>, <span class="fu">as.numeric</span>(or_str))  <span class="co"># Convert OR to numeric, handle Ref</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>  </span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="co"># Split the CI string, handle empty or malformed CI strings</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>  <span class="cf">if</span> (ci_str <span class="sc">!=</span> <span class="st">""</span> <span class="sc">&amp;&amp;</span> <span class="fu">grepl</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">["</span>, ci_str)) {</span>
<span id="cb14-7"><a href="#cb14-7"></a>    ci_vals <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">[|</span><span class="sc">\\</span><span class="st">]"</span>, <span class="st">""</span>, <span class="fu">unlist</span>(<span class="fu">strsplit</span>(ci_str, <span class="st">";"</span>))))  <span class="co"># Split and convert CI</span></span>
<span id="cb14-8"><a href="#cb14-8"></a>  } <span class="cf">else</span> {</span>
<span id="cb14-9"><a href="#cb14-9"></a>    ci_vals <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>)  <span class="co"># Handle missing CIs</span></span>
<span id="cb14-10"><a href="#cb14-10"></a>  }</span>
<span id="cb14-11"><a href="#cb14-11"></a>  </span>
<span id="cb14-12"><a href="#cb14-12"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">OR =</span> or_val, <span class="at">CI.lower =</span> ci_vals[<span class="dv">1</span>], <span class="at">CI.upper =</span> ci_vals[<span class="dv">2</span>]))</span>
<span id="cb14-13"><a href="#cb14-13"></a>}</span>
<span id="cb14-14"><a href="#cb14-14"></a></span>
<span id="cb14-15"><a href="#cb14-15"></a><span class="co"># Extract ORs and CIs for each model using the helper function</span></span>
<span id="cb14-16"><a href="#cb14-16"></a>or_ci_incorrect <span class="ot">&lt;-</span> <span class="fu">extract_or_ci</span>(<span class="fu">publish</span>(fit_incorrect, <span class="at">print =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>regressionTable[<span class="dv">2</span>, <span class="st">"OddsRatio"</span>],</span>
<span id="cb14-17"><a href="#cb14-17"></a>                                 <span class="fu">publish</span>(fit_incorrect, <span class="at">print =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>regressionTable[<span class="dv">2</span>, <span class="st">"CI.95"</span>])</span>
<span id="cb14-18"><a href="#cb14-18"></a></span>
<span id="cb14-19"><a href="#cb14-19"></a>or_ci_stratified_LBW <span class="ot">&lt;-</span> <span class="fu">extract_or_ci</span>(<span class="fu">publish</span>(fit_stratified_LBW, <span class="at">print =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>regressionTable[<span class="dv">2</span>, <span class="st">"OddsRatio"</span>],</span>
<span id="cb14-20"><a href="#cb14-20"></a>                                      <span class="fu">publish</span>(fit_stratified_LBW, <span class="at">print =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>regressionTable[<span class="dv">2</span>, <span class="st">"CI.95"</span>])</span>
<span id="cb14-21"><a href="#cb14-21"></a></span>
<span id="cb14-22"><a href="#cb14-22"></a>or_ci_stratified_NBW <span class="ot">&lt;-</span> <span class="fu">extract_or_ci</span>(<span class="fu">publish</span>(fit_stratified_NBW, <span class="at">print =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>regressionTable[<span class="dv">2</span>, <span class="st">"OddsRatio"</span>],</span>
<span id="cb14-23"><a href="#cb14-23"></a>                                      <span class="fu">publish</span>(fit_stratified_NBW, <span class="at">print =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>regressionTable[<span class="dv">2</span>, <span class="st">"CI.95"</span>])</span>
<span id="cb14-24"><a href="#cb14-24"></a></span>
<span id="cb14-25"><a href="#cb14-25"></a>or_ci_interaction1 <span class="ot">&lt;-</span> <span class="fu">extract_or_ci</span>(<span class="fu">publish</span>(fit_interaction, <span class="at">print =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>regressionTable[<span class="dv">3</span>, <span class="st">"OddsRatio"</span>],</span>
<span id="cb14-26"><a href="#cb14-26"></a>                                    <span class="fu">publish</span>(fit_interaction, <span class="at">print =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>regressionTable[<span class="dv">3</span>, <span class="st">"CI.95"</span>])</span>
<span id="cb14-27"><a href="#cb14-27"></a></span>
<span id="cb14-28"><a href="#cb14-28"></a>or_ci_interaction2 <span class="ot">&lt;-</span> <span class="fu">extract_or_ci</span>(<span class="fu">publish</span>(fit_interaction, <span class="at">print =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>regressionTable[<span class="dv">4</span>, <span class="st">"OddsRatio"</span>],</span>
<span id="cb14-29"><a href="#cb14-29"></a>                                    <span class="fu">publish</span>(fit_interaction, <span class="at">print =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>regressionTable[<span class="dv">4</span>, <span class="st">"CI.95"</span>])</span>
<span id="cb14-30"><a href="#cb14-30"></a></span>
<span id="cb14-31"><a href="#cb14-31"></a>or_ci_correct <span class="ot">&lt;-</span> <span class="fu">extract_or_ci</span>(<span class="fu">publish</span>(fit_correct, <span class="at">print =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>regressionTable[<span class="dv">2</span>, <span class="st">"OddsRatio"</span>],</span>
<span id="cb14-32"><a href="#cb14-32"></a>                               <span class="fu">publish</span>(fit_correct, <span class="at">print =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>regressionTable[<span class="dv">2</span>, <span class="st">"CI.95"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Step 2: Create a data frame for the forest plot</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>forest_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"Incorrect (Adjusted for LBW)"</span>,</span>
<span id="cb15-4"><a href="#cb15-4"></a>            <span class="st">"Stratified (Low Birthweight)"</span>,</span>
<span id="cb15-5"><a href="#cb15-5"></a>            <span class="st">"Stratified (Normal Birthweight)"</span>,</span>
<span id="cb15-6"><a href="#cb15-6"></a>            <span class="st">"Interaction (Low Birthweight)"</span>,</span>
<span id="cb15-7"><a href="#cb15-7"></a>            <span class="st">"Interaction (Normal Birthweight)"</span>,</span>
<span id="cb15-8"><a href="#cb15-8"></a>            <span class="st">"Correct (Unadjusted)"</span>),</span>
<span id="cb15-9"><a href="#cb15-9"></a>  <span class="at">OR =</span> <span class="fu">c</span>(or_ci_incorrect<span class="sc">$</span>OR, or_ci_stratified_LBW<span class="sc">$</span>OR, or_ci_stratified_NBW<span class="sc">$</span>OR, or_ci_interaction2<span class="sc">$</span>OR, or_ci_interaction1<span class="sc">$</span>OR, or_ci_correct<span class="sc">$</span>OR),</span>
<span id="cb15-10"><a href="#cb15-10"></a>  <span class="at">CI.lower =</span> <span class="fu">c</span>(or_ci_incorrect<span class="sc">$</span>CI.lower, or_ci_stratified_LBW<span class="sc">$</span>CI.lower, or_ci_stratified_NBW<span class="sc">$</span>CI.lower, or_ci_interaction2<span class="sc">$</span>CI.lower, or_ci_interaction1<span class="sc">$</span>CI.lower, or_ci_correct<span class="sc">$</span>CI.lower),</span>
<span id="cb15-11"><a href="#cb15-11"></a>  <span class="at">CI.upper =</span> <span class="fu">c</span>(or_ci_incorrect<span class="sc">$</span>CI.upper, or_ci_stratified_LBW<span class="sc">$</span>CI.upper, or_ci_stratified_NBW<span class="sc">$</span>CI.upper, or_ci_interaction2<span class="sc">$</span>CI.upper, or_ci_interaction1<span class="sc">$</span>CI.upper, or_ci_correct<span class="sc">$</span>CI.upper)</span>
<span id="cb15-12"><a href="#cb15-12"></a>)</span>
<span id="cb15-13"><a href="#cb15-13"></a></span>
<span id="cb15-14"><a href="#cb15-14"></a><span class="co"># Display the data frame to ensure it's correct</span></span>
<span id="cb15-15"><a href="#cb15-15"></a><span class="fu">print</span>(forest_data)</span>
<span id="cb15-16"><a href="#cb15-16"></a><span class="co">#&gt;                              Model   OR CI.lower CI.upper</span></span>
<span id="cb15-17"><a href="#cb15-17"></a><span class="co">#&gt; 1     Incorrect (Adjusted for LBW) 0.73     0.63     0.84</span></span>
<span id="cb15-18"><a href="#cb15-18"></a><span class="co">#&gt; 2     Stratified (Low Birthweight) 0.69     0.55     0.85</span></span>
<span id="cb15-19"><a href="#cb15-19"></a><span class="co">#&gt; 3  Stratified (Normal Birthweight) 0.77     0.63     0.93</span></span>
<span id="cb15-20"><a href="#cb15-20"></a><span class="co">#&gt; 4    Interaction (Low Birthweight) 0.69     0.55     0.85</span></span>
<span id="cb15-21"><a href="#cb15-21"></a><span class="co">#&gt; 5 Interaction (Normal Birthweight) 0.77     0.63     0.93</span></span>
<span id="cb15-22"><a href="#cb15-22"></a><span class="co">#&gt; 6             Correct (Unadjusted) 2.31     2.12     2.53</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># Create the forest plot</span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="fu">ggplot</span>(forest_data, <span class="fu">aes</span>(<span class="at">x =</span> OR, <span class="at">y =</span> Model)) <span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> CI.lower, <span class="at">xmax =</span> CI.upper), <span class="at">height =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span>  <span class="co"># Reference line at OR = 1</span></span>
<span id="cb16-6"><a href="#cb16-6"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Forest Plot of OR"</span>,</span>
<span id="cb16-7"><a href="#cb16-7"></a>       <span class="at">x =</span> <span class="st">"Odds Ratio (OR) and Confidence Intervals"</span>,</span>
<span id="cb16-8"><a href="#cb16-8"></a>       <span class="at">y =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb16-9"><a href="#cb16-9"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb16-11"><a href="#cb16-11"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb16-12"><a href="#cb16-12"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="confounding3b_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="simpsons-paradox-in-the-current-example" class="level3"><h3 class="anchored" data-anchor-id="simpsons-paradox-in-the-current-example">Simpson’s Paradox in the Current Example</h3>
<p>Simpson’s Paradox occurs when the relationship between two variables changes direction when data is stratified by a third variable. In our case, we observe this paradox when examining the effect of maternal smoking on infant mortality, particularly in relation to birth weight.</p>
<ul>
<li>Initially, the crude analysis shows that smoking increases the overall risk of mortality.</li>
<li>However, when we stratify by birth weight, a seemingly paradoxical result emerges: among low birthweight (LBW) infants, those born to smokers appear to have lower mortality than those born to non-smokers.</li>
</ul>
<p>This misleading association suggests that smoking is “protective” for LBW infants, which contradicts well-established evidence that smoking during pregnancy is harmful.</p>
<p>The reason for this paradox is that birth weight acts as a <strong>collider</strong> in this causal pathway. Both smoking and unmeasured factors (such as birth defects) influence birth weight, and birth weight itself is a strong predictor of mortality. By conditioning on or adjusting for birth weight, we introduce bias that distorts the true relationship between smoking and infant mortality. This paradox demonstrates the importance of using causal diagrams, such as DAGs, to avoid improper adjustment and accurately infer causal relationships.</p>
</section><section id="conclusion" class="level3"><h3 class="anchored" data-anchor-id="conclusion">Conclusion</h3>
<ul>
<li>
<strong>Key Insight</strong>: Avoid adjusting for colliders when estimating causal effects. Use tools like <strong>DAGs</strong> to identify colliders and confounders in your model.</li>
<li>
<strong>Correct Approach</strong>: When analyzing the effect of <strong>Smoking</strong> on <strong>Mortality</strong>, do not adjust for <strong>Low Birthweight</strong> as it is a collider.</li>
</ul>
<p>By avoiding collider bias, we ensure accurate causal inferences.</p>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./confounding3.html" class="pagination-link" aria-label="Collider">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Collider</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./confounding4.html" class="pagination-link" aria-label="Z-bias">
        <span class="nav-page-text">Z-bias</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>