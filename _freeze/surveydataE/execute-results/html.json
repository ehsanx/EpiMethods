{
  "hash": "84c9cc89fae77f92d4f6ec9ee5b9f4dc",
  "result": {
    "markdown": "## Exercise (D) {.unnumbered}\n\n\n\n\n\n::: callout-tip\nYou can download all of the related files in a zip file **surveydataEx.zip** from [Github](https://github.com/ehsanx/EpiMethods/tree/main/LabExercises/)\n\n-   Navigate to the GitHub page (above link) where the ZIP file is located.\n-   Click on the file name (above zip file) to open its preview window.\n-   Click on the Download button to download the file. If you can't see the Download button, click on \"Download Raw File\" link that should appear on the page.\n:::\n\n## Problem Statement\n\nWe will use the article by [Flegal et al. (2021)](https://jamanetwork.com/journals/jama/article-abstract/2526639).\n\nWe will reproduce some results from the article. The authors used NHANES 2013-14 dataset to create their main analytic dataset. The dataset contains 10,175 subjects with 12 relevant variables:\n\n-   SEQN: Respondent sequence number\n-   RIDAGEYR: Age in years at screening\n-   RIAGENDR: Gender\n-   DMDEDUC2: Education level\n-   RIDRETH3: Race/ethnicity\n-   RIDEXPRG: Pregnancy status at exam\n-   WTINT2YR: Full sample 2 year weights\n-   SDMVPSU: Masked variance pseudo-PSU\n-   SDMVSTRA: Masked variance pseudo-stratum\n-   BMXBMI: Body mass index in kg/m\\*\\*2\n-   SMQ020: Whether smoked at least 100 cigarettes in life\n-   SMQ040: Current status of smoking (Do you now smoke cigarettes?)\n\n## Question 1: Creating data and table\n\n### 1(a) Importing dataset\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# you have to download the data in the same folder\nload(\"Data/surveydata/Flegal2016.RData\")\nls()\n#> [1] \"dat.full\"\nnames(dat.full)\n#>  [1] \"SEQN\"     \"RIDAGEYR\" \"RIAGENDR\" \"DMDEDUC2\" \"RIDRETH3\" \"RIDEXPRG\"\n#>  [7] \"WTINT2YR\" \"SDMVPSU\"  \"SDMVSTRA\" \"BMXBMI\"   \"SMQ020\"   \"SMQ040\"\n```\n:::\n\n\n### 1(b) Subsetting according to eligibility\n\nSubset the dataset according to the eligibility criteria described in the second paragraph of the `Methods` section.\n\n-   Hint: The authors restricted their study to\n    -   adults aged 20 years and more,\n    -   non-missing body mass index, and\n    -   non-pregnant.\n\nYour analytic sample size should be 5,455, as described in the first sentence in the `Results` section.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 20+\ndat.analytic <- subset(dat.full, RIDAGEYR>=20) # N = 5,769\n\n# Non-missing outcome\ndat.analytic <- subset(dat.analytic, !is.na(BMXBMI)) # N = 5,520\n\n# Non-pregnant\ndat.analytic <- subset(dat.analytic, is.na(RIDEXPRG) | RIDEXPRG != \n                         \"Yes, positive lab pregnancy test\") # N = 5,455\n\ndim(dat.analytic)\n#> [1] 5455   12\n```\n:::\n\n\n### 1(c) Reproduce Table 1\n\nReproduce Table 1 of the article.\n\n-   Hint 1: The authors reported unweighted frequencies, and thus, survey features should not be utilized to answer this question. Please be advised to order the categories as shown in the table. `tableone` package could be helpful.\n\n-   Hint 2: the authors did not show the results for the `Other` race category. But in your table, you could include all race categories.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tableone)\n\ndat <- dat.analytic\n\n# Age\ndat$age <- cut(dat$RIDAGEYR, c(20, 40, 60, Inf), right = FALSE)\n\n# Gender\ndat$gender <- dat$RIAGENDR\n\n# Race/Hispanic origin group\ndat$race <- dat$RIDRETH3\ndat$race <- car::recode(dat$race, \" 'Non-Hispanic White'='White'; 'Non-Hispanic Black'=\n                        'Black'; 'Non-Hispanic Asian'='Asian'; c('Mexican American',\n                        'Other Hispanic')='Hispanic'; 'Other Race - Including Multi-Rac'=\n                        'Other'; else=NA\", levels = c(\"White\", \"Black\", \"Asian\",\n                                                      \"Hispanic\", \"Other\"))\n\n# Table 1: Overall \ntab11 <- CreateTableOne(vars = \"age\", strata = \"race\", data = dat, test = F, \n                        addOverall = T)\n\n# Table 1: Male\ntab12 <- CreateTableOne(vars = \"age\", strata = \"race\", test = F, addOverall = T, \n                        data = subset(dat, gender == \"Male\"))\n\n# Table 1: Female\ntab13 <- CreateTableOne(vars = \"age\", strata = \"race\", test = F, addOverall = T,\n                        data = subset(dat, gender == \"Female\"))\n\n# Reproducing Table 1\ntab1a <- list(Overall = tab11, Male = tab12, Female = tab13)\nprint(tab1a, format = \"f\") # Showing only frequencies \n#> $Overall\n#>              Stratified by race\n#>               Overall White Black Asian Hispanic Other\n#>   n           5455    2343  1115  623   1214     160  \n#>   age                                                 \n#>      [20,40)  1810     734   362  216    412      86  \n#>      [40,60)  1896     759   383  251    449      54  \n#>      [60,Inf) 1749     850   370  156    353      20  \n#> \n#> $Male\n#>              Stratified by race\n#>               Overall White Black Asian Hispanic Other\n#>   n           2638    1130  556   300   573      79   \n#>   age                                                 \n#>      [20,40)   909     386  182   106   189      46   \n#>      [40,60)   897     360  179   120   215      23   \n#>      [60,Inf)  832     384  195    74   169      10   \n#> \n#> $Female\n#>              Stratified by race\n#>               Overall White Black Asian Hispanic Other\n#>   n           2817    1213  559   323   641      81   \n#>   age                                                 \n#>      [20,40)   901     348  180   110   223      40   \n#>      [40,60)   999     399  204   131   234      31   \n#>      [60,Inf)  917     466  175    82   184      10\n```\n:::\n\n\n## Question 2\n\n### 2(a) Reproduce Table 1 with survey features \\[15% grade\\]\n\nNot in this article but in many other articles, you would see `n` comes from the analytic sample and `%` comes from the survey design that accounts for survey features such as strata, clusters and survey weights. In Question 1, you see how n comes from the analytic sample. Your task for Question 2(a) is to create % part of the Table 1 with survey features, i.e., % should come from the survey design that accounts for strata, clusters and survey weights.\n\n-   Hint 1: Subset the design, not the sample. If you have generated a variable in your analytic dataset (based on eligibility), that variable should also be present in the full dataset.\n\n-   Hint 2: Generate age, gender, and race variable in your full data (codes shown in Question 1 could be helpful).\n\n-   Hint 3: Subset the design.\n\n-   Hint 4: Reproduce Table 1 with the design. `svyCreateTableOne` could be a helpful function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Create all variables in the full data\n# Age\ndat.full$age <- cut(dat.full$RIDAGEYR, c(20, 40, 60, Inf), right = FALSE)\n\n# Gender\ndat.full$gender <- dat.full$RIAGENDR\n\n# Race/Hispanic origin group\ndat.full$race <- dat.full$RIDRETH3\ndat.full$race <- car::recode(dat.full$race, \" 'Non-Hispanic White'='White'; \n                             'Non-Hispanic Black'='Black'; 'Non-Hispanic Asian'='Asian'; \n                             c('Mexican American','Other Hispanic')='Hispanic'; \n                             'Other Race - Including Multi-Rac'='Other'; \n                             else=NA\", levels = c(\"White\", \"Black\", \"Asian\",\n                                                  \"Hispanic\", \"Other\"))\n\n## Subset the design\n# your codes here\n\n\n## Table 1 \n# your codes here\n\n#print(tab1b, format = \"p\") # Showing only percentages  \n```\n:::\n\n\n### 2(b) Reproduce Table 3 \\[50% grade\\]\n\nReproduce the first column of Table 3 of the article (i.e., among men, explore the relationship between obesity and four predictors shown in the table).\n\n-   Hint 1: If necessary, re-level or re-order the levels. Use `Publish` package to report the estimates.\n\n-   Hint 2: Subset the design, not the sample. If you have generated a variable in your analytic dataset (based on eligibility), that variable should also be present in the full dataset.\n\n-   Hint 3: The authors used SAS to produce the results vs. We are using R. The estimates could be slightly different (in second decimal point) from the estimates presented in Table 3, but they should be approximately similar.\n\n-   Hint 4: You need to generate two variables, `smoking status` and `education`. The unweighted frequencies should be matched with the frequencies in eTable 1 and eTable 2.\n\nYour odds ratios could be look like as follows:\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/surveydata/tab3exs.png){width=70%}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n## Recode Obese, Smoking status, Education - work on full data\n# your codes here\n\n\n## Set up the survey design\n# your codes here\n\n\n## Reproduce Table 3 - column 1\n# your codes here\n```\n:::\n\n\n### 2(c) Model selection \\[25% grade\\]\n\nFrom the literature, you know that `age` and `race` needs to be adjusted in the model, but you are not sure about `smoking` and `education`. Run an AIC based backward selection process to figure out whether you want to add `smoking` or `education`, or both in the final model in 2(b). What is your conclusion \\[Expected answer: one short sentence\\]?\n\n-   Hint 1: You need to make sure your design (that is based on eligibility) is free from missing values. Even after applying eligibility criteria, you may have some missing values on multiple variables (see eTable 1 and eTable 2). This is especially important for model selection process.\n\n-   Hint 2: Work with the analytic data, keep only the relevant variables, and then remove missing values. Finally, subset the design and then select your final model.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Recode Obese, Smoking status, Education - work on analytic data\n# your codes here\n\n\n## Remove missing values - work on analytic data\n# your codes here\n\n\n## Set up the survey design\n# your codes here\n\n\n## Model selection \n# your codes here\n```\n:::\n\n\n### 2(d) Testing for interactions \\[10% grade\\]\n\nCheck whether the interaction between `age` and `smoking` should be added in the 2(b) model (yes or no answer required, along with the code and p-value):\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# your codes here\n\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}