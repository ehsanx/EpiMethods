{
  "hash": "9dbbb82a3650d14b350f1176abaead53",
  "result": {
    "engine": "knitr",
    "markdown": "## Binary outcome {.unnumbered}\n\n::: callout-important\nThis tutorial is very similar to one of the [previous tutorials](predictivefactors3.html), but uses a different data (we used [RHC data](researchquestion1.html) here). We are revisiting concepts related to [prediction](predictivefactors.html) before introducing ideas related to machine learning. \n:::\n\nIn this chapter, we will talk about Regression that deals with prediction of binary outcomes. We will use logistic regression to build the first prediction model.\n\n\n\n\n\n### Read previously saved data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nObsData <- readRDS(file = \"Data/machinelearning/rhcAnalytic.RDS\")\n```\n:::\n\n\n### Outcome levels (factor)\n\n-   Label\n    -   Possible values of outcome\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlevels(ObsData$Death)=c(\"No\",\"Yes\") # this is useful for caret\n# ref: https://tinyurl.com/caretbin\nclass(ObsData$Death)\n#> [1] \"factor\"\ntable(ObsData$Death)\n#> \n#>   No  Yes \n#> 2013 3722\n```\n:::\n\n\n### Measuring prediction error\n\n-   [Brier score](predictivefactors7.html)\n    -   Brier score 0 means perfect prediction, and\n    -   close to zero means better prediction,\n    -   1 being the worst prediction.\n    -   Less accurate forecasts get higher score in Brier score.\n    \n-   [AUC](predictivefactors7.html)\n    -   The area under a ROC curve is called as a c statistics.\n    -   c being 0.5 means random prediction and\n    -   1 indicates perfect prediction\n\n### Prediction for death\n\nIn this section, we show the regression fitting when outcome is binary (death).\n\n#### Variables\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbaselinevars <- names(dplyr::select(ObsData, \n                         !c(Length.of.Stay,Death)))\nbaselinevars\n#>  [1] \"Disease.category\"      \"Cancer\"                \"Cardiovascular\"       \n#>  [4] \"Congestive.HF\"         \"Dementia\"              \"Psychiatric\"          \n#>  [7] \"Pulmonary\"             \"Renal\"                 \"Hepatic\"              \n#> [10] \"GI.Bleed\"              \"Tumor\"                 \"Immunosupperssion\"    \n#> [13] \"Transfer.hx\"           \"MI\"                    \"age\"                  \n#> [16] \"sex\"                   \"edu\"                   \"DASIndex\"             \n#> [19] \"APACHE.score\"          \"Glasgow.Coma.Score\"    \"blood.pressure\"       \n#> [22] \"WBC\"                   \"Heart.rate\"            \"Respiratory.rate\"     \n#> [25] \"Temperature\"           \"PaO2vs.FIO2\"           \"Albumin\"              \n#> [28] \"Hematocrit\"            \"Bilirubin\"             \"Creatinine\"           \n#> [31] \"Sodium\"                \"Potassium\"             \"PaCo2\"                \n#> [34] \"PH\"                    \"Weight\"                \"DNR.status\"           \n#> [37] \"Medical.insurance\"     \"Respiratory.Diag\"      \"Cardiovascular.Diag\"  \n#> [40] \"Neurological.Diag\"     \"Gastrointestinal.Diag\" \"Renal.Diag\"           \n#> [43] \"Metabolic.Diag\"        \"Hematologic.Diag\"      \"Sepsis.Diag\"          \n#> [46] \"Trauma.Diag\"           \"Orthopedic.Diag\"       \"race\"                 \n#> [49] \"income\"                \"RHC.use\"\n```\n:::\n\n\n#### Model\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# adjust covariates\nout.formula2 <- as.formula(paste(\"Death~ \", paste(baselinevars, collapse = \"+\")))\nsaveRDS(out.formula2, file = \"Data/machinelearning/form2.RDS\")\nfit2 <- glm(out.formula2, data = ObsData, \n            family = binomial(link = \"logit\"))\nrequire(Publish)\nadj.fit2 <- publish(fit2, digits=1)$regressionTable\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nout.formula2\n#> Death ~ Disease.category + Cancer + Cardiovascular + Congestive.HF + \n#>     Dementia + Psychiatric + Pulmonary + Renal + Hepatic + GI.Bleed + \n#>     Tumor + Immunosupperssion + Transfer.hx + MI + age + sex + \n#>     edu + DASIndex + APACHE.score + Glasgow.Coma.Score + blood.pressure + \n#>     WBC + Heart.rate + Respiratory.rate + Temperature + PaO2vs.FIO2 + \n#>     Albumin + Hematocrit + Bilirubin + Creatinine + Sodium + \n#>     Potassium + PaCo2 + PH + Weight + DNR.status + Medical.insurance + \n#>     Respiratory.Diag + Cardiovascular.Diag + Neurological.Diag + \n#>     Gastrointestinal.Diag + Renal.Diag + Metabolic.Diag + Hematologic.Diag + \n#>     Sepsis.Diag + Trauma.Diag + Orthopedic.Diag + race + income + \n#>     RHC.use\nadj.fit2\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Variable\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Units\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"OddsRatio\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"CI.95\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"p-value\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"Disease.category\",\"2\":\"ARF\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"CHF\",\"3\":\"1.0\",\"4\":\"[0.8;1.4]\",\"5\":\"0.8\"},{\"1\":\"\",\"2\":\"Other\",\"3\":\"1.6\",\"4\":\"[1.3;2.0]\",\"5\":\"<0.1\"},{\"1\":\"\",\"2\":\"MOSF\",\"3\":\"1.0\",\"4\":\"[0.9;1.2]\",\"5\":\"0.7\"},{\"1\":\"Cancer\",\"2\":\"None\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"Localized (Yes)\",\"3\":\"6.6\",\"4\":\"[2.2;19.4]\",\"5\":\"<0.1\"},{\"1\":\"\",\"2\":\"Metastatic\",\"3\":\"26.4\",\"4\":\"[8.3;83.6]\",\"5\":\"<0.1\"},{\"1\":\"Cardiovascular\",\"2\":\"0\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"1\",\"3\":\"1.3\",\"4\":\"[1.0;1.5]\",\"5\":\"<0.1\"},{\"1\":\"Congestive.HF\",\"2\":\"0\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"1\",\"3\":\"1.6\",\"4\":\"[1.3;1.9]\",\"5\":\"<0.1\"},{\"1\":\"Dementia\",\"2\":\"0\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"1\",\"3\":\"1.3\",\"4\":\"[1.0;1.6]\",\"5\":\"<0.1\"},{\"1\":\"Psychiatric\",\"2\":\"0\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"1\",\"3\":\"0.9\",\"4\":\"[0.7;1.2]\",\"5\":\"0.6\"},{\"1\":\"Pulmonary\",\"2\":\"0\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"1\",\"3\":\"1.0\",\"4\":\"[0.9;1.2]\",\"5\":\"0.7\"},{\"1\":\"Renal\",\"2\":\"0\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"1\",\"3\":\"1.3\",\"4\":\"[0.9;1.9]\",\"5\":\"0.2\"},{\"1\":\"Hepatic\",\"2\":\"0\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"1\",\"3\":\"1.3\",\"4\":\"[0.9;1.8]\",\"5\":\"0.1\"},{\"1\":\"GI.Bleed\",\"2\":\"0\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"1\",\"3\":\"1.2\",\"4\":\"[0.8;1.9]\",\"5\":\"0.3\"},{\"1\":\"Tumor\",\"2\":\"0\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"1\",\"3\":\"0.3\",\"4\":\"[0.1;0.9]\",\"5\":\"<0.1\"},{\"1\":\"Immunosupperssion\",\"2\":\"0\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"1\",\"3\":\"1.2\",\"4\":\"[1.1;1.4]\",\"5\":\"<0.1\"},{\"1\":\"Transfer.hx\",\"2\":\"0\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"1\",\"3\":\"0.8\",\"4\":\"[0.7;1.0]\",\"5\":\"<0.1\"},{\"1\":\"MI\",\"2\":\"0\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"1\",\"3\":\"0.8\",\"4\":\"[0.6;1.2]\",\"5\":\"0.3\"},{\"1\":\"age\",\"2\":\"[-Inf,50)\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"[50,60)\",\"3\":\"1.4\",\"4\":\"[1.2;1.8]\",\"5\":\"<0.1\"},{\"1\":\"\",\"2\":\"[60,70)\",\"3\":\"2.1\",\"4\":\"[1.7;2.5]\",\"5\":\"<0.1\"},{\"1\":\"\",\"2\":\"[70,80)\",\"3\":\"2.1\",\"4\":\"[1.6;2.6]\",\"5\":\"<0.1\"},{\"1\":\"\",\"2\":\"[80, Inf)\",\"3\":\"2.8\",\"4\":\"[2.1;3.8]\",\"5\":\"<0.1\"},{\"1\":\"sex\",\"2\":\"Male\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"Female\",\"3\":\"0.8\",\"4\":\"[0.7;0.9]\",\"5\":\"<0.1\"},{\"1\":\"edu\",\"2\":\"\",\"3\":\"1.0\",\"4\":\"[1.0;1.0]\",\"5\":\"0.4\"},{\"1\":\"DASIndex\",\"2\":\"\",\"3\":\"1.0\",\"4\":\"[0.9;1.0]\",\"5\":\"<0.1\"},{\"1\":\"APACHE.score\",\"2\":\"\",\"3\":\"1.0\",\"4\":\"[1.0;1.0]\",\"5\":\"<0.1\"},{\"1\":\"Glasgow.Coma.Score\",\"2\":\"\",\"3\":\"1.0\",\"4\":\"[1.0;1.0]\",\"5\":\"<0.1\"},{\"1\":\"blood.pressure\",\"2\":\"\",\"3\":\"1.0\",\"4\":\"[1.0;1.0]\",\"5\":\"0.4\"},{\"1\":\"WBC\",\"2\":\"\",\"3\":\"1.0\",\"4\":\"[1.0;1.0]\",\"5\":\"0.2\"},{\"1\":\"Heart.rate\",\"2\":\"\",\"3\":\"1.0\",\"4\":\"[1.0;1.0]\",\"5\":\"0.7\"},{\"1\":\"Respiratory.rate\",\"2\":\"\",\"3\":\"1.0\",\"4\":\"[1.0;1.0]\",\"5\":\"0.8\"},{\"1\":\"Temperature\",\"2\":\"\",\"3\":\"0.9\",\"4\":\"[0.9;1.0]\",\"5\":\"<0.1\"},{\"1\":\"PaO2vs.FIO2\",\"2\":\"\",\"3\":\"1.0\",\"4\":\"[1.0;1.0]\",\"5\":\"0.3\"},{\"1\":\"Albumin\",\"2\":\"\",\"3\":\"1.0\",\"4\":\"[0.9;1.1]\",\"5\":\"0.6\"},{\"1\":\"Hematocrit\",\"2\":\"\",\"3\":\"1.0\",\"4\":\"[1.0;1.0]\",\"5\":\"<0.1\"},{\"1\":\"Bilirubin\",\"2\":\"\",\"3\":\"1.0\",\"4\":\"[1.0;1.1]\",\"5\":\"<0.1\"},{\"1\":\"Creatinine\",\"2\":\"\",\"3\":\"1.0\",\"4\":\"[1.0;1.0]\",\"5\":\"0.9\"},{\"1\":\"Sodium\",\"2\":\"\",\"3\":\"1.0\",\"4\":\"[1.0;1.0]\",\"5\":\"0.7\"},{\"1\":\"Potassium\",\"2\":\"\",\"3\":\"1.0\",\"4\":\"[0.9;1.1]\",\"5\":\"0.9\"},{\"1\":\"PaCo2\",\"2\":\"\",\"3\":\"1.0\",\"4\":\"[1.0;1.0]\",\"5\":\"0.3\"},{\"1\":\"PH\",\"2\":\"\",\"3\":\"1.1\",\"4\":\"[0.5;2.3]\",\"5\":\"0.9\"},{\"1\":\"Weight\",\"2\":\"\",\"3\":\"1.0\",\"4\":\"[1.0;1.0]\",\"5\":\"<0.1\"},{\"1\":\"DNR.status\",\"2\":\"No\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"Yes\",\"3\":\"2.6\",\"4\":\"[2.0;3.3]\",\"5\":\"<0.1\"},{\"1\":\"Medical.insurance\",\"2\":\"Medicaid\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"Medicare\",\"3\":\"1.6\",\"4\":\"[1.2;2.0]\",\"5\":\"<0.1\"},{\"1\":\"\",\"2\":\"Medicare & Medicaid\",\"3\":\"1.4\",\"4\":\"[1.0;1.9]\",\"5\":\"<0.1\"},{\"1\":\"\",\"2\":\"No insurance\",\"3\":\"1.5\",\"4\":\"[1.1;2.0]\",\"5\":\"<0.1\"},{\"1\":\"\",\"2\":\"Private\",\"3\":\"1.3\",\"4\":\"[1.1;1.7]\",\"5\":\"<0.1\"},{\"1\":\"\",\"2\":\"Private & Medicare\",\"3\":\"1.3\",\"4\":\"[1.0;1.7]\",\"5\":\"<0.1\"},{\"1\":\"Respiratory.Diag\",\"2\":\"No\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"Yes\",\"3\":\"1.2\",\"4\":\"[1.0;1.4]\",\"5\":\"<0.1\"},{\"1\":\"Cardiovascular.Diag\",\"2\":\"No\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"Yes\",\"3\":\"1.2\",\"4\":\"[1.0;1.4]\",\"5\":\"<0.1\"},{\"1\":\"Neurological.Diag\",\"2\":\"No\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"Yes\",\"3\":\"1.5\",\"4\":\"[1.2;1.9]\",\"5\":\"<0.1\"},{\"1\":\"Gastrointestinal.Diag\",\"2\":\"No\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"Yes\",\"3\":\"1.3\",\"4\":\"[1.1;1.6]\",\"5\":\"<0.1\"},{\"1\":\"Renal.Diag\",\"2\":\"No\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"Yes\",\"3\":\"0.8\",\"4\":\"[0.6;1.1]\",\"5\":\"0.2\"},{\"1\":\"Metabolic.Diag\",\"2\":\"No\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"Yes\",\"3\":\"1.0\",\"4\":\"[0.8;1.4]\",\"5\":\"0.8\"},{\"1\":\"Hematologic.Diag\",\"2\":\"No\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"Yes\",\"3\":\"2.7\",\"4\":\"[2.0;3.8]\",\"5\":\"<0.1\"},{\"1\":\"Sepsis.Diag\",\"2\":\"No\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"Yes\",\"3\":\"1.1\",\"4\":\"[0.9;1.4]\",\"5\":\"0.2\"},{\"1\":\"Trauma.Diag\",\"2\":\"No\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"Yes\",\"3\":\"0.8\",\"4\":\"[0.4;1.4]\",\"5\":\"0.4\"},{\"1\":\"Orthopedic.Diag\",\"2\":\"No\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"Yes\",\"3\":\"1.4\",\"4\":\"[0.2;8.1]\",\"5\":\"0.7\"},{\"1\":\"race\",\"2\":\"white\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"black\",\"3\":\"1.0\",\"4\":\"[0.8;1.2]\",\"5\":\"0.9\"},{\"1\":\"\",\"2\":\"other\",\"3\":\"1.1\",\"4\":\"[0.8;1.4]\",\"5\":\"0.7\"},{\"1\":\"income\",\"2\":\"$11-$25k\",\"3\":\"Ref\",\"4\":\"\",\"5\":\"\"},{\"1\":\"\",\"2\":\"$25-$50k\",\"3\":\"0.8\",\"4\":\"[0.7;1.0]\",\"5\":\"<0.1\"},{\"1\":\"\",\"2\":\"> $50k\",\"3\":\"0.8\",\"4\":\"[0.6;1.1]\",\"5\":\"0.2\"},{\"1\":\"\",\"2\":\"Under $11k\",\"3\":\"1.2\",\"4\":\"[1.0;1.4]\",\"5\":\"<0.1\"},{\"1\":\"RHC.use\",\"2\":\"\",\"3\":\"1.4\",\"4\":\"[1.2;1.6]\",\"5\":\"<0.1\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n#### Measuring prediction error\n\n##### AUC\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(pROC)\nobs.y2<-ObsData$Death\npred.y2 <- predict(fit2, type = \"response\")\nrocobj <- roc(obs.y2, pred.y2)\n#> Setting levels: control = No, case = Yes\n#> Setting direction: controls < cases\nrocobj\n#> \n#> Call:\n#> roc.default(response = obs.y2, predictor = pred.y2)\n#> \n#> Data: pred.y2 in 2013 controls (obs.y2 No) < 3722 cases (obs.y2 Yes).\n#> Area under the curve: 0.7682\nplot(rocobj)\n```\n\n::: {.cell-output-display}\n![](machinelearning4_files/figure-html/auc1-1.png){width=672}\n:::\n\n```{.r .cell-code}\nauc(rocobj)\n#> Area under the curve: 0.7682\n```\n:::\n\n\n##### Brier Score\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(DescTools)\nBrierScore(fit2)\n#> [1] 0.1812502\n```\n:::\n\n\n### Cross-validation using caret\n\n### Basic setup\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Using Caret package\nset.seed(504)\n\n# make a 5-fold CV\nrequire(caret)\nctrl<-trainControl(method = \"cv\", number = 5, \n                   classProbs = TRUE,\n                   summaryFunction = twoClassSummary)\n\n# fit the model with formula = out.formula2\n# use training method glm (have to specify family)\nfit.cv.bin<-train(out.formula2, trControl = ctrl,\n               data = ObsData, method = \"glm\",\n              family = binomial(),\n              metric=\"ROC\")\nfit.cv.bin\n#> Generalized Linear Model \n#> \n#> 5735 samples\n#>   50 predictor\n#>    2 classes: 'No', 'Yes' \n#> \n#> No pre-processing\n#> Resampling: Cross-Validated (5 fold) \n#> Summary of sample sizes: 4587, 4589, 4587, 4589, 4588 \n#> Resampling results:\n#> \n#>   ROC        Sens       Spec     \n#>   0.7545115  0.4659618  0.8535653\n```\n:::\n\n\n#### Extract results from each test data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary.res <- fit.cv.bin$resample\nsummary.res\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"ROC\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Sens\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Spec\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Resample\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"0.7444835\",\"2\":\"0.4739454\",\"3\":\"0.8630872\",\"4\":\"Fold1\"},{\"1\":\"0.7544836\",\"2\":\"0.4502488\",\"3\":\"0.8561828\",\"4\":\"Fold2\"},{\"1\":\"0.7786734\",\"2\":\"0.4739454\",\"3\":\"0.8738255\",\"4\":\"Fold3\"},{\"1\":\"0.7350679\",\"2\":\"0.4626866\",\"3\":\"0.8373656\",\"4\":\"Fold4\"},{\"1\":\"0.7598488\",\"2\":\"0.4689826\",\"3\":\"0.8373656\",\"4\":\"Fold5\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nmean(fit.cv.bin$resample$ROC)\n#> [1] 0.7545115\nsd(fit.cv.bin$resample$ROC)\n#> [1] 0.01651437\n```\n:::\n\n\n#### More options\n\n\n::: {.cell}\n\n```{.r .cell-code}\nctrl<-trainControl(method = \"cv\", number = 5, \n                   classProbs = TRUE,\n                   summaryFunction = twoClassSummary)\nfit.cv.bin<-train(out.formula2, trControl = ctrl,\n               data = ObsData, method = \"glm\",\n              family = binomial(),\n              metric=\"ROC\",\n              preProc = c(\"center\", \"scale\"))\nfit.cv.bin\n#> Generalized Linear Model \n#> \n#> 5735 samples\n#>   50 predictor\n#>    2 classes: 'No', 'Yes' \n#> \n#> Pre-processing: centered (63), scaled (63) \n#> Resampling: Cross-Validated (5 fold) \n#> Summary of sample sizes: 4588, 4589, 4587, 4588, 4588 \n#> Resampling results:\n#> \n#>   ROC        Sens       Spec     \n#>   0.7548047  0.4629717  0.8530367\n```\n:::\n\n\n### Variable selection\n\nWe can also use stepwise regression that uses AIC as a criterion.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(504)\nctrl<-trainControl(method = \"cv\", number = 5, \n                   classProbs = TRUE,\n                   summaryFunction = twoClassSummary)\nfit.cv.bin.aic<-train(out.formula2, trControl = ctrl,\n               data = ObsData, method = \"glmStepAIC\",\n               direction =\"backward\",\n              family = binomial(),\n              metric=\"ROC\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfit.cv.bin.aic\n#> Generalized Linear Model with Stepwise Feature Selection \n#> \n#> 5735 samples\n#>   50 predictor\n#>    2 classes: 'No', 'Yes' \n#> \n#> No pre-processing\n#> Resampling: Cross-Validated (5 fold) \n#> Summary of sample sizes: 4587, 4589, 4587, 4589, 4588 \n#> Resampling results:\n#> \n#>   ROC        Sens      Spec     \n#>   0.7540424  0.464468  0.8562535\nsummary(fit.cv.bin.aic)\n#> \n#> Call:\n#> NULL\n#> \n#> Deviance Residuals: \n#>     Min       1Q   Median       3Q      Max  \n#> -2.8626  -0.9960   0.5052   0.8638   1.9578  \n#> \n#> Coefficients:\n#>                                          Estimate Std. Error z value Pr(>|z|)\n#> (Intercept)                             1.0783624  0.7822168   1.379 0.168019\n#> Disease.categoryOther                   0.4495099  0.0919860   4.887 1.03e-06\n#> `CancerLocalized (Yes)`                 1.8942512  0.5501880   3.443 0.000575\n#> CancerMetastatic                        3.2703316  0.5858715   5.582 2.38e-08\n#> Cardiovascular1                         0.2386749  0.0939617   2.540 0.011081\n#> Congestive.HF1                          0.4539010  0.0971624   4.672 2.99e-06\n#> Dementia1                               0.2380213  0.1162903   2.047 0.040679\n#> Hepatic1                                0.3593093  0.1541762   2.331 0.019779\n#> Tumor1                                 -1.2455123  0.5542624  -2.247 0.024630\n#> Immunosupperssion1                      0.2174294  0.0730803   2.975 0.002928\n#> Transfer.hx1                           -0.1849029  0.0945679  -1.955 0.050555\n#> `age[50,60)`                            0.3621248  0.0984288   3.679 0.000234\n#> `age[60,70)`                            0.6941924  0.0968434   7.168 7.60e-13\n#> `age[70,80)`                            0.6804939  0.1126637   6.040 1.54e-09\n#> `age[80, Inf)`                          0.9833851  0.1410563   6.972 3.13e-12\n#> sexFemale                              -0.2805950  0.0653527  -4.294 1.76e-05\n#> DASIndex                               -0.0429272  0.0062191  -6.902 5.11e-12\n#> APACHE.score                            0.0174907  0.0020017   8.738  < 2e-16\n#> Glasgow.Coma.Score                      0.0093657  0.0012563   7.455 9.00e-14\n#> WBC                                     0.0044518  0.0030090   1.479 0.139009\n#> Temperature                            -0.0524703  0.0192757  -2.722 0.006487\n#> PaO2vs.FIO2                             0.0004741  0.0003054   1.552 0.120548\n#> Hematocrit                             -0.0154796  0.0041593  -3.722 0.000198\n#> Bilirubin                               0.0313087  0.0094004   3.331 0.000867\n#> Weight                                 -0.0031548  0.0011213  -2.813 0.004902\n#> DNR.statusYes                           0.9347360  0.1326924   7.044 1.86e-12\n#> Medical.insuranceMedicare               0.4764895  0.1257582   3.789 0.000151\n#> `Medical.insuranceMedicare & Medicaid`  0.3364916  0.1584757   2.123 0.033729\n#> `Medical.insuranceNo insurance`         0.3711345  0.1568820   2.366 0.017996\n#> Medical.insurancePrivate                0.2632637  0.1139805   2.310 0.020903\n#> `Medical.insurancePrivate & Medicare`   0.2819715  0.1313101   2.147 0.031764\n#> Respiratory.DiagYes                     0.1393974  0.0769026   1.813 0.069886\n#> Cardiovascular.DiagYes                  0.1804967  0.0836679   2.157 0.030982\n#> Neurological.DiagYes                    0.4320266  0.1189357   3.632 0.000281\n#> Gastrointestinal.DiagYes                0.2819563  0.1092206   2.582 0.009836\n#> Hematologic.DiagYes                     0.9734424  0.1651363   5.895 3.75e-09\n#> Sepsis.DiagYes                          0.1539651  0.0943235   1.632 0.102614\n#> `incomeUnder $11k`                      0.2151437  0.0689392   3.121 0.001804\n#> RHC.use                                 0.3552053  0.0713632   4.977 6.44e-07\n#>                                           \n#> (Intercept)                               \n#> Disease.categoryOther                  ***\n#> `CancerLocalized (Yes)`                ***\n#> CancerMetastatic                       ***\n#> Cardiovascular1                        *  \n#> Congestive.HF1                         ***\n#> Dementia1                              *  \n#> Hepatic1                               *  \n#> Tumor1                                 *  \n#> Immunosupperssion1                     ** \n#> Transfer.hx1                           .  \n#> `age[50,60)`                           ***\n#> `age[60,70)`                           ***\n#> `age[70,80)`                           ***\n#> `age[80, Inf)`                         ***\n#> sexFemale                              ***\n#> DASIndex                               ***\n#> APACHE.score                           ***\n#> Glasgow.Coma.Score                     ***\n#> WBC                                       \n#> Temperature                            ** \n#> PaO2vs.FIO2                               \n#> Hematocrit                             ***\n#> Bilirubin                              ***\n#> Weight                                 ** \n#> DNR.statusYes                          ***\n#> Medical.insuranceMedicare              ***\n#> `Medical.insuranceMedicare & Medicaid` *  \n#> `Medical.insuranceNo insurance`        *  \n#> Medical.insurancePrivate               *  \n#> `Medical.insurancePrivate & Medicare`  *  \n#> Respiratory.DiagYes                    .  \n#> Cardiovascular.DiagYes                 *  \n#> Neurological.DiagYes                   ***\n#> Gastrointestinal.DiagYes               ** \n#> Hematologic.DiagYes                    ***\n#> Sepsis.DiagYes                            \n#> `incomeUnder $11k`                     ** \n#> RHC.use                                ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> (Dispersion parameter for binomial family taken to be 1)\n#> \n#>     Null deviance: 7433.3  on 5734  degrees of freedom\n#> Residual deviance: 6198.0  on 5696  degrees of freedom\n#> AIC: 6276\n#> \n#> Number of Fisher Scoring iterations: 5\n```\n:::\n\n\n\n### Video content (optional)\n\n::: callout-tip\nFor those who prefer a video walkthrough, feel free to watch the video below, which offers a description of an earlier version of the above content.\n:::\n\n::: {style=\"position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;\"}\n<iframe src=\"https://www.youtube.com/embed/YPOP82Wxfy8\" style=\"position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;\" allowfullscreen>\n\n</iframe>\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}