{
  "hash": "c190d1794537a84bf581f6fb0bfa1631",
  "result": {
    "markdown": "## Exercise (S) {.unnumbered}\n\n::: callout-tip\nYou can download all of the related files in a zip file **propensityscoreEx.zip** from [Github folder](https://github.com/ehsanx/EpiMethods/tree/main/LabExercises/), or just by clicking this link [directly](https://github.com/ehsanx/EpiMethods/raw/main/LabExercises/propensityscoreEx.zip).\n\n-   Navigate to the GitHub folder (above link) where the ZIP file is located.\n-   Click on the file name (above zip file) to open its preview window.\n-   Click on the Download button to download the file. If you can't see the Download button, click on \"Download Raw File\" link that should appear on the page.\n:::\n\n## Problem Statement\n\n\n\n\n\n\n\n\n\nWe will use the article by [Moon et al. (2021)](https://doi.org/10.1002/nau.24711):\n\nWe will reproduce some results from the article. The authors aggregated 4 NHANES cycles 2005-12 to create their analytic dataset. The full dataset contains 40,790 subjects with the following relevant variables for this exercise:\n\n**Survey information**\n\n-   SEQN: Respondent sequence number\n-   strata: Masked pseudo strata (strata is nested within PSU)\n-   psu: Masked pseudo PSU\n-   survey.weight: Full sample 8 year interview weight divided by 4\n-   survey.cycle: NHANES cycle\n\n**Outcome variable**\n\n-   cvd: Cardiovascular disease\n\n**Exposure**\n\n-   nocturia: Binary nocturia\n\n**Confounders and other variables**\n\n-   age: Age in years at screening\n-   gender: Gender\n-   race: Race/Ethnicity\n-   smoking: 100+ cigarettes in life\n-   alcohol: Alcohol consumption (12+ drinks in 1 year)\n-   sleep: Sleep duration, h\n-   bmi: Body Mass Index in kg/m$^2$\n-   systolic: Systolic blood pressure, mmHg\n-   diastolic: Diastolic blood pressure, mmHg\n-   tcholesterol: Total cholesterol, mg/dl\n-   triglycerides: Triglycerides, mg/dl\n-   hdl: HDL‚Äêcholesterol, mg/dl\n-   diabetes: Diabetes mellitus\n-   hypertension: Hypertension\n\nTwo important **warnings** before we start:\n\n-   In this paper, there is insufficient information to create the analytic dataset. This is mainly because of not sufficiently defining the covariates and not explicitly explaining the inclusion/exclusion criteria.\n\n-   The authors did incorrect analyses. For example, they didn't consider survey features. Since we will utilize survey features in our analysis, our results will likely be different than the results shown by the authors in Table 2.\n\n## Question 1: \\[0% grade\\]\n\n### 1(a) Importing dataset\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nload(file = \"Data/propensityscore/Moon2021.RData\")\n```\n:::\n\n\n\n\n### 1(b) Subsetting according to eligibility\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Age 20+\ndat.analytic <- dat.full[complete.cases(dat.full$age),]\n\n# Complete outcome and exposure information\ndat.analytic <- dat.analytic[complete.cases(dat.analytic$cvd),] \ndat.analytic <- dat.analytic[complete.cases(dat.analytic$nocturia),] \n\n# Keep important variables only\nvars <- c(\n  # Survey features\n  \"SEQN\", \"strata\", \"psu\", \"survey.weight\", \n  \n  # Survey cycle\n  \"survey.cycle\", \n  \n  # Binary exposure\n  \"nocturia\",\n  \n  # Outcome\n  \"cvd\",\n  \n  # Covariates\n  \"age\", \"gender\", \"race\" , \"smoking\", \"alcohol\", \"sleep\", \"bmi\", \"diabetes\", \n  \"hypertension\", \"tcholesterol\", \"triglycerides\", \"hdl\", \"systolic\", \"diastolic\")\n\ndat.analytic <- dat.analytic[,vars]\n\n# Complete case\ndat.analytic <- na.omit(dat.analytic) #  N = 15,404 (numbers do not match with Fig 1)\ndim(dat.analytic)\n#> [1] 15404    21\n```\n:::\n\n\n\n\n### 1(c) Run the design-adjusted logistic regression\n\nCreate the first column of Table 2 of the article, i.e., explore the relationship between binary nocturia and CVD among adults aged 20 years and more. Adjust the model for age, gender, race, body mass index, smoking status, alcohol consumption, sleep duration, hypertension, diabetes mellitus, and survey cycles.\n\n-   Hint 1: the authors did not utilize the survey features (e.g., strata, psu, survey weights). But you should utilize the survey features to answer this question.\n\n-   Hint 2: Adjust the model for age, gender, race, bmi, smoking, alcohol, sleep, tcholesterol, triglycerides, hdl, hypertension, diabetes, and survey cycle.\n\n-   Hint 3: Use Publish package to report the odds ratio with the 95% CI and p-value.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create an indicator variable in the full data\ndat.full$miss <- 1\ndat.full$miss[dat.full$SEQN %in% dat.analytic$SEQN] <- 0\n\n# Design setup\nsvy.design0 <- svydesign(strata = ~strata, id = ~psu, weights = ~survey.weight,\n                         data = dat.full, nest = TRUE)\n\n# Subset the design\nsvy.design <- subset(svy.design0, miss == 0)\n\n# Design-adjusted logistic\nfit.logit <- svyglm(I(cvd == \"Yes\") ~ nocturia + age + gender + race + bmi + \n                      smoking + alcohol + sleep + tcholesterol + triglycerides + \n                      hdl + hypertension + diabetes + survey.cycle, \n                    family = binomial, design = svy.design)\npublish(fit.logit)\n#>       Variable              Units OddsRatio         CI.95     p-value \n#>       nocturia                 <2       Ref                           \n#>                                2+      1.44   [1.21;1.71]   0.0001496 \n#>            age            [20,40)       Ref                           \n#>                           [40,60)      4.21   [3.05;5.82]     < 1e-04 \n#>                           [60,80)     11.46  [7.89;16.64]     < 1e-04 \n#>                          [80,Inf)     25.28 [17.51;36.50]     < 1e-04 \n#>         gender               Male       Ref                           \n#>                            Female      0.68   [0.58;0.79]     < 1e-04 \n#>           race          Hispanics       Ref                           \n#>                Non-Hispanic White      1.32   [1.10;1.57]   0.0036168 \n#>                Non-Hispanic Black      1.15   [0.92;1.44]   0.2362499 \n#>                       Other races      1.55   [1.05;2.30]   0.0319116 \n#>            bmi                         1.02   [1.01;1.03]   0.0003273 \n#>        smoking                 No       Ref                           \n#>                               Yes      1.74   [1.46;2.07]     < 1e-04 \n#>        alcohol                 No       Ref                           \n#>                               Yes      0.92   [0.59;1.45]   0.7273627 \n#>          sleep                         0.96   [0.90;1.01]   0.1146287 \n#>   tcholesterol                         0.99   [0.99;0.99]     < 1e-04 \n#>  triglycerides                         1.00   [1.00;1.00]   0.4801803 \n#>            hdl                         0.99   [0.98;1.00]   0.0416900 \n#>   hypertension                 No       Ref                           \n#>                               Yes      2.73   [2.27;3.29]     < 1e-04 \n#>       diabetes                 No       Ref                           \n#>                               Yes      1.83   [1.51;2.22]     < 1e-04 \n#>   survey.cycle            2005-06       Ref                           \n#>                           2007-08      0.84   [0.65;1.07]   0.1644272 \n#>                           2009-10      0.91   [0.73;1.12]   0.3793696 \n#>                           2011-11      0.82   [0.68;0.99]   0.0398975\n```\n:::\n\n\n\n\n## Question 2: Propensity score matching by DuGoff et al. (2014) \\[50% grade\\]\n\nCreate the second column of Table 2 (exploring the relationship between binary nocturia and CVD; the same exposure and outcome used in Question 1) using the propensity score **1:1 matching** analysis as per [DuGoff et al. (2014)](https://pubmed.ncbi.nlm.nih.gov/23855598/) recommendations.\n\nPlease read the hints carefully:\n\n-   Hint 1: You should consider all four steps in the propensity score (PS) analysis:\n\n    -   Step 1: Fit the PS model by considering survey features as covariates. Other covariates for the PS model are: age, gender, race, bmi, smoking, alcohol, sleep, tcholesterol, triglycerides, hdl, hypertension, diabetes, systolic, diastolic, and survey cycle.\n\n    -   Step 2: Match an exposed subject (nocturia $\\ge2$ times) with a control subject (nocturia \\<2 times) without replacement within the caliper of 0.2 times the standard deviation of the logit of PS. Set your seed to 123.\n\n    -   Step 3: Balance checking using SMD. Consider SMD \\<0.1 as a good covariate balancing.\n\n    -   Step 4: Fit the outcome model on the matched data. If needed, adjust for imbalanced covariates in the outcome model. Report the odds ratio with a 95% CI. For step 4, you should utilize the survey feature as the design (NOT covariates).\n\n-   Hint 2: Compare your results with the results reported by the authors. \\[Expected answer: 2-3 sentences\\]\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# your codes here\n\n```\n:::\n\n\n\n\n## Question 3: Propensity score matching by Austin et al. (2018) \\[50% grade\\]\n\nCreate the second column of Table 2 (exploring the relationship between binary nocturia and CVD; the same exposure and outcome used in Questions 1 and 2) using the propensity score **1:4 matching** analysis as per [Austin et al. (2018)](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5843030/) recommendations.\n\nPlease read the hints carefully:\n\n-   Hint 1: You should consider all four steps in the propensity score (PS) analysis:\n\n    -   Step 1: Fit the PS model by considering survey features as design, i.e., fit the design-adjusted PS model. Other covariates for the PS model are: age, gender, race, bmi, smoking, alcohol, sleep, tcholesterol, triglycerides, hdl, hypertension, diabetes, systolic, diastolic, and survey cycle.\n\n    -   Step 2: Match an exposed subject (nocturia $\\ge2$ times) with 4 control subjects (nocturia \\<2 times) with replacement within the caliper of 0.2 times the standard deviation of the logit of PS. Set your seed to 123.\n\n    -   Step 3: Balance checking using SMD. Consider SMD \\<0.1 as a good covariate balancing. Remember, you need to multiply matching weights and survey weights to get survey-based estimates.\n\n    -   Step 4: Fit the outcome model on the matched data. If needed, adjust for imbalanced covariates in the outcome model. Report the odds ratio with a 95% CI. For step 4, you should utilize the survey feature as the design (NOT covariates).\n\n-   Hint 2: Compare the results with Question 2. What's the overall conclusion? \\[Expected answer: 2-3 sentences\\]\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# your codes here\n\n```\n:::\n",
    "supporting": [
      "propensityscoreE_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}