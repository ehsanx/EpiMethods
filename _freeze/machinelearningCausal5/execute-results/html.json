{
  "hash": "04ef73b889df9d9ebbb8ae2851d6be10",
  "result": {
    "markdown": "## Comparing results {.unnumbered}\n\nIn this tutorial, we will use the RHC dataset in exploring the relationship between RHC (yes/no) and death (yes/no). We will use the following approaches:\n\n-   logistic regression\n-   propensity score matching and weighting with logistic regression\n-   propensity score matching and weighting with Super Learner\n-   TMLE\n\n### Load packages\n\nWe load several R packages required for fitting the models.\n\n\n::: {.cell hash='machinelearningCausal5_cache/html/setup_a7b136b6e971fd9b12adc554eda417dd'}\n\n```{.r .cell-code}\n# Load required packages\nlibrary(tableone)\nlibrary(Publish)\nlibrary(randomForest)\nlibrary(tmle)\nlibrary(xgboost)\nlibrary(kableExtra)\nlibrary(SuperLearner)\nlibrary(dbarts)\nlibrary(MatchIt)\nlibrary(cobalt)\nlibrary(survey)\nlibrary(knitr)\n```\n:::\n\n\n### Load dataset\n\n\n::: {.cell hash='machinelearningCausal5_cache/html/data_55eea73a5f93a7a7c54ac8398ecee455'}\n\n```{.r .cell-code}\nload(file = \"Data/machinelearningCausal/cl2.RData\")\nls()\n#> [1] \"baselinevars\" \"ObsData\"      \"tab0\"\n```\n:::\n\n::: {.cell hash='machinelearningCausal5_cache/html/data2_978b3ef2cc4d11e913ca603e9e77c049'}\n\n```{.r .cell-code}\n# Data\ndat <- ObsData\nhead(dat)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"Disease.category\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Cancer\"],\"name\":[2],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Cardiovascular\"],\"name\":[3],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Congestive.HF\"],\"name\":[4],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Dementia\"],\"name\":[5],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Psychiatric\"],\"name\":[6],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Pulmonary\"],\"name\":[7],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Renal\"],\"name\":[8],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Hepatic\"],\"name\":[9],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"GI.Bleed\"],\"name\":[10],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Tumor\"],\"name\":[11],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Immunosupperssion\"],\"name\":[12],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Transfer.hx\"],\"name\":[13],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"MI\"],\"name\":[14],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"age\"],\"name\":[15],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"sex\"],\"name\":[16],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"edu\"],\"name\":[17],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"DASIndex\"],\"name\":[18],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"APACHE.score\"],\"name\":[19],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Glasgow.Coma.Score\"],\"name\":[20],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"blood.pressure\"],\"name\":[21],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"WBC\"],\"name\":[22],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Heart.rate\"],\"name\":[23],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Respiratory.rate\"],\"name\":[24],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Temperature\"],\"name\":[25],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"PaO2vs.FIO2\"],\"name\":[26],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Albumin\"],\"name\":[27],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Hematocrit\"],\"name\":[28],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Bilirubin\"],\"name\":[29],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Creatinine\"],\"name\":[30],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Sodium\"],\"name\":[31],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Potassium\"],\"name\":[32],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"PaCo2\"],\"name\":[33],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"PH\"],\"name\":[34],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Weight\"],\"name\":[35],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"DNR.status\"],\"name\":[36],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Medical.insurance\"],\"name\":[37],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Respiratory.Diag\"],\"name\":[38],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Cardiovascular.Diag\"],\"name\":[39],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Neurological.Diag\"],\"name\":[40],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Gastrointestinal.Diag\"],\"name\":[41],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Renal.Diag\"],\"name\":[42],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Metabolic.Diag\"],\"name\":[43],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Hematologic.Diag\"],\"name\":[44],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Sepsis.Diag\"],\"name\":[45],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Trauma.Diag\"],\"name\":[46],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Orthopedic.Diag\"],\"name\":[47],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"race\"],\"name\":[48],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"income\"],\"name\":[49],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Length.of.Stay\"],\"name\":[50],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Death\"],\"name\":[51],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"RHC.use\"],\"name\":[52],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Other\",\"2\":\"Localized (Yes)\",\"3\":\"0\",\"4\":\"0\",\"5\":\"0\",\"6\":\"0\",\"7\":\"1\",\"8\":\"0\",\"9\":\"0\",\"10\":\"0\",\"11\":\"1\",\"12\":\"0\",\"13\":\"0\",\"14\":\"0\",\"15\":\"[70,80)\",\"16\":\"Male\",\"17\":\"12.000000\",\"18\":\"23.50000\",\"19\":\"46\",\"20\":\"0\",\"21\":\"41\",\"22\":\"22.09765620\",\"23\":\"124\",\"24\":\"10\",\"25\":\"38.69531\",\"26\":\"68.0000\",\"27\":\"3.500000\",\"28\":\"58.00000\",\"29\":\"1.0097656\",\"30\":\"1.1999512\",\"31\":\"145\",\"32\":\"4.000000\",\"33\":\"40\",\"34\":\"7.359375\",\"35\":\"64.69995\",\"36\":\"No\",\"37\":\"Medicare\",\"38\":\"Yes\",\"39\":\"Yes\",\"40\":\"No\",\"41\":\"No\",\"42\":\"No\",\"43\":\"No\",\"44\":\"No\",\"45\":\"No\",\"46\":\"No\",\"47\":\"No\",\"48\":\"white\",\"49\":\"Under $11k\",\"50\":\"9\",\"51\":\"0\",\"52\":\"0\",\"_rn_\":\"1\"},{\"1\":\"MOSF\",\"2\":\"None\",\"3\":\"1\",\"4\":\"1\",\"5\":\"0\",\"6\":\"0\",\"7\":\"0\",\"8\":\"0\",\"9\":\"0\",\"10\":\"0\",\"11\":\"0\",\"12\":\"1\",\"13\":\"1\",\"14\":\"0\",\"15\":\"[70,80)\",\"16\":\"Female\",\"17\":\"12.000000\",\"18\":\"14.75195\",\"19\":\"50\",\"20\":\"0\",\"21\":\"63\",\"22\":\"28.89843750\",\"23\":\"137\",\"24\":\"38\",\"25\":\"38.89844\",\"26\":\"218.3125\",\"27\":\"2.599609\",\"28\":\"32.50000\",\"29\":\"0.6999512\",\"30\":\"0.5999756\",\"31\":\"137\",\"32\":\"3.299805\",\"33\":\"34\",\"34\":\"7.329102\",\"35\":\"45.69998\",\"36\":\"No\",\"37\":\"Private & Medicare\",\"38\":\"No\",\"39\":\"No\",\"40\":\"No\",\"41\":\"No\",\"42\":\"No\",\"43\":\"No\",\"44\":\"No\",\"45\":\"Yes\",\"46\":\"No\",\"47\":\"No\",\"48\":\"white\",\"49\":\"Under $11k\",\"50\":\"45\",\"51\":\"1\",\"52\":\"1\",\"_rn_\":\"2\"},{\"1\":\"MOSF\",\"2\":\"Localized (Yes)\",\"3\":\"0\",\"4\":\"0\",\"5\":\"0\",\"6\":\"0\",\"7\":\"0\",\"8\":\"0\",\"9\":\"0\",\"10\":\"0\",\"11\":\"1\",\"12\":\"1\",\"13\":\"0\",\"14\":\"0\",\"15\":\"[-Inf,50)\",\"16\":\"Female\",\"17\":\"14.069916\",\"18\":\"18.13672\",\"19\":\"82\",\"20\":\"0\",\"21\":\"57\",\"22\":\"0.04999542\",\"23\":\"130\",\"24\":\"40\",\"25\":\"36.39844\",\"26\":\"275.5000\",\"27\":\"3.500000\",\"28\":\"21.09766\",\"29\":\"1.0097656\",\"30\":\"2.5996094\",\"31\":\"146\",\"32\":\"2.899902\",\"33\":\"16\",\"34\":\"7.359375\",\"35\":\"0.00000\",\"36\":\"No\",\"37\":\"Private\",\"38\":\"No\",\"39\":\"Yes\",\"40\":\"No\",\"41\":\"No\",\"42\":\"No\",\"43\":\"No\",\"44\":\"No\",\"45\":\"No\",\"46\":\"No\",\"47\":\"No\",\"48\":\"white\",\"49\":\"$25-$50k\",\"50\":\"60\",\"51\":\"0\",\"52\":\"1\",\"_rn_\":\"3\"},{\"1\":\"ARF\",\"2\":\"None\",\"3\":\"0\",\"4\":\"0\",\"5\":\"0\",\"6\":\"0\",\"7\":\"0\",\"8\":\"0\",\"9\":\"0\",\"10\":\"0\",\"11\":\"0\",\"12\":\"1\",\"13\":\"0\",\"14\":\"0\",\"15\":\"[70,80)\",\"16\":\"Female\",\"17\":\"9.000000\",\"18\":\"22.92969\",\"19\":\"48\",\"20\":\"0\",\"21\":\"55\",\"22\":\"23.29687500\",\"23\":\"58\",\"24\":\"26\",\"25\":\"35.79688\",\"26\":\"156.6562\",\"27\":\"3.500000\",\"28\":\"26.29688\",\"29\":\"0.3999634\",\"30\":\"1.6999512\",\"31\":\"117\",\"32\":\"5.799805\",\"33\":\"30\",\"34\":\"7.459961\",\"35\":\"54.59998\",\"36\":\"No\",\"37\":\"Private & Medicare\",\"38\":\"Yes\",\"39\":\"No\",\"40\":\"No\",\"41\":\"No\",\"42\":\"No\",\"43\":\"No\",\"44\":\"No\",\"45\":\"No\",\"46\":\"No\",\"47\":\"No\",\"48\":\"white\",\"49\":\"$11-$25k\",\"50\":\"37\",\"51\":\"1\",\"52\":\"0\",\"_rn_\":\"4\"},{\"1\":\"MOSF\",\"2\":\"None\",\"3\":\"0\",\"4\":\"0\",\"5\":\"0\",\"6\":\"0\",\"7\":\"0\",\"8\":\"0\",\"9\":\"0\",\"10\":\"0\",\"11\":\"0\",\"12\":\"0\",\"13\":\"0\",\"14\":\"0\",\"15\":\"[60,70)\",\"16\":\"Male\",\"17\":\"9.945259\",\"18\":\"21.05078\",\"19\":\"72\",\"20\":\"41\",\"21\":\"65\",\"22\":\"29.69921880\",\"23\":\"125\",\"24\":\"27\",\"25\":\"34.79688\",\"26\":\"478.0000\",\"27\":\"3.500000\",\"28\":\"24.00000\",\"29\":\"1.0097656\",\"30\":\"3.5996094\",\"31\":\"126\",\"32\":\"5.799805\",\"33\":\"17\",\"34\":\"7.229492\",\"35\":\"78.39996\",\"36\":\"Yes\",\"37\":\"Medicare\",\"38\":\"No\",\"39\":\"Yes\",\"40\":\"No\",\"41\":\"No\",\"42\":\"No\",\"43\":\"No\",\"44\":\"No\",\"45\":\"No\",\"46\":\"No\",\"47\":\"No\",\"48\":\"white\",\"49\":\"Under $11k\",\"50\":\"2\",\"51\":\"1\",\"52\":\"1\",\"_rn_\":\"5\"},{\"1\":\"Other\",\"2\":\"None\",\"3\":\"0\",\"4\":\"1\",\"5\":\"0\",\"6\":\"0\",\"7\":\"1\",\"8\":\"0\",\"9\":\"0\",\"10\":\"0\",\"11\":\"0\",\"12\":\"0\",\"13\":\"0\",\"14\":\"0\",\"15\":\"[80, Inf)\",\"16\":\"Female\",\"17\":\"8.000000\",\"18\":\"17.50000\",\"19\":\"38\",\"20\":\"0\",\"21\":\"115\",\"22\":\"18.00000000\",\"23\":\"134\",\"24\":\"36\",\"25\":\"39.19531\",\"26\":\"184.1875\",\"27\":\"3.099609\",\"28\":\"30.50000\",\"29\":\"1.0097656\",\"30\":\"1.3999023\",\"31\":\"138\",\"32\":\"5.399414\",\"33\":\"68\",\"34\":\"7.299805\",\"35\":\"54.89999\",\"36\":\"No\",\"37\":\"Medicare\",\"38\":\"Yes\",\"39\":\"No\",\"40\":\"No\",\"41\":\"No\",\"42\":\"No\",\"43\":\"No\",\"44\":\"No\",\"45\":\"No\",\"46\":\"No\",\"47\":\"No\",\"48\":\"white\",\"49\":\"Under $11k\",\"50\":\"7\",\"51\":\"0\",\"52\":\"0\",\"_rn_\":\"6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\n\n# Data dimension\ndim(dat)\n#> [1] 5735   52\n```\n:::\n\n\nConfounder list in the `baselinevars` vector is\n\n\n::: {.cell hash='machinelearningCausal5_cache/html/data2x_6c7dfdfa86ed628a77356c83f5cf2ca5'}\n::: {.cell-output-display}\n|Confounders           |\n|:---------------------|\n|Disease.category      |\n|Cancer                |\n|Cardiovascular        |\n|Congestive.HF         |\n|Dementia              |\n|Psychiatric           |\n|Pulmonary             |\n|Renal                 |\n|Hepatic               |\n|GI.Bleed              |\n|Tumor                 |\n|Immunosupperssion     |\n|Transfer.hx           |\n|MI                    |\n|age                   |\n|sex                   |\n|edu                   |\n|DASIndex              |\n|APACHE.score          |\n|Glasgow.Coma.Score    |\n|blood.pressure        |\n|WBC                   |\n|Heart.rate            |\n|Respiratory.rate      |\n|Temperature           |\n|PaO2vs.FIO2           |\n|Albumin               |\n|Hematocrit            |\n|Bilirubin             |\n|Creatinine            |\n|Sodium                |\n|Potassium             |\n|PaCo2                 |\n|PH                    |\n|Weight                |\n|DNR.status            |\n|Medical.insurance     |\n|Respiratory.Diag      |\n|Cardiovascular.Diag   |\n|Neurological.Diag     |\n|Gastrointestinal.Diag |\n|Renal.Diag            |\n|Metabolic.Diag        |\n|Hematologic.Diag      |\n|Sepsis.Diag           |\n|Trauma.Diag           |\n|Orthopedic.Diag       |\n|race                  |\n|income                |\n:::\n:::\n\n\n### Logistic regression\n\nLet us define the regression formula and fit logistic regression, adjusting for baseline confounders.\n\n\n::: {.cell hash='machinelearningCausal5_cache/html/logistic_9ea338185ce56fc5cc70935996f9082a'}\n\n```{.r .cell-code}\n# Formula\nFormula <- formula(paste(\"Death ~ RHC.use + \", \n                         paste(baselinevars, \n                               collapse = \" + \")))\n\n# Logistic regression\nfit.glm <- glm(Formula, \n               data = dat, \n               family = binomial)\n```\n:::\n\n\nWe can use `flextable` package to view `fit.glm`, the regression output:\n\n\n::: {.cell caption='Your Table Title' hash='machinelearningCausal5_cache/html/unnamed-chunk-1_3b474c954844f8fec020d1e577e8c574'}\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-e05d0a34{table-layout:auto;width:50%;}.cl-e051b2c4{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-e055fa14{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-e05626f6{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e0562700{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-e05d0a34'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-e05626f6\"><p class=\"cl-e055fa14\"><span class=\"cl-e051b2c4\">Variable</span></p></th><th class=\"cl-e05626f6\"><p class=\"cl-e055fa14\"><span class=\"cl-e051b2c4\">Odds_Ratio</span></p></th><th class=\"cl-e05626f6\"><p class=\"cl-e055fa14\"><span class=\"cl-e051b2c4\">CI_Lower</span></p></th><th class=\"cl-e05626f6\"><p class=\"cl-e055fa14\"><span class=\"cl-e051b2c4\">CI_Upper</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e0562700\"><p class=\"cl-e055fa14\"><span class=\"cl-e051b2c4\">RHC.use</span></p></td><td class=\"cl-e0562700\"><p class=\"cl-e055fa14\"><span class=\"cl-e051b2c4\">1.42</span></p></td><td class=\"cl-e0562700\"><p class=\"cl-e055fa14\"><span class=\"cl-e051b2c4\">1.23</span></p></td><td class=\"cl-e0562700\"><p class=\"cl-e055fa14\"><span class=\"cl-e051b2c4\">1.65</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nAs we can see, the odds of death was 42% higher among those participants with RHC use than those with no RHC use.\n\n### Propensity score matching with logistic regression\n\nNow we will use propensity score matching, where propensity score will be estimated using logistic regression. The first step is to define the propensity score formula and estimate the propensity scores.\n\n#### Step 1\n\n\n::: {.cell hash='machinelearningCausal5_cache/html/psml1_dc3f8a69963ab6fd902b52ad51629fcd'}\n\n```{.r .cell-code}\n# Propensity score model define\nps.formula <- as.formula(paste0(\"RHC.use ~ \", \n                                paste(baselinevars, \n                                      collapse = \"+\")))\n\n# Propensity score model fitting\nfit.ps <- glm(ps.formula, \n              data = dat, \n              family = binomial)\n\n# Propensity scores\ndat$ps <- predict(fit.ps, \n                  type = \"response\")\nsummary(dat$ps)\n#>     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. \n#> 0.002478 0.161446 0.358300 0.380819 0.574319 0.968425\n```\n:::\n\n\n#### Step 2\n\nThe second step is to match exposed (i.e., RHC users) to unexposed (i.e., RHC non-users) based on the propensity scores. We will use nearest neighborhood and caliper approach.\n\n\n::: {.cell hash='machinelearningCausal5_cache/html/psml2a_340aab33ba44ddaef1a32a78111aa993'}\n\n:::\n\n::: {.cell hash='machinelearningCausal5_cache/html/psml2b_c81cefd90ee6f1ead832a95c908bf60f'}\n\n:::\n\n::: {.cell hash='machinelearningCausal5_cache/html/psml2c_ec649548252d0ab3b6688b548d2262e1'}\n\n```{.r .cell-code}\n# Caliper\ncaliper <- 0.2*sd(log(dat$ps/(1-dat$ps)))\n\n# 1:1 matching\nset.seed(123)\nmatch.obj <- matchit(ps.formula, \n                     data = dat,\n                     distance = dat$ps, \n                     method = \"nearest\",\n                     ratio = 1,\n                     caliper = caliper)\n```\n:::\n\n::: {.cell hash='machinelearningCausal5_cache/html/psml2d_27fa01893dc119aebe71ce63085e4e97'}\n\n```{.r .cell-code}\n# See how many matched\nmatch.obj \n#> A `matchit` object\n#>  - method: 1:1 nearest neighbor matching without replacement\n#>  - distance: User-defined [caliper]\n#>  - caliper: <distance> (0.068)\n#>  - number of obs.: 5735 (original), 3478 (matched)\n#>  - target estimand: ATT\n#>  - covariates: too many to name\n\n# Extract matched data\nmatched.data <- match.data(match.obj)\n\n# Overlap checking\nbal.plot(match.obj,\n         var.name=\"distance\",\n         which=\"both\",\n         type = \"density\",\n         colors = c(\"red\",\"blue\"))\n```\n\n::: {.cell-output-display}\n![](machinelearningCausal5_files/figure-html/psml2d-1.png){width=672}\n:::\n:::\n\n\n#### Step 3\n\nThe third step is to check the balancing on the matched data. We will compare the similarity of baseline characteristics between RHC users and non-users in the propensity score matched sample. Let's consider SMD \\>0.1 as imbalanced.\n\n\n::: {.cell hash='machinelearningCausal5_cache/html/psml3_79bc373cabacd59c446a4d14c8152021'}\n\n```{.r .cell-code}\n# Balance checking in terms of SMD - using love plot\nlove.plot(match.obj, \n          binary = \"std\", \n          grid = TRUE,\n          thresholds = c(m = .1),\n          colors = c(\"red\",\"blue\")) \n```\n\n::: {.cell-output-display}\n![](machinelearningCausal5_files/figure-html/psml3-1.png){width=672}\n:::\n\n```{.r .cell-code}\n\n# Balance checking in terms of SMD - using tableone\ntab1b <- CreateTableOne(vars = baselinevars, strata = \"RHC.use\", \n                        data = matched.data, includeNA = T,\n                        addOverall = F, test = F)\n#print(tab1b, showAllLevels = T, catDigits = 2, smd = T)\n```\n:::\n\n\n`ExtractSmd(tab1b)` shows\n\n\n::: {.cell caption='Your Table Title' hash='machinelearningCausal5_cache/html/unnamed-chunk-2_5c9e1cc62e3a19e1f8c25512216d32db'}\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-e2f5abe8{}.cl-e2e7726c{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-e2ee36b0{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-e2ee36ce{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-e2ee93a8{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e2ee93b2{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e2ee93bc{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e2ee93c6{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e2ee93c7{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e2ee93d0{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-e2f5abe8'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-e2ee93a8\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Variables</span></p></th><th class=\"cl-e2ee93b2\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">1 vs 2</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Disease.category</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.06</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Cancer</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Cardiovascular</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Congestive.HF</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Dementia</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Psychiatric</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.04</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Pulmonary</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.04</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Renal</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Hepatic</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">GI.Bleed</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Tumor</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Immunosupperssion</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Transfer.hx</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">MI</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">age</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.04</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">sex</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">edu</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">DASIndex</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">APACHE.score</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.08</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Glasgow.Coma.Score</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">blood.pressure</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.07</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">WBC</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Heart.rate</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Respiratory.rate</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.04</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Temperature</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">PaO2vs.FIO2</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.06</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Albumin</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Hematocrit</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Bilirubin</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Creatinine</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Sodium</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Potassium</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">PaCo2</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.04</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">PH</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Weight</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">DNR.status</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Medical.insurance</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.06</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Respiratory.Diag</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.06</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Cardiovascular.Diag</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.05</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Neurological.Diag</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.04</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Gastrointestinal.Diag</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Renal.Diag</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Metabolic.Diag</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Hematologic.Diag</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Sepsis.Diag</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Trauma.Diag</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">Orthopedic.Diag</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.05</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93bc\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">race</span></p></td><td class=\"cl-e2ee93c6\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e2ee93c7\"><p class=\"cl-e2ee36b0\"><span class=\"cl-e2e7726c\">income</span></p></td><td class=\"cl-e2ee93d0\"><p class=\"cl-e2ee36ce\"><span class=\"cl-e2e7726c\">0.06</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nAfter propensity score matching, all the confounders are balanced in terms of SMD. Now, we will fit the outcome model on the matched data.\n\n#### Step 4\n\n\n::: {.cell hash='machinelearningCausal5_cache/html/psml4_865239c0c2fa410e23b285abd57c7018'}\n\n```{.r .cell-code}\nfit.psm <- glm(Death ~ RHC.use, \n               data = matched.data, \n               family = binomial)\n```\n:::\n\n\nSummary of `fit.psm`:\n\n\n::: {.cell caption='Your Table Title' hash='machinelearningCausal5_cache/html/unnamed-chunk-3_bf1a0b94cd5416cb3e7c6a898aa15afd'}\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-e32bd966{table-layout:auto;width:50%;}.cl-e3222a38{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-e3262d72{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-e326575c{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e3265766{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-e32bd966'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-e326575c\"><p class=\"cl-e3262d72\"><span class=\"cl-e3222a38\">Variable</span></p></th><th class=\"cl-e326575c\"><p class=\"cl-e3262d72\"><span class=\"cl-e3222a38\">Odds_Ratio</span></p></th><th class=\"cl-e326575c\"><p class=\"cl-e3262d72\"><span class=\"cl-e3222a38\">CI_Lower</span></p></th><th class=\"cl-e326575c\"><p class=\"cl-e3262d72\"><span class=\"cl-e3222a38\">CI_Upper</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e3265766\"><p class=\"cl-e3262d72\"><span class=\"cl-e3222a38\">RHC.use</span></p></td><td class=\"cl-e3265766\"><p class=\"cl-e3262d72\"><span class=\"cl-e3222a38\">1.29</span></p></td><td class=\"cl-e3265766\"><p class=\"cl-e3262d72\"><span class=\"cl-e3222a38\">1.12</span></p></td><td class=\"cl-e3265766\"><p class=\"cl-e3262d72\"><span class=\"cl-e3222a38\">1.48</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nIn the propensity score matched data, the odds of death was 29% higher among those participants with RHC use than those with no RHC use.\n\n### Propensity score weighting with logistic regression\n\nNow we will use the propensity score weighting approach where propensity scores are estimated using logistic regression.\n\n#### Step 1\n\nStep 1 is the same as we did it for the propensity score matching.\n\n#### Step 2\n\nFor the second step, we will calculate the stabilized inverse probability weight.\n\n\n::: {.cell hash='machinelearningCausal5_cache/html/pswl2_c8843dd5cf1e12d936f0653827d7f16b'}\n\n```{.r .cell-code}\ndat$ipw <- with(dat, ifelse(RHC.use==1, mean(RHC.use)/ps, \n                            mean(1-RHC.use)/(1-ps)))\nsummary(dat$ipw)\n#>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#>  0.3932  0.6571  0.7781  0.9953  1.0624 24.1854\n```\n:::\n\n\n#### Step 3\n\nNow, we will check the balance in terms of SMD.\n\n\n::: {.cell hash='machinelearningCausal5_cache/html/pswl3_093359d76f567cd1a14d17c82fe2bad7'}\n\n```{.r .cell-code}\n# Design with inverse probability weights\nw.design <- svydesign(id = ~1, weights = ~ipw, data = dat, nest = F)\n\n# Balance checking in terms of SMD\ntab1e <- svyCreateTableOne(vars = baselinevars, strata = \"RHC.use\", \n                           data = w.design, includeNA = T, \n                           addOverall = F, test = F)\n#print(tab1e, showAllLevels = T, catDigits = 2, smd = T)\n```\n:::\n\n\n`ExtractSmd(tab1e)` shows\n\n\n::: {.cell caption='Your Table Title' hash='machinelearningCausal5_cache/html/unnamed-chunk-4_5f7e8f199949ffa857d06a2d0b8b0874'}\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-e69308ea{}.cl-e687ddc6{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-e68c3b28{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-e68c3b32{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-e68c6814{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e68c681e{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e68c681f{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e68c6828{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e68c6829{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e68c6832{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-e69308ea'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-e68c6814\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Variables</span></p></th><th class=\"cl-e68c681e\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">1 vs 2</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Disease.category</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Cancer</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Cardiovascular</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Congestive.HF</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Dementia</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.05</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Psychiatric</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Pulmonary</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Renal</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Hepatic</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">GI.Bleed</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Tumor</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Immunosupperssion</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Transfer.hx</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">MI</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">age</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.05</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">sex</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">edu</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">DASIndex</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.04</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">APACHE.score</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Glasgow.Coma.Score</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">blood.pressure</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">WBC</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.04</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Heart.rate</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Respiratory.rate</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Temperature</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">PaO2vs.FIO2</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Albumin</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Hematocrit</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Bilirubin</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Creatinine</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Sodium</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Potassium</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">PaCo2</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">PH</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Weight</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">DNR.status</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.04</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Medical.insurance</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Respiratory.Diag</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Cardiovascular.Diag</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Neurological.Diag</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Gastrointestinal.Diag</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Renal.Diag</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Metabolic.Diag</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Hematologic.Diag</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Sepsis.Diag</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Trauma.Diag</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">Orthopedic.Diag</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c681f\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">race</span></p></td><td class=\"cl-e68c6828\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e68c6829\"><p class=\"cl-e68c3b28\"><span class=\"cl-e687ddc6\">income</span></p></td><td class=\"cl-e68c6832\"><p class=\"cl-e68c3b32\"><span class=\"cl-e687ddc6\">0.02</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nAll confounders are balanced (SMD \\< 0.1).\n\n#### Step 4\n\n\n::: {.cell hash='machinelearningCausal5_cache/html/pswl4_f8c332db8e72b21b5d18fc8fb7f5ab41'}\n\n```{.r .cell-code}\nfit.ipw <- svyglm(Death ~ RHC.use, \n                  design = w.design, \n                  family = binomial)\n```\n:::\n\n\nSummary of `fit.ipw`:\n\n\n::: {.cell caption='Your Table Title' hash='machinelearningCausal5_cache/html/unnamed-chunk-5_3fc2ff207d965467d1ffc73a30d598c2'}\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-e6da3c6a{table-layout:auto;width:50%;}.cl-e6d10104{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-e6d4c1d6{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-e6d4e9c2{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e6d4e9d6{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-e6da3c6a'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-e6d4e9c2\"><p class=\"cl-e6d4c1d6\"><span class=\"cl-e6d10104\">Variable</span></p></th><th class=\"cl-e6d4e9c2\"><p class=\"cl-e6d4c1d6\"><span class=\"cl-e6d10104\">Odds_Ratio</span></p></th><th class=\"cl-e6d4e9c2\"><p class=\"cl-e6d4c1d6\"><span class=\"cl-e6d10104\">CI_Lower</span></p></th><th class=\"cl-e6d4e9c2\"><p class=\"cl-e6d4c1d6\"><span class=\"cl-e6d10104\">CI_Upper</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e6d4e9d6\"><p class=\"cl-e6d4c1d6\"><span class=\"cl-e6d10104\">RHC.use</span></p></td><td class=\"cl-e6d4e9d6\"><p class=\"cl-e6d4c1d6\"><span class=\"cl-e6d10104\">1.30</span></p></td><td class=\"cl-e6d4e9d6\"><p class=\"cl-e6d4c1d6\"><span class=\"cl-e6d10104\">1.11</span></p></td><td class=\"cl-e6d4e9d6\"><p class=\"cl-e6d4c1d6\"><span class=\"cl-e6d10104\">1.53</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nIn the propensity score weighted data, the odds of death was 30% higher among those participants with RHC use than those with no RHC use.\n\n### Propensity score matching with super learner\n\nNow we will use the propensity score matching, where we will be using super learner to calculate the propensity scores. We use logistic, LASSO, and XGBoost as the candidate learners.\n\n#### Step 1\n\n\n\n\n::: {.cell hash='machinelearningCausal5_cache/html/psmSL1b_3662334ceb03aafef11090a825240adf'}\n\n:::\n\n::: {.cell hash='machinelearningCausal5_cache/html/psmSL1c_af3bfb551ded6e9b7eb1a48d2c68d607'}\n\n```{.r .cell-code}\nset.seed(123)\nps.fit <- CV.SuperLearner(\n  Y = dat$RHC.use,\n  X = dat[,baselinevars], \n  family = \"binomial\",\n  SL.library = c(\"SL.glm\", \"SL.glmnet\", \"SL.xgboost\"), \n  verbose = FALSE,\n  V = 5, \n  method = \"method.NNLS\")\n```\n:::\n\n::: {.cell hash='machinelearningCausal5_cache/html/psmSL1d_74979aa9272e95bc6c4e9d285dc4f9b1'}\n\n```{.r .cell-code}\n# Propensity scores for all learners  \npredictions <- cbind(ps.fit$SL.predict, ps.fit$library.predict)\nhead(predictions)\n#>                SL.glm_All SL.glmnet_All SL.xgboost_All\n#> [1,] 0.3632635 0.39789364    0.39569431     0.32144672\n#> [2,] 0.5870492 0.64983590    0.61497078     0.54465985\n#> [3,] 0.5740246 0.66329951    0.65396650     0.46847290\n#> [4,] 0.2172501 0.33044244    0.34478278     0.02363573\n#> [5,] 0.6347749 0.45972157    0.43779434     0.86645132\n#> [6,] 0.0272532 0.03420477    0.03629319     0.01730520\n\n# Propensity scores for super learner\ndat$ps.sl <- predictions[,1]\nsummary(dat$ps.sl)\n#>     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. \n#> 0.001671 0.147762 0.337664 0.376282 0.587237 0.975584\n```\n:::\n\n\n#### Step 2\n\nThe same as before, we will match exposed to unexposed based on their propensity scores.\n\n\n::: {.cell hash='machinelearningCausal5_cache/html/psmSL2a_627b8d09f19aeee740b891521dd3ce12'}\n\n:::\n\n::: {.cell hash='machinelearningCausal5_cache/html/psmSL2b_1002f17de0338eab0cb32c2f1b4c53b4'}\n\n:::\n\n::: {.cell hash='machinelearningCausal5_cache/html/psmSL2c_14935c8ba1a5c9b1815dc400d831f641'}\n\n```{.r .cell-code}\n# Caliper\ncaliper <- 0.2*sd(log(dat$ps.sl/(1-dat$ps.sl)))\n\n# 1:1 matching\nset.seed(123)\nmatch.obj2 <- matchit(ps.formula, \n                      data = dat,\n                      distance = dat$ps.sl, \n                      method = \"nearest\",\n                      ratio = 1,\n                      caliper = caliper)\n```\n:::\n\n::: {.cell hash='machinelearningCausal5_cache/html/psmSL2_b6a49ee8a657a84629ed729dfd6da2ce'}\n\n```{.r .cell-code}\n# See how many matched\nmatch.obj2 \n#> A `matchit` object\n#>  - method: 1:1 nearest neighbor matching without replacement\n#>  - distance: User-defined [caliper]\n#>  - caliper: <distance> (0.075)\n#>  - number of obs.: 5735 (original), 3430 (matched)\n#>  - target estimand: ATT\n#>  - covariates: too many to name\n\n# Extract matched data\nmatched.data.sl <- match.data(match.obj2) \n\n# Overlap checking\nbal.plot(match.obj2,\n         var.name=\"distance\",\n         which=\"both\",\n         type = \"density\",\n         colors = c(\"red\",\"blue\"))\n```\n\n::: {.cell-output-display}\n![](machinelearningCausal5_files/figure-html/psmSL2-1.png){width=672}\n:::\n:::\n\n\n#### Step 3\n\nNow we will check the balancing on the matched data.\n\n\n::: {.cell hash='machinelearningCausal5_cache/html/psmSL3_2ac74c08db471a44b9e1b38f593f0f4e'}\n\n```{.r .cell-code}\n# Balance checking in terms of SMD - using love plot\nlove.plot(match.obj2, \n          binary = \"std\", \n          grid = TRUE,\n          thresholds = c(m = .1),\n          colors = c(\"red\",\"blue\")) \n```\n\n::: {.cell-output-display}\n![](machinelearningCausal5_files/figure-html/psmSL3-1.png){width=672}\n:::\n\n```{.r .cell-code}\n\n# Balance checking in terms of SMD - using tableone\ntab1c <- CreateTableOne(vars = baselinevars, strata = \"RHC.use\", \n                        data = matched.data.sl, includeNA = T, \n                        addOverall = T, test = F)\n#print(tab1c, showAllLevels = T, catDigits = 2, smd = T)\n```\n:::\n\n\n`ExtractSmd(tab1c)` shows\n\n\n::: {.cell caption='Your Table Title' hash='machinelearningCausal5_cache/html/unnamed-chunk-6_f05905349888a725b084b4d04ff63517'}\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-e9091e8e{}.cl-e8fdb7c4{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-e9020ea0{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-e9020eaa{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-e9023cd6{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e9023ce0{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e9023cea{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e9023ceb{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e9023cf4{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e9023cf5{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-e9091e8e'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-e9023cd6\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Variables</span></p></th><th class=\"cl-e9023ce0\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">1 vs 2</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Disease.category</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.08</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Cancer</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.05</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Cardiovascular</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Congestive.HF</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Dementia</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Psychiatric</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Pulmonary</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Renal</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Hepatic</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">GI.Bleed</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Tumor</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.05</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Immunosupperssion</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Transfer.hx</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.06</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">MI</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">age</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.06</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">sex</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.04</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">edu</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">DASIndex</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">APACHE.score</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.08</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Glasgow.Coma.Score</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">blood.pressure</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.05</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">WBC</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Heart.rate</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.05</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Respiratory.rate</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Temperature</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.04</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">PaO2vs.FIO2</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.09</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Albumin</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.05</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Hematocrit</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Bilirubin</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Creatinine</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.05</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Sodium</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Potassium</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">PaCo2</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.05</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">PH</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.06</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Weight</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.06</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">DNR.status</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.04</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Medical.insurance</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.06</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Respiratory.Diag</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.08</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Cardiovascular.Diag</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.05</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Neurological.Diag</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.04</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Gastrointestinal.Diag</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Renal.Diag</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Metabolic.Diag</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Hematologic.Diag</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Sepsis.Diag</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.04</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Trauma.Diag</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.06</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">Orthopedic.Diag</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.06</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cea\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">race</span></p></td><td class=\"cl-e9023ceb\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e9023cf4\"><p class=\"cl-e9020ea0\"><span class=\"cl-e8fdb7c4\">income</span></p></td><td class=\"cl-e9023cf5\"><p class=\"cl-e9020eaa\"><span class=\"cl-e8fdb7c4\">0.04</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nAgain, all confounders are balanced in terms of SMD (all SMDs \\< 0.1). Next, we will fit the outcome model.\n\n#### Step 4\n\n\n::: {.cell hash='machinelearningCausal5_cache/html/psmSL4_f68fe7fc62b99a8bc88261f1392c8c66'}\n\n```{.r .cell-code}\nfit.psm.sl <- glm(Death ~ RHC.use, \n                  data = matched.data.sl, \n                  family = binomial)\n```\n:::\n\n\nSummary of `fit.psm.sl`:\n\n\n::: {.cell caption='Your Table Title' hash='machinelearningCausal5_cache/html/unnamed-chunk-7_39d06a3c38fd2719e30bb5a06d75fef6'}\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-e9412fb8{table-layout:auto;width:50%;}.cl-e937d62a{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-e93bac5a{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-e93bd1da{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e93bd1e4{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-e9412fb8'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-e93bd1da\"><p class=\"cl-e93bac5a\"><span class=\"cl-e937d62a\">Variable</span></p></th><th class=\"cl-e93bd1da\"><p class=\"cl-e93bac5a\"><span class=\"cl-e937d62a\">Odds_Ratio</span></p></th><th class=\"cl-e93bd1da\"><p class=\"cl-e93bac5a\"><span class=\"cl-e937d62a\">CI_Lower</span></p></th><th class=\"cl-e93bd1da\"><p class=\"cl-e93bac5a\"><span class=\"cl-e937d62a\">CI_Upper</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-e93bd1e4\"><p class=\"cl-e93bac5a\"><span class=\"cl-e937d62a\">RHC.use</span></p></td><td class=\"cl-e93bd1e4\"><p class=\"cl-e93bac5a\"><span class=\"cl-e937d62a\">1.26</span></p></td><td class=\"cl-e93bd1e4\"><p class=\"cl-e93bac5a\"><span class=\"cl-e937d62a\">1.09</span></p></td><td class=\"cl-e93bd1e4\"><p class=\"cl-e93bac5a\"><span class=\"cl-e937d62a\">1.45</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nThe interpretation is the same as before. In the propensity score matched data, the odds of death was 26% higher among those participants with RHC use than those without RHC use.\n\n### Propensity score weighting with super learner\n\n#### Step 1\n\nStep 1 is the same as we did it for the propensity score matching.\n\n#### Step 2\n\nFor the second step, we will calculate the stabilized inverse probability weight.\n\n\n::: {.cell hash='machinelearningCausal5_cache/html/pswSL2_0371cf145fb8885d56b56f1311776778'}\n\n```{.r .cell-code}\ndat$ipw.sl <- with(dat, ifelse(RHC.use==1, mean(RHC.use)/ps.sl, \n                               mean(1-RHC.use)/(1-ps.sl)))\nsummary(dat$ipw.sl)\n#>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#>  0.3903  0.6496  0.7647  1.0191  1.0468 41.4490\n```\n:::\n\n\n#### Step 3\n\nNext, we will check the balance in terms of SMD.\n\n\n::: {.cell hash='machinelearningCausal5_cache/html/pswSL3_194264fa6d985f6980b717d6ae5ae3ec'}\n\n```{.r .cell-code}\n# Design with inverse probability weights\nw.design.sl <- svydesign(id = ~1, weights = ~ipw.sl, \n                         data = dat, nest = F)\n\n# Balance checking in terms of SMD\ntab1k <- svyCreateTableOne(vars = baselinevars, strata = \"RHC.use\", \n                           data = w.design.sl, includeNA = T, \n                           addOverall = T, test = F)\n#print(tab1k, showAllLevels = T, catDigits = 2, smd = T)\n```\n:::\n\n\n`ExtractSmd(tab1k)` shows\n\n\n::: {.cell caption='Your Table Title' hash='machinelearningCausal5_cache/html/unnamed-chunk-8_bf84ba8b6e13715d72fa1a5c0111f629'}\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-ee3e5040{}.cl-ee336e96{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-ee37984a{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-ee379854{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-ee37c5d6{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ee37c5e0{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ee37c5ea{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ee37c5f4{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ee37c5f5{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ee37c5fe{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-ee3e5040'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-ee37c5d6\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Variables</span></p></th><th class=\"cl-ee37c5e0\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">1 vs 2</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Disease.category</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Cancer</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Cardiovascular</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Congestive.HF</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Dementia</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.05</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Psychiatric</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Pulmonary</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Renal</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Hepatic</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">GI.Bleed</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Tumor</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Immunosupperssion</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Transfer.hx</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">MI</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">age</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.07</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">sex</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">edu</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">DASIndex</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.04</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">APACHE.score</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Glasgow.Coma.Score</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">blood.pressure</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.05</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">WBC</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.06</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Heart.rate</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Respiratory.rate</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Temperature</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">PaO2vs.FIO2</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Albumin</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Hematocrit</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Bilirubin</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Creatinine</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Sodium</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Potassium</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">PaCo2</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.05</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">PH</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Weight</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">DNR.status</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.05</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Medical.insurance</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Respiratory.Diag</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Cardiovascular.Diag</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Neurological.Diag</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Gastrointestinal.Diag</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Renal.Diag</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Metabolic.Diag</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Hematologic.Diag</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Sepsis.Diag</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.00</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Trauma.Diag</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.05</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">Orthopedic.Diag</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5ea\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">race</span></p></td><td class=\"cl-ee37c5f4\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.05</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee37c5f5\"><p class=\"cl-ee37984a\"><span class=\"cl-ee336e96\">income</span></p></td><td class=\"cl-ee37c5fe\"><p class=\"cl-ee379854\"><span class=\"cl-ee336e96\">0.05</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nAll confounders are balanced (SMD \\< 0.1).\n\n#### Step 4\n\n\n::: {.cell hash='machinelearningCausal5_cache/html/pswSL4_588f877bdf4e7ff777a4c0fa5f3a631c'}\n\n```{.r .cell-code}\nfit.ipw.sl <- svyglm(Death ~ RHC.use, \n                     design = w.design.sl, \n                     family = binomial)\n```\n:::\n\n\nSummary of `fit.ipw.sl`:\n\n\n::: {.cell caption='Your Table Title' hash='machinelearningCausal5_cache/html/unnamed-chunk-9_1095a727e6146d9b59ac023815feac97'}\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-ee8a2222{table-layout:auto;width:50%;}.cl-ee805080{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-ee844dd4{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-ee8473f4{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ee8473fe{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-ee8a2222'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-ee8473f4\"><p class=\"cl-ee844dd4\"><span class=\"cl-ee805080\">Variable</span></p></th><th class=\"cl-ee8473f4\"><p class=\"cl-ee844dd4\"><span class=\"cl-ee805080\">Odds_Ratio</span></p></th><th class=\"cl-ee8473f4\"><p class=\"cl-ee844dd4\"><span class=\"cl-ee805080\">CI_Lower</span></p></th><th class=\"cl-ee8473f4\"><p class=\"cl-ee844dd4\"><span class=\"cl-ee805080\">CI_Upper</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ee8473fe\"><p class=\"cl-ee844dd4\"><span class=\"cl-ee805080\">RHC.use</span></p></td><td class=\"cl-ee8473fe\"><p class=\"cl-ee844dd4\"><span class=\"cl-ee805080\">1.26</span></p></td><td class=\"cl-ee8473fe\"><p class=\"cl-ee844dd4\"><span class=\"cl-ee805080\">1.04</span></p></td><td class=\"cl-ee8473fe\"><p class=\"cl-ee844dd4\"><span class=\"cl-ee805080\">1.52</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nIn the propensity score weighted data, the odds of death was 26% higher among those participants with RHC use than those without RHC use.\n\n### TMLE\n\nFrom the previous tutorial, we calculated the effective sample size for the outcome model as well as for the exposure model:\n\n\n::: {.cell hash='machinelearningCausal5_cache/html/neffY_298d122b833ee1cdbdd64f5fe19b6547'}\n\n```{.r .cell-code}\nn <- nrow(dat) \npY <- nrow(dat[dat$Death == 1,])/n \nn_eff <- min(n, 5*(n*min(pY, 1 - pY))) \nn_eff\n#> [1] 5735\n```\n:::\n\n::: {.cell hash='machinelearningCausal5_cache/html/neffA_e9bf216325648b81d2aa79c02c7d61ed'}\n\n```{.r .cell-code}\nn <- nrow(dat) \npA <- nrow(dat[dat$RHC.use == 1,])/n \nn_eff <- min(n, 5*(n*min(pA, 1 - pA))) \nn_eff\n#> [1] 5735\n```\n:::\n\n\nSince the effective sample size is $\\ge 5,000$ for both model, we can consider $5 \\le \\text{V} \\le 10$, where V is the number of folds. Let's work with 10-fold cross-validation for both the exposure and the outcome model, with the default super learner library.\n\n\n::: {.cell hash='machinelearningCausal5_cache/html/tmle1a_5c16c1c4b5d261bfefdb3a9fd4674903'}\n\n:::\n\n::: {.cell hash='machinelearningCausal5_cache/html/tmle1b_8a4e1bb31fe06cdc656b7b307095dba0'}\n\n:::\n\n::: {.cell hash='machinelearningCausal5_cache/html/tmle1c_8c3d5caccacdfef867b2070aa30ab645'}\n\n```{.r .cell-code}\nfit.tmle <- tmle(Y = dat$Death, \n                 A = dat$RHC.use, \n                 W = dat[,baselinevars], \n                 family = \"binomial\", \n                 V.Q = 10, \n                 V.g = 10)\n```\n:::\n\n::: {.cell hash='machinelearningCausal5_cache/html/tmle1OR_b259ee36f5c9d346aa4b861705f43a54'}\n\n```{.r .cell-code}\n# OR\nround(fit.tmle$estimates$OR$psi, 2)\n#> [1] 1.26\n\n# 95% CI\nround(fit.tmle$estimates$OR$CI, 2)\n#> [1] 1.12 1.42\n```\n:::\n\n\nAs we can see that the odds of death was 26% higher among those participants with RHC use than those without RHC use.\n\n### Results comparison\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"font-size: 14px; width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Model </th>\n   <th style=\"text-align:right;\"> OR </th>\n   <th style=\"text-align:left;\"> 95% CI </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Logistic regression </td>\n   <td style=\"text-align:right;width: 15%; \"> 1.42 </td>\n   <td style=\"text-align:left;width: 15%; \"> 1.32-1.65 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Propensity score matching with logistic </td>\n   <td style=\"text-align:right;width: 15%; \"> 1.29 </td>\n   <td style=\"text-align:left;width: 15%; \"> 1.12-1.48 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Propensity score weighting with logistic </td>\n   <td style=\"text-align:right;width: 15%; \"> 1.30 </td>\n   <td style=\"text-align:left;width: 15%; \"> 1.11-1.53 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Propensity score matching with super learner (logistic, LASSO, and XGBoost) </td>\n   <td style=\"text-align:right;width: 15%; \"> 1.26 </td>\n   <td style=\"text-align:left;width: 15%; \"> 1.09-1.45 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Propensity score weighting with super learner (logistic, LASSO, and XGBoost) </td>\n   <td style=\"text-align:right;width: 15%; \"> 1.26 </td>\n   <td style=\"text-align:left;width: 15%; \"> 1.04-1.52 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> TMLE (default SL library) </td>\n   <td style=\"text-align:right;width: 15%; \"> 1.26 </td>\n   <td style=\"text-align:left;width: 15%; \"> 1.12-1.42 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Forest Plot of Odds Ratios](machinelearningCausal5_files/figure-html/unnamed-chunk-11-1.png){width=768}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/tabwid-1.1.3/tabwid.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/tabwid-1.1.3/tabwid.js\"></script>\r\n<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\r\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\r\n<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}