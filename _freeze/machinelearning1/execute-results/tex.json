{
  "hash": "413e78bd56f93e70961e509cf5c54bb8",
  "result": {
    "markdown": "## Continuous outcome {.unnumbered}\n\n::: callout-important\nThis tutorial is very similar to one of the [previous tutorials](predictivefactors2.html), but uses a different data (we used [RHC data](researchquestion1.html) here). We are revisiting concepts related to [prediction](predictivefactors.html) before introducing ideas related to machine learning.\n:::\n\nIn this chapter, we will talk about Regression that deals with prediction of continuous outcomes. We will use multiple linear regression to build the first prediction model.\n\n\n\n\n\n\n\n### Load dataset\n\n\n\n::: {.cell hash='machinelearning1_cache/pdf/data_26fd7b744cc44f0666c3cad23f6cb17a'}\n\n```{.r .cell-code}\nObsData <- readRDS(file = \"Data/machinelearning/rhcAnalytic.RDS\")\nhead(ObsData)\n#>   Disease.category          Cancer Death Cardiovascular Congestive.HF Dementia\n#> 1            Other Localized (Yes)     0              0             0        0\n#> 2             MOSF            None     1              1             1        0\n#> 3             MOSF Localized (Yes)     0              0             0        0\n#> 4              ARF            None     1              0             0        0\n#> 5             MOSF            None     1              0             0        0\n#> 6            Other            None     0              0             1        0\n#>   Psychiatric Pulmonary Renal Hepatic GI.Bleed Tumor Immunosupperssion\n#> 1           0         1     0       0        0     1                 0\n#> 2           0         0     0       0        0     0                 1\n#> 3           0         0     0       0        0     1                 1\n#> 4           0         0     0       0        0     0                 1\n#> 5           0         0     0       0        0     0                 0\n#> 6           0         1     0       0        0     0                 0\n#>   Transfer.hx MI       age    sex       edu DASIndex APACHE.score\n#> 1           0  0   [70,80)   Male 12.000000 23.50000           46\n#> 2           1  0   [70,80) Female 12.000000 14.75195           50\n#> 3           0  0 [-Inf,50) Female 14.069916 18.13672           82\n#> 4           0  0   [70,80) Female  9.000000 22.92969           48\n#> 5           0  0   [60,70)   Male  9.945259 21.05078           72\n#> 6           0  0 [80, Inf) Female  8.000000 17.50000           38\n#>   Glasgow.Coma.Score blood.pressure         WBC Heart.rate Respiratory.rate\n#> 1                  0             41 22.09765620        124               10\n#> 2                  0             63 28.89843750        137               38\n#> 3                  0             57  0.04999542        130               40\n#> 4                  0             55 23.29687500         58               26\n#> 5                 41             65 29.69921880        125               27\n#> 6                  0            115 18.00000000        134               36\n#>   Temperature PaO2vs.FIO2  Albumin Hematocrit Bilirubin Creatinine Sodium\n#> 1    38.69531     68.0000 3.500000   58.00000 1.0097656  1.1999512    145\n#> 2    38.89844    218.3125 2.599609   32.50000 0.6999512  0.5999756    137\n#> 3    36.39844    275.5000 3.500000   21.09766 1.0097656  2.5996094    146\n#> 4    35.79688    156.6562 3.500000   26.29688 0.3999634  1.6999512    117\n#> 5    34.79688    478.0000 3.500000   24.00000 1.0097656  3.5996094    126\n#> 6    39.19531    184.1875 3.099609   30.50000 1.0097656  1.3999023    138\n#>   Potassium PaCo2       PH   Weight DNR.status  Medical.insurance\n#> 1  4.000000    40 7.359375 64.69995         No           Medicare\n#> 2  3.299805    34 7.329102 45.69998         No Private & Medicare\n#> 3  2.899902    16 7.359375  0.00000         No            Private\n#> 4  5.799805    30 7.459961 54.59998         No Private & Medicare\n#> 5  5.799805    17 7.229492 78.39996        Yes           Medicare\n#> 6  5.399414    68 7.299805 54.89999         No           Medicare\n#>   Respiratory.Diag Cardiovascular.Diag Neurological.Diag Gastrointestinal.Diag\n#> 1              Yes                 Yes                No                    No\n#> 2               No                  No                No                    No\n#> 3               No                 Yes                No                    No\n#> 4              Yes                  No                No                    No\n#> 5               No                 Yes                No                    No\n#> 6              Yes                  No                No                    No\n#>   Renal.Diag Metabolic.Diag Hematologic.Diag Sepsis.Diag Trauma.Diag\n#> 1         No             No               No          No          No\n#> 2         No             No               No         Yes          No\n#> 3         No             No               No          No          No\n#> 4         No             No               No          No          No\n#> 5         No             No               No          No          No\n#> 6         No             No               No          No          No\n#>   Orthopedic.Diag  race     income Length.of.Stay RHC.use\n#> 1              No white Under $11k              9       0\n#> 2              No white Under $11k             45       1\n#> 3              No white   $25-$50k             60       1\n#> 4              No white   $11-$25k             37       0\n#> 5              No white Under $11k              2       1\n#> 6              No white Under $11k              7       0\n```\n:::\n\n\n\n### Prediction for length of stay\n\nNow, we show the regression fitting when outcome is continuous (length of stay).\n\n#### Variables\n\n\n\n::: {.cell hash='machinelearning1_cache/pdf/vars2_98921982d232a2e2cc34761a29928b26'}\n\n```{.r .cell-code}\nbaselinevars <- names(dplyr::select(ObsData, \n                         !c(Length.of.Stay,Death)))\nbaselinevars\n#>  [1] \"Disease.category\"      \"Cancer\"                \"Cardiovascular\"       \n#>  [4] \"Congestive.HF\"         \"Dementia\"              \"Psychiatric\"          \n#>  [7] \"Pulmonary\"             \"Renal\"                 \"Hepatic\"              \n#> [10] \"GI.Bleed\"              \"Tumor\"                 \"Immunosupperssion\"    \n#> [13] \"Transfer.hx\"           \"MI\"                    \"age\"                  \n#> [16] \"sex\"                   \"edu\"                   \"DASIndex\"             \n#> [19] \"APACHE.score\"          \"Glasgow.Coma.Score\"    \"blood.pressure\"       \n#> [22] \"WBC\"                   \"Heart.rate\"            \"Respiratory.rate\"     \n#> [25] \"Temperature\"           \"PaO2vs.FIO2\"           \"Albumin\"              \n#> [28] \"Hematocrit\"            \"Bilirubin\"             \"Creatinine\"           \n#> [31] \"Sodium\"                \"Potassium\"             \"PaCo2\"                \n#> [34] \"PH\"                    \"Weight\"                \"DNR.status\"           \n#> [37] \"Medical.insurance\"     \"Respiratory.Diag\"      \"Cardiovascular.Diag\"  \n#> [40] \"Neurological.Diag\"     \"Gastrointestinal.Diag\" \"Renal.Diag\"           \n#> [43] \"Metabolic.Diag\"        \"Hematologic.Diag\"      \"Sepsis.Diag\"          \n#> [46] \"Trauma.Diag\"           \"Orthopedic.Diag\"       \"race\"                 \n#> [49] \"income\"                \"RHC.use\"\n```\n:::\n\n\n\n#### Model\n\n\n\n::: {.cell hash='machinelearning1_cache/pdf/reg2_0ede5e099b5209f4827da1487e372419'}\n\n```{.r .cell-code}\n# adjust covariates\nout.formula1 <- as.formula(paste(\"Length.of.Stay~ \", \n                               paste(baselinevars, \n                                     collapse = \"+\")))\nsaveRDS(out.formula1, file = \"Data/machinelearning/form1.RDS\")\nfit1 <- lm(out.formula1, data = ObsData)\nrequire(Publish)\nadj.fit1 <- publish(fit1, digits=1)$regressionTable\n```\n:::\n\n::: {.cell hash='machinelearning1_cache/pdf/reg2a_d37ee1d061adfeabd47f26f4c8d21226'}\n\n```{.r .cell-code}\nout.formula1\n#> Length.of.Stay ~ Disease.category + Cancer + Cardiovascular + \n#>     Congestive.HF + Dementia + Psychiatric + Pulmonary + Renal + \n#>     Hepatic + GI.Bleed + Tumor + Immunosupperssion + Transfer.hx + \n#>     MI + age + sex + edu + DASIndex + APACHE.score + Glasgow.Coma.Score + \n#>     blood.pressure + WBC + Heart.rate + Respiratory.rate + Temperature + \n#>     PaO2vs.FIO2 + Albumin + Hematocrit + Bilirubin + Creatinine + \n#>     Sodium + Potassium + PaCo2 + PH + Weight + DNR.status + Medical.insurance + \n#>     Respiratory.Diag + Cardiovascular.Diag + Neurological.Diag + \n#>     Gastrointestinal.Diag + Renal.Diag + Metabolic.Diag + Hematologic.Diag + \n#>     Sepsis.Diag + Trauma.Diag + Orthopedic.Diag + race + income + \n#>     RHC.use\nadj.fit1\n#>                 Variable               Units Coefficient          CI.95 p-value\n#> 1            (Intercept)                           -76.8 [-139.4;-14.2]    <0.1\n#> 2       Disease.category                 ARF         Ref                       \n#> 3                                        CHF        -5.6    [-9.0;-2.2]    <0.1\n#> 4                                      Other        -4.4    [-6.5;-2.3]    <0.1\n#> 5                                       MOSF         2.9      [1.1;4.7]    <0.1\n#> 6                 Cancer                None         Ref                       \n#> 7                            Localized (Yes)        -7.8    [-15.7;0.1]    <0.1\n#> 8                                 Metastatic       -10.6   [-19.1;-2.1]    <0.1\n#> 9         Cardiovascular                   0         Ref                       \n#> 10                                         1         0.7     [-1.3;2.7]     0.5\n#> 11         Congestive.HF                   0         Ref                       \n#> 12                                         1        -1.8     [-3.9;0.4]     0.1\n#> 13              Dementia                   0         Ref                       \n#> 14                                         1        -1.3     [-3.6;1.1]     0.3\n#> 15           Psychiatric                   0         Ref                       \n#> 16                                         1        -0.5     [-3.1;2.2]     0.7\n#> 17             Pulmonary                   0         Ref                       \n#> 18                                         1         2.1      [0.1;4.0]    <0.1\n#> 19                 Renal                   0         Ref                       \n#> 20                                         1        -6.9   [-10.8;-3.1]    <0.1\n#> 21               Hepatic                   0         Ref                       \n#> 22                                         1        -1.5     [-5.1;2.1]     0.4\n#> 23              GI.Bleed                   0         Ref                       \n#> 24                                         1        -5.1    [-9.7;-0.5]    <0.1\n#> 25                 Tumor                   0         Ref                       \n#> 26                                         1         4.6    [-3.4;12.6]     0.3\n#> 27     Immunosupperssion                   0         Ref                       \n#> 28                                         1         0.1     [-1.4;1.7]     0.9\n#> 29           Transfer.hx                   0         Ref                       \n#> 30                                         1         1.2     [-0.9;3.2]     0.3\n#> 31                    MI                   0         Ref                       \n#> 32                                         1        -1.7     [-5.3;2.0]     0.4\n#> 33                   age           [-Inf,50)         Ref                       \n#> 34                                   [50,60)         0.1     [-2.0;2.3]     0.9\n#> 35                                   [60,70)        -0.4     [-2.5;1.7]     0.7\n#> 36                                   [70,80)        -1.1     [-3.6;1.4]     0.4\n#> 37                                 [80, Inf)        -2.8     [-5.7;0.2]    <0.1\n#> 38                   sex                Male         Ref                       \n#> 39                                    Female         0.8     [-0.6;2.2]     0.2\n#> 40                   edu                             0.0     [-0.2;0.3]     0.7\n#> 41              DASIndex                            -0.1     [-0.2;0.1]     0.4\n#> 42          APACHE.score                            -0.1    [-0.1;-0.0]    <0.1\n#> 43    Glasgow.Coma.Score                             0.0     [-0.0;0.0]     0.2\n#> 44        blood.pressure                            -0.0     [-0.0;0.0]     0.2\n#> 45                   WBC                             0.0     [-0.0;0.1]     0.2\n#> 46            Heart.rate                             0.0      [0.0;0.0]    <0.1\n#> 47      Respiratory.rate                            -0.0     [-0.1;0.1]     1.0\n#> 48           Temperature                             0.5      [0.1;0.9]    <0.1\n#> 49           PaO2vs.FIO2                            -0.0    [-0.0;-0.0]    <0.1\n#> 50               Albumin                            -2.6    [-3.5;-1.6]    <0.1\n#> 51            Hematocrit                            -0.2    [-0.3;-0.1]    <0.1\n#> 52             Bilirubin                            -0.1     [-0.3;0.1]     0.2\n#> 53            Creatinine                             0.5      [0.1;1.0]    <0.1\n#> 54                Sodium                             0.1      [0.0;0.2]    <0.1\n#> 55             Potassium                             0.3     [-0.3;1.0]     0.3\n#> 56                 PaCo2                             0.1      [0.0;0.2]    <0.1\n#> 57                    PH                            10.1     [2.2;17.9]    <0.1\n#> 58                Weight                             0.0     [-0.0;0.0]     1.0\n#> 59            DNR.status                  No         Ref                       \n#> 60                                       Yes        -8.0   [-10.1;-5.8]    <0.1\n#> 61     Medical.insurance            Medicaid         Ref                       \n#> 62                                  Medicare        -0.5     [-3.2;2.2]     0.7\n#> 63                       Medicare & Medicaid        -2.4     [-5.8;0.9]     0.2\n#> 64                              No insurance        -1.8     [-5.2;1.6]     0.3\n#> 65                                   Private        -2.1     [-4.6;0.4]     0.1\n#> 66                        Private & Medicare        -2.0     [-4.8;0.8]     0.2\n#> 67      Respiratory.Diag                  No         Ref                       \n#> 68                                       Yes         0.3     [-1.4;2.0]     0.7\n#> 69   Cardiovascular.Diag                  No         Ref                       \n#> 70                                       Yes         0.4     [-1.4;2.1]     0.7\n#> 71     Neurological.Diag                  No         Ref                       \n#> 72                                       Yes         3.5      [1.1;6.0]    <0.1\n#> 73 Gastrointestinal.Diag                  No         Ref                       \n#> 74                                       Yes         2.6      [0.3;4.8]    <0.1\n#> 75            Renal.Diag                  No         Ref                       \n#> 76                                       Yes         1.8     [-1.4;5.0]     0.3\n#> 77        Metabolic.Diag                  No         Ref                       \n#> 78                                       Yes        -1.2     [-4.3;2.0]     0.5\n#> 79      Hematologic.Diag                  No         Ref                       \n#> 80                                       Yes        -3.9    [-6.8;-0.9]    <0.1\n#> 81           Sepsis.Diag                  No         Ref                       \n#> 82                                       Yes         0.0     [-2.0;2.0]     1.0\n#> 83           Trauma.Diag                  No         Ref                       \n#> 84                                       Yes         1.1     [-5.9;8.2]     0.8\n#> 85       Orthopedic.Diag                  No         Ref                       \n#> 86                                       Yes         3.5   [-15.1;22.2]     0.7\n#> 87                  race               white         Ref                       \n#> 88                                     black        -1.1     [-3.1;0.8]     0.2\n#> 89                                     other         0.2     [-2.5;3.0]     0.9\n#> 90                income            $11-$25k         Ref                       \n#> 91                                  $25-$50k         2.5      [0.2;4.7]    <0.1\n#> 92                                    > $50k         0.4     [-2.4;3.3]     0.8\n#> 93                                Under $11k        -0.4     [-2.2;1.4]     0.6\n#> 94               RHC.use                             2.9      [1.4;4.4]    <0.1\n```\n:::\n\n\n\n#### Design Matrix\n\n-   Notations\n    -   n is number of observations\n    -   p is number of covariates\n\nExpands factors to a set of dummy variables.\n\n\n\n::: {.cell hash='machinelearning1_cache/pdf/mat0_df98450873d8bb402aef7c5f98016bcd'}\n\n```{.r .cell-code}\ndim(ObsData)\n#> [1] 5735   52\nlength(attr(terms(out.formula1), \"term.labels\"))\n#> [1] 50\n```\n:::\n\n::: {.cell hash='machinelearning1_cache/pdf/mat1_dd138fd76e2eed3bb271a1ed01893f74'}\n\n```{.r .cell-code}\nhead(model.matrix(fit1))\n#>   (Intercept) Disease.categoryCHF Disease.categoryOther Disease.categoryMOSF\n#> 1           1                   0                     1                    0\n#> 2           1                   0                     0                    1\n#> 3           1                   0                     0                    1\n#> 4           1                   0                     0                    0\n#> 5           1                   0                     0                    1\n#> 6           1                   0                     1                    0\n#>   CancerLocalized (Yes) CancerMetastatic Cardiovascular1 Congestive.HF1\n#> 1                     1                0               0              0\n#> 2                     0                0               1              1\n#> 3                     1                0               0              0\n#> 4                     0                0               0              0\n#> 5                     0                0               0              0\n#> 6                     0                0               0              1\n#>   Dementia1 Psychiatric1 Pulmonary1 Renal1 Hepatic1 GI.Bleed1 Tumor1\n#> 1         0            0          1      0        0         0      1\n#> 2         0            0          0      0        0         0      0\n#> 3         0            0          0      0        0         0      1\n#> 4         0            0          0      0        0         0      0\n#> 5         0            0          0      0        0         0      0\n#> 6         0            0          1      0        0         0      0\n#>   Immunosupperssion1 Transfer.hx1 MI1 age[50,60) age[60,70) age[70,80)\n#> 1                  0            0   0          0          0          1\n#> 2                  1            1   0          0          0          1\n#> 3                  1            0   0          0          0          0\n#> 4                  1            0   0          0          0          1\n#> 5                  0            0   0          0          1          0\n#> 6                  0            0   0          0          0          0\n#>   age[80, Inf) sexFemale       edu DASIndex APACHE.score Glasgow.Coma.Score\n#> 1            0         0 12.000000 23.50000           46                  0\n#> 2            0         1 12.000000 14.75195           50                  0\n#> 3            0         1 14.069916 18.13672           82                  0\n#> 4            0         1  9.000000 22.92969           48                  0\n#> 5            0         0  9.945259 21.05078           72                 41\n#> 6            1         1  8.000000 17.50000           38                  0\n#>   blood.pressure         WBC Heart.rate Respiratory.rate Temperature\n#> 1             41 22.09765620        124               10    38.69531\n#> 2             63 28.89843750        137               38    38.89844\n#> 3             57  0.04999542        130               40    36.39844\n#> 4             55 23.29687500         58               26    35.79688\n#> 5             65 29.69921880        125               27    34.79688\n#> 6            115 18.00000000        134               36    39.19531\n#>   PaO2vs.FIO2  Albumin Hematocrit Bilirubin Creatinine Sodium Potassium PaCo2\n#> 1     68.0000 3.500000   58.00000 1.0097656  1.1999512    145  4.000000    40\n#> 2    218.3125 2.599609   32.50000 0.6999512  0.5999756    137  3.299805    34\n#> 3    275.5000 3.500000   21.09766 1.0097656  2.5996094    146  2.899902    16\n#> 4    156.6562 3.500000   26.29688 0.3999634  1.6999512    117  5.799805    30\n#> 5    478.0000 3.500000   24.00000 1.0097656  3.5996094    126  5.799805    17\n#> 6    184.1875 3.099609   30.50000 1.0097656  1.3999023    138  5.399414    68\n#>         PH   Weight DNR.statusYes Medical.insuranceMedicare\n#> 1 7.359375 64.69995             0                         1\n#> 2 7.329102 45.69998             0                         0\n#> 3 7.359375  0.00000             0                         0\n#> 4 7.459961 54.59998             0                         0\n#> 5 7.229492 78.39996             1                         1\n#> 6 7.299805 54.89999             0                         1\n#>   Medical.insuranceMedicare & Medicaid Medical.insuranceNo insurance\n#> 1                                    0                             0\n#> 2                                    0                             0\n#> 3                                    0                             0\n#> 4                                    0                             0\n#> 5                                    0                             0\n#> 6                                    0                             0\n#>   Medical.insurancePrivate Medical.insurancePrivate & Medicare\n#> 1                        0                                   0\n#> 2                        0                                   1\n#> 3                        1                                   0\n#> 4                        0                                   1\n#> 5                        0                                   0\n#> 6                        0                                   0\n#>   Respiratory.DiagYes Cardiovascular.DiagYes Neurological.DiagYes\n#> 1                   1                      1                    0\n#> 2                   0                      0                    0\n#> 3                   0                      1                    0\n#> 4                   1                      0                    0\n#> 5                   0                      1                    0\n#> 6                   1                      0                    0\n#>   Gastrointestinal.DiagYes Renal.DiagYes Metabolic.DiagYes Hematologic.DiagYes\n#> 1                        0             0                 0                   0\n#> 2                        0             0                 0                   0\n#> 3                        0             0                 0                   0\n#> 4                        0             0                 0                   0\n#> 5                        0             0                 0                   0\n#> 6                        0             0                 0                   0\n#>   Sepsis.DiagYes Trauma.DiagYes Orthopedic.DiagYes raceblack raceother\n#> 1              0              0                  0         0         0\n#> 2              1              0                  0         0         0\n#> 3              0              0                  0         0         0\n#> 4              0              0                  0         0         0\n#> 5              0              0                  0         0         0\n#> 6              0              0                  0         0         0\n#>   income$25-$50k income> $50k incomeUnder $11k RHC.use\n#> 1              0            0                1       0\n#> 2              0            0                1       1\n#> 3              1            0                0       1\n#> 4              0            0                0       0\n#> 5              0            0                1       1\n#> 6              0            0                1       0\ndim(model.matrix(fit1))\n#> [1] 5735   64\np <- dim(model.matrix(fit1))[2] # intercept + slopes\np\n#> [1] 64\n```\n:::\n\n\n\n#### Obtain prediction\n\n\n\n::: {.cell hash='machinelearning1_cache/pdf/pred_81ef977a7ca7b69257919386e8f0eb24'}\n\n```{.r .cell-code}\nobs.y <- ObsData$Length.of.Stay\nsummary(obs.y)\n#>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#>    2.00    7.00   14.00   21.56   25.00  394.00\n# Predict the above fit on ObsData data\npred.y1 <- predict(fit1, ObsData)\nsummary(pred.y1)\n#>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#>  -32.76   16.62   21.96   21.56   26.73   42.67\nn <- length(pred.y1)\nn\n#> [1] 5735\nplot(obs.y,pred.y1)\nlines(lowess(obs.y,pred.y1), col = \"red\")\n```\n\n::: {.cell-output-display}\n![](machinelearning1_files/figure-pdf/pred-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n### Measuring prediction error\n\n**Prediction error** measures how well the model can predict the outcome for new data that were **not** used in developing the prediction model.\n\n-   Bias reduced for models with more variables\n-   Unimportant variables lead to noise / variability\n-   Bias variance trade-off / need penalization\n\n#### R2\n\n\nThe provided information describes a statistical context involving a dataset of `n` values, $y_1, ..., y_n$ (referred to as $y_i$ or as a vector $y = [y_1,...,y_n]^T$), each paired with a fitted value $f_1,...,f_n$ (denoted as $f_i$ or sometimes $\\hat{y_i}$, and as a vector $f$). The residuals, represented as $e_i$, are defined as the differences between the observed and the fitted values: \n$ e_i = y_i − f_i$ \n\nThe mean of the observed data is denoted by \n$$ \\bar{y} = \\frac{1}{n}\\sum_{i=1}^{n}y_i $$\n\nThe variability of the dataset can be quantified using two sums of squares formulas:\n1. **Residual Sum of Squares (SSres)** or `SSE`: It quantifies the variance remaining in the data after fitting a model, calculated as:\n$$ SS_{res} = \\sum_{i}(y_i - f_i)^2 = \\sum_{i}e_i^2 $$\n2. **Total Sum of Squares (SStot)** or `SST`: It represents the total variance in the observed data, calculated as:\n$$ SS_{tot} = \\sum_{i}(y_i - \\bar{y})^2 $$\n\nThe **Coefficient of Determination (R²)** or `R.2`, which provides a measure of how well the model's predictions match the observed data, is defined as:\n$$ R^2 = 1 - \\frac{SS_{res}}{SS_{tot}} $$\n\nIn the ideal scenario where the model fits the data perfectly, we have $SS_{res} = 0$ and thus $R^2 = 1$. Conversely, a baseline model, which always predicts the mean $\\bar{y}$ of the observed data, would yield $R^2 = 0$. Models performing worse than this baseline model would result in a negative R² value. This metric is widely utilized in regression analysis to evaluate model performance, where a higher R² indicates a better fit of the model to the data.\n\n\n\n\n::: {.cell hash='machinelearning1_cache/pdf/r2_033462cbf0c7359b9ccafc708b9495aa'}\n\n```{.r .cell-code}\n# Find SSE\nSSE <- sum( (obs.y - pred.y1)^2 )\nSSE\n#> [1] 3536398\n# Find SST\nmean.obs.y <- mean(obs.y)\nSST <- sum( (obs.y - mean.obs.y)^2 )\nSST\n#> [1] 3836690\n# Find R2\nR.2 <- 1- SSE/SST\nR.2\n#> [1] 0.07826832\nrequire(caret)\ncaret::R2(pred.y1, obs.y)\n#> [1] 0.07826832\n```\n:::\n\n\n\n[ref](https://en.wikipedia.org/wiki/Coefficient_of_determination)\n\n\n#### RMSE\n\n\n\n::: {.cell hash='machinelearning1_cache/pdf/rmse_74583d6319a6c1391ae21af033d0b9df'}\n\n```{.r .cell-code}\n# Find RMSE\nRmse <- sqrt(SSE/(n-p)) \nRmse\n#> [1] 24.97185\ncaret::RMSE(pred.y1, obs.y)\n#> [1] 24.83212\n```\n:::\n\n\n\nSee [@anova]\n\n\n#### Adj R2\n\nThe **Adjusted R²** statistic modifies the $R^2$ value to counteract the automatic increase of $R^2$ when extra explanatory variables are added to a model, even if they do not improve the model fit. This adjustment is crucial for ensuring that the metric offers a reliable indication of the explanatory power of the model, especially in multiple regression where several predictors are involved.\n\nThe commonly used formula  is defined as:\n\n$$\n\\bar{R}^{2} = 1 - \\frac{SS_{\\text{res}} / df_{\\text{res}}}{SS_{\\text{tot}} / df_{\\text{tot}}}\n$$\n\nWhere:\n\n- $SS_{\\text{res}}$ and $SS_{\\text{tot}}$ represent the residual and total sums of squares respectively.\n- $df_{\\text{res}}$ and $df_{\\text{tot}}$ refer to the degrees of freedom of the residual and total sums of squares. Usually, $df_{\\text{res}} = n - p$ and $df_{\\text{tot}} = n - 1$, where:\n  - $n$ signifies the sample size.\n  - $p$ denotes the number of variables in the model.\n\nThis metric plays a vital role in model selection and safeguards against overfitting by penalizing the inclusion of non-informative variables\n\nThe alternate formula is:\n\n$$\n\\bar{R}^2 = 1 - (1 - R^2) \\frac{n-1}{n-p-1}\n$$\n\nThis formula modifies the $R^2$ value, accounting for the number of predictors and offering a more parsimonious model fit measure. \n\n\n\n::: {.cell hash='machinelearning1_cache/pdf/adjr2_26c76b81360aacac886739c56f6dc79e'}\n\n```{.r .cell-code}\n# Find adj R2\nadjR2 <- 1-(1-R.2)*((n-1)/(n-p-1))\nadjR2\n#> [1] 0.06786429\n```\n:::\n\n\n\nSee [@coefd]\n\n### Overfitting and Optimism\n\n-   Model usually performs very well in the empirical data where the model was fitted in the same data (optimistic)\n-   Model performs poorly in the new data (generalization is not as good)\n\n#### Causes\n\n-   Model determined by data at hand without expert opinion\n-   Too many model parameters ($age$, $age^2$, $age^3$) / predictors\n-   Too small dataset (training) / data too noisy\n\n#### Consequences\n\n-   Overestimation of effects of predictors\n-   Reduction in model performance in new observations\n\n#### Proposed solutions\n\nWe generally use procedures such as\n\n-   Internal validation\n    -   sample splitting\n    -   cross-validation\n    -   bootstrap\n-   External validation\n    -   Temporal\n    -   Geographical\n    -   Different data source to calculate same variable\n    -   Different disease\n\n### Video content (optional)\n\n::: callout-tip\nFor those who prefer a video walkthrough, feel free to watch the video below, which offers a description of an earlier version of the above content.\n:::\n\n::: {style=\"position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;\"}\n<iframe src=\"https://www.youtube.com/embed/TmrG2ZbeJoY\" style=\"position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;\" allowfullscreen>\n\n</iframe>\n:::\n\n### References\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}