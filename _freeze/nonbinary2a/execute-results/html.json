{
  "hash": "5c1c332d6c91c4f242eab507eb945005",
  "result": {
    "markdown": "## Survival analysis: NHANES {.unnumbered}\n\nThe tutorial demonstrates analyzing complex survey data (NHANES) with mortality as a survival outcome. See the [tutorial in the previous chapter](accessing7.html) on linking public-use US mortality data with the NHANES.\n\nWe will explore the relationship between caffeine consumption and mortality in adults with diabetes using NHANES 1999-2010 datasets. We will follow the following article by [Neves et al. (2018)](https://doi.org/10.3389/fendo.2018.00547).\n\n### Load required packages\n\n\n::: {.cell hash='nonbinary2a_cache/html/setup_e7234c69f36a13cd6fd462bf9f591d39'}\n\n```{.r .cell-code}\n# Load required packages\nlibrary(tableone)\nlibrary(survival)\nlibrary(Publish)\nlibrary(survey)\nlibrary(DataExplorer)\n```\n:::\n\n\n### Load datasets\n\nLet us load NHANES 1999-2000, 2001-2002, 2003-2004, 2005-2006, 2007-2008, and 2009-2010 datasets and merged all cycles.\n\n\n::: {.cell hash='nonbinary2a_cache/html/load_41d0db60d6e87616dfd663f8eadb8a00'}\n\n```{.r .cell-code}\n# Load\nload(\"Data/nonbinary/coffee.RData\")\nls()\n#> [1] \"dat.analytic1999\" \"dat.analytic2001\" \"dat.analytic2003\" \"dat.analytic2005\"\n#> [5] \"dat.analytic2007\" \"dat.analytic2009\" \"has_annotations\"\n\n# Merge all cycles\ndat.full <- rbind(dat.analytic1999, dat.analytic2001, dat.analytic2003, \n                  dat.analytic2005, dat.analytic2007, dat.analytic2009)\nhead(dat.full)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"id\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"survey.weight\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"psu\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"strata\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"caff\"],\"name\":[5],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"stime\"],\"name\":[6],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"status\"],\"name\":[7],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"sex\"],\"name\":[8],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"age\"],\"name\":[9],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"race\"],\"name\":[10],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"income\"],\"name\":[11],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"smoking\"],\"name\":[12],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"diabetic.nephropathy\"],\"name\":[13],\"type\":[\"lgl\"],\"align\":[\"right\"]},{\"label\":[\"bmi.cat\"],\"name\":[14],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"education\"],\"name\":[15],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"carbohyd\"],\"name\":[16],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"alcohol\"],\"name\":[17],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"diab.years\"],\"name\":[18],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"htn\"],\"name\":[19],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"daib.retino\"],\"name\":[20],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"macrovascular\"],\"name\":[21],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"insulin\"],\"name\":[22],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"survey.cycle\"],\"name\":[23],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"physical.activity\"],\"name\":[24],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"diabetes\"],\"name\":[25],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"cal.total\"],\"name\":[26],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"9727.079\",\"3\":\"1\",\"4\":\"5\",\"5\":\"No consumption\",\"6\":\"NA\",\"7\":\"NA\",\"8\":\"Female\",\"9\":\"2\",\"10\":\"Non-Hispanic Black\",\"11\":\"<$25,000\",\"12\":\"NA\",\"13\":\"NA\",\"14\":\"<20.0\",\"15\":\"NA\",\"16\":\"250.36\",\"17\":\"No consumption\",\"18\":\"Undiagnosed\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"NA\",\"23\":\"1999-00\",\"24\":\"NA\",\"25\":\"No\",\"26\":\"1358.88\",\"_rn_\":\"1\"},{\"1\":\"2\",\"2\":\"26678.636\",\"3\":\"3\",\"4\":\"1\",\"5\":\"200+ mg/day\",\"6\":\"177\",\"7\":\"1\",\"8\":\"Male\",\"9\":\"77\",\"10\":\"Non-Hispanic White\",\"11\":\"$25,000 to $75,000\",\"12\":\"Never smoker\",\"13\":\"NA\",\"14\":\"20.0 to <25.0\",\"15\":\"College graduate or above\",\"16\":\"350.37\",\"17\":\"No consumption\",\"18\":\"Undiagnosed\",\"19\":\"No\",\"20\":\"NA\",\"21\":\"No\",\"22\":\"NA\",\"23\":\"1999-00\",\"24\":\"High\",\"25\":\"No\",\"26\":\"2463.00\",\"_rn_\":\"2\"},{\"1\":\"3\",\"2\":\"43621.681\",\"3\":\"2\",\"4\":\"7\",\"5\":\"<100 mg/day\",\"6\":\"NA\",\"7\":\"NA\",\"8\":\"Female\",\"9\":\"10\",\"10\":\"Non-Hispanic White\",\"11\":\"$25,000 to $75,000\",\"12\":\"NA\",\"13\":\"NA\",\"14\":\"<20.0\",\"15\":\"NA\",\"16\":\"233.63\",\"17\":\"No consumption\",\"18\":\"Undiagnosed\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"No\",\"23\":\"1999-00\",\"24\":\"NA\",\"25\":\"No\",\"26\":\"1517.69\",\"_rn_\":\"3\"},{\"1\":\"4\",\"2\":\"10346.119\",\"3\":\"1\",\"4\":\"2\",\"5\":\"No consumption\",\"6\":\"NA\",\"7\":\"NA\",\"8\":\"Male\",\"9\":\"1\",\"10\":\"Non-Hispanic Black\",\"11\":\"<$25,000\",\"12\":\"NA\",\"13\":\"NA\",\"14\":\"NA\",\"15\":\"NA\",\"16\":\"191.03\",\"17\":\"No consumption\",\"18\":\"Undiagnosed\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"NA\",\"23\":\"1999-00\",\"24\":\"NA\",\"25\":\"No\",\"26\":\"1474.93\",\"_rn_\":\"4\"},{\"1\":\"5\",\"2\":\"91050.847\",\"3\":\"2\",\"4\":\"8\",\"5\":\"No consumption\",\"6\":\"244\",\"7\":\"0\",\"8\":\"Male\",\"9\":\"49\",\"10\":\"Non-Hispanic White\",\"11\":\">$75,000\",\"12\":\"Former smoker\",\"13\":\"NA\",\"14\":\"25.0 to <30.0\",\"15\":\"College graduate or above\",\"16\":\"253.98\",\"17\":\"20+ grams/day\",\"18\":\"Undiagnosed\",\"19\":\"Yes\",\"20\":\"NA\",\"21\":\"No\",\"22\":\"No\",\"23\":\"1999-00\",\"24\":\"High\",\"25\":\"No\",\"26\":\"2658.14\",\"_rn_\":\"5\"},{\"1\":\"6\",\"2\":\"36508.250\",\"3\":\"2\",\"4\":\"2\",\"5\":\"200+ mg/day\",\"6\":\"246\",\"7\":\"0\",\"8\":\"Female\",\"9\":\"19\",\"10\":\"Other race\",\"11\":\"<$25,000\",\"12\":\"NA\",\"13\":\"NA\",\"14\":\"20.0 to <25.0\",\"15\":\"NA\",\"16\":\"202.11\",\"17\":\"No consumption\",\"18\":\"Undiagnosed\",\"19\":\"No\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"NA\",\"23\":\"1999-00\",\"24\":\"Intermediate\",\"25\":\"No\",\"26\":\"1113.66\",\"_rn_\":\"6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\ndim(dat.full)\n#> [1] 62160    26\n```\n:::\n\n\nThe merged dataset contains 62,160 subjects with 26 relevant variables:\n\n-   id: Respondent sequence/ID number\n-   survey.weight: Full sample 2 year weights\n-   psu: Masked pseudo-PSU\n-   strata: Masked pseudo-stratum\n-   caff: Caffeine (exposure variable)\n-   stime: Follow-up time (time from interview date to death or censoring)\n-   status: Mortality status\n-   sex: Sex\n-   age: Age in years\n-   race: Race/ethnicity\n-   income: Annual household income\n-   smoking: Smoking status\n-   diabetic.nephropathy: Diabetic nephropathy (no data)\n-   bmi.cat: BMI - categorical\n-   education: Education level\n-   carbohyd: Carbohydrate in gm\n-   alcohol: Alcohol consumption\n-   diab.years: Years since diabetes\n-   htn: Hypertension\n-   daib.retino: Diabetes retinopathy\n-   macrovascular: Macrovascular complications\n-   insulin: Insulin\n-   survey.cycle: Survey cycle\n-   physical.activity: Physical activity\n-   diabetes: Diabetes status\n-   cal.total: Total calories in kcal\n\n### Data pre-processing\n\n#### Eligibility criteria\n\nThe authors considered adults aged 18 years or more, only diabetic, and total calories between 500 and 3500.\n\n\n::: {.cell hash='nonbinary2a_cache/html/Eligibility_9cf79aa136a430fe13e6f2e15e014ffe'}\n\n```{.r .cell-code}\n# Total samples in the merged dataset\nnrow(dat.full) # N = 62,160\n#> [1] 62160\n\n# Age >= 18 years\ndat2 <- subset(dat.full, age >= 18) \nnrow(dat2) # N = 35,379\n#> [1] 35379\n\n# With diabetes\ndat3 <- subset(dat2, diabetes == \"Yes\") \nnrow(dat3) # N = 4,687 - numbers don't match with the paper (N = 4,544)\n#> [1] 4687\n\n# Implausible alimentary reports\ndat4 <- subset(dat3, cal.total >= 500 & cal.total <= 3500) \nnrow(dat4) # N = 4,083 - numbers don't match with the paper (N = 3,948)\n#> [1] 4083\n```\n:::\n\n\n#### Complete case data\n\nLet us drop missing values in the exposure and outcome:\n\n\n::: {.cell hash='nonbinary2a_cache/html/cc1_408e19bbe94abf6184d796fae92e0294'}\n\n```{.r .cell-code}\n# Drop missing exposure and outcome\ndat <- dat4[complete.cases(dat4$id),]\ndat <- dat[complete.cases(dat$caff),]\ndat <- dat[complete.cases(dat$status),]\ndat <- dat[complete.cases(dat$stime),] # N = 4,080\ndim(dat)\n#> [1] 4080   26\n\n# Missing plot\nplot_missing(dat)\n```\n\n::: {.cell-output-display}\n![](nonbinary2a_files/figure-html/cc1-1.png){width=672}\n:::\n:::\n\n\nNow, let us drop variables with high missingness for this exercise. As explained in the [Missing data analysis chapter](missingdata.html), a better approach could be imputing missing values under the missing at random assumption.\n\n\n::: {.cell hash='nonbinary2a_cache/html/cc2_f00e2154df6eee8c7f90a52373fccc70'}\n\n```{.r .cell-code}\n# Drop variables with high missingness\ndat$diabetic.nephropathy <- dat$diab.years <- dat$daib.retino <- dat$income <- NULL\n\n# Complete case data\ndat <- na.omit(dat)\ndim(dat) # N = 3,780\n#> [1] 3780   22\n```\n:::\n\n\n### Table 1\n\nNow, let us create Table 1 stratified by coffee consumption (exposure), separately for males and females, as done in the article.\n\n\n::: {.cell hash='nonbinary2a_cache/html/tab1_9f33b92c58fe39c3f892d1c59d3ff8d5'}\n\n```{.r .cell-code}\nvars <- c(\"age\", \"race\", \"education\", \"smoking\", \"alcohol\", \"carbohyd\", \"physical.activity\",\n          \"bmi.cat\", \"htn\", \"macrovascular\", \"insulin\", \"survey.cycle\")\n\ntab1a <- CreateTableOne(vars = vars, strata = \"caff\", data = dat[dat$sex==\"Female\",], \n                        test = F)\ntab1b <- CreateTableOne(vars = vars, strata = \"caff\", data = dat[dat$sex==\"Male\",], \n                        test = F)\n\ntab1 <- list(Female = tab1a, Male = tab1b)\nprint(tab1, showAllLevels = T, smd = T)\n#> $Female\n#>                        Stratified by caff\n#>                         level                     No consumption <100 mg/day   \n#>   n                                                  203            916        \n#>   age (mean (SD))                                  59.33 (15.14)  62.92 (14.02)\n#>   race (%)              Non-Hispanic White            38 (18.7)     286 (31.2) \n#>                         Non-Hispanic Black            96 (47.3)     284 (31.0) \n#>                         Mexican American              47 (23.2)     228 (24.9) \n#>                         Other Hispanic                10 ( 4.9)      80 ( 8.7) \n#>                         Other race                    12 ( 5.9)      38 ( 4.1) \n#>   education (%)         Less than 9th grade           58 (28.6)     238 (26.0) \n#>                         9-11th grade                  48 (23.6)     182 (19.9) \n#>                         High school grade             43 (21.2)     224 (24.5) \n#>                         Some college                  39 (19.2)     209 (22.8) \n#>                         College graduate or above     15 ( 7.4)      63 ( 6.9) \n#>   smoking (%)           Never smoker                 143 (70.4)     598 (65.3) \n#>                         Current smoker                24 (11.8)     127 (13.9) \n#>                         Former smoker                 36 (17.7)     191 (20.9) \n#>   alcohol (%)           No consumption               192 (94.6)     826 (90.2) \n#>                         <20 grams/day                  4 ( 2.0)      69 ( 7.5) \n#>                         20+ grams/day                  7 ( 3.4)      21 ( 2.3) \n#>   carbohyd (mean (SD))                            176.17 (73.88) 190.64 (73.34)\n#>   physical.activity (%) Low                           95 (46.8)     393 (42.9) \n#>                         Intermediate                  59 (29.1)     309 (33.7) \n#>                         High                          49 (24.1)     214 (23.4) \n#>   bmi.cat (%)           <20.0                          4 ( 2.0)       6 ( 0.7) \n#>                         20.0 to <25.0                 24 (11.8)     107 (11.7) \n#>                         25.0 to <30.0                 35 (17.2)     254 (27.7) \n#>                         30.0 to <35.0                 45 (22.2)     263 (28.7) \n#>                         35.0 to <40.0                 47 (23.2)     138 (15.1) \n#>                         40.0+                         48 (23.6)     148 (16.2) \n#>   htn (%)               No                            58 (28.6)     273 (29.8) \n#>                         Yes                          145 (71.4)     643 (70.2) \n#>   macrovascular (%)     No                           166 (81.8)     758 (82.8) \n#>                         Yes                           37 (18.2)     158 (17.2) \n#>   insulin (%)           No                           156 (76.8)     755 (82.4) \n#>                         Yes                           47 (23.2)     161 (17.6) \n#>   survey.cycle (%)      1999-00                       45 (22.2)     111 (12.1) \n#>                         2001-02                       45 (22.2)      98 (10.7) \n#>                         2003-04                       26 (12.8)     127 (13.9) \n#>                         2005-06                       20 ( 9.9)     154 (16.8) \n#>                         2007-08                       37 (18.2)     198 (21.6) \n#>                         2009-10                       30 (14.8)     228 (24.9) \n#>                        Stratified by caff\n#>                         100-200 mg/day 200+ mg/day    SMD   \n#>   n                        424            332               \n#>   age (mean (SD))        62.04 (13.75)  60.19 (13.10)  0.150\n#>   race (%)                 154 (36.3)     189 (56.9)   0.527\n#>                            108 (25.5)      40 (12.0)        \n#>                            111 (26.2)      69 (20.8)        \n#>                             30 ( 7.1)      20 ( 6.0)        \n#>                             21 ( 5.0)      14 ( 4.2)        \n#>   education (%)             79 (18.6)      56 (16.9)   0.203\n#>                             89 (21.0)      76 (22.9)        \n#>                            109 (25.7)      81 (24.4)        \n#>                            109 (25.7)      89 (26.8)        \n#>                             38 ( 9.0)      30 ( 9.0)        \n#>   smoking (%)              238 (56.1)     136 (41.0)   0.377\n#>                             81 (19.1)     119 (35.8)        \n#>                            105 (24.8)      77 (23.2)        \n#>   alcohol (%)              370 (87.3)     283 (85.2)   0.211\n#>                             38 ( 9.0)      35 (10.5)        \n#>                             16 ( 3.8)      14 ( 4.2)        \n#>   carbohyd (mean (SD))  193.79 (72.18) 203.36 (76.05)  0.190\n#>   physical.activity (%)    179 (42.2)     148 (44.6)   0.093\n#>                            151 (35.6)     117 (35.2)        \n#>                             94 (22.2)      67 (20.2)        \n#>   bmi.cat (%)                7 ( 1.7)       4 ( 1.2)   0.250\n#>                             40 ( 9.4)      44 (13.3)        \n#>                            109 (25.7)      80 (24.1)        \n#>                            133 (31.4)      82 (24.7)        \n#>                             73 (17.2)      63 (19.0)        \n#>                             62 (14.6)      59 (17.8)        \n#>   htn (%)                  123 (29.0)     110 (33.1)   0.052\n#>                            301 (71.0)     222 (66.9)        \n#>   macrovascular (%)        352 (83.0)     266 (80.1)   0.042\n#>                             72 (17.0)      66 (19.9)        \n#>   insulin (%)              340 (80.2)     252 (75.9)   0.094\n#>                             84 (19.8)      80 (24.1)        \n#>   survey.cycle (%)          42 ( 9.9)      46 (13.9)   0.305\n#>                             53 (12.5)      48 (14.5)        \n#>                             63 (14.9)      46 (13.9)        \n#>                             59 (13.9)      43 (13.0)        \n#>                            111 (26.2)      82 (24.7)        \n#>                             96 (22.6)      67 (20.2)        \n#> \n#> $Male\n#>                        Stratified by caff\n#>                         level                     No consumption <100 mg/day   \n#>   n                                                  168            707        \n#>   age (mean (SD))                                  60.95 (12.68)  62.86 (12.88)\n#>   race (%)              Non-Hispanic White            35 (20.8)     238 (33.7) \n#>                         Non-Hispanic Black            78 (46.4)     209 (29.6) \n#>                         Mexican American              37 (22.0)     190 (26.9) \n#>                         Other Hispanic                13 ( 7.7)      48 ( 6.8) \n#>                         Other race                     5 ( 3.0)      22 ( 3.1) \n#>   education (%)         Less than 9th grade           50 (29.8)     194 (27.4) \n#>                         9-11th grade                  41 (24.4)     135 (19.1) \n#>                         High school grade             31 (18.5)     145 (20.5) \n#>                         Some college                  30 (17.9)     136 (19.2) \n#>                         College graduate or above     16 ( 9.5)      97 (13.7) \n#>   smoking (%)           Never smoker                  72 (42.9)     281 (39.7) \n#>                         Current smoker                34 (20.2)     155 (21.9) \n#>                         Former smoker                 62 (36.9)     271 (38.3) \n#>   alcohol (%)           No consumption               131 (78.0)     539 (76.2) \n#>                         <20 grams/day                 16 ( 9.5)      96 (13.6) \n#>                         20+ grams/day                 21 (12.5)      72 (10.2) \n#>   carbohyd (mean (SD))                            195.01 (85.93) 213.00 (80.40)\n#>   physical.activity (%) Low                           63 (37.5)     230 (32.5) \n#>                         Intermediate                  54 (32.1)     284 (40.2) \n#>                         High                          51 (30.4)     193 (27.3) \n#>   bmi.cat (%)           <20.0                          5 ( 3.0)       4 ( 0.6) \n#>                         20.0 to <25.0                 26 (15.5)      95 (13.4) \n#>                         25.0 to <30.0                 53 (31.5)     276 (39.0) \n#>                         30.0 to <35.0                 46 (27.4)     185 (26.2) \n#>                         35.0 to <40.0                 21 (12.5)      95 (13.4) \n#>                         40.0+                         17 (10.1)      52 ( 7.4) \n#>   htn (%)               No                            50 (29.8)     279 (39.5) \n#>                         Yes                          118 (70.2)     428 (60.5) \n#>   macrovascular (%)     No                           120 (71.4)     526 (74.4) \n#>                         Yes                           48 (28.6)     181 (25.6) \n#>   insulin (%)           No                           135 (80.4)     571 (80.8) \n#>                         Yes                           33 (19.6)     136 (19.2) \n#>   survey.cycle (%)      1999-00                       36 (21.4)      72 (10.2) \n#>                         2001-02                       28 (16.7)      92 (13.0) \n#>                         2003-04                       21 (12.5)     104 (14.7) \n#>                         2005-06                       18 (10.7)     115 (16.3) \n#>                         2007-08                       36 (21.4)     168 (23.8) \n#>                         2009-10                       29 (17.3)     156 (22.1) \n#>                        Stratified by caff\n#>                         100-200 mg/day 200+ mg/day    SMD   \n#>   n                        461            569               \n#>   age (mean (SD))        61.67 (13.66)  61.70 (12.40)  0.074\n#>   race (%)                 214 (46.4)     344 (60.5)   0.575\n#>                             92 (20.0)      67 (11.8)        \n#>                             90 (19.5)     115 (20.2)        \n#>                             54 (11.7)      26 ( 4.6)        \n#>                             11 ( 2.4)      17 ( 3.0)        \n#>   education (%)             98 (21.3)      97 (17.0)   0.269\n#>                             79 (17.1)      95 (16.7)        \n#>                            104 (22.6)     125 (22.0)        \n#>                            100 (21.7)     161 (28.3)        \n#>                             80 (17.4)      91 (16.0)        \n#>   smoking (%)              162 (35.1)     153 (26.9)   0.216\n#>                            109 (23.6)     196 (34.4)        \n#>                            190 (41.2)     220 (38.7)        \n#>   alcohol (%)              349 (75.7)     427 (75.0)   0.080\n#>                             63 (13.7)      80 (14.1)        \n#>                             49 (10.6)      62 (10.9)        \n#>   carbohyd (mean (SD))  225.58 (87.51) 237.26 (85.11)  0.273\n#>   physical.activity (%)    153 (33.2)     195 (34.3)   0.099\n#>                            177 (38.4)     199 (35.0)        \n#>                            131 (28.4)     175 (30.8)        \n#>   bmi.cat (%)                4 ( 0.9)       4 ( 0.7)   0.181\n#>                             61 (13.2)      80 (14.1)        \n#>                            169 (36.7)     187 (32.9)        \n#>                            132 (28.6)     146 (25.7)        \n#>                             64 (13.9)      95 (16.7)        \n#>                             31 ( 6.7)      57 (10.0)        \n#>   htn (%)                  190 (41.2)     234 (41.1)   0.126\n#>                            271 (58.8)     335 (58.9)        \n#>   macrovascular (%)        353 (76.6)     412 (72.4)   0.066\n#>                            108 (23.4)     157 (27.6)        \n#>   insulin (%)              375 (81.3)     449 (78.9)   0.032\n#>                             86 (18.7)     120 (21.1)        \n#>   survey.cycle (%)          48 (10.4)      64 (11.2)   0.284\n#>                             59 (12.8)      69 (12.1)        \n#>                             48 (10.4)     106 (18.6)        \n#>                             70 (15.2)      65 (11.4)        \n#>                            112 (24.3)     130 (22.8)        \n#>                            124 (26.9)     135 (23.7)\n```\n:::\n\n\n### Survey design\n\nThe paper analyzed the data separately for males and females. Let us create the survey design:\n\n\n::: {.cell hash='nonbinary2a_cache/html/unnamed-chunk-1_ff0c5933ef563fef1a6cca2721c910c3'}\n\n```{.r .cell-code}\n# Revised weight - weight divided by 6 cycles\ndat.full$svy.weight <- dat.full$survey.weight/6 \ndat$svy.weight <- dat$survey.weight/6 \nsummary(dat$svy.weight)\n#>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#>   223.2  1760.2  3349.3  4555.9  5817.8 25347.4\n\n# Create an indicator variable\ndat.full$miss <- 1\ndat.full$miss[dat.full$id %in% dat$id] <- 0\n\n# Set up the design\nw.design0 <- svydesign(strata = ~strata, id = ~psu, weights = ~svy.weight, \n                       data = dat.full, nest = TRUE)\n\n# Subset the design\nw.design1 <- subset(w.design0, miss == 0)\n\n# Subset the design for females\nw.design.f <- subset(w.design1, sex == \"Female\")\ndim(w.design.f)\n#> [1] 1875   28\n\n# Subset the design for males\nw.design.m <- subset(w.design1, sex == \"Male\")\ndim(w.design.m)\n#> [1] 1905   28\n```\n:::\n\n\n### Kaplan-Meier plot\n\nLet us create the Kaplan-Meier plot for males and females:\n\n\n::: {.cell hash='nonbinary2a_cache/html/kmplot_8c7b00efaba8c42853d7f97dbed94799'}\n\n```{.r .cell-code}\n# KM for females\nfit0.f <- svykm(Surv(stime, status) ~ caff, design = w.design.f)\nplot(fit0.f)\n```\n\n::: {.cell-output-display}\n![](nonbinary2a_files/figure-html/kmplot-1.png){width=672}\n:::\n\n```{.r .cell-code}\n\n# KM for males\nfit0.m <- svykm(Surv(stime, status) ~ caff, design = w.design.m)\nplot(fit0.m)\n```\n\n::: {.cell-output-display}\n![](nonbinary2a_files/figure-html/kmplot-2.png){width=672}\n:::\n:::\n\n\n### Cox PH\n\nNow, we will fit the Cox proportional hazards model, separately for males and females. Let us run the unadjusted model first.\n\n\n::: {.cell hash='nonbinary2a_cache/html/coxunadj_11d891a199a108ec2cc4fa4f87eb2fa6'}\n\n```{.r .cell-code}\n# Unadjusted Cox PH for females\nfit1.f <- svycoxph(Surv(stime, status) ~ caff, design = w.design.f)\npublish(fit1.f)\n#> Stratified 1 - level Cluster Sampling design (with replacement)\n#> With (180) clusters.\n#> subset(w.design1, sex == \"Female\")\n#>  Variable          Units HazardRatio       CI.95   p-value \n#>      caff No consumption         Ref                       \n#>              <100 mg/day        0.80 [0.62;1.03]   0.08543 \n#>           100-200 mg/day        0.58 [0.42;0.80]   < 0.001 \n#>              200+ mg/day        0.61 [0.43;0.86]   0.00507\n\n# Unadjusted Cox PH for males\nfit1.m <- svycoxph(Surv(stime, status) ~ caff, design = w.design.m)\npublish(fit1.m)\n#> Stratified 1 - level Cluster Sampling design (with replacement)\n#> With (180) clusters.\n#> subset(w.design1, sex == \"Male\")\n#>  Variable          Units HazardRatio       CI.95 p-value \n#>      caff No consumption         Ref                     \n#>              <100 mg/day        1.20 [0.88;1.63]   0.246 \n#>           100-200 mg/day        1.10 [0.75;1.59]   0.632 \n#>              200+ mg/day        1.10 [0.76;1.58]   0.607\n```\n:::\n\n\nNow, we will fit the Cox PH model, adjusting for covariates.\n\n\n::: {.cell hash='nonbinary2a_cache/html/coxadj_3c0b6185b397fb3163b676408cdf3f7a'}\n\n```{.r .cell-code}\n# Covariate adjusted Cox PH for females\nfit2.f <- svycoxph(Surv(stime, status) ~ caff + age + race + education + smoking + \n                     alcohol +  carbohyd + physical.activity + bmi.cat + htn +\n                     macrovascular + insulin + survey.cycle, design = w.design.f)\npublish(fit2.f)\n#> Stratified 1 - level Cluster Sampling design (with replacement)\n#> With (180) clusters.\n#> subset(w.design1, sex == \"Female\")\n#>           Variable                     Units HazardRatio       CI.95   p-value \n#>               caff            No consumption         Ref                       \n#>                                  <100 mg/day        0.62 [0.46;0.84]   0.00166 \n#>                               100-200 mg/day        0.44 [0.30;0.64]   < 0.001 \n#>                                  200+ mg/day        0.43 [0.28;0.66]   < 0.001 \n#>                age                                  1.08 [1.07;1.09]   < 0.001 \n#>               race        Non-Hispanic White         Ref                       \n#>                           Non-Hispanic Black        0.81 [0.65;1.01]   0.06322 \n#>                             Mexican American        0.79 [0.61;1.03]   0.07976 \n#>                               Other Hispanic        0.65 [0.41;1.01]   0.05634 \n#>                                   Other race        0.64 [0.38;1.08]   0.09394 \n#>          education       Less than 9th grade         Ref                       \n#>                                 9-11th grade        1.15 [0.84;1.57]   0.37396 \n#>                            High school grade        1.03 [0.75;1.41]   0.84759 \n#>                                 Some college        1.06 [0.79;1.44]   0.69484 \n#>                    College graduate or above        0.61 [0.40;0.93]   0.02192 \n#>            smoking              Never smoker         Ref                       \n#>                               Current smoker        1.84 [1.42;2.38]   < 0.001 \n#>                                Former smoker        1.17 [0.95;1.46]   0.14379 \n#>            alcohol            No consumption         Ref                       \n#>                                <20 grams/day        0.94 [0.65;1.36]   0.75056 \n#>                                20+ grams/day        1.05 [0.58;1.93]   0.86786 \n#>           carbohyd                                  1.00 [1.00;1.00]   0.69680 \n#>  physical.activity                       Low         Ref                       \n#>                                 Intermediate        0.73 [0.57;0.92]   0.00834 \n#>                                         High        0.66 [0.49;0.89]   0.00638 \n#>            bmi.cat                     <20.0         Ref                       \n#>                                20.0 to <25.0        0.39 [0.21;0.73]   0.00301 \n#>                                25.0 to <30.0        0.33 [0.19;0.57]   < 0.001 \n#>                                30.0 to <35.0        0.30 [0.17;0.54]   < 0.001 \n#>                                35.0 to <40.0        0.26 [0.13;0.49]   < 0.001 \n#>                                        40.0+        0.31 [0.16;0.62]   < 0.001 \n#>                htn                        No         Ref                       \n#>                                          Yes        1.00 [0.80;1.24]   0.98084 \n#>      macrovascular                        No         Ref                       \n#>                                          Yes        1.85 [1.48;2.32]   < 0.001 \n#>            insulin                        No         Ref                       \n#>                                          Yes        1.87 [1.50;2.32]   < 0.001 \n#>       survey.cycle                   1999-00         Ref                       \n#>                                      2001-02        0.58 [0.43;0.78]   < 0.001 \n#>                                      2003-04        0.75 [0.54;1.04]   0.08384 \n#>                                      2005-06        0.81 [0.57;1.15]   0.24147 \n#>                                      2007-08        0.88 [0.60;1.28]   0.49860 \n#>                                      2009-10        0.76 [0.56;1.04]   0.08292\n\n# Covariate adjusted Cox PH for males\nfit2.m <- svycoxph(Surv(stime, status) ~ caff + age + race + education + smoking + \n                     alcohol +  carbohyd + physical.activity + bmi.cat + htn +\n                     macrovascular + insulin + survey.cycle, design = w.design.m)\npublish(fit2.m)\n#> Stratified 1 - level Cluster Sampling design (with replacement)\n#> With (180) clusters.\n#> subset(w.design1, sex == \"Male\")\n#>           Variable                     Units HazardRatio       CI.95   p-value \n#>               caff            No consumption         Ref                       \n#>                                  <100 mg/day        1.06 [0.75;1.49]   0.74199 \n#>                               100-200 mg/day        1.04 [0.69;1.57]   0.84938 \n#>                                  200+ mg/day        1.05 [0.71;1.54]   0.81249 \n#>                age                                  1.08 [1.06;1.09]   < 0.001 \n#>               race        Non-Hispanic White         Ref                       \n#>                           Non-Hispanic Black        0.75 [0.61;0.91]   0.00423 \n#>                             Mexican American        0.68 [0.52;0.88]   0.00348 \n#>                               Other Hispanic        0.83 [0.51;1.36]   0.46367 \n#>                                   Other race        1.03 [0.60;1.76]   0.91073 \n#>          education       Less than 9th grade         Ref                       \n#>                                 9-11th grade        1.47 [1.10;1.96]   0.00846 \n#>                            High school grade        1.03 [0.80;1.33]   0.81768 \n#>                                 Some college        1.02 [0.76;1.36]   0.91606 \n#>                    College graduate or above        0.68 [0.47;0.98]   0.03833 \n#>            smoking              Never smoker         Ref                       \n#>                               Current smoker        1.90 [1.38;2.62]   < 0.001 \n#>                                Former smoker        1.03 [0.85;1.26]   0.74101 \n#>            alcohol            No consumption         Ref                       \n#>                                <20 grams/day        0.95 [0.74;1.21]   0.67612 \n#>                                20+ grams/day        1.14 [0.83;1.58]   0.42116 \n#>           carbohyd                                  1.00 [1.00;1.00]   0.37461 \n#>  physical.activity                       Low         Ref                       \n#>                                 Intermediate        0.64 [0.52;0.80]   < 0.001 \n#>                                         High        0.69 [0.56;0.87]   0.00137 \n#>            bmi.cat                     <20.0         Ref                       \n#>                                20.0 to <25.0        0.25 [0.11;0.58]   0.00134 \n#>                                25.0 to <30.0        0.20 [0.09;0.48]   < 0.001 \n#>                                30.0 to <35.0        0.19 [0.08;0.45]   < 0.001 \n#>                                35.0 to <40.0        0.25 [0.10;0.64]   0.00380 \n#>                                        40.0+        0.26 [0.11;0.60]   0.00160 \n#>                htn                        No         Ref                       \n#>                                          Yes        1.18 [0.98;1.42]   0.08442 \n#>      macrovascular                        No         Ref                       \n#>                                          Yes        1.40 [1.17;1.66]   < 0.001 \n#>            insulin                        No         Ref                       \n#>                                          Yes        1.48 [1.21;1.81]   < 0.001 \n#>       survey.cycle                   1999-00         Ref                       \n#>                                      2001-02        1.37 [1.04;1.80]   0.02569 \n#>                                      2003-04        0.98 [0.68;1.43]   0.93245 \n#>                                      2005-06        1.07 [0.77;1.48]   0.67918 \n#>                                      2007-08        1.05 [0.78;1.41]   0.75981 \n#>                                      2009-10        0.83 [0.58;1.18]   0.29625\n```\n:::\n\n\nThe adjusted results are approximately the same as in Table 2 of the article. Caffeine consumption was associated with mortality among women but not among men.\n\n### PH assumption\n\nNow, we will check the proportional hazard assumption.\n\n\n::: {.cell hash='nonbinary2a_cache/html/proportional_d3c25f91c5e0cc309ec14e04198c733e'}\n\n```{.r .cell-code}\n# PH assumption among females\ncox.zph(fit2.f)\n#>                      chisq df    p\n#> caff              3.65e-03  3 1.00\n#> age               2.15e-06  1 1.00\n#> race              2.87e-03  4 1.00\n#> education         2.42e-03  4 1.00\n#> smoking           2.44e-03  2 1.00\n#> alcohol           1.14e-03  2 1.00\n#> carbohyd          7.38e-04  1 0.98\n#> physical.activity 3.34e-03  2 1.00\n#> bmi.cat           2.21e-03  5 1.00\n#> htn               1.33e-03  1 0.97\n#> macrovascular     4.24e-04  1 0.98\n#> insulin           2.26e-04  1 0.99\n#> survey.cycle      3.49e-03  5 1.00\n#> GLOBAL            2.55e-02 32 1.00\n\n# PH assumption among males\ncox.zph(fit2.m)\n#>                      chisq df    p\n#> caff              2.70e-03  3 1.00\n#> age               2.45e-03  1 0.96\n#> race              2.40e-03  4 1.00\n#> education         1.13e-03  4 1.00\n#> smoking           1.67e-03  2 1.00\n#> alcohol           1.50e-03  2 1.00\n#> carbohyd          1.33e-03  1 0.97\n#> physical.activity 7.73e-03  2 1.00\n#> bmi.cat           3.60e-03  5 1.00\n#> htn               4.45e-06  1 1.00\n#> macrovascular     4.32e-06  1 1.00\n#> insulin           9.24e-05  1 0.99\n#> survey.cycle      2.21e-03  5 1.00\n#> GLOBAL            2.78e-02 32 1.00\n```\n:::\n\n\nThe large p-values indicate that the proportional hazard assumption was met for both models.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}