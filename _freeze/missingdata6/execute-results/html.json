{
  "hash": "7ec83b634bdc64356af66420e08b5f45",
  "result": {
    "markdown": "## MCAR tests {.unnumbered}\n\nMCAR tests are essential tools in the data analysis process. They help researchers understand the nature of missingness in their datasets, guide appropriate imputation strategies, and ensure the validity and reliability of statistical analyses.\n\n### MCAR data\n\nIn the initial chunk, several packages are loaded. These packages provide functions and tools necessary for the subsequent analysis, including multiple imputation, statistical modeling, and data visualization.\n\n\n::: {.cell hash='missingdata6_cache/html/setup_a36a0aeabec1847c4536de947802d983'}\n\n```{.r .cell-code}\n# Load required packages\nrequire(mice)\nrequire(mitools)\nrequire(survey)\nrequire(remotes)\nrequire(simcausal)\n```\n:::\n\n\n#### Data generating process\n\nA Directed Acyclic Graph (DAG) is defined, which represents a causal model of how different variables in the dataset relate to each other. This DAG is used to simulate data based on the relationships defined. We generate `L` as a function of `P` and `B`.\n\n\n::: {.cell hash='missingdata6_cache/html/dgm0_c1ab4d0d4281f288db330b4f7c7ac83e'}\n\n```{.r .cell-code}\nrequire(simcausal)\nD <- DAG.empty()\nD <- D + \n  node(\"B\", distr = \"rnorm\", mean = 0, sd = 1) +\n  node(\"P\", distr = \"rnorm\", mean = 0, sd = .7) +\n  node(\"L\", distr = \"rnorm\", mean = 2 + 2 * P + 3 * B, sd = 3) + \n  node(\"A\", distr = \"rnorm\", mean = 0.5 + L + 2 * P, sd = 1) + \n  node(\"Y\", distr = \"rnorm\", mean = 1.1 * L + 1.3 * A + B + 2 * P, sd = .5)\nDset <- set.DAG(D)\n```\n:::\n\n\n#### Generate DAG\n\nThe previously defined DAG is visualized, providing a graphical representation of the relationships between variables.\n\n\n::: {.cell hash='missingdata6_cache/html/dag0_4021df7be074bbe52959ce1964d2e211'}\n\n```{.r .cell-code}\nplotDAG(Dset, xjitter = 0.1, yjitter = .9,\n        edge_attrs = list(width = 0.5, arrow.width = 0.4, arrow.size = 0.7),\n        vertex_attrs = list(size = 12, label.cex = 0.8))\n```\n\n::: {.cell-output-display}\n![](missingdata6_files/figure-html/dag0-1.png){width=672}\n:::\n:::\n\n\n#### Generate Data\n\nUsing the DAG, a dataset is simulated. This dataset will be used for subsequent analysis.\n\n\n::: {.cell hash='missingdata6_cache/html/data0_6ff68d9ea2475f3a9603febcc894dcf9'}\n\n```{.r .cell-code}\nObs.Data <- sim(DAG = Dset, n = 10000, rndseed = 123)\nhead(Obs.Data)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"ID\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"B\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"P\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"L\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"A\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Y\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"-0.56047565\",\"3\":\"1.6595077\",\"4\":\"1.1286981\",\"5\":\"4.7541070\",\"6\":\"10.421710\",\"_rn_\":\"1\"},{\"1\":\"2\",\"2\":\"-0.23017749\",\"3\":\"-0.1167684\",\"4\":\"0.4142118\",\"5\":\"0.9388224\",\"6\":\"1.573070\",\"_rn_\":\"2\"},{\"1\":\"3\",\"2\":\"1.55870831\",\"3\":\"0.6488730\",\"4\":\"1.6633266\",\"5\":\"2.9227600\",\"6\":\"8.231805\",\"_rn_\":\"3\"},{\"1\":\"4\",\"2\":\"0.07050839\",\"3\":\"-0.3977062\",\"4\":\"-3.5873099\",\"5\":\"-5.0617852\",\"6\":\"-11.283620\",\"_rn_\":\"4\"},{\"1\":\"5\",\"2\":\"0.12928774\",\"3\":\"0.1575631\",\"4\":\"-0.5908993\",\"5\":\"1.1248743\",\"6\":\"1.907822\",\"_rn_\":\"5\"},{\"1\":\"6\",\"2\":\"1.71506499\",\"3\":\"0.7923901\",\"4\":\"3.7331116\",\"5\":\"5.8016423\",\"6\":\"14.839085\",\"_rn_\":\"6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nObs.Data.original <- Obs.Data\n```\n:::\n\n\n#### Randomly set some data to missing\n\nSome values in the dataset are randomly set to missing (i.e., randomly assign some L values to missing). This simulates a scenario where data might be missing completely at random (MCAR).\n\n\n::: {.cell hash='missingdata6_cache/html/data0a_bc6a121600caa0960ec3378b83abfbb2'}\n\n```{.r .cell-code}\nset.seed(123)\nObs.Data$L[sample(1:length(Obs.Data$L), size = 1000)] <- NA\nsummary(Obs.Data$L)\n#>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n#> -17.116  -1.096   1.896   1.968   4.996  20.129    1000\n```\n:::\n\n\nThe missing data patterns in the dataset are visualized. This helps in understanding which variables have missing values and how they might be related.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(VIM)\nres <- aggr(Obs.Data, plot = FALSE)\nplot(res, numbers = TRUE, prop = FALSE)\n```\n\n::: {.cell-output-display}\n![](missingdata6_files/figure-html/pattern0-1.png){width=672}\n:::\n:::\n\n\n#### Visualize via margin plots\n\nMargin plots are used to compare the distributions of variables when a particular variable is missing versus when it is observed. This provides insights into how missingness might be related to the values of other variables.\n\n-   The red boxplot depicts the distribution of a variable in the data where **L has a missing value**.\n-   The blue boxplot depicts the distribution of the values of a variable in the data where **L has an observed value**.\n-   **Same median and spread (range) may mean no difference in the distribution**.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmarginplot(Obs.Data[,c(\"L\", \"P\")])\n```\n\n::: {.cell-output-display}\n![](missingdata6_files/figure-html/plot0p-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmarginplot(Obs.Data[,c(\"L\", \"B\")])\n```\n\n::: {.cell-output-display}\n![](missingdata6_files/figure-html/plot0b-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmarginplot(Obs.Data[,c(\"L\", \"A\")])\n```\n\n::: {.cell-output-display}\n![](missingdata6_files/figure-html/plot0a-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmarginplot(Obs.Data[,c(\"L\", \"Y\")])\n```\n\n::: {.cell-output-display}\n![](missingdata6_files/figure-html/plot0y-1.png){width=672}\n:::\n:::\n\n\n\n#### Little's MCAR test\n\nA statistical test is conducted to determine if data is missing entirely at random (MCAR). The outcome of this test offers a deeper understanding of the reasons behind the missing data.\n\nLittle's 1988 chi-squared test evaluates if data is MCAR by checking for significant differences in the means of various missing-value patterns [@little1988test]. Based on the test's statistic and p-value, we can infer if the data is MCAR. The null hypothesis for this test is that the data is MCAR.\n\n-   The essence of this test is to compare means across groups with different missing data patterns. It uses a likelihood ratio test and assumes the data follows a multivariate normal distribution.\n-   If this test is rejected (indicated by a low p-value or a high statistic), it suggests the data might not be MCAR.\n\nHowever, this test has several limitations [@natest]:\n\n-   The test doesn't pinpoint which specific variables don't adhere to MCAR, meaning it doesn't highlight potential variables associated with missingness.\n-   It assumes multivariate normality. If this assumption isn't met, especially with non-normal or categorical variables, the test might not be reliable unless there's a large sample size.\n-   The test assumes that all missing data patterns have the same covariance matrix. This means it can't detect deviations from MCAR that are based on covariance, especially if the data is Missing at Random (MAR) or Missing Not at Random (MNAR).\n-   Research has shown that Little's MCAR test might have low power, especially when few variables don't follow MCAR, the association between the data and its missingness is weak, or if the data is MNAR.\n-   The test can only reject the MCAR assumption but can't confirm it. A non-significant result doesn't necessarily confirm that the data is MCAR.\n-   Even if the test result is significant, it doesn't rule out the possibility of the data being MNAR.\n\n\n::: {.cell hash='missingdata6_cache/html/mcar_e3ed3ade4351c4a401cd2040cb2ef556'}\n\n```{.r .cell-code}\nrequire(naniar)\nmcar_test(Obs.Data)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"statistic\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"df\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"p.value\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"missing.patterns\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"2.604569\",\"2\":\"5\",\"3\":\"0.760671\",\"4\":\"2\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\n\nrequire(misty)\nna.test(Obs.Data)\n#>  Little's MCAR Test\n#> \n#>       n nIncomp nPattern chi2 df  pval \n#>   10000    1000        2 2.60  5 0.761\n```\n:::\n\n\n#### MCAR and normality test\n\nHawkins, in 1981, introduced a method to assess both multivariate normality and the consistency in variances, known as homoscedasticity. This method not only checks for consistent variances but also for mean equality [@hawkins1981new].\n\nIn 2010, Jamshidian and Jalal suggested a technique to compare covariances among groups with the same missing data patterns. They utilized the Hawkins test for data assumed to be normal and a non-parametric approach for other data types [@jamshidian2010tests].\n\nThe following package [@jamshidian2010tests] tests multivariate normality and homoscedasticity in the context of missing data.\n\n\n::: {.cell hash='missingdata6_cache/html/normality_87791a1e87bf15774304db599b95df48'}\n\n```{.r .cell-code}\n#library(devtools)\n#install_github(\"cran/MissMech\")\nlibrary(MissMech)\ntest.result <- TestMCARNormality(data = Obs.Data)\ntest.result\n#> Call:\n#> TestMCARNormality(data = Obs.Data)\n#> \n#> Number of Patterns:  2 \n#> \n#> Total number of cases used in the analysis:  10000 \n#> \n#>  Pattern(s) used:\n#>           ID   B   P    L   A   Y   Number of cases\n#> group.1    1   1   1   NA   1   1              1000\n#> group.2    1   1   1    1   1   1              9000\n#> \n#> \n#>     Test of normality and Homoscedasticity:\n#>   -------------------------------------------\n#> \n#> Hawkins Test:\n#> \n#>     P-value for the Hawkins test of normality and homoscedasticity:  1.749746e-15 \n#> \n#>     Either the test of multivariate normality or homoscedasticity (or both) is rejected.\n#>     Provided that normality can be assumed, the hypothesis of MCAR is \n#>     rejected at 0.05 significance level. \n#> \n#> Non-Parametric Test:\n#> \n#>     P-value for the non-parametric test of homoscedasticity:  0.4019219 \n#> \n#>     Reject Normality at 0.05 significance level.\n#>     There is not sufficient evidence to reject MCAR at 0.05 significance level.\nsummary(test.result)\n#> \n#> Number of imputation:  1 \n#> \n#> Number of Patterns:  2 \n#> \n#> Total number of cases used in the analysis:  10000 \n#> \n#>  Pattern(s) used:\n#>           ID   B   P    L   A   Y   Number of cases\n#> group.1    1   1   1   NA   1   1              1000\n#> group.2    1   1   1    1   1   1              9000\n#> \n#> \n#>     Test of normality and Homoscedasticity:\n#>   -------------------------------------------\n#> \n#> Hawkins Test:\n#> \n#>     P-value for the Hawkins test of normality and homoscedasticity:  1.749746e-15 \n#> \n#> Non-Parametric Test:\n#> \n#>     P-value for the non-parametric test of homoscedasticity:  0.4019219\n```\n:::\n\n::: {.cell hash='missingdata6_cache/html/normality2_f75f4c428f3f0d7d065163bae2de22ef'}\n\n```{.r .cell-code}\npng(\"E:/GitHub/EpiMethods/Images/missingdata/boxplot.png\", width = 600, height = 600)\nboxplot(test.result)\ndev.off()\n```\n:::\n\n::: {.cell hash='missingdata6_cache/html/normality3_cf9e3f9e791ddc4ea39920b3eb44ce3a'}\n\n```{.r .cell-code}\nboxplot(test.result)\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/missingdata/boxplot.png){width=800px}\n:::\n:::\n\n\n### Non-MCAR data\n\n#### Set some data to missing based on a rule\n\nIn this section, the original dataset is restored. Then, for a specific column, any value greater than a certain threshold is set to 'missing'. A summary of this column is then provided to understand the distribution of missing values.\n\n\n::: {.cell hash='missingdata6_cache/html/data1_676c85e426cf3019d450bed56ed5ecb8'}\n\n```{.r .cell-code}\nObs.Data <- Obs.Data.original\nObs.Data$L[Obs.Data$L > 7.79] <- NA\nsummary(Obs.Data$L)\n#>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n#> -17.116  -1.482   1.330   1.050   3.954   7.787    1035\n```\n:::\n\n\nThe dataset's missing data patterns are visualized. This visualization helps in understanding which data points are missing and their distribution across the dataset.\n\n\n::: {.cell hash='missingdata6_cache/html/plot1_1f679796341d3fbf90aa26f28258c79d'}\n\n```{.r .cell-code}\nres <- aggr(Obs.Data, plot = FALSE)\nplot(res, numbers = TRUE, prop = FALSE)\n```\n\n::: {.cell-output-display}\n![](missingdata6_files/figure-html/plot1-1.png){width=672}\n:::\n:::\n\n\n#### Visualize via margin plots\n\nMargin plots are used to visualize the relationship between two variables, especially when one of them has missing values. Here, the relationship of a specific column with missing values is visualized against other columns in the dataset. This helps in understanding how the missingness in one variable might relate to other variables.\n\n\n::: {.cell hash='missingdata6_cache/html/plot2_19dc94b5952af58bafd662676eec4728'}\n\n```{.r .cell-code}\nmarginplot(Obs.Data[,c(\"L\", \"P\")])\n```\n\n::: {.cell-output-display}\n![](missingdata6_files/figure-html/plot2-1.png){width=672}\n:::\n\n```{.r .cell-code}\nmarginplot(Obs.Data[,c(\"L\", \"B\")])\n```\n\n::: {.cell-output-display}\n![](missingdata6_files/figure-html/plot2-2.png){width=672}\n:::\n\n```{.r .cell-code}\nmarginplot(Obs.Data[,c(\"L\", \"A\")])\n```\n\n::: {.cell-output-display}\n![](missingdata6_files/figure-html/plot2-3.png){width=672}\n:::\n\n```{.r .cell-code}\nmarginplot(Obs.Data[,c(\"L\", \"Y\")])\n```\n\n::: {.cell-output-display}\n![](missingdata6_files/figure-html/plot2-4.png){width=672}\n:::\n:::\n\n\n#### Little's MCAR test\n\nLittle's MCAR test is applied to the dataset to check if the data is missing completely at random. This test provides a statistic and a p-value to determine the nature of missingness in the data.\n\n\n::: {.cell hash='missingdata6_cache/html/mcar1_d1c4b89ca92c217c71bf042fc8e37555'}\n\n```{.r .cell-code}\nmcar_test(Obs.Data)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"statistic\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"df\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"p.value\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"missing.patterns\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"3511.083\",\"2\":\"5\",\"3\":\"0\",\"4\":\"2\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nna.test(Obs.Data)\n#>  Little's MCAR Test\n#> \n#>       n nIncomp nPattern    chi2 df  pval \n#>   10000    1035        2 3511.08  5 0.000\n```\n:::\n\n\n#### MCAR and normality test\n\nA test is conducted to check if the data follows a multivariate normal distribution and if the variances across different groups are consistent (homoscedasticity). The results of this test, along with a summary and a boxplot visualization, are provided to understand the distribution and characteristics of the data.\n\n\n::: {.cell hash='missingdata6_cache/html/normality1_7b3a51fb351148ac059a7b24b89a14d3'}\n\n```{.r .cell-code}\ntest.result <- TestMCARNormality(data = Obs.Data)\ntest.result\n#> Call:\n#> TestMCARNormality(data = Obs.Data)\n#> \n#> Number of Patterns:  2 \n#> \n#> Total number of cases used in the analysis:  10000 \n#> \n#>  Pattern(s) used:\n#>           ID   B   P    L   A   Y   Number of cases\n#> group.1    1   1   1    1   1   1              8965\n#> group.2    1   1   1   NA   1   1              1035\n#> \n#> \n#>     Test of normality and Homoscedasticity:\n#>   -------------------------------------------\n#> \n#> Hawkins Test:\n#> \n#>     P-value for the Hawkins test of normality and homoscedasticity:  2.401873e-30 \n#> \n#>     Either the test of multivariate normality or homoscedasticity (or both) is rejected.\n#>     Provided that normality can be assumed, the hypothesis of MCAR is \n#>     rejected at 0.05 significance level. \n#> \n#> Non-Parametric Test:\n#> \n#>     P-value for the non-parametric test of homoscedasticity:  0 \n#> \n#>     Hypothesis of MCAR is rejected at  0.05 significance level.\n#>     The multivariate normality test is inconclusive.\nsummary(test.result)\n#> \n#> Number of imputation:  1 \n#> \n#> Number of Patterns:  2 \n#> \n#> Total number of cases used in the analysis:  10000 \n#> \n#>  Pattern(s) used:\n#>           ID   B   P    L   A   Y   Number of cases\n#> group.1    1   1   1    1   1   1              8965\n#> group.2    1   1   1   NA   1   1              1035\n#> \n#> \n#>     Test of normality and Homoscedasticity:\n#>   -------------------------------------------\n#> \n#> Hawkins Test:\n#> \n#>     P-value for the Hawkins test of normality and homoscedasticity:  2.401873e-30 \n#> \n#> Non-Parametric Test:\n#> \n#>     P-value for the non-parametric test of homoscedasticity:  0\n```\n:::\n\n::: {.cell hash='missingdata6_cache/html/normality1p_77bdf7f1df61eaaa8dcd594f4a4d0b9d'}\n\n```{.r .cell-code}\npng(\"E:/GitHub/EpiMethods/Images/missingdata/boxplot1.png\", width = 600, height = 600)\nboxplot(test.result)\ndev.off()\n```\n:::\n\n::: {.cell hash='missingdata6_cache/html/normality1ps_e5b94fbb542c03970cf4da2a236c1f8d'}\n\n```{.r .cell-code}\nboxplot(test.result)\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/missingdata/boxplot1.png){width=800px}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}