{
  "hash": "8fd97c92f59181570bbe79dc11be1310",
  "result": {
    "engine": "knitr",
    "markdown": "## Effect modification {.unnumbered}\n\nIn this tutorial, we delve into the concept of effect modification.\n\n::: callout-important\nWe discussed about effect modification in an [earlier discussion](confounding0.html).\n:::\n\nWe start by loading the necessary packages that will aid in the analysis. We also define a function `tidy.pool_mi` to streamline the pooling process for multiple imputation results.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load required packages\nlibrary(survey)\nrequire(interactions)\nrequire(mitools)\nrequire(mice)\nrequire(miceadds)\nlibrary(modelsummary)\n\ntidy.pool_mi <- function(x, ...) {\n  msg <- capture.output(out <- summary(x, ...))\n  out$term <- row.names(out)\n  colnames(out) <- c(\"estimate\", \"std.error\", \"statistic\", \"p.value\",\n                     \"conf.low\", \"conf.high\", \"miss\", \"term\")\n  return(out)\n}\n```\n:::\n\n\n### Data\n\nWe load a dataset named `smi`. This dataset is a list of multiple imputed datasets, which is evident from the structure and the way we access its elements.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(mitools)\ndata(smi)\nlength(smi)\n#> [1] 2\nlength(smi[[1]])\n#> [1] 5\nhead(smi[[1]][[1]])\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"id\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"wave\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"mmetro\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"parsmk\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"drkfre\"],\"name\":[5],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"alcdos\"],\"name\":[6],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"alcdhi\"],\"name\":[7],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"smk\"],\"name\":[8],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"cistot\"],\"name\":[9],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"mdrkfre\"],\"name\":[10],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"sex\"],\"name\":[11],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"drinkreg\"],\"name\":[12],\"type\":[\"lgl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"920006\",\"2\":\"1\",\"3\":\"1\",\"4\":\"0\",\"5\":\"Non drinker\",\"6\":\"Non drinker\",\"7\":\"0\",\"8\":\"non/ex-smoker\",\"9\":\"0\",\"10\":\"0\",\"11\":\"1\",\"12\":\"FALSE\",\"_rn_\":\"1\"},{\"1\":\"920006\",\"2\":\"2\",\"3\":\"1\",\"4\":\"0\",\"5\":\"Non drinker\",\"6\":\"Non drinker\",\"7\":\"0\",\"8\":\"non/ex-smoker\",\"9\":\"0\",\"10\":\"0\",\"11\":\"1\",\"12\":\"FALSE\",\"_rn_\":\"2\"},{\"1\":\"920006\",\"2\":\"3\",\"3\":\"1\",\"4\":\"0\",\"5\":\"Non drinker\",\"6\":\"Non drinker\",\"7\":\"0\",\"8\":\"non/ex-smoker\",\"9\":\"0\",\"10\":\"0\",\"11\":\"1\",\"12\":\"FALSE\",\"_rn_\":\"3\"},{\"1\":\"920006\",\"2\":\"4\",\"3\":\"1\",\"4\":\"0\",\"5\":\"Non drinker\",\"6\":\"Non drinker\",\"7\":\"0\",\"8\":\"non/ex-smoker\",\"9\":\"1\",\"10\":\"0\",\"11\":\"1\",\"12\":\"FALSE\",\"_rn_\":\"4\"},{\"1\":\"920006\",\"2\":\"5\",\"3\":\"1\",\"4\":\"0\",\"5\":\"Non drinker\",\"6\":\"Non drinker\",\"7\":\"0\",\"8\":\"non/ex-smoker\",\"9\":\"4\",\"10\":\"0\",\"11\":\"1\",\"12\":\"FALSE\",\"_rn_\":\"5\"},{\"1\":\"920006\",\"2\":\"6\",\"3\":\"1\",\"4\":\"0\",\"5\":\"not in last wk\",\"6\":\"not in last wk\",\"7\":\"0\",\"8\":\"non/ex-smoker\",\"9\":\"3\",\"10\":\"0\",\"11\":\"1\",\"12\":\"FALSE\",\"_rn_\":\"6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n### Model with interaction and ORs\n\nWe're interested in understanding how the variable `wave` interacts with `sex` in predicting `drinkreg`. We fit two logistic regression models, one for each level of the `sex` variable (0 males, 1 females), to understand this interaction. `wave` is the exposure variable here.\n\n#### For effect modifier sex = 0 (males)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodels <- with(smi, glm(drinkreg~ wave + sex + wave*sex, family = binomial()))\nsummary(pool(models, rule = \"rubin1987\"), conf.int = TRUE, exponentiate = TRUE)[2,]\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"term\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"estimate\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"std.error\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"statistic\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"df\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"p.value\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2.5 %\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"97.5 %\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"conf.low\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"conf.high\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"wave\",\"2\":\"1.271952\",\"3\":\"0.06587423\",\"4\":\"3.651693\",\"5\":\"234.4974\",\"6\":\"0.0003212903\",\"7\":\"1.11714\",\"8\":\"1.448217\",\"9\":\"1.11714\",\"10\":\"1.448217\",\"_rn_\":\"2\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n#### For effect modifier sex = 1 (females) (just changing reference)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodels2<-with(smi, glm(drinkreg~ wave + I(sex==0) + wave*I(sex==0),family=binomial()))\nsummary(pool(models2, rule = \"rubin1987\"),conf.int = TRUE, exponentiate = TRUE)[2,]\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"term\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"estimate\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"std.error\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"statistic\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"df\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"p.value\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2.5 %\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"97.5 %\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"conf.low\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"conf.high\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"wave\",\"2\":\"1.225438\",\"3\":\"0.05876369\",\"4\":\"3.45959\",\"5\":\"240.3053\",\"6\":\"0.0006399352\",\"7\":\"1.091487\",\"8\":\"1.375828\",\"9\":\"1.091487\",\"10\":\"1.375828\",\"_rn_\":\"2\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n-   Notice the ORs for `wave` in the above 2 analyses. These are basically our target.\n-   For proper survey data analysis, you will have to work with design and make sure you subset your subpopulation (those eligible) appropriately.\n\n### Simple slopes analyses\n\nWe perform a simple slopes analysis for each imputed dataset. This analysis helps in understanding the relationship between the predictor and the outcome at specific levels of the moderator.\n\n\n::: {.cell}\n\n```{.r .cell-code}\na1 <- sim_slopes(models[[1]], pred = wave, modx = sex)\na2 <- sim_slopes(models[[2]], pred = wave, modx = sex)\na3 <- sim_slopes(models[[3]], pred = wave, modx = sex)\na4 <- sim_slopes(models[[4]], pred = wave, modx = sex)\na5 <- sim_slopes(models[[5]], pred = wave, modx = sex)\n```\n:::\n\n\nAfter obtaining the results from each imputed dataset, we pool them to get a consolidated result. This is done separately for each level of the `sex` variable.\n\n### Pooled results for sex = 0\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# For sex = 0\nef.lev <- 1\nest <- c(a1$slopes$Est.[ef.lev],\n         a2$slopes$Est.[ef.lev],\n         a3$slopes$Est.[ef.lev],\n         a4$slopes$Est.[ef.lev],\n         a5$slopes$Est.[ef.lev])\nse <- c(a1$slopes$S.E.[ef.lev],\n        a2$slopes$S.E.[ef.lev],\n        a3$slopes$S.E.[ef.lev],\n        a4$slopes$S.E.[ef.lev],\n        a5$slopes$S.E.[ef.lev])\nvr <- se^2\nOR <- exp(est)\nOR.se <- OR * se\nOR.v <- OR.se^2\n\nmod_pooled <- miceadds::pool_mi(qhat=OR, u=OR.v)\ntidy.pool_mi(mod_pooled)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"estimate\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"std.error\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"statistic\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"p.value\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"conf.low\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"conf.high\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"miss\"],\"name\":[7],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"term\"],\"name\":[8],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"1.272164\",\"2\":\"0.08386552\",\"3\":\"15.16909\",\"4\":\"6.987679e-39\",\"5\":\"1.107118\",\"6\":\"1.43721\",\"7\":\"12.2 %\",\"8\":\"1\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nsummary(MIcombine(as.list(OR), as.list(OR.v)))\n#> Multiple imputation results:\n#>       MIcombine.default(as.list(OR), as.list(OR.v))\n#>    results         se   (lower  upper) missInfo\n#> 1 1.272164 0.08386552 1.107118 1.43721     12 %\n```\n:::\n\n\n### Pooled results for sex = 1\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# For sex = 1\nef.lev <- 2\nest <- c(a1$slopes$Est.[ef.lev],\n         a2$slopes$Est.[ef.lev],\n         a3$slopes$Est.[ef.lev],\n         a4$slopes$Est.[ef.lev],\n         a5$slopes$Est.[ef.lev])\nse <- c(a1$slopes$S.E.[ef.lev],\n        a2$slopes$S.E.[ef.lev],\n        a3$slopes$S.E.[ef.lev],\n        a4$slopes$S.E.[ef.lev],\n        a5$slopes$S.E.[ef.lev])\nvr <- se^2\nOR <- exp(est)\nOR.se <- OR * se\nOR.v <- OR.se^2\n\nmod_pooled <- miceadds::pool_mi(qhat=OR, u=OR.v)\ntidy.pool_mi(mod_pooled)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"estimate\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"std.error\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"statistic\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"p.value\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"conf.low\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"conf.high\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"miss\"],\"name\":[7],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"term\"],\"name\":[8],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"1.225598\",\"2\":\"0.07204679\",\"3\":\"17.01113\",\"4\":\"2.282427e-46\",\"5\":\"1.083838\",\"6\":\"1.367357\",\"7\":\"11.9 %\",\"8\":\"1\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nsummary(MIcombine(as.list(OR), as.list(OR.v)))\n#> Multiple imputation results:\n#>       MIcombine.default(as.list(OR), as.list(OR.v))\n#>    results         se   (lower   upper) missInfo\n#> 1 1.225598 0.07204679 1.083838 1.367357     12 %\n```\n:::\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}