{
  "hash": "666d21669652f175cd577df97038d401",
  "result": {
    "engine": "knitr",
    "markdown": "## Poisson {.unnumbered}\n\nIn this tutorial, we will see how to use Poisson and negative binomial regression. In practice, we use Poisson regression to model a count outcome. Note that we assume the mean is equal to the variance in Poisson. When the variance is greater than what's assumed by the model, overdispersion occurs. Poisson regression of overdispersed data leads to under-estimated or deflated standard errors, which leads to inflated test statistics and p-values. We can use negative binomial regression to model overdispersed data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load required packages\nknitr::opts_chunk$set(echo = TRUE)\nrequire(Publish)\nrequire(survey)\n```\n:::\n\n\n### Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load\nload(\"Data/nonbinary/OAcvd.RData\")\n\n# Survey weight\nanalytic2$weight <- analytic2$weight/3\n\n# Make fruit.cont as a numeric variable\nanalytic2$fruit.cont <- as.numeric(as.character(analytic2$fruit.cont))\n\n# Make fruit.cont as a integer/count variable\nanalytic2$fruit.cont <- floor(analytic2$fruit.cont) # round\n\n# Factor variables using lapply\nvar.names <- c(\"age\", \"sex\", \"income\", \"race\", \"bmicat\", \"phyact\", \"smoke\",\n               \"fruit\", \"painmed\", \"ht\", \"copd\", \"diab\", \"edu\", \"CVD\", \"OA\")\nanalytic2[var.names] <- lapply(analytic2[var.names] , factor)\nstr(analytic2)\n#> 'data.frame':\t21623 obs. of  17 variables:\n#>  $ CVD       : Factor w/ 2 levels \"0 event\",\"event\": 1 1 1 1 1 1 1 1 1 1 ...\n#>  $ age       : Factor w/ 4 levels \"20-39 years\",..: 2 3 4 1 3 1 3 1 3 3 ...\n#>  $ sex       : Factor w/ 2 levels \"Female\",\"Male\": 2 1 1 1 2 1 2 1 1 2 ...\n#>  $ income    : Factor w/ 4 levels \"$29,999 or less\",..: 3 4 1 2 1 2 2 3 3 4 ...\n#>  $ race      : Factor w/ 2 levels \"Non-white\",\"White\": 2 2 2 2 2 2 2 2 2 2 ...\n#>  $ bmicat    : Factor w/ 3 levels \"Normal\",\"Overweight\",..: 1 1 2 2 2 1 2 1 2 2 ...\n#>  $ phyact    : Factor w/ 3 levels \"Active\",\"Inactive\",..: 3 1 1 2 1 3 2 3 2 3 ...\n#>  $ smoke     : Factor w/ 3 levels \"Current smoker\",..: 2 3 3 2 2 2 2 2 3 2 ...\n#>  $ fruit     : Factor w/ 3 levels \"0-3 daily serving\",..: 2 2 3 2 1 3 1 3 2 2 ...\n#>  $ painmed   : Factor w/ 2 levels \"No\",\"Yes\": 2 2 2 2 2 2 2 2 1 1 ...\n#>  $ ht        : Factor w/ 2 levels \"No\",\"Yes\": 1 1 1 1 1 1 1 1 1 1 ...\n#>  $ copd      : Factor w/ 2 levels \"No\",\"Yes\": 1 1 1 1 1 1 1 1 1 1 ...\n#>  $ diab      : Factor w/ 2 levels \"No\",\"Yes\": 1 1 1 1 1 1 1 1 1 1 ...\n#>  $ edu       : Factor w/ 4 levels \"< 2ndary\",\"2nd grad.\",..: 2 2 1 4 4 4 1 4 4 1 ...\n#>  $ weight    : num  4.8 13.29 4.43 11.1 9.61 ...\n#>  $ OA        : Factor w/ 2 levels \"Control\",\"OA\": 2 1 2 1 1 1 2 1 1 1 ...\n#>  $ fruit.cont: num  3 4 8 3 2 10 1 8 5 3 ...\n#>  - attr(*, \"na.action\")= 'omit' Named int [1:219757] 1 2 3 4 5 6 7 8 9 10 ...\n#>   ..- attr(*, \"names\")= chr [1:219757] \"3\" \"5\" \"7\" \"9\" ...\n```\n:::\n\n\n### Survey weighted summary\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Survey design\nw.design <- svydesign(id=~1, weights=~weight, data=analytic2)\n\n# Cross-tabulation\nxtabs(~fruit.cont, analytic2)\n#> fruit.cont\n#>    0    1    2    3    4    5    6    7    8    9   10   11   12   13   14   15 \n#>  407 1628 3304 4261 3759 2887 1980 1288  809  480  303  174  109   80   51   25 \n#>   16   17   18   19   20   21   22   23   24   25   26   27   29   42 \n#>   21   14    9    4    5    4    2    6    7    1    2    1    1    1\nsvytable(~fruit.cont, w.design)\n#> fruit.cont\n#>            0            1            2            3            4            5 \n#>   9085.00222  39974.10444  88216.88222 119206.45778 108665.00556  82149.23111 \n#>            6            7            8            9           10           11 \n#>  53791.70444  35463.49111  22593.73000  13023.83556   8878.24778   4520.85000 \n#>           12           13           14           15           16           17 \n#>   3476.42667   2210.76000   1911.70556    973.93444    571.37667    414.44444 \n#>           18           19           20           21           22           23 \n#>    270.82556     77.76222    253.13000     24.74778     34.17444    185.70778 \n#>           24           25           26           27           29           42 \n#>    154.67778    109.88444    149.81222     89.61444     14.91111     93.76889\nsvyhist(~fruit.cont, w.design)\n```\n\n::: {.cell-output-display}\n![](nonbinary3_files/figure-html/summary-1.png){width=672}\n:::\n\n```{.r .cell-code}\nsvyby(~fruit.cont, ~phyact, w.design, svymean, deff = TRUE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"phyact\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"fruit.cont\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"se\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"DEff.fruit.cont\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Active\",\"2\":\"5.123848\",\"3\":\"0.06310984\",\"4\":\"2.709145\",\"_rn_\":\"Active\"},{\"1\":\"Inactive\",\"2\":\"3.945868\",\"3\":\"0.03699451\",\"4\":\"2.394506\",\"_rn_\":\"Inactive\"},{\"1\":\"Moderate\",\"2\":\"4.468549\",\"3\":\"0.05297366\",\"4\":\"2.442263\",\"_rn_\":\"Moderate\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n### Poisson regression\n\nLet us fit the traditional (not design-adjusted) Poisson regression using the `glm` function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(jtools)\nanalytic2$phyact2=relevel(analytic2$phyact, ref =\"Inactive\")\n\n# Poisson regression - crude\nfit1 <- glm(fruit.cont ~phyact2, data=analytic2, family=poisson)\nsumm(fit1, confint = TRUE, digits = 3)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Observations </td>\n   <td style=\"text-align:right;\"> 21623 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Dependent variable </td>\n   <td style=\"text-align:right;\"> fruit.cont </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Type </td>\n   <td style=\"text-align:right;\"> Generalized linear model </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Family </td>\n   <td style=\"text-align:right;\"> poisson </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Link </td>\n   <td style=\"text-align:right;\"> log </td>\n  </tr>\n</tbody>\n</table> <table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> χ²(2) </td>\n   <td style=\"text-align:right;\"> 1219.347 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Pseudo-R² (Cragg-Uhler) </td>\n   <td style=\"text-align:right;\"> 0.055 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Pseudo-R² (McFadden) </td>\n   <td style=\"text-align:right;\"> 0.012 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> AIC </td>\n   <td style=\"text-align:right;\"> 98570.197 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> BIC </td>\n   <td style=\"text-align:right;\"> 98594.142 </td>\n  </tr>\n</tbody>\n</table> <table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> Est. </th>\n   <th style=\"text-align:right;\"> 2.5% </th>\n   <th style=\"text-align:right;\"> 97.5% </th>\n   <th style=\"text-align:right;\"> z val. </th>\n   <th style=\"text-align:right;\"> p </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 1.337 </td>\n   <td style=\"text-align:right;\"> 1.328 </td>\n   <td style=\"text-align:right;\"> 1.347 </td>\n   <td style=\"text-align:right;\"> 267.387 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> phyact2Active </td>\n   <td style=\"text-align:right;\"> 0.274 </td>\n   <td style=\"text-align:right;\"> 0.259 </td>\n   <td style=\"text-align:right;\"> 0.289 </td>\n   <td style=\"text-align:right;\"> 34.983 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> phyact2Moderate </td>\n   <td style=\"text-align:right;\"> 0.136 </td>\n   <td style=\"text-align:right;\"> 0.120 </td>\n   <td style=\"text-align:right;\"> 0.152 </td>\n   <td style=\"text-align:right;\"> 16.741 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n  </tr>\n</tbody>\n<tfoot><tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> Standard errors: MLE</td></tr></tfoot>\n</table>\n`````\n:::\n\n```{.r .cell-code}\n\n# Poisson regression - adjusted for covariates\nfit2 <- glm(fruit.cont ~ phyact2 + age + sex + \n               income + race + bmicat + \n               smoke + edu, data=analytic2, family=poisson)\nsumm(fit2, confint = TRUE, digits = 3, vifs = TRUE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Observations </td>\n   <td style=\"text-align:right;\"> 21623 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Dependent variable </td>\n   <td style=\"text-align:right;\"> fruit.cont </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Type </td>\n   <td style=\"text-align:right;\"> Generalized linear model </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Family </td>\n   <td style=\"text-align:right;\"> poisson </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Link </td>\n   <td style=\"text-align:right;\"> log </td>\n  </tr>\n</tbody>\n</table> <table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> χ²(17) </td>\n   <td style=\"text-align:right;\"> 2984.005 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Pseudo-R² (Cragg-Uhler) </td>\n   <td style=\"text-align:right;\"> 0.130 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Pseudo-R² (McFadden) </td>\n   <td style=\"text-align:right;\"> 0.030 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> AIC </td>\n   <td style=\"text-align:right;\"> 96835.540 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> BIC </td>\n   <td style=\"text-align:right;\"> 96979.207 </td>\n  </tr>\n</tbody>\n</table> <table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> Est. </th>\n   <th style=\"text-align:right;\"> 2.5% </th>\n   <th style=\"text-align:right;\"> 97.5% </th>\n   <th style=\"text-align:right;\"> z val. </th>\n   <th style=\"text-align:right;\"> p </th>\n   <th style=\"text-align:right;\"> VIF </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 1.156 </td>\n   <td style=\"text-align:right;\"> 1.123 </td>\n   <td style=\"text-align:right;\"> 1.189 </td>\n   <td style=\"text-align:right;\"> 68.773 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> phyact2Active </td>\n   <td style=\"text-align:right;\"> 0.250 </td>\n   <td style=\"text-align:right;\"> 0.235 </td>\n   <td style=\"text-align:right;\"> 0.266 </td>\n   <td style=\"text-align:right;\"> 31.432 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> 1.040 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> phyact2Moderate </td>\n   <td style=\"text-align:right;\"> 0.112 </td>\n   <td style=\"text-align:right;\"> 0.095 </td>\n   <td style=\"text-align:right;\"> 0.128 </td>\n   <td style=\"text-align:right;\"> 13.640 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> 1.040 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> age40-49 years </td>\n   <td style=\"text-align:right;\"> 0.027 </td>\n   <td style=\"text-align:right;\"> 0.010 </td>\n   <td style=\"text-align:right;\"> 0.043 </td>\n   <td style=\"text-align:right;\"> 3.196 </td>\n   <td style=\"text-align:right;\"> 0.001 </td>\n   <td style=\"text-align:right;\"> 1.102 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> age50-59 years </td>\n   <td style=\"text-align:right;\"> 0.083 </td>\n   <td style=\"text-align:right;\"> 0.066 </td>\n   <td style=\"text-align:right;\"> 0.100 </td>\n   <td style=\"text-align:right;\"> 9.400 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> 1.102 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> age60-64 years </td>\n   <td style=\"text-align:right;\"> 0.127 </td>\n   <td style=\"text-align:right;\"> 0.103 </td>\n   <td style=\"text-align:right;\"> 0.151 </td>\n   <td style=\"text-align:right;\"> 10.287 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> 1.102 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> sexMale </td>\n   <td style=\"text-align:right;\"> -0.173 </td>\n   <td style=\"text-align:right;\"> -0.187 </td>\n   <td style=\"text-align:right;\"> -0.160 </td>\n   <td style=\"text-align:right;\"> -25.108 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> 1.082 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> income$30,000-$49,999 </td>\n   <td style=\"text-align:right;\"> 0.039 </td>\n   <td style=\"text-align:right;\"> 0.017 </td>\n   <td style=\"text-align:right;\"> 0.060 </td>\n   <td style=\"text-align:right;\"> 3.557 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> 1.144 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> income$50,000-$79,999 </td>\n   <td style=\"text-align:right;\"> 0.050 </td>\n   <td style=\"text-align:right;\"> 0.030 </td>\n   <td style=\"text-align:right;\"> 0.070 </td>\n   <td style=\"text-align:right;\"> 4.923 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> 1.144 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> income$80,000 or more </td>\n   <td style=\"text-align:right;\"> 0.083 </td>\n   <td style=\"text-align:right;\"> 0.062 </td>\n   <td style=\"text-align:right;\"> 0.103 </td>\n   <td style=\"text-align:right;\"> 7.964 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> 1.144 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> raceWhite </td>\n   <td style=\"text-align:right;\"> -0.003 </td>\n   <td style=\"text-align:right;\"> -0.024 </td>\n   <td style=\"text-align:right;\"> 0.018 </td>\n   <td style=\"text-align:right;\"> -0.240 </td>\n   <td style=\"text-align:right;\"> 0.811 </td>\n   <td style=\"text-align:right;\"> 1.077 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> bmicatOverweight </td>\n   <td style=\"text-align:right;\"> -0.021 </td>\n   <td style=\"text-align:right;\"> -0.035 </td>\n   <td style=\"text-align:right;\"> -0.008 </td>\n   <td style=\"text-align:right;\"> -3.054 </td>\n   <td style=\"text-align:right;\"> 0.002 </td>\n   <td style=\"text-align:right;\"> 1.096 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> bmicatUnderweight </td>\n   <td style=\"text-align:right;\"> -0.001 </td>\n   <td style=\"text-align:right;\"> -0.034 </td>\n   <td style=\"text-align:right;\"> 0.033 </td>\n   <td style=\"text-align:right;\"> -0.030 </td>\n   <td style=\"text-align:right;\"> 0.976 </td>\n   <td style=\"text-align:right;\"> 1.096 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> smokeFormer smoker </td>\n   <td style=\"text-align:right;\"> 0.131 </td>\n   <td style=\"text-align:right;\"> 0.114 </td>\n   <td style=\"text-align:right;\"> 0.148 </td>\n   <td style=\"text-align:right;\"> 15.050 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> 1.132 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> smokeNever smoker </td>\n   <td style=\"text-align:right;\"> 0.181 </td>\n   <td style=\"text-align:right;\"> 0.163 </td>\n   <td style=\"text-align:right;\"> 0.199 </td>\n   <td style=\"text-align:right;\"> 19.436 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> 1.132 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> edu2nd grad. </td>\n   <td style=\"text-align:right;\"> 0.040 </td>\n   <td style=\"text-align:right;\"> 0.016 </td>\n   <td style=\"text-align:right;\"> 0.064 </td>\n   <td style=\"text-align:right;\"> 3.291 </td>\n   <td style=\"text-align:right;\"> 0.001 </td>\n   <td style=\"text-align:right;\"> 1.125 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> eduOther 2nd grad. </td>\n   <td style=\"text-align:right;\"> 0.051 </td>\n   <td style=\"text-align:right;\"> 0.020 </td>\n   <td style=\"text-align:right;\"> 0.083 </td>\n   <td style=\"text-align:right;\"> 3.201 </td>\n   <td style=\"text-align:right;\"> 0.001 </td>\n   <td style=\"text-align:right;\"> 1.125 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> eduPost-2nd grad. </td>\n   <td style=\"text-align:right;\"> 0.122 </td>\n   <td style=\"text-align:right;\"> 0.101 </td>\n   <td style=\"text-align:right;\"> 0.144 </td>\n   <td style=\"text-align:right;\"> 11.219 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> 1.125 </td>\n  </tr>\n</tbody>\n<tfoot><tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> Standard errors: MLE</td></tr></tfoot>\n</table>\n`````\n:::\n:::\n\n\n### Survey weighted Poisson regression\n\nNow, let's fit the design-adjusted Poisson regression using the `svyglm` function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(jtools)\n# Design\nw.design <- update (w.design , phyact2=relevel(phyact, ref =\"Inactive\"))\n\n# Design-adjusted Poisson - crude\nfit1 <- svyglm(fruit.cont ~phyact2, design=w.design, family=poisson)\nsumm(fit1, confint = TRUE, digits = 3)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Observations </td>\n   <td style=\"text-align:right;\"> 21623 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Dependent variable </td>\n   <td style=\"text-align:right;\"> fruit.cont </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Type </td>\n   <td style=\"text-align:right;\"> Survey-weighted generalized linear model </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Family </td>\n   <td style=\"text-align:right;\"> poisson </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Link </td>\n   <td style=\"text-align:right;\"> log </td>\n  </tr>\n</tbody>\n</table> <table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Pseudo-R² (Cragg-Uhler) </td>\n   <td style=\"text-align:right;\"> 0.064 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Pseudo-R² (McFadden) </td>\n   <td style=\"text-align:right;\"> 0.035 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> AIC </td>\n   <td style=\"text-align:right;\"> 99087.436 </td>\n  </tr>\n</tbody>\n</table> <table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> Est. </th>\n   <th style=\"text-align:right;\"> 2.5% </th>\n   <th style=\"text-align:right;\"> 97.5% </th>\n   <th style=\"text-align:right;\"> t val. </th>\n   <th style=\"text-align:right;\"> p </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 1.373 </td>\n   <td style=\"text-align:right;\"> 1.354 </td>\n   <td style=\"text-align:right;\"> 1.391 </td>\n   <td style=\"text-align:right;\"> 146.410 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> phyact2Active </td>\n   <td style=\"text-align:right;\"> 0.261 </td>\n   <td style=\"text-align:right;\"> 0.231 </td>\n   <td style=\"text-align:right;\"> 0.292 </td>\n   <td style=\"text-align:right;\"> 16.877 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> phyact2Moderate </td>\n   <td style=\"text-align:right;\"> 0.124 </td>\n   <td style=\"text-align:right;\"> 0.095 </td>\n   <td style=\"text-align:right;\"> 0.154 </td>\n   <td style=\"text-align:right;\"> 8.230 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n  </tr>\n</tbody>\n<tfoot><tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> Standard errors: Robust</td></tr></tfoot>\n</table>\n`````\n:::\n\n```{.r .cell-code}\n\n# Design-adjusted Poisson - adjusted for covariates\nfit2<-svyglm(fruit.cont ~phyact2 + age + sex + \n               income + race + bmicat + \n               smoke + edu, design=w.design, family=poisson)\nsumm(fit2, confint = TRUE, digits = 3, vifs = TRUE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Observations </td>\n   <td style=\"text-align:right;\"> 21623 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Dependent variable </td>\n   <td style=\"text-align:right;\"> fruit.cont </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Type </td>\n   <td style=\"text-align:right;\"> Survey-weighted generalized linear model </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Family </td>\n   <td style=\"text-align:right;\"> poisson </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Link </td>\n   <td style=\"text-align:right;\"> log </td>\n  </tr>\n</tbody>\n</table> <table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Pseudo-R² (Cragg-Uhler) </td>\n   <td style=\"text-align:right;\"> 0.137 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Pseudo-R² (McFadden) </td>\n   <td style=\"text-align:right;\"> 0.076 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> AIC </td>\n   <td style=\"text-align:right;\"> 97795.011 </td>\n  </tr>\n</tbody>\n</table> <table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> Est. </th>\n   <th style=\"text-align:right;\"> 2.5% </th>\n   <th style=\"text-align:right;\"> 97.5% </th>\n   <th style=\"text-align:right;\"> t val. </th>\n   <th style=\"text-align:right;\"> p </th>\n   <th style=\"text-align:right;\"> VIF </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 1.175 </td>\n   <td style=\"text-align:right;\"> 1.113 </td>\n   <td style=\"text-align:right;\"> 1.237 </td>\n   <td style=\"text-align:right;\"> 37.230 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> phyact2Active </td>\n   <td style=\"text-align:right;\"> 0.241 </td>\n   <td style=\"text-align:right;\"> 0.210 </td>\n   <td style=\"text-align:right;\"> 0.272 </td>\n   <td style=\"text-align:right;\"> 15.211 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> 1.346 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> phyact2Moderate </td>\n   <td style=\"text-align:right;\"> 0.105 </td>\n   <td style=\"text-align:right;\"> 0.074 </td>\n   <td style=\"text-align:right;\"> 0.135 </td>\n   <td style=\"text-align:right;\"> 6.775 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> 1.346 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> age40-49 years </td>\n   <td style=\"text-align:right;\"> 0.041 </td>\n   <td style=\"text-align:right;\"> 0.010 </td>\n   <td style=\"text-align:right;\"> 0.071 </td>\n   <td style=\"text-align:right;\"> 2.623 </td>\n   <td style=\"text-align:right;\"> 0.009 </td>\n   <td style=\"text-align:right;\"> 1.447 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> age50-59 years </td>\n   <td style=\"text-align:right;\"> 0.102 </td>\n   <td style=\"text-align:right;\"> 0.071 </td>\n   <td style=\"text-align:right;\"> 0.133 </td>\n   <td style=\"text-align:right;\"> 6.402 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> 1.447 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> age60-64 years </td>\n   <td style=\"text-align:right;\"> 0.149 </td>\n   <td style=\"text-align:right;\"> 0.096 </td>\n   <td style=\"text-align:right;\"> 0.203 </td>\n   <td style=\"text-align:right;\"> 5.461 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> 1.447 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> sexMale </td>\n   <td style=\"text-align:right;\"> -0.136 </td>\n   <td style=\"text-align:right;\"> -0.161 </td>\n   <td style=\"text-align:right;\"> -0.111 </td>\n   <td style=\"text-align:right;\"> -10.500 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> 1.148 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> income$30,000-$49,999 </td>\n   <td style=\"text-align:right;\"> 0.025 </td>\n   <td style=\"text-align:right;\"> -0.015 </td>\n   <td style=\"text-align:right;\"> 0.066 </td>\n   <td style=\"text-align:right;\"> 1.217 </td>\n   <td style=\"text-align:right;\"> 0.224 </td>\n   <td style=\"text-align:right;\"> 1.294 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> income$50,000-$79,999 </td>\n   <td style=\"text-align:right;\"> 0.031 </td>\n   <td style=\"text-align:right;\"> -0.008 </td>\n   <td style=\"text-align:right;\"> 0.070 </td>\n   <td style=\"text-align:right;\"> 1.559 </td>\n   <td style=\"text-align:right;\"> 0.119 </td>\n   <td style=\"text-align:right;\"> 1.294 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> income$80,000 or more </td>\n   <td style=\"text-align:right;\"> 0.057 </td>\n   <td style=\"text-align:right;\"> 0.018 </td>\n   <td style=\"text-align:right;\"> 0.096 </td>\n   <td style=\"text-align:right;\"> 2.874 </td>\n   <td style=\"text-align:right;\"> 0.004 </td>\n   <td style=\"text-align:right;\"> 1.294 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> raceWhite </td>\n   <td style=\"text-align:right;\"> 0.023 </td>\n   <td style=\"text-align:right;\"> -0.012 </td>\n   <td style=\"text-align:right;\"> 0.059 </td>\n   <td style=\"text-align:right;\"> 1.289 </td>\n   <td style=\"text-align:right;\"> 0.197 </td>\n   <td style=\"text-align:right;\"> 1.193 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> bmicatOverweight </td>\n   <td style=\"text-align:right;\"> -0.009 </td>\n   <td style=\"text-align:right;\"> -0.035 </td>\n   <td style=\"text-align:right;\"> 0.017 </td>\n   <td style=\"text-align:right;\"> -0.708 </td>\n   <td style=\"text-align:right;\"> 0.479 </td>\n   <td style=\"text-align:right;\"> 1.331 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> bmicatUnderweight </td>\n   <td style=\"text-align:right;\"> 0.029 </td>\n   <td style=\"text-align:right;\"> -0.033 </td>\n   <td style=\"text-align:right;\"> 0.091 </td>\n   <td style=\"text-align:right;\"> 0.928 </td>\n   <td style=\"text-align:right;\"> 0.353 </td>\n   <td style=\"text-align:right;\"> 1.331 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> smokeFormer smoker </td>\n   <td style=\"text-align:right;\"> 0.094 </td>\n   <td style=\"text-align:right;\"> 0.059 </td>\n   <td style=\"text-align:right;\"> 0.128 </td>\n   <td style=\"text-align:right;\"> 5.352 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> 1.474 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> smokeNever smoker </td>\n   <td style=\"text-align:right;\"> 0.140 </td>\n   <td style=\"text-align:right;\"> 0.102 </td>\n   <td style=\"text-align:right;\"> 0.177 </td>\n   <td style=\"text-align:right;\"> 7.290 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> 1.474 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> edu2nd grad. </td>\n   <td style=\"text-align:right;\"> 0.026 </td>\n   <td style=\"text-align:right;\"> -0.020 </td>\n   <td style=\"text-align:right;\"> 0.072 </td>\n   <td style=\"text-align:right;\"> 1.093 </td>\n   <td style=\"text-align:right;\"> 0.274 </td>\n   <td style=\"text-align:right;\"> 1.302 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> eduOther 2nd grad. </td>\n   <td style=\"text-align:right;\"> 0.033 </td>\n   <td style=\"text-align:right;\"> -0.024 </td>\n   <td style=\"text-align:right;\"> 0.090 </td>\n   <td style=\"text-align:right;\"> 1.136 </td>\n   <td style=\"text-align:right;\"> 0.256 </td>\n   <td style=\"text-align:right;\"> 1.302 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> eduPost-2nd grad. </td>\n   <td style=\"text-align:right;\"> 0.129 </td>\n   <td style=\"text-align:right;\"> 0.085 </td>\n   <td style=\"text-align:right;\"> 0.173 </td>\n   <td style=\"text-align:right;\"> 5.807 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> 1.302 </td>\n  </tr>\n</tbody>\n<tfoot><tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> Standard errors: Robust</td></tr></tfoot>\n</table>\n`````\n:::\n:::\n\n\n### Negative binomial regression\n\nLet's fit the negative binomial regression model using the `glm` function. Below, we specify the dispersion parameter (theta) is equal to 1, which suggests that the ratio of mean and variance is assumed to be 1.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(MASS)\nanalytic2$phyact2=relevel(analytic2$phyact, ref =\"Inactive\")\n\n# Negative binomial regression - crude\nfit3<- glm(fruit.cont ~ phyact2, data=analytic2, family = negative.binomial(theta = 1))\nround(exp(cbind(coef(fit3), confint(fit3))),2)\n#> Waiting for profiling to be done...\n#>                      2.5 % 97.5 %\n#> (Intercept)     3.81  3.76   3.85\n#> phyact2Active   1.32  1.29   1.34\n#> phyact2Moderate 1.15  1.12   1.17\n\n# Negative binomial regression - adjusted for covariates\nfit4<-glm(fruit.cont ~phyact2 + age + sex + income + race + bmicat + smoke + edu, data=analytic2,\n          family = negative.binomial(theta = 1))\nround(exp(cbind(coef(fit4), confint(fit4))),2)\n#> Waiting for profiling to be done...\n#>                            2.5 % 97.5 %\n#> (Intercept)           3.17  3.05   3.30\n#> phyact2Active         1.29  1.26   1.31\n#> phyact2Moderate       1.12  1.10   1.14\n#> age40-49 years        1.03  1.01   1.05\n#> age50-59 years        1.08  1.06   1.11\n#> age60-64 years        1.14  1.10   1.17\n#> sexMale               0.84  0.83   0.86\n#> income$30,000-$49,999 1.05  1.02   1.07\n#> income$50,000-$79,999 1.06  1.03   1.08\n#> income$80,000 or more 1.09  1.07   1.12\n#> raceWhite             0.99  0.97   1.02\n#> bmicatOverweight      0.98  0.96   1.00\n#> bmicatUnderweight     0.99  0.95   1.04\n#> smokeFormer smoker    1.14  1.12   1.16\n#> smokeNever smoker     1.20  1.17   1.23\n#> edu2nd grad.          1.04  1.01   1.07\n#> eduOther 2nd grad.    1.05  1.01   1.09\n#> eduPost-2nd grad.     1.13  1.10   1.16\n```\n:::\n\n\n### Survey weighted negative binomial regression\n\nNow, let's fit the design-adjusted negative binomial regression model:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(sjstats)\n\n# Design-adjusted negative binomial - crude\nfit3<- svyglm.nb(fruit.cont ~phyact2, design=w.design)\nround(exp(cbind(coef(fit3), confint(fit3))),2)\n#>                                2.5 %    97.5 %\n#> theta.(Intercept)   28859.40 5797.98 143647.38\n#> eta.(Intercept)         3.95    3.87      4.02\n#> eta.phyact2Active       1.30    1.26      1.34\n#> eta.phyact2Moderate     1.13    1.10      1.17\n\n# Design-adjusted negative binomial - adjusted for covariates\nfit4<-svyglm.nb(fruit.cont ~phyact2 + age + sex + income + race + bmicat + smoke + edu, \n                design=w.design)\nround(exp(cbind(coef(fit4), confint(fit4))),2)\n#>                                        2.5 %     97.5 %\n#> theta.(Intercept)         132340.69 15727.49 1113594.94\n#> eta.(Intercept)                3.24     3.04       3.44\n#> eta.phyact2Active              1.27     1.23       1.31\n#> eta.phyact2Moderate            1.11     1.08       1.14\n#> eta.age40-49 years             1.04     1.01       1.07\n#> eta.age50-59 years             1.11     1.07       1.14\n#> eta.age60-64 years             1.16     1.10       1.22\n#> eta.sexMale                    0.87     0.85       0.90\n#> eta.income$30,000-$49,999      1.03     0.99       1.07\n#> eta.income$50,000-$79,999      1.03     0.99       1.07\n#> eta.income$80,000 or more      1.06     1.02       1.10\n#> eta.raceWhite                  1.02     0.99       1.06\n#> eta.bmicatOverweight           0.99     0.97       1.02\n#> eta.bmicatUnderweight          1.03     0.97       1.09\n#> eta.smokeFormer smoker         1.10     1.06       1.14\n#> eta.smokeNever smoker          1.15     1.11       1.19\n#> eta.edu2nd grad.               1.03     0.98       1.07\n#> eta.eduOther 2nd grad.         1.03     0.98       1.09\n#> eta.eduPost-2nd grad.          1.14     1.09       1.19\n```\n:::\n\n\n### Video content (optional)\n\n::: callout-tip\nFor those who prefer a video walkthrough, feel free to watch the video below, which offers a description of an earlier version of the above content.\n:::\n\n::: {style=\"position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;\"}\n<iframe src=\"https://www.youtube.com/embed/p2r8N7tcXU8\" style=\"position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;\" allowfullscreen>\n\n</iframe>\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}