{
  "hash": "e38652c3c93e012ea210aa141846e1b6",
  "result": {
    "markdown": "## Collapsibility {.unnumbered}\n\nLet us assume we have a regression of hypertension ($Y$), smoking ($A$) and a risk factor for outcome, gender ($L$). Then let us set up 2 regression models:\n\n-   1st regression model is $Y \\sim \\beta \\times A + \\alpha \\times L$. Here we are conditioning on gender ($L$).\n-   2nd regression model is $Y \\sim \\beta' \\times A$\n\nThen regression is collapsible for $\\beta$ over $L$ if $\\beta = \\beta'$ from the 2nd regression omitting $L$. $\\beta \\ne \\beta'$ would mean non-collapsibility. A measure of association (say, risk difference) is collapsible if the marginal measure of association is equal to a weighted average of the stratum-specific measures of association. Non-collapsibility is also knows as Simpson's Paradox (in absence of confounding of course): a statistical phenomenon where an association between two factors (say, hypertension and smoking) in a population (we are talking about marginal estimate here) is different than the associations of same relationship in subpopulations (conditional on some other factor, say, age; hence talking about conditional estimates). Risk ratio and risk difference are collapsible.\n\nOdds ratio can be non-collapsible. It can produce different treatment effect estimate for different covariate adjustment sets (see example below of when adjusting form age and sex vs. when adjusting none). This is true even in the absence of confounding. However, according to our definition here, OR is collapsible when we consider gender in the adjustment set.\n\nNote that, OR non-collapsibility is a consequence of the fact that it is estimated via a logit link function (nonlinearity of the logistic transformation).\n\nRef:\n\n-   [@greenland1999confounding]\n-   [@mansournia2015relation]\n\n\n\n\n::: {.cell hash='confounding5_cache/pdf/setup_9dd851f678cb185d17b610ff91ab5ae1'}\n\n```{.r .cell-code}\n# Load required packages\nlibrary(simcausal)\nlibrary(tableone)\nlibrary(Publish)\nlibrary(lawstat)\n```\n:::\n\n\n\n### Data generating process\n\nLet us generate the data with smoking being the exposure and hypertension being the outcome. \n\n\n\n::: {.cell hash='confounding5_cache/pdf/dgm5_5503fe71a88e12b7723e5d530345827c'}\n\n```{.r .cell-code}\nrequire(simcausal)\nD <- DAG.empty()\nD <- D + \n  node(\"gender\", distr = \"rbern\", prob = 0.7) +\n  node(\"age\", distr = \"rnorm\", mean = 2, sd = 4) +\n  node(\"smoking\", distr = \"rbern\", prob = plogis(.1)) +\n  node(\"hypertension\", distr = \"rbern\", \n       prob = plogis(1 + log(3.5) * smoking + log(.1) * gender + log(7) * age))\nDset <- set.DAG(D)\n```\n:::\n\n\n\n#### Generate DAG\n\n\n\n::: {.cell hash='confounding5_cache/pdf/dag5_ae1860f066aac053d924846a443778d5'}\n\n```{.r .cell-code}\nplotDAG(Dset, xjitter = 0.1, yjitter = .9,\n        edge_attrs = list(width = 0.5, arrow.width = 0.4, arrow.size = 0.7),\n        vertex_attrs = list(size = 12, label.cex = 0.8))\n```\n\n::: {.cell-output-display}\n![](confounding5_files/figure-pdf/dag5-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n#### Generate Data\n\n\n\n::: {.cell hash='confounding5_cache/pdf/data5_f04c2287fa38ec19fc62a69aa5070f2e'}\n\n```{.r .cell-code}\nObs.Data <- sim(DAG = Dset, n = 100000, rndseed = 123)\nhead(Obs.Data)\n#>   ID gender        age smoking hypertension\n#> 1  1      1  3.0383589       0            1\n#> 2  2      0  5.6700429       1            1\n#> 3  3      1 -0.8892734       0            0\n#> 4  4      0 -1.2331361       1            1\n#> 5  5      0  1.4345919       0            1\n#> 6  6      1 11.0280538       1            1\n```\n:::\n\n\n\n#### Balance check\n\n\n\n::: {.cell hash='confounding5_cache/pdf/balance5_fd963ab3eef2257698d95f272af5e62c'}\n\n```{.r .cell-code}\nrequire(tableone)\nCreateTableOne(data = Obs.Data, strata = \"smoking\", vars = c(\"gender\", \"age\"))\n#>                     Stratified by smoking\n#>                      0            1            p      test\n#>   n                  47720        52280                   \n#>   gender (mean (SD))  0.70 (0.46)  0.70 (0.46)  0.403     \n#>   age (mean (SD))     2.02 (4.02)  2.01 (4.00)  0.690\n```\n:::\n\n\n\n### Conditional and crude risk difference (RD)\n\nSince RD is a collapsible measure, the marginal and conditional estimate should be approximately the same.\n\n#### Full list of risk factors for outcome (2 variables)\n\n\n\n::: {.cell hash='confounding5_cache/pdf/rd5_9d1e3175831b611430ae5ca3615c4bfb'}\n\n```{.r .cell-code}\n## RD\nrequire(Publish)\nfitx0 <- glm(hypertension ~ smoking + gender + age, \n             family=gaussian(link = \"identity\"), data=Obs.Data)\npublish(fitx0, print = FALSE, confint.method = \"robust\", \n        pvalue.method = \"robust\")$regressionTable[2,]\n#>   Variable Units Coefficient       CI.95 p-value\n#> 2  smoking              0.06 [0.05;0.06] < 1e-04\n```\n:::\n\n\n\nRef:\n\n-   [@naimi2020estimating] (\"For the risk difference, one may use a GLM with a Gaussian (i.e., normal) distribution and identity link function, or, equivalently, an ordinary least squares estimator ...robust variance estimator (or bootstrap) should be used to obtain valid standard errors.\")\n\n#### Strtatum specific (2 variables)\n\n\n\n::: {.cell hash='confounding5_cache/pdf/eststrata_8b11a488044e91e51501cff5177d476f'}\n\n```{.r .cell-code}\nfitx1 <- glm(hypertension ~ smoking, family=gaussian(link = \"identity\"), \n             data=subset(Obs.Data, gender == 1 & age < 2))\npublish(fitx1, print = FALSE, confint.method = \"robust\", \n        pvalue.method = \"robust\")$regressionTable[2,]\n#>   Variable Units Coefficient       CI.95 p-value\n#> 2  smoking              0.11 [0.10;0.12] < 1e-04\n\nfitx2 <- glm(hypertension ~ smoking, family=gaussian(link = \"identity\"), \n             data=subset(Obs.Data, gender == 0 & age < 2))\npublish(fitx2, print = FALSE, confint.method = \"robust\", \n        pvalue.method = \"robust\")$regressionTable[2,]\n#>   Variable Units Coefficient       CI.95 p-value\n#> 2  smoking              0.10 [0.08;0.12] < 1e-04\n\nfitx3 <- glm(hypertension ~ smoking, family=gaussian(link = \"identity\"), \n             data=subset(Obs.Data, gender == 1 & age >= 2))\npublish(fitx3, print = FALSE, confint.method = \"robust\", \n        pvalue.method = \"robust\")$regressionTable[2,]\n#>   Variable Units Coefficient       CI.95 p-value\n#> 2  smoking              0.01 [0.00;0.01] < 1e-04\n\nfitx4 <- glm(hypertension ~ smoking, family=gaussian(link = \"identity\"), \n             data=subset(Obs.Data, gender == 0 & age >= 2))\npublish(fitx4, print = FALSE, confint.method = \"robust\", \n        pvalue.method = \"robust\")$regressionTable[2,]\n#>   Variable Units Coefficient        CI.95  p-value\n#> 2  smoking              0.00 [-0.00;0.00]   0.3754\n```\n:::\n\n\n\nUnweighted mean from all strata (for simplicity, 2 variables)\n\n\n\n::: {.cell hash='confounding5_cache/pdf/unwgtmean_3e2ef6da224190c019446b09b3ba83dc'}\n\n```{.r .cell-code}\nround(mean(c(coef(fitx1)[\"smoking\"],\n             coef(fitx2)[\"smoking\"],\n             coef(fitx3)[\"smoking\"],\n             coef(fitx4)[\"smoking\"])),2)\n#> [1] 0.05\n```\n:::\n\n\n\n#### Partial list of risk factors for outcome (1 variable)\n\n\n\n::: {.cell hash='confounding5_cache/pdf/riskfactor_a79974333c6f6cd8738cfbfe1bf14843'}\n\n```{.r .cell-code}\nfitx0 <- glm(hypertension ~ smoking + gender, \n             family=gaussian(link = \"identity\"), data=Obs.Data)\npublish(fitx0, print = FALSE, confint.method = \"robust\", \n        pvalue.method = \"robust\")$regressionTable[2,]\n#>   Variable Units Coefficient       CI.95 p-value\n#> 2  smoking              0.05 [0.05;0.06] < 1e-04\n```\n:::\n\n\n\n#### Strtatum specific (1 variable)\n\n\n\n::: {.cell hash='confounding5_cache/pdf/strata1_286f15e0804c50a7f7a5b936f5a5847d'}\n\n```{.r .cell-code}\nfitx1 <- glm(hypertension ~ smoking, family=gaussian(link = \"identity\"), \n             data=subset(Obs.Data, gender == 1))\npublish(fitx1, print = FALSE, confint.method = \"robust\", \n        pvalue.method = \"robust\")$regressionTable[2,]\n#>   Variable Units Coefficient       CI.95 p-value\n#> 2  smoking              0.06 [0.05;0.07] < 1e-04\n\nfitx2 <- glm(hypertension ~ smoking, family=gaussian(link = \"identity\"), \n             data=subset(Obs.Data, gender == 0))\npublish(fitx2, print = FALSE, confint.method = \"robust\", \n        pvalue.method = \"robust\")$regressionTable[2,]\n#>   Variable Units Coefficient       CI.95 p-value\n#> 2  smoking              0.05 [0.04;0.06] < 1e-04\n```\n:::\n\n\n\nUnweighted mean from all strata (for simplicity, 1 variable)\n\n\n\n::: {.cell hash='confounding5_cache/pdf/wmean_1b67cef9e1c043777a7f48e89b67bff8'}\n\n```{.r .cell-code}\nround(mean(c(coef(fitx1)[\"smoking\"],\n             coef(fitx2)[\"smoking\"])),2)\n#> [1] 0.05\n```\n:::\n\n\n\n#### Crude (in absence of confounding)\n\n\n\n::: {.cell hash='confounding5_cache/pdf/crude_10126c529bd238375ec92ebfe47b532b'}\n\n```{.r .cell-code}\nfitx0 <- glm(hypertension ~ smoking, \n             family=gaussian(link = \"identity\"), data=Obs.Data)\npublish(fitx0, print = FALSE, confint.method = \"robust\", \n        pvalue.method = \"robust\")$regressionTable[2,]\n#>   Variable Units Coefficient       CI.95 p-value\n#> 2  smoking              0.05 [0.05;0.06] < 1e-04\n```\n:::\n\n\n\n### Conditional and crude risk ratio (RR)\n\nRef:\n\n-   [@naimi2020estimating] (\"For the risk ratio, one may use a GLM with a Poisson distribution and log link function .... one should use the robust (or sandwich) variance estimator to obtain valid standard errors (the bootstrap can also be used)\").\n\n#### Full list of risk factors for outcome (2 variables)\n\n\n\n::: {.cell hash='confounding5_cache/pdf/fullrisk_5e91407bcd40849bfb15e09463e62848'}\n\n```{.r .cell-code}\nfitx0 <- glm(hypertension ~ smoking + gender + age, \n             family=poisson(link = \"log\"), data=Obs.Data)\npublish(fitx0, print = FALSE, confint.method = \"robust\", \n        pvalue.method = \"robust\")$regressionTable[1,]\n#>   Variable Units HazardRatio       CI.95 p-value\n#> 1  smoking              1.08 [1.08;1.09] < 1e-04\n```\n:::\n\n\n\nThe estimate we see as a `hazard ratio` is basically a `risk ratio`. \n\n#### Strtatum specific (2 variables)\n\n\n\n::: {.cell hash='confounding5_cache/pdf/strata2_211e28f4f8b1250cb666b40eab73a8b9'}\n\n```{.r .cell-code}\nfitx1 <- glm(hypertension ~ smoking, \n             family=poisson(link = \"log\"), \n             data=subset(Obs.Data, gender == 1 & age < 2))\npublish(fitx1, print = FALSE, confint.method = \"robust\", \n        pvalue.method = \"robust\")$regressionTable[1,]\n#>   Variable Units HazardRatio       CI.95 p-value\n#> 1  smoking              1.41 [1.36;1.45] < 1e-04\n\nfitx2 <- glm(hypertension ~ smoking, \n             family=poisson(link = \"log\"), \n             data=subset(Obs.Data, gender == 0 & age < 2))\npublish(fitx2, print = FALSE, confint.method = \"robust\", \n        pvalue.method = \"robust\")$regressionTable[1,]\n#>   Variable Units HazardRatio       CI.95 p-value\n#> 1  smoking              1.21 [1.17;1.25] < 1e-04\n\nfitx3 <- glm(hypertension ~ smoking, \n             family=poisson(link = \"log\"), \n             data=subset(Obs.Data, gender == 1 & age >= 2))\npublish(fitx3, print = FALSE, confint.method = \"robust\", \n        pvalue.method = \"robust\")$regressionTable[1,]\n#>   Variable Units HazardRatio       CI.95 p-value\n#> 1  smoking              1.01 [1.00;1.01] < 1e-04\n\nfitx4 <- glm(hypertension ~ smoking, \n             family=poisson(link = \"log\"), \n             data=subset(Obs.Data, gender == 0 & age >= 2))\npublish(fitx4, print = FALSE, confint.method = \"robust\", \n        pvalue.method = \"robust\")$regressionTable[1,]\n#>   Variable Units HazardRatio       CI.95  p-value\n#> 1  smoking              1.00 [1.00;1.00]   0.3754\n```\n:::\n\n\n\nUnweighted mean from all strata (for simplicity, 2 variables)\n\n\n\n::: {.cell hash='confounding5_cache/pdf/unwgtmean2_e84c9b1e983ed17690623083823ea574'}\n\n```{.r .cell-code}\nmean(exp(c(coef(fitx1)[\"smoking\"],\n           coef(fitx2)[\"smoking\"],\n           coef(fitx3)[\"smoking\"],\n           coef(fitx4)[\"smoking\"])))\n#> [1] 1.156387\n```\n:::\n\n\n\n#### Partial list of risk factors for outcome (1 variable)\n\n\n\n::: {.cell hash='confounding5_cache/pdf/riskpartial_e21393cb6445a65cd0e6b1d1c21275fc'}\n\n```{.r .cell-code}\nfitx0 <- glm(hypertension ~ smoking + gender, \n             family=poisson(link = \"log\"), data=Obs.Data)\npublish(fitx0, print = FALSE, confint.method = \"robust\", \n        pvalue.method = \"robust\")$regressionTable[1,]\n#>   Variable Units HazardRatio       CI.95 p-value\n#> 1  smoking              1.08 [1.07;1.09] < 1e-04\n```\n:::\n\n\n\n#### Strtatum specific (1 variable)\n\n\n\n::: {.cell hash='confounding5_cache/pdf/strata11_a8742d6625f3755310085c75e7197124'}\n\n```{.r .cell-code}\nfitx1 <- glm(hypertension ~ smoking, \n             family=poisson(link = \"log\"), \n             data=subset(Obs.Data, gender == 1))\npublish(fitx1, print = FALSE, confint.method = \"robust\", \n        pvalue.method = \"robust\")$regressionTable[1,]\n#>   Variable Units HazardRatio       CI.95 p-value\n#> 1  smoking              1.09 [1.08;1.10] < 1e-04\nfitx2 <- glm(hypertension ~ smoking, \n             family=poisson(link = \"log\"), \n             data=subset(Obs.Data, gender == 0))\npublish(fitx2, print = FALSE, confint.method = \"robust\", \n        pvalue.method = \"robust\")$regressionTable[1,]\n#>   Variable Units HazardRatio       CI.95 p-value\n#> 1  smoking              1.06 [1.05;1.08] < 1e-04\n```\n:::\n\n\n\nUnweighted mean from all strata (for simplicity, 1 variable)\n\n\n\n::: {.cell hash='confounding5_cache/pdf/unwgtmean3_88911af21a4c10816ea178a04d929c4a'}\n\n```{.r .cell-code}\nmean(exp(c(coef(fitx1)[\"smoking\"],\n           coef(fitx2)[\"smoking\"])))\n#> [1] 1.077402\n```\n:::\n\n\n\n#### Crude (in absence of confounding)\n\n\n\n::: {.cell hash='confounding5_cache/pdf/crude11_23481b188c91a497992de44f1371ad04'}\n\n```{.r .cell-code}\nfitx0 <- glm(hypertension ~ smoking, \n             family=poisson(link = \"log\"), data=Obs.Data)\npublish(fitx0, print = FALSE, confint.method = \"robust\", \n        pvalue.method = \"robust\")$regressionTable[1,]\n#>   Variable Units HazardRatio       CI.95 p-value\n#> 1  smoking              1.08 [1.07;1.09] < 1e-04\n```\n:::\n\n\n\nSince the marginal and conditional estimate are approximately the same, RD is a collapsible measure. \n\n### Conditional and crude OR\n\n#### Full list of risk factors for outcome (2 variables)\n\n\n\n::: {.cell hash='confounding5_cache/pdf/orest_ea200adf3d6f7c684e9fbffa26067b2d'}\n\n```{.r .cell-code}\nfitx0 <- glm(hypertension ~ smoking + gender + age, family=binomial(link = \"logit\"), data=Obs.Data)\npublish(fitx0, print = FALSE, confint.method = \"robust\", pvalue.method = \"robust\")$regressionTable[1,]\n#>   Variable Units OddsRatio       CI.95 p-value\n#> 1  smoking            3.37 [3.17;3.58] < 1e-04\n```\n:::\n\n\n\n#### Strtatum specific (2 variables)\n\n\n\n::: {.cell hash='confounding5_cache/pdf/strata12_91ae9fcd324eb88f21c536b491193db1'}\n\n```{.r .cell-code}\nfitx1 <- glm(hypertension ~ smoking, \n             family=binomial(link = \"logit\"), \n             data=subset(Obs.Data, gender == 1 & age < 2))\npublish(fitx1, print = FALSE, confint.method = \"robust\", \n        pvalue.method = \"robust\")$regressionTable[1,]\n#>   Variable Units OddsRatio       CI.95 p-value\n#> 1  smoking            1.65 [1.57;1.73] < 1e-04\n\nfitx2 <- glm(hypertension ~ smoking, \n             family=binomial(link = \"logit\"), \n             data=subset(Obs.Data, gender == 0 & age < 2))\npublish(fitx2, print = FALSE, confint.method = \"robust\", \n        pvalue.method = \"robust\")$regressionTable[1,]\n#>   Variable Units OddsRatio       CI.95 p-value\n#> 1  smoking            1.49 [1.40;1.59] < 1e-04\n\nfitx3 <- glm(hypertension ~ smoking, \n             family=binomial(link = \"logit\"), \n             data=subset(Obs.Data, gender == 1 & age >= 2))\npublish(fitx3, print = FALSE, confint.method = \"robust\", \n        pvalue.method = \"robust\")$regressionTable[1,]\n#>   Variable Units OddsRatio       CI.95 p-value\n#> 1  smoking            3.45 [2.49;4.77] < 1e-04\n\nfitx4 <- glm(hypertension ~ smoking, \n             family=binomial(link = \"logit\"), \n             data=subset(Obs.Data, gender == 0 & age >= 2))\npublish(fitx4, print = FALSE, confint.method = \"robust\", \n        pvalue.method = \"robust\")$regressionTable[1,]\n#>   Variable Units OddsRatio        CI.95  p-value\n#> 1  smoking            2.14 [0.39;11.66]   0.3811\n```\n:::\n\n\n\nUnweighted mean from all strata (for simplicity, 2 variables)\n\n\n\n::: {.cell hash='confounding5_cache/pdf/unwgtmean4_cffaa6837b5c6b25d93aa0b55fa7d6e2'}\n\n```{.r .cell-code}\nmean(exp(c(coef(fitx1)[\"smoking\"],\n           coef(fitx2)[\"smoking\"],\n           coef(fitx3)[\"smoking\"],\n           coef(fitx4)[\"smoking\"])))\n#> [1] 2.180804\n```\n:::\n\n\n\n#### Partial list of risk factors for outcome (1 variable)\n\n\n\n::: {.cell hash='confounding5_cache/pdf/riskpartial11_f94de89a03400d47dee09d40422fc71c'}\n\n```{.r .cell-code}\nfitx0 <- glm(hypertension ~ smoking + gender, \n             family=binomial(link = \"logit\"), data=Obs.Data)\npublish(fitx0, print = FALSE, confint.method = \"robust\", \n        pvalue.method = \"robust\")$regressionTable[1,]\n#>   Variable Units OddsRatio       CI.95 p-value\n#> 1  smoking            1.29 [1.26;1.33] < 1e-04\n```\n:::\n\n\n\n#### Strtatum specific (1 variable)\n\n\n\n::: {.cell hash='confounding5_cache/pdf/strata21_16abd622a0fd8f588d86d4f1b0cffe8c'}\n\n```{.r .cell-code}\nfitx1 <- glm(hypertension ~ smoking, \n             family=binomial(link = \"logit\"), \n             data=subset(Obs.Data, gender == 1))\npublish(fitx1, print = FALSE, confint.method = \"robust\",\n        pvalue.method = \"robust\")$regressionTable[1,]\n#>   Variable Units OddsRatio       CI.95 p-value\n#> 1  smoking            1.29 [1.25;1.34] < 1e-04\n\nfitx2 <- glm(hypertension ~ smoking, \n             family=binomial(link = \"logit\"), \n             data=subset(Obs.Data, gender == 0))\npublish(fitx2, print = FALSE, confint.method = \"robust\", \n        pvalue.method = \"robust\")$regressionTable[1,]\n#>   Variable Units OddsRatio       CI.95 p-value\n#> 1  smoking            1.29 [1.22;1.36] < 1e-04\n```\n:::\n\n\n\nUnweighted mean from all strata (for simplicity, 1 variable)\n\n\n\n::: {.cell hash='confounding5_cache/pdf/wmean12_a1a39229898a838732728c7294660994'}\n\n```{.r .cell-code}\nmean(exp(c(coef(fitx1)[\"smoking\"],\n           coef(fitx2)[\"smoking\"])))\n#> [1] 1.290429\n```\n:::\n\n\n\n#### Mantel-Haenszel adjusted ORs with 1 variable\n\n\n\n::: {.cell hash='confounding5_cache/pdf/mhor_9d31f6875b245b4f5b0644ba542e2793'}\n\n```{.r .cell-code}\ntabx <- xtabs( ~ hypertension + smoking + gender, data = Obs.Data)\nftable(tabx)    \n#>                      gender     0     1\n#> hypertension smoking                   \n#> 0            0               3788 12401\n#>              1               3400 11504\n#> 1            0              10547 20984\n#>              1              12178 25198\n# require(samplesizeCMH)\n# apply(tabx, 3, odds.ratio)\n\nlibrary(lawstat)\ncmh.test(tabx)\n#> \n#> \tCochran-Mantel-Haenszel Chi-square Test\n#> \n#> data:  tabx\n#> CMH statistic = NA, df = 1.0000, p-value = NA, MH Estimate = 1.2924,\n#> Pooled Odd Ratio = 1.2876, Odd Ratio of level 1 = 1.2864, Odd Ratio of\n#> level 2 = 1.2945\n# mantelhaen.test(tabx, exact = TRUE)\n```\n:::\n\n\n\n#### Crude (in absence of confounding)\n\n\n\n::: {.cell hash='confounding5_cache/pdf/crude12_8131f9d58213a1760e12559cea00ff56'}\n\n```{.r .cell-code}\nfitx0 <- glm(hypertension ~ smoking, \n             family=binomial(link = \"logit\"), data=Obs.Data)\npublish(fitx0, print = FALSE, confint.method = \"robust\", \n        pvalue.method = \"robust\")$regressionTable[1,]\n#>   Variable Units OddsRatio       CI.95 p-value\n#> 1  smoking            1.29 [1.25;1.32] < 1e-04\n```\n:::\n\n\n\n### Marginal RD, RR and OR\n\nBelow we show a procedure for calculating marginal probabilities $p_1$ (for treated) and $p_0$ (for untreated).\n\n#### Adjustment of 2 variables\n\n\n\n::: {.cell hash='confounding5_cache/pdf/adj12_edb14b416a4a83f1b4798a81fa115329'}\n\n```{.r .cell-code}\nfitx3 <- glm(hypertension ~ smoking + gender + age, \n             family=binomial(link = \"logit\"), data=Obs.Data)\nObs.Data.all.tx <- Obs.Data\nObs.Data.all.tx$smoking <- 1\np1 <- mean(predict(fitx3, \n                   newdata = Obs.Data.all.tx, type = \"response\"))\nObs.Data.all.utx <- Obs.Data\nObs.Data.all.utx$smoking <- 0\np0 <- mean(predict(fitx3, \n                   newdata = Obs.Data.all.utx, type = \"response\"))\n\nRDm <- p1 - p0\nRRm <- p1 / p0\nORm <- (p1 / (1-p1)) / (p0 / (1-p0))\nORc <- as.numeric(exp(coef(fitx3)[\"smoking\"]))\nRRz <- ORm / ((1-p0) + p0 * ORm) # Zhang and Yu (1998)\ncat(\"RD marginal = \", round(RDm,2), \n    \"\\nRR marginal = \", round(RRm,2), \n    \"\\nOR marginal = \", round(ORm,2), \n    \"\\nOR conditional = \", round(ORc,2), \n    \"\\nRR (ZY)= \", round(RRz,2))\n#> RD marginal =  0.05 \n#> RR marginal =  1.08 \n#> OR marginal =  1.29 \n#> OR conditional =  3.37 \n#> RR (ZY)=  1.08\n```\n:::\n\n\n\n#### Adjustment of 1 variable\n\n\n\n::: {.cell hash='confounding5_cache/pdf/adj13_48cf1a7470d64bbd7a7f9ea18d416a0c'}\n\n```{.r .cell-code}\nfitx2 <- glm(hypertension ~ smoking + gender, \n             family=binomial(link = \"logit\"), data=Obs.Data)\nObs.Data.all.tx <- Obs.Data\nObs.Data.all.tx$smoking <- 1\np1 <- mean(predict(fitx2, \n                   newdata = Obs.Data.all.tx, type = \"response\"))\nObs.Data.all.utx <- Obs.Data\nObs.Data.all.utx$smoking <- 0\np0 <- mean(predict(fitx2, \n                   newdata = Obs.Data.all.utx, type = \"response\"))\n\nRDm <- p1 - p0\nRRm <- p1 / p0\nORm <- (p1 / (1-p1)) / (p0 / (1-p0))\nORc <- as.numeric(exp(coef(fitx2)[\"smoking\"]))\nRRz <- ORm / ((1-p0) + p0 * ORm) # Zhang and Yu (1998)\ncat(\"RD marginal = \", round(RDm,2), \n    \"\\nRR marginal = \", round(RRm,2), \n    \"\\nOR marginal = \", round(ORm,2), \n    \"\\nOR conditional = \", round(ORc,2), \n    \"\\nRR (ZY)= \", round(RRz,2))\n#> RD marginal =  0.05 \n#> RR marginal =  1.08 \n#> OR marginal =  1.29 \n#> OR conditional =  1.29 \n#> RR (ZY)=  1.08\n```\n:::\n\n\n\n#### No adjustment\n\n\n\n::: {.cell hash='confounding5_cache/pdf/crude15_c4d513dd917966913adaba253fbb3771'}\n\n```{.r .cell-code}\nfitx1 <- glm(hypertension ~ smoking, \n             family=binomial(link = \"logit\"), data=Obs.Data)\nObs.Data.all.tx <- Obs.Data\nObs.Data.all.tx$smoking <- 1\np1 <- mean(predict(fitx0, \n                   newdata = Obs.Data.all.tx, type = \"response\"))\nObs.Data.all.utx <- Obs.Data\nObs.Data.all.utx$smoking <- 0\np0 <- mean(predict(fitx0, \n                   newdata = Obs.Data.all.utx, type = \"response\"))\n\nRDm <- p1 - p0\nRRm <- p1 / p0\nORm <- (p1 / (1-p1)) / (p0 / (1-p0))\nORc <- as.numeric(exp(coef(fitx1)[\"smoking\"]))\nRRz <- ORm / ((1-p0) + p0 * ORm) # Zhang and Yu (1998)\ncat(\"RD marginal = \", round(RDm,2), \n    \"\\nRR marginal = \", round(RRm,2), \n    \"\\nOR marginal = \", round(ORm,2), \n    \"\\nOR conditional = \", round(ORc,2), \n    \"\\nRR (ZY)= \", round(RRz,2))\n#> RD marginal =  0.05 \n#> RR marginal =  1.08 \n#> OR marginal =  1.29 \n#> OR conditional =  1.29 \n#> RR (ZY)=  1.08\n```\n:::\n\n\n\nBootstrap could be used to estimate confidence intervals.\n\nRef:\n\n-   [@kleinman2009s] (\"this paper demonstrates how to move from a nonlinear model to estimates of marginal effects that are quantified as the adjusted risk ratio or adjusted risk difference\")\n-   [@austin2010absolute] (\"clinically meaningful measures of treatment effect using logistic regression model\")\n-   [@luijken2022comparison] (\"marginal odds ratio\")\n-   [@muller2014estimating] (\"marginal standardization\")\n-   [@greenland2004model] (\"standardized / population-averaged\")\n-   [@bieler2010estimating] (\"standardized /population-averaged risk from the logistic model\")\n\n### Summary\n\nHere are the summary of the results based on a scenario where confounding was absent:\n\n| Modelling strategy                                         | RD (conditional)          | RR (conditional)            | OR (conditional)                            |\n|--------------------|-----------------|-----------------|-----------------|\n| age + gender in regression                                 | 0.06 \\[0.05;0.06\\]        | 1.08 \\[1.08;1.09\\]          | 3.37 \\[3.17;3.58\\]                          |\n| stratified by age and gender (mean)                        | 0.05 (*0.11, 0.1,0.01,0*) | 1.16 (*1.41, 1.21, 1.01,1*) | 2.18 (unweighted; *1.65, 1.49, 3.45, 2.14*) |\n| gender in regression                                       | 0.05 \\[0.05;0.06\\]        | 1.08 \\[1.07;1.09\\]          | 1.29 \\[1.26;1.33\\]                          |\n| stratified by gender (mean)                                | 0.05 (*0.6,0.5*)          | 1.08 (*1.09, 1.06*)         | 1.29 (*1.29, 1.29*; **M-H** 1.29)           |\n| **Marginal estimates**                                     |                           |                             |                                             |\n| crude                                                      | 0.05 \\[0.05;0.06\\]        | 1.08 \\[1.07;1.09\\]          | 1.29 \\[1.25;1.32\\]                          |\n| Based on marginal probabilities (any variable combination) | 0.05                      | 1.08                        | 1.29                                        |\n\nAs we can see, marginal estimate = conditional estimate for RD and RR but not for OR. Hence, RD and RR are collapsible measures, while OR is a non-collapsible measure.\n\n### Video content (optional)\n\n::: callout-tip\nFor those who prefer a video walk through, feel free to watch the video below, which offers a description of an earlier version of the above content.\n:::\n\n::: {style=\"position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;\"}\n<iframe src=\"https://www.youtube.com/embed/h4q70cIPldQ\" style=\"position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;\" allowfullscreen>\n\n</iframe>\n:::\n\n### References\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}