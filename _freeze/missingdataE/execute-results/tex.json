{
  "hash": "fd388ae31196129437cef6fb0bf9c474",
  "result": {
    "markdown": "## Exercise (M) {.unnumbered}\n\n\n\n\n\n\n\n\n\n::: callout-tip\nYou can download all of the related files in a zip file **missingdataEx.zip** from [Github folder](https://github.com/ehsanx/EpiMethods/tree/main/LabExercises/), or just by clicking this link [directly](https://github.com/ehsanx/EpiMethods/raw/main/LabExercises/missingdataEx.zip).\n\n-   Navigate to the GitHub folder (above link) where the ZIP file is located.\n-   Click on the file name (above zip file) to open its preview window.\n-   Click on the Download button to download the file. If you can't see the Download button, click on \"Download Raw File\" link that should appear on the page.\n:::\n\n## Problem Statement\n\nWe will use the article by [Williams AR, Wilson-Genderson M, Thomson MD. (2021)](https://doi.org/10.1016/j.ypmed.2021.106426)\n\nWe will reproduce some results from the article. The authors used NHANES 2015-16 and 2017-18 datasets to create their analytic dataset. The combined dataset contains 19,225 subjects with 20 relevant variables for this exercise:\n\n**Survey information**\n\n-   id: Respondent sequence number\n-   survey.weight: Full sample 4 year interview weight\n-   psu: Masked pseudo PSU\n-   strata: Masked pseudo strata (strata is nested within PSU)\n\n**4 Outcome variables**\n\n-   weight.loss.behavior: doing lifestyle behavior changes - controlling or losing weight\n-   exercise.behavior: doing lifestyle behavior changes - increasing exercise\n-   salt.behavior: doing lifestyle behavior changes - reducing salt in diet\n-   fat.behavior: doing lifestyle behavior changes - reducing fat in diet\n\n**4 predictors (i.e., exposure variables)**\n\n-   weight.loss.advice: told by a doctor or health professional - to control/lose weight\n-   exercise.advice: told by a doctor or health professional - to exercise\n-   salt.advice: told by a doctor or health professional - to reduce salt in diet\n-   fat.advice: told by a doctor or health professional - to reduce fat/calories\n\n**Confounders and other variables**\n\n-   gender: Gender\n-   age: Age in years at screening\n-   income: The ratio of family income to federal poverty level\n-   race: Race/Ethnicity\n-   bmi: Body Mass Index in kg/m$^2$\n-   comorbidity: Comorbidity index\n-   DIQ010: Self-report to have been informed by a provider to have diabetes\n-   BPQ020: Self-report to have been informed by a provider to have hypertension\n\n## Question 1: Analytic dataset\n\n### 1(a) Importing dataset\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# download the data in the same folder\nload(\"Data/missingdata/Williams2021.RData\")\n```\n:::\n\n\n\n\n### 1(b) Subsetting according to eligibility\n\nCreate a dataset with missing values in outcomes, predictors, and confounders. As shown in Figure 1, the sample size should be 4,746.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Drop < 18 years\ndat <- dat.full\ndat <- dat[dat$age >= 18,] \n\n# Eligibility\ndat <- dat[dat$DIQ010==\"Yes\" | dat$BPQ020==\"Yes\",] \n\n# Dataset with missing values in outcomes, predictors, and confounders\ndat.with.miss <- dat\nnrow(dat.with.miss) # N = 4,746\n#> [1] 4746\n```\n:::\n\n\n\n\n### 1(c) Dataset with missing values only in confounders\n\nCreate a dataset with missing values in only in confounders. There should not be any missing values in the outcomes or predictors. As shown in Figure 1, the sample size should be 4,716.\n\n-   Hint: there are four outcome variables and four predictors in this paper. Read the \"Self-reported behavior change and receipt of advice\" paragraph.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- dat.with.miss\n\n# Drop missing or don't know outcomes \ndat <- dat[complete.cases(dat$weight.loss.behavior),]\ndat <- dat[complete.cases(dat$exercise.behavior),]\ndat <- dat[complete.cases(dat$salt.behavior),]\ndat <- dat[complete.cases(dat$fat.behavior),]\n\n# Drop missing or don't know predictors\ndat <- dat[complete.cases(dat$weight.loss.advice),]\ndat <- dat[complete.cases(dat$exercise.advice),]\ndat <- dat[complete.cases(dat$salt.advice),]\ndat <- dat[complete.cases(dat$fat.advice),] \n\n# Dataset without missing in outcomes and predictors but missing in confounders \ndat.with.miss2 <- dat\nnrow(dat.with.miss2) # N = 4,716\n#> [1] 4716\n```\n:::\n\n\n\n\n### 1(d) Reproduce Table 1\n\nCreate the first column of Table 1 of the article.\n\n-   Hint 1: The authors reported unweighted frequencies, and thus, survey features should not be utilized to answer this question. Use `tableone` package.\n\n-   Hint 2: You may need to generate the `Condition` variable.\n\n-   Hint 3: `age` and `comorbidity` are numerical variables. `tableone` package gives mean (SD) for numerical variables by default. For this exercise, instead of reporting the frequency, you could report the mean (SD) for `age` and `comorbidity`.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- dat.with.miss2\n\n# Create the condition variable\ndat$condition <- NA\ndat$condition[dat$BPQ020 == \"Yes\"] <- \"Hypertension Only\"\ndat$condition[dat$DIQ010 == \"Yes\"] <- \"Diabetes Only\"\ndat$condition[dat$BPQ020 == \"Yes\" & dat$DIQ010 == \"Yes\"] <- \"Both\"\ndat$condition <- factor(dat$condition, levels=c(\"Hypertension Only\", \"Diabetes Only\",\n                                                \"Both\"))\ntable(dat$condition, useNA = \"always\")\n#> \n#> Hypertension Only     Diabetes Only              Both              <NA> \n#>              3004               533              1179                 0\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# First column of Table 1\nvars <- c(\"gender\", \"age\", \"income\", \"race\", \"bmi\", \"condition\", \"comorbidity\")\ntab1 <- CreateTableOne(vars = vars, data = dat, includeNA = F)\nprint(tab1, format = \"f\")\n#>                          \n#>                           Overall      \n#>   n                        4716        \n#>   gender = Male            2332        \n#>   age (mean (SD))         59.94 (14.96)\n#>   income                               \n#>      <100%                  881        \n#>      100-199%              1193        \n#>      200-299%               672        \n#>      300-399%               424        \n#>      400+%                  930        \n#>   race                                 \n#>      Hispanic              1161        \n#>      Non-Hispanic white    1630        \n#>      Non-Hispanic black    1239        \n#>      Others                 686        \n#>   bmi                                  \n#>      Reference              753        \n#>      Overweight            1372        \n#>      Obese                 2287        \n#>   condition                            \n#>      Hypertension Only     3004        \n#>      Diabetes Only          533        \n#>      Both                  1179        \n#>   comorbidity (mean (SD))  1.29 (1.45)\n```\n:::\n\n\n\n\n## Question 2: Dealing with missing values in confoudners \\[100% grade\\]\n\n### 2(a) Check missingness using a plot\n\nIn the dataset created in 1(c), use a plot to check missingness. In the plot, include only the outcome variables, predictors, and confounders.\n\n-   Hint 1: There are four outcome variables and four predictor variables used in the study.\n-   Hint 2: The authors considered the following confounders: gender, age, income, race, bmi, condition, and comorbidity.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create the condition variable in the analytic dataset\ndat.with.miss2$condition[dat.with.miss2$BPQ020 == \"Yes\"] <- \"Hypertension Only\"\ndat.with.miss2$condition[dat.with.miss2$DIQ010 == \"Yes\"] <- \"Diabetes Only\"\ndat.with.miss2$condition[dat.with.miss2$BPQ020 == \"Yes\" & \n                          dat.with.miss2$DIQ010 == \"Yes\"] <- \"Both\"\ndat.with.miss2$condition <- factor(dat.with.miss2$condition, \n                                  levels=c(\"Hypertension Only\", \"Diabetes Only\", \"Both\"))\n\n# Variables of interest\nvars <- c(\n  # Outcome\n  \"weight.loss.behavior\", \"exercise.behavior\", \"salt.behavior\", \"fat.behavior\",\n  \n  #Predictors\n  \"weight.loss.advice\", \"exercise.advice\", \"salt.advice\", \"fat.advice\",\n   \n  # Confounders       \n  \"gender\", \"age\", \"income\", \"race\", \"bmi\", \"condition\", \"comorbidity\")\n\n# Plot missing values using DataExplorer\nplot_missing(dat.with.miss2[,vars])\n```\n\n::: {.cell-output-display}\n![](missingdataE_files/figure-pdf/unnamed-chunk-6-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n### 2(b) Reproduce Table 3: Multiple imputation\n\nPerform multiple imputations to deal with missing values only in confounders. Use the dataset created in Dataset with missing values only in confounders (`dat.with.miss2`). Consider 5 imputed datasets, 5 iterations, and fit the design-adjusted logistic regression in all of the 5 imputed datasets. Obtain the pooled adjusted odds ratio with the 95% confidence intervals. In this case, consider only one outcome and one predictor that are related to lose weights, i.e., create only the **first column of Table 3**.\n\n-   Hint 1: Setup the data such that the variables are of appropriate types. `lapply` function could be helpful.\n-   Hint 2: Relevel the confounders as shown in Table 3.\n-   Hint 3: Use the strata variable as an auxiliary variable in the imputation model, but not the survey weight or PSU variable.\n-   Hint 4: Consider predictive mean matching method for bmi and comorbidity variable in the imputation model.\n-   Hint 5: Set your seed to 123.\n-   Hint 6: Remove any subject ID variable from the imputation model, if created in an intermediate step.\n-   Hint 7: The point and interval estimates could be slightly different than shown in Table 3. But they should very close.\n-   Hint 8: Remember to keep count of the ineligible subjects from the full data, and consider adding them back in the imputed datasets (so that all the weight, strata and cluster information are available in the design).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Setup the data such that the variables are of appropriate types\nfactor.names <- c(\"weight.loss.behavior\", \"exercise.behavior\", \"salt.behavior\", \n                  \"fat.behavior\", \"weight.loss.advice\", \"exercise.advice\", \n                  \"salt.advice\", \"fat.advice\", \"gender\", \"income\", \"race\", \"bmi\", \n                  \"condition\")\n# your codes \n\n\n## Change the reference categories\n# your codes\n\n\n## Imputation model set up\n# your codes\n\n\n## Regression analysis\n# your codes\n\n\n## Pooled estimates\n# your codes\n```\n:::\n\n\n\n\n## Question 3: Dealing with missing values in outcome, predictor, and confoudners \\[optional\\]\n\nPerform multiple imputations to deal with missing values only in outcome, predictor, confounders. Use the Multiple Imputation then deletion (MID) approach. Use the dataset created in Subsetting according to eligibility (`dat.with.miss`). Consider 5 imputed datasets, 5 iterations, and fit the design-adjusted logistic regression in all of the 5 imputed datasets. Obtain the pooled adjusted odds ratio with the 95% confidence intervals. In this case, consider only one outcome and one predictor that are related to reduce fat/calories, i.e., create only the **fourth column of Table 3**.\n\n-   Hint 1: Setup the data such that the variables are of appropriate types.\n-   Hint 2: Relevel the confounders as shown in Table 3.\n-   Hint 3: Use the strata variable as an auxiliary variable in the imputation model, but not the survey weight or PSU variable.\n-   Hint 4: Include all 4 outcomes and 4 predictors in your imputation model.\n-   Hint 5: Consider predictive mean matching method for bmi and comorbidity variable in the imputation model.\n-   Hint 6: Set your seed to 123.\n-   Hint 7: Remove any subject ID variable from the imputation model, if created in an intermediate step.\n-   Hint 8: The point and interval estimates could be slightly different than shown in Table 3. But they should very close.\n-   Hint 9: Remember to keep count of the ineligible subjects from the full data, and consider adding them back in the imputed datasets (so that all the weight, strata and cluster information are available in the design).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Create a missing indicator so that MID can be applied\n# your codes here\n\n## MID\n# your codes here\n\n```\n:::\n",
    "supporting": [
      "missingdataE_files\\figure-pdf"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}