{
  "hash": "ab37f0c038d35ae11747a7b71d7e5a31",
  "result": {
    "markdown": "## Importing NHIS to R {.unnumbered}\n\nThis tutorial provides instructions on accessing the National Health Interview Survey (NHIS) dataset from the US Centers for Disease Control and Prevention (CDC) website and importing it into the RStudio environment.\n\n### Overview\n\nLike NHANES, NHIS is supported by the CDC and is a large-scale multi-stage cross-sectional survey. The NHIS survey includes information on population disease prevalence, extent of disability, and use of health care services. In contrast to the NHANES that provides data every 2 years, NHIS provides data annually.\n\n::: column-margin\nTo obtain population-level estimate, we must utilize the survey features (weights, strata, PSU/cluster)\n:::\n\n### NHIS datafile and documents\n\nThe NHIS files are stored in the NHIS website in different formats. You can import this data in any statistical package that supports these file formats, e.g., ASCII, CSV, SAS.\n\n::: column-margin\n[NHIS Data, Questionnaires and Related Documentation](https://www.cdc.gov/nchs/nhis/data-questionnaires-documentation.htm)\n:::\n\n::: column-margin\nIn the recent NHIS (2019 or later), data are available in 5 categories:\n\n-   Interview data for adults\n-   Interview data for children\n-   Imputed income for adults\n-   Imputed income for children\n-   Paradata\n:::\n\n::: column-margin\nIn the earlier NHIS (before 2019), data are available in 8 categories:\n\n-   Family file\n-   Household file\n-   Person file\n-   Child file\n-   Adult file\n-   Imputed income\n-   Functioning and disability\n-   Paradata\n:::\n\n#### Combining data\n\n##### Different cycles\n\nIt is possible to combine datasets from different years/cycles together in NHIS. Similar to NHANES, identification of the same person in NHIS across different cycles is not possible in the public release datasets. For appending data from different cycles, please make sure that the variable names/labels are the same/identical in years under consideration (in some years, names and labels do change).\n\n##### Within the same cycle\n\nWithin NHIS datasets in a given cycle, each sampled person has a household number (`HHX`), family number (`FMX`), and a person number within family (`FPX`). We can create a unique identifier based on these three variables and merge the datasets.\n\n### Accessing NHIS Data\n\n::: column-margin\nNHIS survey datasets are publicly available at <https://www.cdc.gov/nchs/nhis/>\n:::\n\nUnlike NHANES where a R package is available to download the dataset, NHIS datasets need to be downloaded directly from the CDC website. In the following example, we will see how to download 'Adult' data from [2021 NHIS](https://www.cdc.gov/nchs/nhis/2021nhis.htm), and check associated variable in that dataset.\n\n\n::: {.cell hash='accessing5_cache/html/cdc1_47c782f09895130a412261d54cc5e97f'}\n::: {.cell-output-display}\n![](Images/accessing/nhis1.png){width=100%}\n:::\n:::\n\n\n-   **Step 1**: Say, for example, we are interested to download the adult dataset in the CSV format:\n\n\n::: {.cell hash='accessing5_cache/html/cdc2_764147c655fd06be22abca3b713fbd9b'}\n::: {.cell-output-display}\n![](Images/accessing/nhis2.png){width=65%}\n:::\n:::\n\n\n-   **Step 2**: We can download the data in the local PC folder, unzip it, and then read the data into R as as follows:\n\n\n::: {.cell hash='accessing5_cache/html/load_d2e85cc910f2ffa10488533069b1ff3e'}\n\n```{.r .cell-code}\nadult21 <- read.csv(\"Data/accessing/adult21.csv\", header = T)\n```\n:::\n\n::: {.cell hash='accessing5_cache/html/loadMirror_0a01f16beee8a5d0b3ffe56be614392a'}\n\n:::\n\n\n-   **Step 3**: Once data is imported in RStudio, we will see the `adult21` object listed under data window (see below):\n\n\n::: {.cell hash='accessing5_cache/html/cdc4_3c19cbd32fb7d687cd51c98baf48c3a9'}\n::: {.cell-output-display}\n![](Images/accessing/nhis3.png){width=65%}\n:::\n:::\n\n\n-   **Step 4**: We can check the variable names in this `adult21` dataset using the `names` function.\n\n\n::: {.cell hash='accessing5_cache/html/cdc5_a0ada100a9bb463b938093da28fde737'}\n\n```{.r .cell-code}\nnames(adult21)\n```\n:::\n\n\n-   **Step 5**: We can check how many unique adults are in this `adult21` dataset. Note that the `HHX` variable in the dataset is the unique household identifier, where only one adult per household was selected for interview. We can use this `HHX` variable to merge adult datafile with other datafiles (e.g., child data).\n\n\n::: {.cell hash='accessing5_cache/html/uniquehh_e714c8949ca72ffec28be6288555526f'}\n\n```{.r .cell-code}\nlength(unique(adult21$HHX))\n#> [1] 29482\n```\n:::\n\n\n-   **Step 6**: We can open the data in RStudio in the dataview window (by clicking the `adult21` data from the data window). The next Figure shows only a few columns and rows from this large dataset. Note that there are some values marked as \"NA\", which represents missing values.\n\n\n::: {.cell hash='accessing5_cache/html/cdc6_6ca3610307043e6c135635056e22b4ad'}\n::: {.cell-output-display}\n![](Images/accessing/nhis4.png){width=99%}\n:::\n:::\n\n\n-   **Step 7**: To understand what the column names mean in this Figure, we need to take a look at the codebook, which is also available on the CDC website:\n\n\n::: {.cell hash='accessing5_cache/html/cdc7_b80916ccdecd09c956be907229a8c3f0'}\n::: {.cell-output-display}\n![](Images/accessing/nhis5.png){width=65%}\n:::\n:::\n\n\n-   **Step 8**: We can see a check for the column or variables, e.g., `REGION`, in the codebook:\n\n\n::: {.cell hash='accessing5_cache/html/cdc8_8f97509ff02ee8e1ed62a1e107531a46'}\n::: {.cell-output-display}\n![](Images/accessing/nhis6.png){width=100%}\n:::\n:::\n\n\n-   **Step 9**: We can assess if the numbers reported under count matches with what we get from the `adult21` data we just imported (particularly, for the `REGION` variable):\n\n\n::: {.cell hash='accessing5_cache/html/cdc9_60923f69e4e77dd6eb9aced9b1e60fac'}\n\n```{.r .cell-code}\n# Frequency table\ntable(adult21$REGION, useNA = \"always\") \n#> \n#>     1     2     3     4  <NA> \n#>  4775  6327 10731  7649     0\n```\n:::\n\n\nSimilarly, we can download the child data and open it in R:\n\n\n::: {.cell hash='accessing5_cache/html/loadchild_005844996cd327f91562d35a897f3ff6'}\n\n```{.r .cell-code}\nchild21 <- read.csv(\"Data/accessing/child21.csv\", header = T)\n```\n:::\n\n::: {.cell hash='accessing5_cache/html/loadchildMirror_5bb2958f2036b6aa097b9908cc79bf10'}\n\n:::\n\n::: {.cell hash='accessing5_cache/html/nhisc1_4f143039b8f3176dcad5ffe2bbb25b58'}\n::: {.cell-output-display}\n![](Images/accessing/nhis_child1.png){width=65%}\n:::\n:::\n\n\nLet's check how many unique children are in this `child21` dataset:\n\n\n::: {.cell hash='accessing5_cache/html/uniquehhc_069b2066b7673dc447f53ae917f2cb52'}\n\n```{.r .cell-code}\nlength(unique(child21$HHX))\n#> [1] 8261\n```\n:::\n\n\nNow let's check for the column or variables, e.g., `SEX_C`, in the codebook:\n\n\n::: {.cell hash='accessing5_cache/html/nhisc2_d81d43263b2ab3724b1cd048072a74c3'}\n::: {.cell-output-display}\n![](Images/accessing/nhis_child2.png){width=100%}\n:::\n:::\n\n\nWe can assess if the numbers reported under count matches with what we get from the `child21` data we just imported:\n\n\n::: {.cell hash='accessing5_cache/html/nhisc3_95c525b2ac862bdc376d6ec4ffbf4cdc'}\n\n```{.r .cell-code}\n# Frequency table\ntable(child21$SEX_C, useNA = \"always\") \n#> \n#>    1    2    7 <NA> \n#> 4257 4002    2    0\n```\n:::\n\n\n### Merging within the same cycle\n\n::: callout-note\nWe can use `HHX` variable to merge different datafiles within the same survey cycle.\n:::\n\nAs mentioned earlier, `HHX` variable in the dataset is the unique household identifier. We can use this `HHX` variable to merge different datafiles within the same survey cycle. Say, we are interested in merging child age (AGEP_C) and sex (SEX_C) variables with the adult datafile. We can use the `merge` function as follows:\n\n\n::: {.cell hash='accessing5_cache/html/nhisc4_a415d8da8bd2b439a8df907b21b98aff'}\n\n```{.r .cell-code}\ndat <- merge(adult21, child21[,c(\"HHX\", \"AGEP_C\", \"SEX_C\")], by = \"HHX\", all = T)\n```\n:::\n\n::: {.cell hash='accessing5_cache/html/nhisc5_57ed64e1f38e04df6f827f66ccba47a1'}\n::: {.cell-output-display}\n![](Images/accessing/nhis_child3.png){width=65%}\n:::\n:::\n\n\nAs we can see, there are data from 30,673 unique households, suggesting that not all children are sampled from the same household of sampled adults.\n\n\n::: {.cell hash='accessing5_cache/html/uniquehhn_d1725a4a40077bec9d5d3db3e396a9ac'}\n\n```{.r .cell-code}\nlength(unique(dat$HHX))\n#> [1] 30673\n```\n:::\n\n\n### Table 1\n\nNow we will use the `adult21` dataset to create Table 1 with utilizing survey features (i.e., psu, strata, and weights). For that, let us create/recode some variables:\n\n\n::: {.cell hash='accessing5_cache/html/recode_24d2391909daa42b75385adecc34a9aa'}\n\n```{.r .cell-code}\n# Heart attack\nadult21$heart.attack <- car::recode(adult21$MIEV_A, \" 2 = 'No'; 1 = 'Yes'; else = NA\", \n                                levels = c(\"No\", \"Yes\"), as.factor = T)\ntable(adult21$heart.attack, useNA = \"always\")\n#> \n#>    No   Yes  <NA> \n#> 28378  1078    26\n\n# Diabetes\nadult21$diabetes <- car::recode(adult21$DIBEV_A, \" 2 = 'No'; 1 = 'Yes'; else = NA\", \n                            levels = c(\"No\", \"Yes\"), as.factor = T)\ntable(adult21$diabetes, useNA = \"always\")\n#> \n#>    No   Yes  <NA> \n#> 26318  3134    30\n\n# Sex\nadult21$sex <- car::recode(adult21$SEX_A, \" '1'='Male'; '2'='Female'; else=NA\", \n                       levels = c(\"Female\", \"Male\"), as.factor = T)\ntable(adult21$sex, useNA = \"always\")\n#> \n#> Female   Male   <NA> \n#>  16102  13378      2\n\n# Pseudo-PSU\nadult21$psu <- adult21$PPSU\nadult21$psu <- as.factor(adult21$psu)\ntable(adult21$psu, useNA = \"always\")\n#> \n#>    1    2    3    4    5    6    7    8    9   10   11   12   13   14   15   16 \n#> 1952 1599 1141  792  669  461  549  662  629  840  521  359  491  421  405  346 \n#>   17   18   19   20   21   22   23   24   25   26   27   28   29   30   31   32 \n#>  156  221  348  531  596  656  588  593  383  647  374  294  218   57  310  334 \n#>   33   34   35   36   37   38   39   40   41   42   43   44   45   46   47   48 \n#>  269  369  410  447  180  279  263   85   70  208  175  224  302  270  396  376 \n#>   49   50   51   52   53   54   55   56   57   58   59   60   61   62   63   64 \n#>  202  240  303  253  349  249   75   67  257  203  234  327  410  364  252  247 \n#>   65   66   67   68   72   73   74   75   76   77   78   79   80   81   82   87 \n#>  199  149   96   22   65   42  108  131   37   41   31   28   50   46   64   31 \n#>   89   90   91   92   93   97   98   99  100  101  102  103  104  108  109  110 \n#>   81   28  132  170   64   86   45   32  144  128  129  171  117   63   48   13 \n#>  114  127  128  134  139  140  150  151  152  153 <NA> \n#>   54   44   10   29   69   18   46   50   49   24    0\n\n# Pseudo-stratum\nadult21$strata <- adult21$PSTRAT\nadult21$strata <- as.factor(adult21$strata)\ntable(adult21$strata, useNA = \"always\")\n#> \n#>  100  101  102  103  104  105  106  107  108  109  110  111  112  113  114  115 \n#>  736  714  589  480  499  605  733  748  757  629  623  614  158  914  386  603 \n#>  116  117  118  119  120  121  122  123  124  125  126  127  128  129  130  131 \n#>  192  678  661  842  549  510  606  306  517  385  633  418  265  801  449  558 \n#>  132  133  134  135  136  137  138  139  140  141  142  143  144  145  146  147 \n#>  558  563  434  532  595  576  494  370  644  485  460  738  625  368  412  650 \n#>  148  149  150  151 <NA> \n#>  672  531  556 1061    0\n\n# Sampling weight\nadult21$sweight <- adult21$WTFA\nsummary(adult21$sweight)\n#>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#>   793.2  4698.3  7402.6  8586.9 10671.1 71378.0\n\n# Drop the missing values associated with Heart attack, Diabetes, Sex\ndat.analytic <- adult21[complete.cases(adult21$heart.attack),]\ndat.analytic <- dat.analytic[complete.cases(dat.analytic$diabetes),]\ndat.analytic <- dat.analytic[complete.cases(dat.analytic$sex),]\ndim(dat.analytic)\n#> [1] 29435   628\n```\n:::\n\n\nFirst, we will create the survey design. Second, we will report Table 1 with heart attack and sex variable, stratified by diabetes.\n\n\n::: {.cell hash='accessing5_cache/html/tab1_0e75765f7704b583807f1b7714faf235'}\n\n```{.r .cell-code}\nlibrary(tableone)\nlibrary(survey)\n\n# Indicator in the full data\nadult21$indicator <- 1\nadult21$indicator[adult21$HHX %in% dat.analytic$HHX] <- 0\ntable(adult21$indicator)\n#> \n#>     0     1 \n#> 29435    47\n\n# Survey design\nw.design <- svydesign(id = ~psu, strata = ~strata, weights = ~sweight, data = adult21, nest = T)\n\n# Subset\nw.design0 <- subset(w.design, indicator == 0)\n\n# Table 1\ntab1 <- svyCreateTableOne(var = c(\"heart.attack\", \"sex\"), strata= \"diabetes\", \n                          data = w.design0, test = FALSE)\nprint(tab1)\n#>                         Stratified by diabetes\n#>                          No                  Yes               \n#>   n                      228524605.2         24325386.4        \n#>   heart.attack = Yes (%)   5335722.7 ( 2.3)   2358175.6 ( 9.7) \n#>   sex = Male (%)         109610086.2 (48.0)  12510287.1 (51.4)\n```\n:::\n\n\n### Regression analysis\n\nLet's run a regression analysis with utilizing survey features.\n\n\n::: {.cell hash='accessing5_cache/html/regression_0423d2f43aa50c5ab0ba777e58f23fd4'}\n\n```{.r .cell-code}\nlibrary(Publish)\n\n# Design-adjusted logistic\nfit1 <- svyglm(I(heart.attack == \"Yes\") ~ diabetes + sex, design = w.design0, family = binomial)\npublish(fit1)\n#>  Variable  Units OddsRatio       CI.95 p-value \n#>  diabetes     No       Ref                     \n#>              Yes      4.42 [3.76;5.21]  <1e-04 \n#>       sex Female       Ref                     \n#>             Male      2.04 [1.75;2.39]  <1e-04\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}