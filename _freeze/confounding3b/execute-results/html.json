{
  "hash": "83692cac98e05845d591f3a47eba6a67",
  "result": {
    "markdown": "## Simpson's Paradox {.unnumbered}\n\n### Introduction\n\nIn this tutorial, we will use **simcausal** in R to simulate data and demonstrate how **Simpson's Paradox** arises in a birthweight example similar to the \"Birthweight Paradox\" discussed by [Hernández-Díaz et al. (2006)](https://doi.org/10.1093/aje/kwj275). The paradox arises when adjusting for birthweight, leading to misleading conclusions about the relationship between maternal smoking and infant mortality. We will show how improper adjustment for birthweight, a collider in this context, can lead to biased estimates, and how to correct for this.\n\n### Birth Weight Paradox\n\nStudies showed that while maternal smoking increased the risk of low birth weight (LBW) and infant mortality, among LBW infants, [those born to smokers had lower infant mortality than LBW infants born to non-smokers](https://doi.org/10.1093/oxfordjournals.aje.a121278). This seemingly paradoxical finding suggests that smoking could be \"protective\" for LBW infants, contradicting the established harmful effects of smoking during pregnancy.\n\nThis is a classic example of Simpson’s Paradox. The statistical reversal happens upon stratification, and the reason in this specific causal structure is that birthweight acts as a collider. Understanding this causal role is the only way to determine whether the stratified or unstratified result is the correct one for our research question.\n\n\n### Data Generation\n\nA Directed Acyclic Graph (DAG) is more than a mere illustration; it is a formal representation of a set of non-parametric causal assumptions about the data-generating process. The DAG provided in the tutorial encapsulates the hypothesized relationships between maternal smoking, an unmeasured factor, low birthweight, and infant mortality. \n\n#### Setup\n\nWe will use the following R packages:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(simcausal)\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(Publish)\nlibrary(knitr)\nlibrary(kableExtra)\n```\n:::\n\n\n#### Data Generation\n\nWe will generate data to simulate the birthweight paradox. We assume that:\n\n-   **Smoking** influences **Birthweight** (low birth weight).\n-   **Birthweight** influences **Infant Mortality**.\n-   There are unmeasured factors (e.g., birth defects) that also influence both birthweight and infant mortality.\n\nWe will set up this data generating process using **simcausal**.\n\n\n::: {.cell hash='confounding3b_cache/html/unnamed-chunk-2_2466450c103303d96cc410450430a4b6'}\n\n```{.r .cell-code}\nD <- DAG.empty()\nD <- D + \n  node(\"Smoking\", distr = \"rbern\", prob = 0.3) +\n  node(\"Unmeasured\", distr = \"rbern\", prob = 0.2) +\n  node(\"LowBirthweight\", distr = \"rbern\", prob = plogis(-1 + 1.5*Smoking + 2*Unmeasured)) +\n  node(\"Mortality\", distr = \"rbern\", prob = plogis(-2 + 4*LowBirthweight + 4*Unmeasured))\n\nDset <- set.DAG(D)\n```\n:::\n\n\n#### Visualizing the DAG\n\nLet's plot the DAG to see how these variables are related:\n\n\n::: {.cell hash='confounding3b_cache/html/unnamed-chunk-3_c927a958681bad11199d0221ed49ce62'}\n\n```{.r .cell-code}\nplotDAG(Dset, xjitter = 0.1, yjitter = 0.1, \n        edge_attrs = list(width = 1, arrow.width = 1, arrow.size = 1),\n        vertex_attrs = list(size = 15, label.cex = 0.8))\n```\n\n::: {.cell-output-display}\n![](confounding3b_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nThis DAG represents the relationships between maternal smoking, low birth weight, and mortality, with an unmeasured confounder affecting both birthweight and mortality. Low birth weight is a **collider** because it has two incoming arrows from both **Smoking** and **Birth Defect (Unmeasured)**.\n\n![DAG Plot](Images/confounding/dag0.png)\n\n#### The Dual Role of Low Birthweight: Mediator and Collider\n\nThe key to this puzzle is that LowBirthweight plays two different and conflicting roles depending on which causal path you examine.\n\n- **Mediator:** On the path Smoking → LowBirthweight → Mortality, LBW is a mediator. It is a mechanism through which smoking causes death. Smoking leads to LBW, which in turn leads to mortality. The purpose of mediation analysis is often to isolate the direct effect from this indirect, mediated path.\n\n- **Collider:** On the path Smoking → LowBirthweight ← Unmeasured, LBW is a collider. A collider is a variable that is a common effect of two other variables (arrows \"collide\" into it).  The fundamental rule of DAGs concerning colliders is that one must not condition on them or their descendants. Conditioning on a collider opens the non-causal path between its parents, inducing a spurious statistical association where none may have existed before. Conditioning on a collider (by adjusting for it in a model or stratifying by it) is a major analytical error.\n\nThis dual role creates an analytical trap. The statistical act of adjusting for LowBirthweight—which you might do to block its mediating effect—simultaneously conditions on it as a collider. This opens a spurious \"backdoor\" path between Smoking and the Unmeasured factors, introducing severe bias and leading to the paradoxical conclusion.\n\n#### Simulate Data\n\nWe now simulate data based on the DAG structure.\n\n\n::: {.cell hash='confounding3b_cache/html/unnamed-chunk-4_58a43446a9bcf09ca123821e7abdfa08'}\n\n```{.r .cell-code}\nsim_data <- sim(Dset, n = 10000, rndseed = 123)\n#> simulating observed dataset from the DAG object\nhead(sim_data) %>%\n  kable(\"html\", caption = \"First 6 Rows of Simulated Data\") %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\"), \n                full_width = FALSE, \n                position = \"center\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>First 6 Rows of Simulated Data</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> ID </th>\n   <th style=\"text-align:right;\"> Smoking </th>\n   <th style=\"text-align:right;\"> Unmeasured </th>\n   <th style=\"text-align:right;\"> LowBirthweight </th>\n   <th style=\"text-align:right;\"> Mortality </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n#### Visualizing Hypothetical Distributions\n\n\n::: {.cell hash='confounding3b_cache/html/unnamed-chunk-5_f6d6159393f61f3b3a69d28b2b6f522a'}\n\n```{.r .cell-code}\n# Simulate continuous birth weight based on binary LowBirthweight variable\nset.seed(123)\nsim_data$BirthWeight <- ifelse(sim_data$LowBirthweight == 1, \n                               rnorm(n = sum(sim_data$LowBirthweight == 1), \n                                     mean = 2200, sd = 300),  # Low birthweight\n                               rnorm(n = sum(sim_data$LowBirthweight == 0), \n                                     mean = 3300, sd = 500))  # Normal birthweight\nsim_data$Smoking <- factor(sim_data$Smoking, \n                           levels = c(0, 1), \n                           labels = c(\"Non-smoking\", \"Smoking\"))\nsim_data$LowBirthweight <- factor(sim_data$LowBirthweight, \n                                  levels = c(0, 1), \n                                  labels = c(\"Normal Birthweight\", \"Low Birthweight\"))\n# Create a density plot for birth weight distribution by smoking status\nggplot(sim_data, aes(x = BirthWeight, fill = Smoking, color = Smoking)) +\n  geom_density(alpha = 0.3, size = 1.2) +\n  geom_vline(xintercept = 2500, linetype = \"solid\", color = \"black\", size = 1) +\n  scale_fill_manual(values = c(\"Smoking\" = \"red\", \"Non-smoking\" = \"blue\")) +\n  scale_color_manual(values = c(\"Smoking\" = \"red\", \"Non-smoking\" = \"blue\")) +\n  labs(title = \"Distribution of Birth Weights by Smoking Status\",\n    subtitle = \"Low Birth Weight (LBW) is typically defined as a birth weight of less than 2,500 grams\",\n       x = \"Birth Weight (g)\", \n       y = \"Density\",\n       fill = \"Smoking Status\",\n       color = \"Smoking Status\") +\n  theme_minimal() +\n  theme(legend.position = \"top\")\n```\n\n::: {.cell-output-display}\n![](confounding3b_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n### Analysis\n\n#### Crude Bivariate Relationships\n\n\n::: {.cell hash='confounding3b_cache/html/unnamed-chunk-6_7b3a4df9f3530d282d1563a5d2fb179c'}\n\n```{.r .cell-code}\n# Calculate the summary statistics (mean birth weight, LBW prevalence, and mortality prevalence) by smoking status\nsummary_stats <- sim_data %>%\n  group_by(Smoking) %>%\n  summarise(\n    mean_birthweight = mean(BirthWeight, na.rm = TRUE),  # Mean birth weight\n    prevalence_LBW = mean(LowBirthweight == \"Low Birthweight\") * 100,  # Prevalence of LBW in percentage\n    prevalence_mortality = mean(Mortality) * 100  # Prevalence of mortality in percentage\n  ) %>%\n  mutate(\n    mean_birthweight = format(round(mean_birthweight, 1), big.mark = \",\"),  # Round and format birth weight\n    prevalence_LBW = round(prevalence_LBW, 1),  # Round LBW prevalence to 1 decimal place\n    prevalence_mortality = round(prevalence_mortality, 1)  # Round mortality prevalence to 1 decimal place\n  )\n\n# Display the formatted table with kable\nsummary_stats %>%\n  kable(\"html\", caption = \"Summary Statistics: Mean Birth Weight, LowBirthWeight (LBW) Prevalence, and Mortality Prevalence\") %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\"), \n                full_width = FALSE, \n                position = \"center\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>Summary Statistics: Mean Birth Weight, LowBirthWeight (LBW) Prevalence, and Mortality Prevalence</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Smoking </th>\n   <th style=\"text-align:left;\"> mean_birthweight </th>\n   <th style=\"text-align:right;\"> prevalence_LBW </th>\n   <th style=\"text-align:right;\"> prevalence_mortality </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Non-smoking </td>\n   <td style=\"text-align:left;\"> 2,895.1 </td>\n   <td style=\"text-align:right;\"> 36.6 </td>\n   <td style=\"text-align:right;\"> 45.8 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Smoking </td>\n   <td style=\"text-align:left;\"> 2,552.5 </td>\n   <td style=\"text-align:right;\"> 67.9 </td>\n   <td style=\"text-align:right;\"> 66.2 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n#### Analysis Part 1: Attempting to Estimate the Direct Effect\n\nWe now show what happens when we adjust for **LowBirthweight**, which acts as a collider.\n\n\n::: {.cell hash='confounding3b_cache/html/unnamed-chunk-7_704d9abecafc2abf020a407fb7d195d0'}\n\n```{.r .cell-code}\n# Model adjusted for LowBirthweight (incorrect adjustment)\nfit_incorrect <- glm(Mortality ~ Smoking + LowBirthweight, family = binomial(), data = sim_data)\npublish(fit_incorrect, print = FALSE)$regressionTable %>%\n  kable(\"html\", caption = \"Adjusted Model Regression Table\") %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\"), \n                full_width = FALSE, \n                position = \"center\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>Adjusted Model Regression Table</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Variable </th>\n   <th style=\"text-align:left;\"> Units </th>\n   <th style=\"text-align:left;\"> OddsRatio </th>\n   <th style=\"text-align:left;\"> CI.95 </th>\n   <th style=\"text-align:left;\"> p-value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Smoking </td>\n   <td style=\"text-align:left;\"> Non-smoking </td>\n   <td style=\"text-align:left;\"> Ref </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> Smoking </td>\n   <td style=\"text-align:left;\"> 0.73 </td>\n   <td style=\"text-align:left;\"> [0.63;0.84] </td>\n   <td style=\"text-align:left;\"> &lt;1e-04 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> LowBirthweight </td>\n   <td style=\"text-align:left;\"> Normal Birthweight </td>\n   <td style=\"text-align:left;\"> Ref </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> Low Birthweight </td>\n   <td style=\"text-align:left;\"> 59.40 </td>\n   <td style=\"text-align:left;\"> [51.75;68.18] </td>\n   <td style=\"text-align:left;\"> &lt;1e-04 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n**Explanation**: To estimate the direct effect of smoking (the effect not mediated through birthweight), the standard approach would be to adjust for the mediator, `LowBirthweight`. However, in this causal structure, this adjustment is incorrect because it simultaneously conditions on a collider. This opens a spurious backdoor path between `Smoking` and `Unmeasured`, introducing collider bias. The resulting odds ratio of 0.73 is not a valid estimate of the direct effect; it is a hopelessly biased number.\n\n#### Stratification\n\nWe will now stratify the data by **Low Birthweight** and calculate the effect of smoking on mortality separately for **low birthweight** and **normal birthweight** infants.\n\n\n::: {.cell hash='confounding3b_cache/html/unnamed-chunk-8_ce0065b800155f58824c14cf26e9dbd5'}\n\n```{.r .cell-code}\n# Subset for low birthweight\nfit_stratified_LBW <- glm(Mortality ~ Smoking, family = binomial(), data = subset(sim_data, LowBirthweight == \"Low Birthweight\"))\npublish(fit_stratified_LBW, print = FALSE)$regressionTable %>%\n  kable(\"html\", caption = \"Stratified Model Regression Table\") %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\"), \n                full_width = FALSE, \n                position = \"center\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>Stratified Model Regression Table</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Variable </th>\n   <th style=\"text-align:left;\"> Units </th>\n   <th style=\"text-align:left;\"> OddsRatio </th>\n   <th style=\"text-align:left;\"> CI.95 </th>\n   <th style=\"text-align:left;\"> p-value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Smoking </td>\n   <td style=\"text-align:left;\"> Non-smoking </td>\n   <td style=\"text-align:left;\"> Ref </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> Smoking </td>\n   <td style=\"text-align:left;\"> 0.69 </td>\n   <td style=\"text-align:left;\"> [0.55;0.85] </td>\n   <td style=\"text-align:left;\"> 0.000565 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n\n```{.r .cell-code}\n\n# Subset for normal birthweight\nfit_stratified_NBW <- glm(Mortality ~ Smoking, family = binomial(), data = subset(sim_data, LowBirthweight == \"Normal Birthweight\"))\npublish(fit_stratified_NBW, print = FALSE)$regressionTable %>%\n  kable(\"html\", caption = \"Stratified Model Regression Table\") %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\"), \n                full_width = FALSE, \n                position = \"center\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>Stratified Model Regression Table</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Variable </th>\n   <th style=\"text-align:left;\"> Units </th>\n   <th style=\"text-align:left;\"> OddsRatio </th>\n   <th style=\"text-align:left;\"> CI.95 </th>\n   <th style=\"text-align:left;\"> p-value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Smoking </td>\n   <td style=\"text-align:left;\"> Non-smoking </td>\n   <td style=\"text-align:left;\"> Ref </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> Smoking </td>\n   <td style=\"text-align:left;\"> 0.77 </td>\n   <td style=\"text-align:left;\"> [0.63;0.93] </td>\n   <td style=\"text-align:left;\"> 0.007758 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n#### Interaction Approach\n\nWe include an interaction term between **Smoking** and **LowBirthweight** to test whether the effect of smoking on mortality differs by birthweight status.\n\n\n::: {.cell hash='confounding3b_cache/html/unnamed-chunk-9_e5c5f480b668bb463b8647bf32523a4d'}\n\n```{.r .cell-code}\nfit_interaction <- glm(Mortality ~ Smoking * LowBirthweight, family = binomial(), data = sim_data)\npublish(fit_interaction, print = FALSE)$regressionTable %>%\n  kable(\"html\", caption = \"Interaction Model Regression Table\") %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\"), \n                full_width = FALSE, \n                position = \"center\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>Interaction Model Regression Table</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Variable </th>\n   <th style=\"text-align:left;\"> Units </th>\n   <th style=\"text-align:left;\"> OddsRatio </th>\n   <th style=\"text-align:left;\"> CI.95 </th>\n   <th style=\"text-align:left;\"> p-value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Smoking(Non-smoking): LowBirthweight(Low Birthweight vs Normal Birthweight) </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> 61.73 </td>\n   <td style=\"text-align:left;\"> [52.00;73.28] </td>\n   <td style=\"text-align:left;\"> &lt; 1e-04 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Smoking(Smoking): LowBirthweight(Low Birthweight vs Normal Birthweight) </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> 55.21 </td>\n   <td style=\"text-align:left;\"> [43.70;69.74] </td>\n   <td style=\"text-align:left;\"> &lt; 1e-04 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> LowBirthweight(Normal Birthweight): Smoking(Smoking vs Non-smoking) </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> 0.77 </td>\n   <td style=\"text-align:left;\"> [0.63;0.93] </td>\n   <td style=\"text-align:left;\"> 0.007758 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> LowBirthweight(Low Birthweight): Smoking(Smoking vs Non-smoking) </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> 0.69 </td>\n   <td style=\"text-align:left;\"> [0.55;0.85] </td>\n   <td style=\"text-align:left;\"> 0.000565 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n#### Correct Approach: No Adjustment for LowBirthweight\n\nTo estimate the total causal effect of smoking on mortality (the net effect through all pathways), we must not adjust for the mediator, `LowBirthweight`. Our DAG shows no other open backdoor paths that need blocking. Therefore, the unadjusted model correctly estimates the total causal effect.\n\n\n::: {.cell hash='confounding3b_cache/html/unnamed-chunk-10_42c2cc54e0da49b051aede467290355f'}\n\n```{.r .cell-code}\n# Correct model (no adjustment for LowBirthweight)\nfit_correct <- glm(Mortality ~ Smoking, family = binomial(), data = sim_data)\npublish(fit_correct, print = FALSE)$regressionTable %>%\n  kable(\"html\", caption = \"Unadjusted Model Regression Table\") %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\"), \n                full_width = FALSE, \n                position = \"center\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>Unadjusted Model Regression Table</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Variable </th>\n   <th style=\"text-align:left;\"> Units </th>\n   <th style=\"text-align:left;\"> OddsRatio </th>\n   <th style=\"text-align:left;\"> CI.95 </th>\n   <th style=\"text-align:left;\"> p-value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Smoking </td>\n   <td style=\"text-align:left;\"> Non-smoking </td>\n   <td style=\"text-align:left;\"> Ref </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> Smoking </td>\n   <td style=\"text-align:left;\"> 2.31 </td>\n   <td style=\"text-align:left;\"> [2.12;2.53] </td>\n   <td style=\"text-align:left;\"> &lt;1e-04 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n#### Comparing Estimates\n\n\n::: {.cell hash='confounding3b_cache/html/unnamed-chunk-11_bf9aab00204e9987012cc5ea64945474'}\n\n```{.r .cell-code}\n# Extract ORs from publish output for each model\nor_incorrect <- publish(fit_incorrect, print = FALSE)$regressionTable[2, \"OddsRatio\"]\nor_stratified_LBW <- publish(fit_stratified_LBW, print = FALSE)$regressionTable[2, \"OddsRatio\"]\nor_stratified_NBW <- publish(fit_stratified_NBW, print = FALSE)$regressionTable[2, \"OddsRatio\"]\nor_interaction1 <- publish(fit_interaction, print = FALSE)$regressionTable[3, \"OddsRatio\"]\nor_interaction2 <- publish(fit_interaction, print = FALSE)$regressionTable[4, \"OddsRatio\"]\n```\n:::\n\n\n![DAG plot with incorrect adjustment](Images/confounding/daginc.png)\n\n\n::: {.cell hash='confounding3b_cache/html/unnamed-chunk-12_e974ea01c32e1b6778e893e2735251a6'}\n\n```{.r .cell-code}\n# Extract ORs from publish output for correct model\nor_correct <- publish(fit_correct, print = FALSE)$regressionTable[2, \"OddsRatio\"]\n```\n:::\n\n\n![DAG plot with no adjustment](Images/confounding/dag.png)\n\nNow we compare the estimates from:\n\n-   The incorrect model (adjusted for LowBirthweight), with an OR of 0.73.\n-   The stratified model\n    -   for **low birthweight** infants, with an OR of 0.69.\n    -   for **normal birthweight** infants, with an OR of 0.77.\n-   The interaction model, where the OR for **smokers** is\n    -   0.69 (Low Birthweight),\n    -   0.77 (Normal Birthweight).\n-   The correct model (unadjusted for LowBirthweight), with an OR of 2.31.\n\nThese comparisons highlight how adjusting for a collider (Low Birthweight) introduces bias, while avoiding this adjustment gives an unbiased estimate of the effect of **Smoking** on **Mortality**.\n\n#### Visualizing Estimates\n\n\n::: {.cell hash='confounding3b_cache/html/unnamed-chunk-13_c281b680ee1c0d8a9706e359a81c217e'}\n\n```{.r .cell-code}\n# Helper function to clean and convert ORs and CIs\nextract_or_ci <- function(or_str, ci_str) {\n  or_val <- ifelse(or_str == \"Ref\", NA, as.numeric(or_str))  # Convert OR to numeric, handle Ref\n  \n  # Split the CI string, handle empty or malformed CI strings\n  if (ci_str != \"\" && grepl(\"\\\\[\", ci_str)) {\n    ci_vals <- as.numeric(gsub(\"\\\\[|\\\\]\", \"\", unlist(strsplit(ci_str, \";\"))))  # Split and convert CI\n  } else {\n    ci_vals <- c(NA, NA)  # Handle missing CIs\n  }\n  \n  return(list(OR = or_val, CI.lower = ci_vals[1], CI.upper = ci_vals[2]))\n}\n\n# Extract ORs and CIs for each model using the helper function\nor_ci_incorrect <- extract_or_ci(publish(fit_incorrect, print = FALSE)$regressionTable[2, \"OddsRatio\"],\n                                 publish(fit_incorrect, print = FALSE)$regressionTable[2, \"CI.95\"])\n\nor_ci_stratified_LBW <- extract_or_ci(publish(fit_stratified_LBW, print = FALSE)$regressionTable[2, \"OddsRatio\"],\n                                      publish(fit_stratified_LBW, print = FALSE)$regressionTable[2, \"CI.95\"])\n\nor_ci_stratified_NBW <- extract_or_ci(publish(fit_stratified_NBW, print = FALSE)$regressionTable[2, \"OddsRatio\"],\n                                      publish(fit_stratified_NBW, print = FALSE)$regressionTable[2, \"CI.95\"])\n\nor_ci_interaction1 <- extract_or_ci(publish(fit_interaction, print = FALSE)$regressionTable[3, \"OddsRatio\"],\n                                    publish(fit_interaction, print = FALSE)$regressionTable[3, \"CI.95\"])\n\nor_ci_interaction2 <- extract_or_ci(publish(fit_interaction, print = FALSE)$regressionTable[4, \"OddsRatio\"],\n                                    publish(fit_interaction, print = FALSE)$regressionTable[4, \"CI.95\"])\n\nor_ci_correct <- extract_or_ci(publish(fit_correct, print = FALSE)$regressionTable[2, \"OddsRatio\"],\n                               publish(fit_correct, print = FALSE)$regressionTable[2, \"CI.95\"])\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Step 2: Create a data frame for the forest plot\nforest_data <- data.frame(\n  Model = c(\"Incorrect (Adjusted for LBW)\",\n            \"Stratified (Low Birthweight)\",\n            \"Stratified (Normal Birthweight)\",\n            \"Interaction (Low Birthweight)\",\n            \"Interaction (Normal Birthweight)\",\n            \"Correct (Unadjusted)\"),\n  OR = c(or_ci_incorrect$OR, or_ci_stratified_LBW$OR, or_ci_stratified_NBW$OR, or_ci_interaction2$OR, or_ci_interaction1$OR, or_ci_correct$OR),\n  CI.lower = c(or_ci_incorrect$CI.lower, or_ci_stratified_LBW$CI.lower, or_ci_stratified_NBW$CI.lower, or_ci_interaction2$CI.lower, or_ci_interaction1$CI.lower, or_ci_correct$CI.lower),\n  CI.upper = c(or_ci_incorrect$CI.upper, or_ci_stratified_LBW$CI.upper, or_ci_stratified_NBW$CI.upper, or_ci_interaction2$CI.upper, or_ci_interaction1$CI.upper, or_ci_correct$CI.upper)\n)\n\n# Display the data frame to ensure it's correct\nprint(forest_data)\n#>                              Model   OR CI.lower CI.upper\n#> 1     Incorrect (Adjusted for LBW) 0.73     0.63     0.84\n#> 2     Stratified (Low Birthweight) 0.69     0.55     0.85\n#> 3  Stratified (Normal Birthweight) 0.77     0.63     0.93\n#> 4    Interaction (Low Birthweight) 0.69     0.55     0.85\n#> 5 Interaction (Normal Birthweight) 0.77     0.63     0.93\n#> 6             Correct (Unadjusted) 2.31     2.12     2.53\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create the forest plot\nggplot(forest_data, aes(x = OR, y = Model)) +\n  geom_point(size = 3) +\n  geom_errorbarh(aes(xmin = CI.lower, xmax = CI.upper), height = 0.2) +\n  geom_vline(xintercept = 1, linetype = \"dashed\", color = \"red\") +  # Reference line at OR = 1\n  labs(title = \"Forest Plot of OR\",\n       x = \"Odds Ratio (OR) and Confidence Intervals\",\n       y = \"\") +\n  theme_minimal() +\n  theme(axis.text.y = element_text(size = 12),\n        axis.title.x = element_text(size = 14),\n        plot.title = element_text(size = 16, face = \"bold\"))\n```\n\n::: {.cell-output-display}\n![](confounding3b_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n### Clarifying the Target: Total Effect vs. Direct Effect\n\nA frequent source of confusion in causal analysis is the failure to distinguish between different causal questions, or \"estimands.\" The tutorial correctly demonstrates how to estimate the total causal effect of smoking, while the user's query focuses on the direct effect. These are distinct quantities that require different analytical strategies.\n\n- **Total Causal Effect**: This estimand represents the overall impact of the exposure on the outcome, encompassing all causal pathways. It answers the question: \"What is the net effect of a mother smoking versus not smoking on the risk of infant mortality?\" To estimate the TCE, an analyst must block all non-causal \"back-door\" paths between the exposure and outcome. In the provided DAG, there are no open back-door paths from `Smoking` to `Mortality`. The path through `LowBirthweight` is a front-door (causal) path, and the path involving the `Unmeasured` variable is blocked by the collider `LowBirthweight`. Therefore, as the tutorial's \"Correct Approach\" shows, the total causal effect is correctly estimated by a simple unadjusted regression of `Mortality` on `Smoking`, which yields an Odds Ratio (OR) of 2.31.  \n\n- **Direct Effect**: This estimand represents the effect of the exposure on the outcome that does not operate through a specific mediator. It answers the question: \"What is the effect of a mother smoking on infant mortality, independent of its effect on the baby's birth weight?\" As noted above, the conventional (though in this case, incorrect) approach to isolating this effect is to include the mediator as a covariate in a regression model. The tutorial's \"Incorrect Adjustment\" section performs exactly this, regressing `Mortality` on both `Smoking` and `LowBirthweight`. \n\n\n\n### Causal Questions Dictate Correct Methods\n\nThe Birthweight Paradox is a powerful lesson in causal inference. It demonstrates that a naive statistical adjustment, without regard for the underlying causal structure, can produce results that are not just wrong, but dangerously misleading.\n\n- **The \"paradox\" is resolved by causal reasoning**: The reversal is caused by conditioning on `LowBirthweight`, a variable that is simultaneously a mediator of the effect we want to study and a collider that introduces bias from an unmeasured variable.\n\n- **The analysis must match the question**:\n\n  - To estimate the **total effect** of smoking, we must *not* adjust for the mediator/collider. The unadjusted OR of 2.31 is the correct estimate for this question.\n\n  - Estimating the **direct effect** is not possible with simple adjustment in this scenario. The adjusted OR of 0.73 is a biased artifact and does not represent a real causal effect.\n\n::: callout-tip\n###  The Quest for the Direct Effect: A Fundamental Problem of Identifiability\n\nEstimating the direct effect (\"What is the effect of smoking on mortality that is not mediated by birthweight?\") is \"not possible with simple adjustment\" because the necessary information to disentangle the direct effect from the confounding effect of the Unmeasured variable is simply not present in the observable data (`Smoking`, `LowBirthweight`, `Mortality`). No matter how sophisticated a regression model one fits using only these observed variables, it cannot recover an unbiased estimate of the (natural) direct effect. The problem is not with the statistical tool, but with the fundamental limits of what the data can reveal given the causal reality depicted by the DAG. The language of potential outcomes makes this challenge explicit, as it requires estimating \"cross-world\" counterfactuals (e.g., the outcome under smoking with the mediator at its non-smoking level), which is impossible when an unmeasured confounder links the worlds of the mediator and the outcome. \n\nAdvanced methods such as instrumental variable analysis represents a powerful theoretical alternative for achieving identification in the face of unmeasured confounding. However, it should not be seen as a simple or universally applicable solution. It requires a fundamental shift in the \"burden of belief\" from the assumption of no unmeasured confounding (sequential ignorability) to a different, and often more stringent, set of untestable assumptions about the existence of a valid instrument. The choice between these analytical frameworks is not a statistical one, but a scientific one, based on which set of assumptions is most defensible in a specific research context.\n::: \n\n- **Key Insight**: The most important step in an analysis is to draw a DAG based on subject-matter knowledge. This causal map is essential for identifying which variables to adjust for and which to leave alone to answer your specific research question correctly.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\r\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\r\n<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}