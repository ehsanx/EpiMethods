{
  "hash": "026ca64f392937923a4d6b41dff19653",
  "result": {
    "engine": "knitr",
    "markdown": "## Predictive question-1 {.unnumbered}\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load required packages\nrequire(tableone)\nrequire(Publish)\nrequire(MatchIt)\nrequire(cobalt)\nrequire(ggplot2)\n```\n:::\n\n\n### Working with a Predictive question using RHC\n\nThis tutorial delves into processing and understanding the right heart catheterization (RHC) dataset, which pertains to patients in the intensive care unit. The dataset is particularly centered around the implications of using RHC in the early phases of care, with a focus on comparing two patient groups: those who received the RHC procedure and those who did not. The key outcome being analyzed is the 30-day survival rate. We will use this as an example to explain how to work with a predictive research question to build the analytic data.\n\n::: column-margin\n[Link for the RHC dataset](https://search.r-project.org/CRAN/refmans/ATbounds/html/RHC.html)\n:::\n\n[@connors1996effectiveness] published an article in [JAMA](https://jamanetwork.com/journals/jama). The article is about managing or guiding therapy for the critically ill patients in the intensive care unit. They considered a number of **health-outcomes** such as\n\n-   *length of stay* (hospital stay; measured continuously)\n-   *death* within certain period (death at any time up to 180 Days; measured as a binary variable)\n\nThe original article was concerned about the association of right heart catheterization *(RHC)* use during the first 24 hours of care in the intensive care unit and the health-outcomes mentioned above.\n\nBut we will use this data as a case study for our **prediction modelling**. Traditional PICOT framework is designed primarily for clinical questions related to interventions, so when applying it to other areas like predictive modeling, some creative adaptation is needed.\n\n| Aspect | Description                                                    |\n|--------|----------------------------------------------------------------|\n| **P**  | Patients who are critically ill                                |\n| **I**  | Not applicable, as we are dealing with a prediction model here |\n| **C**  | Not applicable, as we are dealing with a prediction model here |\n| **O**  | in-hospital mortality                                          |\n| **T**  | Between 1989 to 1994 (see the JAMA paper)                      |\n\n::: column-margin\nWe are interested in developing a prediction model for the length of stay.\n:::\n\n### Data download\n\nData is freely available from [Vanderbilt Biostatistics](https://hbiostat.org/data/), variable list is available [here](https://hbiostat.org/data/repo/rhc.html), and the article is freely available from [researchgate](https://www.researchgate.net/profile/Neal-Dawson/publication/236311165_The_Effectiveness_of_Right_Heart_Catheterization_in_the_Initial_Care_of_Critically_III_Patients/links/00b4951fbfa1e051c1000000/The-Effectiveness-of-Right-Heart-Catheterization-in-the-Initial-Care-of-Critically-III-Patients.pdf?_sg%5B0%5D=w-YI1LtI2m34BhMjYD0VGHX5aKtQK5GC0LPU6kGK-_DtVUlZEYOa7_3mMfXk4kxuk0kkbv17Az5L_wNnXBrLnA.cxps1WB76ZpE9eh5Jec453LXKtQ43wuYJ387_IkhN7ZyqQpnMH19d5QsQjdkAz0unUi-vBbjV9HVdx0kvP9K_Q.roLHhvXmlNj_o0ZyC9Ka5c1zj3W4kOJkxuthqWjtSIbB7feq5Am4P47RlHjT0ukvWHAWFaPol2f58a_0v9azaw&_sg%5B1%5D=BjoiK5iqNKf-0ZsH38KwJJ4oUxNRQdVgxfyBeVp_c5Y1WEEspsEwnD1MXeDteXf4y5gsDvAKL-fwqzhoYP1OsiKWDDlX3ccFYn6yASd9oKKq.cxps1WB76ZpE9eh5Jec453LXKtQ43wuYJ387_IkhN7ZyqQpnMH19d5QsQjdkAz0unUi-vBbjV9HVdx0kvP9K_Q.roLHhvXmlNj_o0ZyC9Ka5c1zj3W4kOJkxuthqWjtSIbB7feq5Am4P47RlHjT0ukvWHAWFaPol2f58a_0v9azaw&_iepl=).\n\n::: column-margin\n[RHC Data](https://hbiostat.org/data/) amd search for right heart catheterization dataset\n:::\n\n::: column-margin\n[Variable list](https://hbiostat.org/data/repo/rhc.html)\n:::\n\n::: column-margin\n[Article](https://www.researchgate.net/profile/Neal-Dawson/publication/236311165_The_Effectiveness_of_Right_Heart_Catheterization_in_the_Initial_Care_of_Critically_III_Patients/links/00b4951fbfa1e051c1000000/The-Effectiveness-of-Right-Heart-Catheterization-in-the-Initial-Care-of-Critically-III-Patients.pdf?_sg%5B0%5D=w-YI1LtI2m34BhMjYD0VGHX5aKtQK5GC0LPU6kGK-_DtVUlZEYOa7_3mMfXk4kxuk0kkbv17Az5L_wNnXBrLnA.cxps1WB76ZpE9eh5Jec453LXKtQ43wuYJ387_IkhN7ZyqQpnMH19d5QsQjdkAz0unUi-vBbjV9HVdx0kvP9K_Q.roLHhvXmlNj_o0ZyC9Ka5c1zj3W4kOJkxuthqWjtSIbB7feq5Am4P47RlHjT0ukvWHAWFaPol2f58a_0v9azaw&_sg%5B1%5D=BjoiK5iqNKf-0ZsH38KwJJ4oUxNRQdVgxfyBeVp_c5Y1WEEspsEwnD1MXeDteXf4y5gsDvAKL-fwqzhoYP1OsiKWDDlX3ccFYn6yASd9oKKq.cxps1WB76ZpE9eh5Jec453LXKtQ43wuYJ387_IkhN7ZyqQpnMH19d5QsQjdkAz0unUi-vBbjV9HVdx0kvP9K_Q.roLHhvXmlNj_o0ZyC9Ka5c1zj3W4kOJkxuthqWjtSIbB7feq5Am4P47RlHjT0ukvWHAWFaPol2f58a_0v9azaw&_iepl=)\n:::\n\nLet us download the dataset and save it for later use.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load the dataset\nObsData <- read.csv(\"https://hbiostat.org/data/repo/rhc.csv\", \n                    header = TRUE)\n\n# Save the dataset\nsaveRDS(ObsData, file = \"Data/researchquestion/rhc.RDS\")\n```\n:::\n\n\n### Creating analytic dataset\n\nNow, we show the process of preparing our analytic dataset (i.e., ready to use dataset for our analysis), so that the variables generally match with the way the authors were coded in the original article. Below we show the process of creating the analytic dataset.\n\n#### Add column for outcome: length of stay\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Length of Stay = date of discharge - study admission date\nObsData$Length.of.Stay <- ObsData$dschdte - ObsData$sadmdte\n\n# Length of Stay = date of death - study admission date if date of discharge not available\nObsData$Length.of.Stay[is.na(ObsData$Length.of.Stay)] <- \n  ObsData$dthdte[is.na(ObsData$Length.of.Stay)] - \n  ObsData$sadmdte[is.na(ObsData$Length.of.Stay)]\n```\n:::\n\n\n#### Recoding column for outcome: death\n\n::: callout-tip\nHere we use the `ifelse` function to create a categorical variable. Other related functions are `cut`, `car`.\n:::\n\nLet us recode our outcome variable as a binary variable:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nObsData$death <- ifelse(ObsData$death == \"Yes\", 1, 0)\n```\n:::\n\n\n#### Remove unnecessary outcomes\n\nOur next task is to remove unnecessary outcomes:\n\n::: callout-tip\nThere are multiple ways to drop variables from a dataset. E.g., without using any package and using the `select` function from the dplyr package.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nObsData <- dplyr::select(ObsData, !c(dthdte, lstctdte, dschdte, \n                            t3d30, dth30, surv2md1))\n```\n:::\n\n\n#### Remove unnecessary and problematic variables\n\nNow we will drop unnecessary and problematic variables:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nObsData <- dplyr::select(ObsData, !c(sadmdte, ptid, X, adld3p, \n                                     urin1, cat2))\n```\n:::\n\n\n#### Basic data cleanup\n\nNow we will do some basic cleanup.\n\n::: callout-tip\nWe an use the `lapply` function to convert all categorical variables to factors at once. Not that a similar function to `lapply` is `sapply`. The main difference is that sapply attempts to convert the result into a vector or matrix, while lapply returns a list.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# convert all categorical variables to factors\nfactors <- c(\"cat1\", \"ca\", \"death\", \"cardiohx\", \"chfhx\", \n             \"dementhx\", \"psychhx\", \"chrpulhx\", \"renalhx\", \n             \"liverhx\", \"gibledhx\", \"malighx\", \"immunhx\", \n             \"transhx\", \"amihx\", \"sex\", \"dnr1\", \"ninsclas\", \n             \"resp\", \"card\", \"neuro\", \"gastr\", \"renal\", \"meta\", \n             \"hema\", \"seps\", \"trauma\", \"ortho\", \"race\", \n             \"income\")\nObsData[factors] <- lapply(ObsData[factors], as.factor)\n\n# convert RHC.use (RHC vs. No RHC) to a binary variable\nObsData$RHC.use <- ifelse(ObsData$swang1 == \"RHC\", 1, 0)\nObsData <- dplyr::select(ObsData, !swang1)\n\n# Categorize the variables to match with the original paper\nObsData$age <- cut(ObsData$age, breaks=c(-Inf, 50, 60, 70, 80, Inf),\n                   right=FALSE)\nObsData$race <- factor(ObsData$race, \n                       levels=c(\"white\",\"black\",\"other\"))\nObsData$sex <- as.factor(ObsData$sex)\nObsData$sex <- relevel(ObsData$sex, ref = \"Male\")\nObsData$cat1 <- as.factor(ObsData$cat1)\nlevels(ObsData$cat1) <- c(\"ARF\",\"CHF\",\"Other\",\"Other\",\"Other\",\n                          \"Other\",\"Other\",\"MOSF\",\"MOSF\")\nObsData$ca <- as.factor(ObsData$ca)\nlevels(ObsData$ca) <- c(\"Metastatic\",\"None\",\"Localized (Yes)\")\nObsData$ca <- factor(ObsData$ca, levels=c(\"None\", \"Localized (Yes)\",\n                                          \"Metastatic\"))\n```\n:::\n\n\n#### Rename variables\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Rename the variables\nnames(ObsData) <- c(\"Disease.category\", \"Cancer\", \"Death\", \n                    \"Cardiovascular\", \"Congestive.HF\", \n                    \"Dementia\", \"Psychiatric\", \"Pulmonary\", \n                    \"Renal\", \"Hepatic\", \"GI.Bleed\", \"Tumor\", \n                    \"Immunosupperssion\", \"Transfer.hx\", \"MI\", \n                    \"age\", \"sex\", \"edu\", \"DASIndex\", \n                    \"APACHE.score\", \"Glasgow.Coma.Score\", \n                    \"blood.pressure\", \"WBC\", \"Heart.rate\",\n                    \"Respiratory.rate\",  \"Temperature\",\n                    \"PaO2vs.FIO2\", \"Albumin\", \"Hematocrit\", \n                    \"Bilirubin\", \"Creatinine\", \"Sodium\", \n                    \"Potassium\", \"PaCo2\",  \"PH\", \"Weight\", \n                    \"DNR.status\", \"Medical.insurance\", \n                    \"Respiratory.Diag\", \"Cardiovascular.Diag\", \n                    \"Neurological.Diag\", \"Gastrointestinal.Diag\",\n                    \"Renal.Diag\", \"Metabolic.Diag\", \n                    \"Hematologic.Diag\", \"Sepsis.Diag\", \n                    \"Trauma.Diag\", \"Orthopedic.Diag\", \n                    \"race\", \"income\", \n                    \"Length.of.Stay\", \"RHC.use\")\n\n# Save the dataset\nsaveRDS(ObsData, file = \"Data/researchquestion/rhcAnalytic.RDS\")\n```\n:::\n\n\n### Notations\n\nlet us introduce with some notations:\n\n| Notations               | Example in RHC study  |\n|-------------------------|-----------------------|\n| $Y_1$: Observed outcome | length of stay        |\n| $Y_2$: Observed outcome | death within 3 months |\n| $L$: Covariates         | See below             |\n\n### Basic data exploration\n\n#### Dimension\n\nLet us the how many rows and columns we have:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndim(ObsData)\n#> [1] 5735   52\n```\n:::\n\n\n#### Comprehensive summary\n\nLet us see the summary statistics of the variables:\n\n::: callout-tip\nTo see the comprehensive summary of the variables, we can use the `skim` function form skimr package or `describe` function from rms package\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(skimr)\n#> Loading required package: skimr\n#> Warning: package 'skimr' was built under R version 4.2.3\nskim(ObsData)\n```\n\n::: {.cell-output-display}\n\nTable: Data summary\n\n|                         |        |\n|:------------------------|:-------|\n|Name                     |ObsData |\n|Number of rows           |5735    |\n|Number of columns        |52      |\n|_______________________  |        |\n|Column type frequency:   |        |\n|factor                   |31      |\n|numeric                  |21      |\n|________________________ |        |\n|Group variables          |None    |\n\n\n**Variable type: factor**\n\n|skim_variable         | n_missing| complete_rate|ordered | n_unique|top_counts                                |\n|:---------------------|---------:|-------------:|:-------|--------:|:-----------------------------------------|\n|Disease.category      |         0|             1|FALSE   |        4|ARF: 2490, MOS: 1626, Oth: 1163, CHF: 456 |\n|Cancer                |         0|             1|FALSE   |        3|Non: 4379, Loc: 972, Met: 384             |\n|Death                 |         0|             1|FALSE   |        2|1: 3722, 0: 2013                          |\n|Cardiovascular        |         0|             1|FALSE   |        2|0: 4722, 1: 1013                          |\n|Congestive.HF         |         0|             1|FALSE   |        2|0: 4714, 1: 1021                          |\n|Dementia              |         0|             1|FALSE   |        2|0: 5171, 1: 564                           |\n|Psychiatric           |         0|             1|FALSE   |        2|0: 5349, 1: 386                           |\n|Pulmonary             |         0|             1|FALSE   |        2|0: 4646, 1: 1089                          |\n|Renal                 |         0|             1|FALSE   |        2|0: 5480, 1: 255                           |\n|Hepatic               |         0|             1|FALSE   |        2|0: 5334, 1: 401                           |\n|GI.Bleed              |         0|             1|FALSE   |        2|0: 5550, 1: 185                           |\n|Tumor                 |         0|             1|FALSE   |        2|0: 4419, 1: 1316                          |\n|Immunosupperssion     |         0|             1|FALSE   |        2|0: 4192, 1: 1543                          |\n|Transfer.hx           |         0|             1|FALSE   |        2|0: 5073, 1: 662                           |\n|MI                    |         0|             1|FALSE   |        2|0: 5535, 1: 200                           |\n|age                   |         0|             1|FALSE   |        5|[-I: 1424, [60: 1389, [70: 1338, [50: 917 |\n|sex                   |         0|             1|FALSE   |        2|Mal: 3192, Fem: 2543                      |\n|DNR.status            |         0|             1|FALSE   |        2|No: 5081, Yes: 654                        |\n|Medical.insurance     |         0|             1|FALSE   |        6|Pri: 1698, Med: 1458, Pri: 1236, Med: 647 |\n|Respiratory.Diag      |         0|             1|FALSE   |        2|No: 3622, Yes: 2113                       |\n|Cardiovascular.Diag   |         0|             1|FALSE   |        2|No: 3804, Yes: 1931                       |\n|Neurological.Diag     |         0|             1|FALSE   |        2|No: 5042, Yes: 693                        |\n|Gastrointestinal.Diag |         0|             1|FALSE   |        2|No: 4793, Yes: 942                        |\n|Renal.Diag            |         0|             1|FALSE   |        2|No: 5440, Yes: 295                        |\n|Metabolic.Diag        |         0|             1|FALSE   |        2|No: 5470, Yes: 265                        |\n|Hematologic.Diag      |         0|             1|FALSE   |        2|No: 5381, Yes: 354                        |\n|Sepsis.Diag           |         0|             1|FALSE   |        2|No: 4704, Yes: 1031                       |\n|Trauma.Diag           |         0|             1|FALSE   |        2|No: 5683, Yes: 52                         |\n|Orthopedic.Diag       |         0|             1|FALSE   |        2|No: 5728, Yes: 7                          |\n|race                  |         0|             1|FALSE   |        3|whi: 4460, bla: 920, oth: 355             |\n|income                |         0|             1|FALSE   |        4|Und: 3226, $11: 1165, $25: 893, > $: 451  |\n\n\n**Variable type: numeric**\n\n|skim_variable      | n_missing| complete_rate|   mean|     sd|     p0|    p25|    p50|    p75|   p100|hist  |\n|:------------------|---------:|-------------:|------:|------:|------:|------:|------:|------:|------:|:-----|\n|edu                |         0|             1|  11.68|   3.15|   0.00|  10.00|  12.00|  13.00|  30.00|▁▇▃▁▁ |\n|DASIndex           |         0|             1|  20.50|   5.32|  11.00|  16.06|  19.75|  23.43|  33.00|▃▇▆▂▃ |\n|APACHE.score       |         0|             1|  54.67|  19.96|   3.00|  41.00|  54.00|  67.00| 147.00|▂▇▅▁▁ |\n|Glasgow.Coma.Score |         0|             1|  21.00|  30.27|   0.00|   0.00|   0.00|  41.00| 100.00|▇▂▂▁▁ |\n|blood.pressure     |         0|             1|  78.52|  38.05|   0.00|  50.00|  63.00| 115.00| 259.00|▆▇▆▁▁ |\n|WBC                |         0|             1|  15.65|  11.87|   0.00|   8.40|  14.10|  20.05| 192.00|▇▁▁▁▁ |\n|Heart.rate         |         0|             1| 115.18|  41.24|   0.00|  97.00| 124.00| 141.00| 250.00|▁▂▇▂▁ |\n|Respiratory.rate   |         0|             1|  28.09|  14.08|   0.00|  14.00|  30.00|  38.00| 100.00|▅▇▂▁▁ |\n|Temperature        |         0|             1|  37.62|   1.77|  27.00|  36.09|  38.09|  39.00|  43.00|▁▁▅▇▁ |\n|PaO2vs.FIO2        |         0|             1| 222.27| 114.95|  11.60| 133.31| 202.50| 316.62| 937.50|▇▇▁▁▁ |\n|Albumin            |         0|             1|   3.09|   0.78|   0.30|   2.60|   3.50|   3.50|  29.00|▇▁▁▁▁ |\n|Hematocrit         |         0|             1|  31.87|   8.36|   2.00|  26.10|  30.00|  36.30|  66.19|▁▆▇▃▁ |\n|Bilirubin          |         0|             1|   2.27|   4.80|   0.10|   0.80|   1.01|   1.40|  58.20|▇▁▁▁▁ |\n|Creatinine         |         0|             1|   2.13|   2.05|   0.10|   1.00|   1.50|   2.40|  25.10|▇▁▁▁▁ |\n|Sodium             |         0|             1| 136.77|   7.66| 101.00| 132.00| 136.00| 142.00| 178.00|▁▂▇▁▁ |\n|Potassium          |         0|             1|   4.07|   1.03|   1.10|   3.40|   3.80|   4.60|  11.90|▂▇▁▁▁ |\n|PaCo2              |         0|             1|  38.75|  13.18|   1.00|  31.00|  37.00|  42.00| 156.00|▃▇▁▁▁ |\n|PH                 |         0|             1|   7.39|   0.11|   6.58|   7.34|   7.40|   7.46|   7.77|▁▁▂▇▁ |\n|Weight             |         0|             1|  67.83|  29.06|   0.00|  56.30|  70.00|  83.70| 244.00|▂▇▁▁▁ |\n|Length.of.Stay     |         0|             1|  21.56|  25.87|   2.00|   7.00|  14.00|  25.00| 394.00|▇▁▁▁▁ |\n|RHC.use            |         0|             1|   0.38|   0.49|   0.00|   0.00|   0.00|   1.00|   1.00|▇▁▁▁▅ |\n\n\n:::\n:::\n\n\n### Predictive vs. causal models\n\nThe focus of current document is predictive models (e.g., predicting a health outcome).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/researchquestion/dagpred.png){width=50%}\n:::\n:::\n\n\nThe original article by @connors1996effectiveness focused on the association of\n\n::: column-margin\n@connors1996effectiveness\n:::\n\n-   right heart catheterization *(RHC)* use during the first 24 hours of care in the intensive care unit (exposure of primary interest) and\n-   the health-outcomes (such as length of stay).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/researchquestion/dagci.png){width=50%}\n:::\n:::\n\n\nThen the PICOT table changes as follows:\n\n| Aspect | Description                                       |\n|--------|---------------------------------------------------|\n| **P**  | Patients who are critically ill                   |\n| **I**  | Receiving a right heart catheterization (RHC)     |\n| **C**  | Not receiving a right heart catheterization (RHC) |\n| **O**  | length of stay                                    |\n| **T**  | Between 1989 to 1994 (see the JAMA paper)         |\n\n### Video content (optional)\n\n::: callout-tip\nFor those who prefer a video walkthrough, feel free to watch the video below, which offers a description of an earlier version of the above content.\n:::\n\n::: {style=\"position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;\"}\n<iframe src=\"https://www.youtube.com/embed/P37_A7sFTVY\" style=\"position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;\" allowfullscreen>\n\n</iframe>\n:::\n\n### References\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}