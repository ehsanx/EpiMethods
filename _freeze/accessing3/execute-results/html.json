{
  "hash": "ef058f7a558f6f923f7cdc55e88d1007",
  "result": {
    "markdown": "## Importing NHANES to R {.unnumbered}\n\nThis tutorial provides comprehensive instructions on accessing the National Health and Nutrition Examination Survey (NHANES) dataset from the US Centers for Disease Control and Prevention (CDC) website and importing it into the RStudio environment. It covers:\n\n1. Introduction to the NHANES dataset, highlighting its significance in evaluating the health and nutritional status of U.S. adults and children.\n2. Sampling Procedure details, explaining the multi-stage sampling strategy and emphasizing the importance of using survey features like weights, strata, and primary sampling units for population-level estimates.\n3. Survey History with a visualization representing different NHANES survey cycles.\n4. NHANES Data Files and Documents:\n- Explains the data's file format, mostly in SAS transport file format (.xpt).\n- Breaks down the NHANES components, which include demographics, dietary, examination, laboratory, and questionnaire data.\n- Provides guidelines on combining data from different cycles and handling missing data or outliers.\n5. Accessing NHANES Data:\n- Directly from the CDC website: A step-by-step guide with accompanying images, illustrating how to navigate the CDC website, download the data, and interpret the accompanying codebook.\n- Using R packages, specifically the nhanesA package: A concise guide on how to download and get summaries of the NHANES data using this R package.\n\n\n::: {.cell hash='accessing3_cache/html/setup_8549b58f8e4f0b357d4ca5f7a4b13272'}\n\n```{.r .cell-code}\n# Load required packages\n#devtools::install_github(\"warnes/SASxport\")\nlibrary(SASxport)\nlibrary(foreign)\nlibrary(nhanesA)\nlibrary(knitr)\nrequire(DiagrammeR)\nrequire(DiagrammeRsvg)\nrequire(rsvg)\nlibrary(magrittr)\nlibrary(svglite)\nlibrary(png)\nuse.saved.chche <- TRUE\n```\n:::\n\n\n::: column-margin\nBefore installing a package from GitHub, it's better to check whether you installed the right version of [Rtools](https://cran.r-project.org/bin/windows/Rtools/)\n:::\n\n### Overview\n\nNational Center for Health Statistics (NCHS) conducts National Health and Nutrition Examination Survey (NHANES) [@nhanes]. These surveys are designed to evaluate the health and nutritional status of U.S. adults and children. These surveys are being administered in two-year cycles or intervals starting from 1999-2000. Prior to 1999, a number of surveys were conducted (e.g., NHANES III), but in our discussion, we will mostly restrict our discussions to continuous NHANES (e.g., NHANES 1999-2000 to NHANES 2017-2018).\n\n::: column-margin\n@nhanes\n:::\n\n### Sampling Procedure:\n\nIt is a probabilistic sample (we know probability of getting selected for all individuals). This sample is unlikely to be representative of the entire population, as some under/oversampling occurs (unlike SRS), and samples may be dependent (due to proximity of some samples). For example, household with the following characteristics may be oversampled in NHANES, e.g., African Americans, Mexican Americans, Low income White Americans, Persons age 60+ years.\n\n::: column-margin\nSampling Procedure:\n\n-   not obtained via simple random sample\n-   multistage sample designs\n-   A sample weight is assigned to each sample person where weight = the number of people in the target population represented by that sample person in NHANES\n:::\n\nNHANES used multistage sample designs:\n\n-   Stage 1: PSU/clusters = geographically contiguous counties. 50 states - divided into \\~3100 counties. Each PSU is assigned to a strata (e.g., urban/rural or PSU size etc.). The counties are randomly/PPS selected using a 2-per-stratum design. Complex sample variance estimation requires PSU + strata (masking involved).\n-   Stage 2: each selected county is broken into segments (with at least \\~50-100 housing units). Segments are randomly/PPS selected.\n-   Stage 3: each selected segment is divided into households. Households are randomly selected.\n-   Stage 4: Within each sampled household, an individual is randomly selected.\n\n::: column-margin\nTo obtain population-level estimate, we must utilize the survey features (weights, strata, PSU/cluster)\n:::\n\n### Survey history\n\nOverall NHANES survey history\n\n\n::: {.cell hash='accessing3_cache/html/graph0i_132d6cc03b943822d0804d98284024a9'}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/g1.png){width=75%}\n:::\n:::\n\n\n### NHANES datafile and documents\n\n#### File format\n\nThe Continuous NHANES files are stored in the NHANES website as SAS transport file formats (.xpt). You can import this data in any statistical package that supports this file format.\n\n#### Continuous NHANES Components\n\nContinuous NHANES components separated to reduce the amount of time to download and documentation size:\n\n::: column-margin\n[NHANES Tutorials](https://wwwn.cdc.gov/nchs/nhanes/tutorials/default.aspx?CDC_AA_refVal=https%3A%2F%2Fwww.cdc.gov%2Fnchs%2Ftutorials%2Findex.htm)\n:::\n\n\n::: {.cell hash='accessing3_cache/html/graph1i_7290d00447dc6da6b99277d546cf028c'}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/g2.png){width=75%}\n:::\n:::\n\n\n::: column-margin\nBroadly, continuous NHANES data are available in 5 categories:\n\n-   Demographics\n-   Dietary\n-   Examination\n-   Laboratory\n-   Questionnaire\n:::\n\n#### Combining data\n\n##### Different cycles\n\nIt is possible to combine datasets from different years/cycles together in NHANES. However, NHANES is a cross-sectional data, and identification of the same person accross different cycles is not possible in the public release datasets. For appending data from different cycles, please make sure that the variable names/labels are the same/identical in years under consideration (in some years, names and labels do change).\n\n::: column-margin\nThe following data have not been released on the NHANES website as public release files due to confidentiality concerns:\n\n-   adolescent data on alcohol use\n-   smoking\n-   sexual behavior\n-   reproductive health and drug use\n:::\n\n##### Within the same cycle\n\nWithin NHANES datasets in a given cycle, each sampled person has an unique identifier sequence number (variable `SEQN`).\n\n#### Missing data and outliers\n\n@CDCfaq recommends:\n\n::: column-margin\n@CDCfaq\n:::\n\n> 1.  \"As a general rule, if 10% or less of your data for a variable are missing from your analytic dataset, it is usually acceptable to continue your analysis without further evaluation or adjustment. However, if more than 10% of the data for a variable are missing, you may need to determine whether the missing values are distributed equally across socio-demographic characteristics, and decide whether further imputation of missing values or use of adjusted weights are necessary.\"\n\n> 2.  \"If you fail to identify 'refusal' or 'do not know' as types of missing data, and treat the assigned values for 'refused' or 'do not know' as real values, you will get distorted results in your statistical analyses. Therefore, it is important to recode 'refused' or 'don't know' responses as missing values (either as a period (.) for numeric variables or as a blank for character variables).\"\n\n> 3.  \"Outliers with extremely large weights could have an influential impact on your estimates. You will have to decide whether to keep these influential outliers in your analysis or not. It is up to the analysts to make that decision.\"\n\n#### NHANES documents\n\n\n::: {.cell hash='accessing3_cache/html/graph2i_c8ef3b1742aa66e3fcde6bd5a101625a'}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/g3.png){width=65%}\n:::\n:::\n\n\n::: column-margin\nThe following websites could be helpful: - For more information about [NHANES design](https://wwwn.cdc.gov/nchs/nhanes/tutorials/module2.aspx).\n\n-   Visit [US CDC](https://wwwn.cdc.gov/Nchs/Nhanes/search/) website and do a variable keyword search based on your research interest (e.g., arthritis).\n:::\n\n### Accessing NHANES Data Directly from the CDC website\n\nIn the following example, we will see how to download 'Demographics' data, and check associated variable in that dataset.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/n15.png){width=65%}\n:::\n:::\n\n\n::: column-margin\nNHANES 1999-2000 and onward survey datasets are publicly available at [wwwn.cdc.gov/nchs/nhanes/](https://wwwn.cdc.gov/nchs/nhanes/)\n:::\n\n-   **Step 1**: Say, for example, we are interested about the NHANES 2015-2016 survey. Clicking the associated link in the above Figure gets us to the page for the corresponding cycle (see below).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/n15demo.png){width=65%}\n:::\n:::\n\n\n-   **Step 2**: There are various types of data available for this survey. Let's explore the demographic information from this cycle. These data are mostly available in the form of SAS `XPT` format (see below).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/xptsasdata.png){width=65%}\n:::\n:::\n\n\n-   **Step 3**: We can download the XPT data in the local PC folder and read the data into R as as follows:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nDEMO <- read.xport(\"Data/accessing/DEMO_I.XPT\")\n```\n:::\n\n::: {.cell}\n\n:::\n\n\n-   **Step 4**: Once data is imported in RStudio, we will see the `DEMO` object listed under data window (see below):\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/rdata.png){width=65%}\n:::\n:::\n\n\n-   **Step 5**: We can also check the variable names in this `DEMO` dataset as follows:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(DEMO)\n#>  [1] \"SEQN\"     \"SDDSRVYR\" \"RIDSTATR\" \"RIAGENDR\" \"RIDAGEYR\" \"RIDAGEMN\"\n#>  [7] \"RIDRETH1\" \"RIDRETH3\" \"RIDEXMON\" \"RIDEXAGM\" \"DMQMILIZ\" \"DMQADFC\" \n#> [13] \"DMDBORN4\" \"DMDCITZN\" \"DMDYRSUS\" \"DMDEDUC3\" \"DMDEDUC2\" \"DMDMARTL\"\n#> [19] \"RIDEXPRG\" \"SIALANG\"  \"SIAPROXY\" \"SIAINTRP\" \"FIALANG\"  \"FIAPROXY\"\n#> [25] \"FIAINTRP\" \"MIALANG\"  \"MIAPROXY\" \"MIAINTRP\" \"AIALANGA\" \"DMDHHSIZ\"\n#> [31] \"DMDFMSIZ\" \"DMDHHSZA\" \"DMDHHSZB\" \"DMDHHSZE\" \"DMDHRGND\" \"DMDHRAGE\"\n#> [37] \"DMDHRBR4\" \"DMDHREDU\" \"DMDHRMAR\" \"DMDHSEDU\" \"WTINT2YR\" \"WTMEC2YR\"\n#> [43] \"SDMVPSU\"  \"SDMVSTRA\" \"INDHHIN2\" \"INDFMIN2\" \"INDFMPIR\"\n```\n:::\n\n\n-   **Step 6**: We can open the data in RStudio in the dataview window (by clicking the `DEMO` data from the data window). The next Figure shows only a few columns and rows from this large dataset. Note that there are some values marked as \"NA\", which represents missing values.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/dataview.png){width=99%}\n:::\n:::\n\n\n-   **Step 7**: There is a column name associated with each column, e.g., `DMDHSEDU` in the first column in the above Figure. To understand what the column names mean in this Figure, we need to take a look at the codebook. To access codebook, click the `'DEMO|Doc'` link (in step 2). This will show the data documentation and associated codebook (see the next Figure).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/toc.png){width=65%}\n:::\n:::\n\n\n-   **Step 8**: We can see a link for the column or variable `DMDHSEDU` in the table of content (in the above Figure). Clicking that link will provide us further information about what this variable means (see the next Figure).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/DMDHSEDU.png){width=85%}\n:::\n:::\n\n\n-   **Step 9**: We can assess if the numbers reported under count and cumulative (from the above Figure) matches with what we get from the `DEMO` data we just imported (particularly, for the `DMDHSEDU` variable):\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(DEMO$DMDHSEDU) # Frequency table\n#> \n#>    1    2    3    4    5    7    9 \n#>  619  511  980 1462 1629    2   23\ncumsum(table(DEMO$DMDHSEDU)) # Cumulative frequency table\n#>    1    2    3    4    5    7    9 \n#>  619 1130 2110 3572 5201 5203 5226\nlength(is.na(DEMO$DMDHSEDU)) # Number of non-NA observations\n#> [1] 9971\n```\n:::\n\n\n### Accessing NHANES Data Using R Packages\n\n#### nhanesA package\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(nhanesA)\n```\n:::\n\n\n::: callout-tip\nR package `nhanesA` provides a convenient way to download and analyze NHANES survey data.\n:::\n\n::: column-margin\nRNHANES [@RNHANES] is another packages for downloading the NHANES data easily.\n:::\n\n-   **Step 1**: Witin the CDC website, NHANES data are available in 5 categories\n    -   Demographics (`DEMO`)\n    -   Dietary (`DIET`)\n    -   Examination (`EXAM`)\n    -   Laboratory (`LAB`)\n    -   Questionnaire (`Q`)\n\nTo get a list of available variables within a data file, we run the following command (e.g., we check variable names within `DEMO` data):\n\n\n::: {.cell hash='accessing3_cache/html/search_6e8b1b1049fe93479530f727a606d3da'}\n\n```{.r .cell-code}\nnhanesTables(data_group='DEMO', year=2015)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Data.File.Name\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Data.File.Description\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"DEMO_I\",\"2\":\"Demographic Variables and Sample Weights\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n-   **Step 2**: We can obtain the summaries of the downloaded data as follows (see below):\n\n\n::: {.cell hash='accessing3_cache/html/search3_b689eaaf83c953f7dbcdc1465a215d6a'}\n\n```{.r .cell-code}\ndemo <- nhanes('DEMO_I')\nnames(demo)\n#>  [1] \"SEQN\"     \"SDDSRVYR\" \"RIDSTATR\" \"RIAGENDR\" \"RIDAGEYR\" \"RIDAGEMN\"\n#>  [7] \"RIDRETH1\" \"RIDRETH3\" \"RIDEXMON\" \"RIDEXAGM\" \"DMQMILIZ\" \"DMQADFC\" \n#> [13] \"DMDBORN4\" \"DMDCITZN\" \"DMDYRSUS\" \"DMDEDUC3\" \"DMDEDUC2\" \"DMDMARTL\"\n#> [19] \"RIDEXPRG\" \"SIALANG\"  \"SIAPROXY\" \"SIAINTRP\" \"FIALANG\"  \"FIAPROXY\"\n#> [25] \"FIAINTRP\" \"MIALANG\"  \"MIAPROXY\" \"MIAINTRP\" \"AIALANGA\" \"DMDHHSIZ\"\n#> [31] \"DMDFMSIZ\" \"DMDHHSZA\" \"DMDHHSZB\" \"DMDHHSZE\" \"DMDHRGND\" \"DMDHRAGE\"\n#> [37] \"DMDHRBR4\" \"DMDHREDU\" \"DMDHRMAR\" \"DMDHSEDU\" \"WTINT2YR\" \"WTMEC2YR\"\n#> [43] \"SDMVPSU\"  \"SDMVSTRA\" \"INDHHIN2\" \"INDFMIN2\" \"INDFMPIR\"\ntable(demo$DMDHSEDU) # Frequency table\n#> \n#>    1    2    3    4    5    7    9 \n#>  619  511  980 1462 1629    2   23\ncumsum(table(demo$DMDHSEDU)) # Cumulative frequency table\n#>    1    2    3    4    5    7    9 \n#>  619 1130 2110 3572 5201 5203 5226\nlength(is.na(demo$DMDHSEDU)) # Number of non-NA observations\n#> [1] 9971\n```\n:::\n\n\n### References\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}