{
  "hash": "9c3e15d80fb20c1f13c1cd8cd05b5ece",
  "result": {
    "markdown": "## GEE {.unnumbered}\n\nIn this section, we will learn about generalized estimating equation (GEE). GEE is another popular method for modeling longitudinal or clustered data.\n\n::: callout-note\n-   GEE is a population-averaged (e.g., marginal) model, whereas mixed effects models are subject/cluster-specific. For example, we can use GEE when we are interested in exploring the population average effect. On the other hand, when we are interested in individual/cluster-specific effects, we can use the mixed effects models.\n\n-   Also, in contrast to the mixed effects models where we assume error term and beta coefficients for subject $i$ both follow normal distribution, GEE is distribution free. However, in GEE, we assume some correlation structures for within subjects/clusters. Hence, we can use GEE for non-normal data such as skewed data, binary data, or count data.\n:::\n\n\n::: {.cell hash='longitudinal2_cache/html/setup_e585af0477e2f2cb212a408ae8a36eb0'}\n\n```{.r .cell-code}\n# Load required packages\nknitr::opts_chunk$set(echo = TRUE)\nrequire(HSAUR2)\nlibrary(gee)\nlibrary(MuMIn)\nlibrary(geepack)\nlibrary(\"lme4\")\nrequire(afex)\n```\n:::\n\n\n### Data Description\n\nIn addition to BtheB dataset in part 1, we used respiratory data from **HSAUR2** package to demonstrate the analysis with non-normal responses:\n\n-   The response variable in this dataset is **status** (the respiratory status), which is a binary response\n-   Other covariates are: treatment, age, gender, the study center\n-   The response has been measured at 0, 1, 2, 3, 4 mths for each subject\n\n\n::: {.cell hash='longitudinal2_cache/html/load_93f8d6cab40b506b4dd600f4fb8f4c94'}\n\n```{.r .cell-code}\ndata(\"respiratory\", package = \"HSAUR2\")\nhead(respiratory)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"centre\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"treatment\"],\"name\":[2],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"gender\"],\"name\":[3],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"age\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"status\"],\"name\":[5],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"month\"],\"name\":[6],\"type\":[\"ord\"],\"align\":[\"right\"]},{\"label\":[\"subject\"],\"name\":[7],\"type\":[\"fct\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"1\",\"2\":\"placebo\",\"3\":\"female\",\"4\":\"46\",\"5\":\"poor\",\"6\":\"0\",\"7\":\"1\",\"_rn_\":\"1\"},{\"1\":\"1\",\"2\":\"placebo\",\"3\":\"female\",\"4\":\"46\",\"5\":\"poor\",\"6\":\"1\",\"7\":\"1\",\"_rn_\":\"112\"},{\"1\":\"1\",\"2\":\"placebo\",\"3\":\"female\",\"4\":\"46\",\"5\":\"poor\",\"6\":\"2\",\"7\":\"1\",\"_rn_\":\"223\"},{\"1\":\"1\",\"2\":\"placebo\",\"3\":\"female\",\"4\":\"46\",\"5\":\"poor\",\"6\":\"3\",\"7\":\"1\",\"_rn_\":\"334\"},{\"1\":\"1\",\"2\":\"placebo\",\"3\":\"female\",\"4\":\"46\",\"5\":\"poor\",\"6\":\"4\",\"7\":\"1\",\"_rn_\":\"445\"},{\"1\":\"1\",\"2\":\"placebo\",\"3\":\"female\",\"4\":\"28\",\"5\":\"poor\",\"6\":\"0\",\"7\":\"2\",\"_rn_\":\"2\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n### Methods for Non-normal Distributions\n\n-   ref: [@hothorn2014handbook] Section 13.2\n\n-   In addition to normally distributed response variables, the response variable can also follow non-normal distributions, such as binary or count responses.\n\n-   We have learned logistic regression or Poisson regression (glm) to analyze binary and count data but they are not considering the \"repeated measurement\" structure.\n\n-   The consequence of ignoring the longitudinal/repeated measurements structure is to have the wrong estimated standard errors for regression coefficients. Hence, our inference will be invalid. However, the glm still gives consistent estimated beta coefficients.\n\n-   There are many correlation structures in modelling GEE.\n\n-   With non-normal responses, different assumptions about these correlation structures can lead to different interpretations of the beta coefficients. Here, we will introduce two different GEE models: **marginal model** and **conditional model**.\n\n### Marginal Models\n\n-   ref: [@hothorn2014handbook] Section 13.2.1\n\nRepeated measurement and longitudinal data has responses taken at different time points. Therefore, we could simply review them as many series of cross-sectional data. Each cross-sectional data can be analyzed using glm introduced in previous lectures. Then a correlation structure can be assumed to connect different \"cross-sections\". The common correlation structures are:\n\n#### An independent structure\n\nAn independent structure which assumes the repeated measures are independent. An example of independent structure is basically is an identity matrix:\n\n$$\n\\left(\\begin{array}{ccc} \n1 & 0 & 0\\\\ \n0 & 1 & 0\\\\\n0 & 0 & 1\n\\end{array}\\right)\n$$\n\n#### An exchangeable correlation\n\nAn exchangeable correlation assumes that for the each individual, the correlation between each pair of repeated measurements is the same, i.e., $Cor(Y_{ij},Y_{ik})=\\rho$. In the correlation matrix, only $\\rho$ is unknown. Therefore, it is a single parameter working correlation matrix. An example of exchangeable correlation matrix is:\n\n$$\n\\left(\\begin{array}{ccc} \n1 & \\rho & \\rho\\\\ \n\\rho & 1 & \\rho\\\\\n\\rho & \\rho & 1\n\\end{array}\\right)\n$$\n\n#### An AR-1 autoregressive correlation\n\nDefined as $Cor(Y_{ij},Y_{ik})=\\rho^{|k-j|}$. If two measurements are taken at two closer time points the correlation is higher than these taken at two farther apart time points. It is also a single parameter working correlation matrix. An example of AR-1 correlation matrix is:\n\n$$\n\\left(\\begin{array}{ccc} \n1 & \\rho & \\rho^2\\\\ \n\\rho & 1 & \\rho\\\\\n\\rho^2 & \\rho & 1\n\\end{array}\\right)\n$$\n\n#### An unstructured correlation\n\nDifferent pairs of observation for each individual have different correlations $Cor(Y_{ij},Y_{ik})=\\rho_{jk}$. Assume that each individual has $K$ pairs of measurements, it is a $K(K-1)/2$ parameters working correlation matrix. An example of unstructured correlation matrix is:\n\n$$\n\\left(\\begin{array}{ccc} \n1 & \\rho_{12} & \\rho_{13}\\\\ \n\\rho_{12} & 1 & \\rho_{23}\\\\\n\\rho_{13} & \\rho_{23} & 1\n\\end{array}\\right)\n$$\n\n-   Sometimes, specifying a \"right\" correlation matrix is hard. However, the marginal model (usually we use GEE) gives us consistent estimated coefficients even with misspecified correlation structure.\n\n### Conditional Models\n\n-   ref: [@hothorn2014handbook] Section 13.2.2\n\n-   In GEE marginal models, the estimated regression coefficients are marginal (or population-averaged) effects. Therefore, the interpretation are at population-level. It is almost impossible to make inference on any specific individual or cluster.\n\n-   One solution is to do conditional models. The random effect approach in the part 1 can be extended to non-Gaussian response.\n\n### GEE models\n\nAfter the short introduction of two models, let's take a look at real examples\n\n-   ref: [@hothorn2014handbook] Section 13.3\n-   ref: [@faraway2016extending] Section 10.2\n\n#### Binary response\n\nWe started with binary response using respiratory dataset:\n\n\n::: {.cell hash='longitudinal2_cache/html/gee1_0ed79b0454b5ca67e3603437f6b2e0f8'}\n\n```{.r .cell-code}\nlibrary(gee)\ndata(\"respiratory\", package = \"HSAUR2\")\n## Data manipulation\nresp <- subset(respiratory, month > \"0\")\nresp$baseline <- rep(subset(respiratory, month == \"0\")$status, rep(4, 111))\n## Change the response to 0 and 1\nresp$nstat <- as.numeric(resp$status == \"good\")\nresp$month <- resp$month[, drop = TRUE]\n```\n:::\n\n\nNow we will fit a regular glm, i.e., model without random effect or any correlation structures. For binary outcomes, the estimated coefficients are log odds.\n\n\n::: {.cell hash='longitudinal2_cache/html/gee2_939e8073554ca7d2590d9773be0cc68b'}\n\n```{.r .cell-code}\n## Regular GLM \nresp_glm <- glm(status ~ centre + treatment + gender + baseline+ age, \n                data = resp, family = \"binomial\")\nsummary(resp_glm)\n#> \n#> Call:\n#> glm(formula = status ~ centre + treatment + gender + baseline + \n#>     age, family = \"binomial\", data = resp)\n#> \n#> Coefficients:\n#>                     Estimate Std. Error z value Pr(>|z|)    \n#> (Intercept)        -0.900171   0.337653  -2.666  0.00768 ** \n#> centre2             0.671601   0.239567   2.803  0.00506 ** \n#> treatmenttreatment  1.299216   0.236841   5.486 4.12e-08 ***\n#> gendermale          0.119244   0.294671   0.405  0.68572    \n#> baselinegood        1.882029   0.241290   7.800 6.20e-15 ***\n#> age                -0.018166   0.008864  -2.049  0.04043 *  \n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> (Dispersion parameter for binomial family taken to be 1)\n#> \n#>     Null deviance: 608.93  on 443  degrees of freedom\n#> Residual deviance: 483.22  on 438  degrees of freedom\n#> AIC: 495.22\n#> \n#> Number of Fisher Scoring iterations: 4\n```\n:::\n\n\nNow we will fit GEE with independent correlation structure:\n\n\n::: {.cell hash='longitudinal2_cache/html/gee3_ce79a2bcfde18545d633c48473aeb3c6'}\n\n```{.r .cell-code}\n## GEE with identity matrix\nresp_gee.in <- gee(nstat ~ centre + treatment + gender + baseline + age, \n                 data = resp, family = \"binomial\", \n                 id = subject,corstr = \"independence\", \n                 scale.fix = TRUE, scale.value = 1)\n#> Beginning Cgee S-function, @(#) geeformula.q 4.13 98/01/27\n#> running glm to get initial regression estimate\n#>        (Intercept)            centre2 treatmenttreatment         gendermale \n#>        -0.90017133         0.67160098         1.29921589         0.11924365 \n#>       baselinegood                age \n#>         1.88202860        -0.01816588\nsummary(resp_gee.in)\n#> \n#>  GEE:  GENERALIZED LINEAR MODELS FOR DEPENDENT DATA\n#>  gee S-function, version 4.13 modified 98/01/27 (1998) \n#> \n#> Model:\n#>  Link:                      Logit \n#>  Variance to Mean Relation: Binomial \n#>  Correlation Structure:     Independent \n#> \n#> Call:\n#> gee(formula = nstat ~ centre + treatment + gender + baseline + \n#>     age, id = subject, data = resp, family = \"binomial\", corstr = \"independence\", \n#>     scale.fix = TRUE, scale.value = 1)\n#> \n#> Summary of Residuals:\n#>         Min          1Q      Median          3Q         Max \n#> -0.93134415 -0.30623174  0.08973552  0.33018952  0.84307712 \n#> \n#> \n#> Coefficients:\n#>                       Estimate  Naive S.E.   Naive z Robust S.E.   Robust z\n#> (Intercept)        -0.90017133 0.337653052 -2.665965  0.46032700 -1.9555041\n#> centre2             0.67160098 0.239566599  2.803400  0.35681913  1.8821889\n#> treatmenttreatment  1.29921589 0.236841017  5.485603  0.35077797  3.7038127\n#> gendermale          0.11924365 0.294671045  0.404667  0.44320235  0.2690501\n#> baselinegood        1.88202860 0.241290221  7.799854  0.35005152  5.3764332\n#> age                -0.01816588 0.008864403 -2.049306  0.01300426 -1.3969169\n#> \n#> Estimated Scale Parameter:  1\n#> Number of Iterations:  1\n#> \n#> Working Correlation\n#>      [,1] [,2] [,3] [,4]\n#> [1,]    1    0    0    0\n#> [2,]    0    1    0    0\n#> [3,]    0    0    1    0\n#> [4,]    0    0    0    1\n```\n:::\n\n\n-   This model assumes an independent correlation structure, the output will be equal to glm.\n\n-   The outputs started from a summary of residuals\n\n-   The estimated coefficients are the same as GLM. For binary outcome, you may still interpret them as log odds. Naive SE and z value are estimated directly from this model. Robust SE and z are sandwich estimates.\n\n-   The difference between naive and robust indicates that the correlation structure may not be good.\n\n-   Working Correlation is the correlation structure estimated from the data (identity matrix for independence).\n\nLet fit the GEE model with exchangeable correlation structure:\n\n\n::: {.cell hash='longitudinal2_cache/html/geeex_924a263115ad7a2ce62a424c382065c2'}\n\n```{.r .cell-code}\n## GEE with exchangeable matrix\nresp_gee.ex <- gee(nstat ~ centre + treatment + gender + baseline+ age, \n                 data = resp, family = \"binomial\", \n                 id = subject, corstr = \"exchangeable\", \n                 scale.fix = TRUE, scale.value = 1)\n#> Beginning Cgee S-function, @(#) geeformula.q 4.13 98/01/27\n#> running glm to get initial regression estimate\n#>        (Intercept)            centre2 treatmenttreatment         gendermale \n#>        -0.90017133         0.67160098         1.29921589         0.11924365 \n#>       baselinegood                age \n#>         1.88202860        -0.01816588\nsummary(resp_gee.ex)\n#> \n#>  GEE:  GENERALIZED LINEAR MODELS FOR DEPENDENT DATA\n#>  gee S-function, version 4.13 modified 98/01/27 (1998) \n#> \n#> Model:\n#>  Link:                      Logit \n#>  Variance to Mean Relation: Binomial \n#>  Correlation Structure:     Exchangeable \n#> \n#> Call:\n#> gee(formula = nstat ~ centre + treatment + gender + baseline + \n#>     age, id = subject, data = resp, family = \"binomial\", corstr = \"exchangeable\", \n#>     scale.fix = TRUE, scale.value = 1)\n#> \n#> Summary of Residuals:\n#>         Min          1Q      Median          3Q         Max \n#> -0.93134415 -0.30623174  0.08973552  0.33018952  0.84307712 \n#> \n#> \n#> Coefficients:\n#>                       Estimate Naive S.E.    Naive z Robust S.E.   Robust z\n#> (Intercept)        -0.90017133  0.4784634 -1.8813796  0.46032700 -1.9555041\n#> centre2             0.67160098  0.3394723  1.9783676  0.35681913  1.8821889\n#> treatmenttreatment  1.29921589  0.3356101  3.8712064  0.35077797  3.7038127\n#> gendermale          0.11924365  0.4175568  0.2855747  0.44320235  0.2690501\n#> baselinegood        1.88202860  0.3419147  5.5043802  0.35005152  5.3764332\n#> age                -0.01816588  0.0125611 -1.4462014  0.01300426 -1.3969169\n#> \n#> Estimated Scale Parameter:  1\n#> Number of Iterations:  1\n#> \n#> Working Correlation\n#>           [,1]      [,2]      [,3]      [,4]\n#> [1,] 1.0000000 0.3359883 0.3359883 0.3359883\n#> [2,] 0.3359883 1.0000000 0.3359883 0.3359883\n#> [3,] 0.3359883 0.3359883 1.0000000 0.3359883\n#> [4,] 0.3359883 0.3359883 0.3359883 1.0000000\n```\n:::\n\n\n-   This model assumes an exchangeable correlation structure.\n\n-   The outputs started from a summary of residuals\n\n-   The estimated coefficients are the same GLM. For binary outcome, you may still interpret them as log odds. Naive S.E and z value are estimated directly from this model. Robust SE and z are sandwich estimates\n\n-   The difference between naive and robust is smaller, which indicates that the correlation structure is better specified.\n\n-   Working Correlation is the correlation structure estimated from the data\n\nLet's check the estimated coefficients from all three models.\n\n\n::: {.cell hash='longitudinal2_cache/html/summ_6ceb4233491f88d229f981e85160e63e'}\n\n```{.r .cell-code}\nsummary(resp_glm)$coefficients\n#>                       Estimate  Std. Error    z value     Pr(>|z|)\n#> (Intercept)        -0.90017133 0.337652992 -2.6659658 7.676750e-03\n#> centre2             0.67160098 0.239566555  2.8034004 5.056684e-03\n#> treatmenttreatment  1.29921589 0.236840962  5.4856047 4.120574e-08\n#> gendermale          0.11924365 0.294671000  0.4046671 6.857223e-01\n#> baselinegood        1.88202860 0.241290163  7.7998563 6.197770e-15\n#> age                -0.01816588 0.008864401 -2.0493065 4.043215e-02\nsummary(resp_gee.in)$coefficients\n#>                       Estimate  Naive S.E.   Naive z Robust S.E.   Robust z\n#> (Intercept)        -0.90017133 0.337653052 -2.665965  0.46032700 -1.9555041\n#> centre2             0.67160098 0.239566599  2.803400  0.35681913  1.8821889\n#> treatmenttreatment  1.29921589 0.236841017  5.485603  0.35077797  3.7038127\n#> gendermale          0.11924365 0.294671045  0.404667  0.44320235  0.2690501\n#> baselinegood        1.88202860 0.241290221  7.799854  0.35005152  5.3764332\n#> age                -0.01816588 0.008864403 -2.049306  0.01300426 -1.3969169\nsummary(resp_gee.ex)$coefficients\n#>                       Estimate Naive S.E.    Naive z Robust S.E.   Robust z\n#> (Intercept)        -0.90017133  0.4784634 -1.8813796  0.46032700 -1.9555041\n#> centre2             0.67160098  0.3394723  1.9783676  0.35681913  1.8821889\n#> treatmenttreatment  1.29921589  0.3356101  3.8712064  0.35077797  3.7038127\n#> gendermale          0.11924365  0.4175568  0.2855747  0.44320235  0.2690501\n#> baselinegood        1.88202860  0.3419147  5.5043802  0.35005152  5.3764332\n#> age                -0.01816588  0.0125611 -1.4462014  0.01300426 -1.3969169\n# Same estimated coefficients but different SEs\n```\n:::\n\n\nGEE with identity matrix is the same as GLM model. If we change the correlation structure to exchangeable does not change the beta estimates, but the naive SEs are closer to Robust SE, which indicates that the exchangeable correlation structure is a better reflection of the correlation structures.\n\n#### Gaussian response\n\nGEE can also be applied to Gaussian response\n\n\n::: {.cell hash='longitudinal2_cache/html/gaus_2184400979d3fd42254015f36490aa5d'}\n\n```{.r .cell-code}\nlibrary(gee)\nlibrary(HSAUR2)\nBtheB$subject <- factor(rownames(BtheB))\nnobs <- nrow(BtheB)\nBtheB_long <- reshape(BtheB, idvar = \"subject\", \n                      varying = c(\"bdi.2m\", \"bdi.3m\", \"bdi.5m\", \"bdi.8m\"), \n                      direction = \"long\")\nBtheB_long$time <- rep(c(2, 3, 5, 8), rep(nobs, 4))\nosub <- order(as.integer(BtheB_long$subject))\nBtheB_long <- BtheB_long[osub,]\nbtb_gee.ind <- gee(bdi ~ bdi.pre + treatment + length + drug, \n               data = BtheB_long, id = subject, \n               family = gaussian, corstr = \"independence\")\n#> Beginning Cgee S-function, @(#) geeformula.q 4.13 98/01/27\n#> running glm to get initial regression estimate\n#>    (Intercept)        bdi.pre treatmentBtheB      length>6m        drugYes \n#>      3.5686314      0.5818494     -3.2372285      1.4577182     -3.7412982\nsummary(btb_gee.ind)\n#> \n#>  GEE:  GENERALIZED LINEAR MODELS FOR DEPENDENT DATA\n#>  gee S-function, version 4.13 modified 98/01/27 (1998) \n#> \n#> Model:\n#>  Link:                      Identity \n#>  Variance to Mean Relation: Gaussian \n#>  Correlation Structure:     Independent \n#> \n#> Call:\n#> gee(formula = bdi ~ bdi.pre + treatment + length + drug, id = subject, \n#>     data = BtheB_long, family = gaussian, corstr = \"independence\")\n#> \n#> Summary of Residuals:\n#>         Min          1Q      Median          3Q         Max \n#> -21.6497810  -5.8485100   0.1131663   5.5838383  28.1871039 \n#> \n#> \n#> Coefficients:\n#>                  Estimate Naive S.E.   Naive z Robust S.E.   Robust z\n#> (Intercept)     3.5686314  1.4833349  2.405816  2.26947617  1.5724472\n#> bdi.pre         0.5818494  0.0563904 10.318235  0.09156455  6.3545274\n#> treatmentBtheB -3.2372285  1.1295569 -2.865928  1.77459534 -1.8242066\n#> length>6m       1.4577182  1.1380277  1.280916  1.48255866  0.9832449\n#> drugYes        -3.7412982  1.1766321 -3.179667  1.78271179 -2.0986557\n#> \n#> Estimated Scale Parameter:  79.25813\n#> Number of Iterations:  1\n#> \n#> Working Correlation\n#>      [,1] [,2] [,3] [,4]\n#> [1,]    1    0    0    0\n#> [2,]    0    1    0    0\n#> [3,]    0    0    1    0\n#> [4,]    0    0    0    1\n# require(Publish)\n# publish(btb_gee.ind)\n```\n:::\n\n\n-   This model assumes an independent correlation structure.\n\n-   The outputs started from a summary of residuals\n\n-   The estimated coefficient will be interpreted the same way as linear model. Naive S.E and z value are estimated directly from this model. Robust SE and z are sandwich estimates\n\n-   Working Correlation is the correlation struture estimated from the data (identity matrix for indepedence)\n\nWith exchangeable correlation matrix:\n\n\n::: {.cell hash='longitudinal2_cache/html/gausex_074435b23809fb4ec09d4dcb882d0847'}\n\n```{.r .cell-code}\nbtb_gee.ex <- gee(bdi ~ bdi.pre + treatment + length + drug,\n                data = BtheB_long, id = subject, \n                family = gaussian, corstr = \"exchangeable\")\n#> Beginning Cgee S-function, @(#) geeformula.q 4.13 98/01/27\n#> running glm to get initial regression estimate\n#>    (Intercept)        bdi.pre treatmentBtheB      length>6m        drugYes \n#>      3.5686314      0.5818494     -3.2372285      1.4577182     -3.7412982\nsummary(btb_gee.ex)\n#> \n#>  GEE:  GENERALIZED LINEAR MODELS FOR DEPENDENT DATA\n#>  gee S-function, version 4.13 modified 98/01/27 (1998) \n#> \n#> Model:\n#>  Link:                      Identity \n#>  Variance to Mean Relation: Gaussian \n#>  Correlation Structure:     Exchangeable \n#> \n#> Call:\n#> gee(formula = bdi ~ bdi.pre + treatment + length + drug, id = subject, \n#>     data = BtheB_long, family = gaussian, corstr = \"exchangeable\")\n#> \n#> Summary of Residuals:\n#>        Min         1Q     Median         3Q        Max \n#> -23.955980  -6.643864  -1.109741   4.257688  25.452310 \n#> \n#> \n#> Coefficients:\n#>                  Estimate Naive S.E.     Naive z Robust S.E.   Robust z\n#> (Intercept)     3.0231602 2.30390185  1.31219140  2.23204410  1.3544357\n#> bdi.pre         0.6479276 0.08228567  7.87412417  0.08351405  7.7583066\n#> treatmentBtheB -2.1692863 1.76642861 -1.22806339  1.73614385 -1.2494854\n#> length>6m      -0.1112910 1.73091679 -0.06429596  1.55092705 -0.0717577\n#> drugYes        -2.9995608 1.82569913 -1.64296559  1.73155411 -1.7322940\n#> \n#> Estimated Scale Parameter:  81.7349\n#> Number of Iterations:  5\n#> \n#> Working Correlation\n#>           [,1]      [,2]      [,3]      [,4]\n#> [1,] 1.0000000 0.6757951 0.6757951 0.6757951\n#> [2,] 0.6757951 1.0000000 0.6757951 0.6757951\n#> [3,] 0.6757951 0.6757951 1.0000000 0.6757951\n#> [4,] 0.6757951 0.6757951 0.6757951 1.0000000\n#publish(btb_gee.ex)\n```\n:::\n\n\n-   The interpretation of estimated coefficients are similar to LM. Naive S.E and z value are estimated directly from this model. Robust SE and z are sandwich estimates\n\n-   Working Correlation is the correlation structure estimated from the data\n\n-   When we change the structure of correlation, the estimates and naive SE and z changed. A closer naive SE to robust SE indicates that the correlation structure is better specified.\n\n### Compare with Random Effects\n\n-   ref: [@hothorn2014handbook] Section 13.4 We then use the conditional models (i.e., adding random effect) with non-normal response\n\nLet us compare the GEE models with the mixed effect models.\n\n\n::: {.cell hash='longitudinal2_cache/html/comp_1888e28a1ead643bb7681538f4697b21'}\n\n```{.r .cell-code}\n## Generalized mixed effect model model\nlibrary(\"lme4\")\nresp_lmer <- glmer(nstat ~ baseline + month + treatment + \n                   gender + age + centre + \n                    (1 | subject), family = binomial(), \n                  data = resp)\n#> Warning in checkConv(attr(opt, \"derivs\"), opt$par, ctrl = control$checkConv, :\n#> Model failed to converge with max|grad| = 0.197382 (tol = 0.002, component 1)\n```\n:::\n\n::: {.cell hash='longitudinal2_cache/html/comp2_fb76b49a90f4f117d536e994097e8ef5'}\n\n```{.r .cell-code}\nrequire(afex)\nresp_afex <- mixed(nstat ~ baseline + month + treatment + \n                   gender + age + centre + \n                    (1 | subject), family = binomial(), \n                  data = resp, method = \"LRT\")\n#> Contrasts set to contr.sum for the following variables: baseline, month, treatment, gender, centre, subject\n#> Numerical variables NOT centered on 0: age\n#> If in interactions, interpretation of lower order (e.g., main) effects difficult.\n#> Warning in checkConv(attr(opt, \"derivs\"), opt$par, ctrl = control$checkConv, :\n#> Model failed to converge with max|grad| = 0.00495329 (tol = 0.002, component 1)\n#> Warning in checkConv(attr(opt, \"derivs\"), opt$par, ctrl = control$checkConv, :\n#> Model failed to converge with max|grad| = 0.00478889 (tol = 0.002, component 1)\n#> Warning in checkConv(attr(opt, \"derivs\"), opt$par, ctrl = control$checkConv, :\n#> Model failed to converge with max|grad| = 0.0466122 (tol = 0.002, component 1)\n#> Warning in checkConv(attr(opt, \"derivs\"), opt$par, ctrl = control$checkConv, :\n#> Model failed to converge with max|grad| = 0.0949357 (tol = 0.002, component 1)\n#> Warning in checkConv(attr(opt, \"derivs\"), opt$par, ctrl = control$checkConv, :\n#> Model failed to converge with max|grad| = 0.0416611 (tol = 0.002, component 1)\n```\n:::\n\n::: {.cell hash='longitudinal2_cache/html/comp3_814db3d39801adc01abb1100e03b56ee'}\n\n```{.r .cell-code}\n## GEE model\nresp_gee3 <- gee(nstat ~ baseline + month + treatment + \n                   gender + age + centre, \n                 data = resp, family = \"binomial\", \n                 id = subject, corstr = \"exchangeable\", \n                 scale.fix = TRUE, scale.value = 1)\n#> Beginning Cgee S-function, @(#) geeformula.q 4.13 98/01/27\n#> running glm to get initial regression estimate\n#>        (Intercept)       baselinegood            month.L            month.Q \n#>        -0.90363465         1.88945124        -0.14372490        -0.02455122 \n#>            month.C treatmenttreatment         gendermale                age \n#>        -0.23255161         1.30410916         0.11969528        -0.01823703 \n#>            centre2 \n#>         0.67417628\nlibrary(MuMIn)\nlibrary(geepack)\nresp_gee4 <- geeglm(nstat ~ baseline + month + treatment + \n                   gender + age + centre, \n                 data = resp, family = \"binomial\", \n                 id = subject, corstr = \"exchangeable\", \n                 scale.fix = TRUE)\nresp_gee5 <- geeglm(nstat ~ baseline + month + treatment + \n                   gender + age + centre, \n                 data = resp, family = \"binomial\", \n                 id = subject, corstr = \"independence\", \n                 scale.fix = TRUE)\nresp_gee6 <- geeglm(nstat ~ baseline + month + treatment + \n                   gender + age + centre, \n                 data = resp, family = \"binomial\", \n                 id = subject, corstr = \"ar1\", \n                 scale.fix = TRUE)\nQIC(resp_gee4)\n#>        QIC       QICu  Quasi Lik        CIC     params       QICC \n#>  510.94098  499.71690 -240.85845   14.61204    9.00000  513.14098\nQIC(resp_gee5)\n#>        QIC       QICu  Quasi Lik        CIC     params       QICC \n#>  511.14981  499.69791 -240.84895   14.72595    9.00000  512.93199\nQIC(resp_gee6)\n#>        QIC       QICu  Quasi Lik        CIC     params       QICC \n#>  511.81242  500.27657 -241.13829   14.76792    9.00000  514.01242\n# Smaller QIC values for correlation structure represents better models\n# i.e., \"exchangeable\" in our case\n\nresp_gee4a <- geeglm(nstat ~ month + treatment + gender + age + centre, \n                 data = resp, family = \"binomial\", \n                 id = subject, corstr = \"exchangeable\", \n                 scale.fix = TRUE)\n\nresp_gee4b <- geeglm(nstat ~ treatment + gender + age + centre, \n                 data = resp, family = \"binomial\", \n                 id = subject, corstr = \"exchangeable\", \n                 scale.fix = TRUE)\n\nresp_gee4c <- geeglm(nstat ~ gender + age + centre, \n                 data = resp, family = \"binomial\", \n                 id = subject, corstr = \"exchangeable\", \n                 scale.fix = TRUE)\n\nresp_gee4d <- geeglm(nstat ~ age + centre, \n                 data = resp, family = \"binomial\", \n                 id = subject, corstr = \"exchangeable\", \n                 scale.fix = TRUE)\n\nresp_gee4e <- geeglm(nstat ~ centre, \n                 data = resp, family = \"binomial\", \n                 id = subject, corstr = \"exchangeable\", \n                 scale.fix = TRUE)\nQIC(resp_gee4)\n#>        QIC       QICu  Quasi Lik        CIC     params       QICC \n#>  510.94098  499.71690 -240.85845   14.61204    9.00000  513.14098\nQIC(resp_gee4a)[2]\n#>   QICu \n#> 567.35\nQIC(resp_gee4b)[2]\n#>     QICu \n#> 562.6247\nQIC(resp_gee4c)[2]\n#>     QICu \n#> 585.3099\nQIC(resp_gee4d)[2]\n#>     QICu \n#> 586.1581\nQIC(resp_gee4e)[2]\n#>     QICu \n#> 592.3437\nQIC(resp_gee4d)[2]\n#>     QICu \n#> 586.1581\n# Covariates are selected based on the QICu criteria\n```\n:::\n\n::: {.cell hash='longitudinal2_cache/html/compsumm_ae15612359c252649bd660892f8269e6'}\n\n```{.r .cell-code}\n## compare estimates (conditional vs. marginal)\nsummary(resp_lmer)$coefficients # Model failed to converge\n#>                       Estimate Std. Error    z value     Pr(>|z|)\n#> (Intercept)        -1.65459986 0.77620476 -2.1316538 3.303531e-02\n#> baselinegood        3.08897132 0.59858148  5.1604860 2.463096e-07\n#> month.L            -0.20348327 0.27957504 -0.7278306 4.667173e-01\n#> month.Q            -0.02821444 0.27907489 -0.1010999 9.194712e-01\n#> month.C            -0.35570944 0.28084948 -1.2665483 2.053168e-01\n#> treatmenttreatment  2.16620464 0.55157208  3.9273283 8.589470e-05\n#> gendermale          0.23836010 0.66606345  0.3578640 7.204451e-01\n#> age                -0.02557320 0.01993984 -1.2825178 1.996611e-01\n#> centre2             1.03849878 0.54182274  1.9166762 5.527908e-02\nsummary(resp_afex)$coefficients # Model failed to converge\n#>                Estimate Std. Error    z value     Pr(>|z|)\n#> (Intercept)  1.61366355 0.79598978  2.0272415 4.263772e-02\n#> baseline1   -1.55321951 0.30467553 -5.0979463 3.433581e-07\n#> month1       0.21660822 0.24441676  0.8862249 3.754963e-01\n#> month2      -0.17701748 0.24250584 -0.7299514 4.654199e-01\n#> month3       0.21559489 0.24440444  0.8821235 3.777101e-01\n#> treatment1  -1.09162957 0.28098789 -3.8849701 1.023425e-04\n#> gender1     -0.10313396 0.33932981 -0.3039343 7.611780e-01\n#> age         -0.02576276 0.02031589 -1.2681088 2.047591e-01\n#> centre1     -0.52829986 0.27639204 -1.9114149 5.595128e-02\nsummary(resp_gee3)$coefficients # Marginalized model\n#>                       Estimate Naive S.E.    Naive z Robust S.E.   Robust z\n#> (Intercept)        -0.90565507 0.47940039 -1.8891413  0.46042640 -1.9669920\n#> baselinegood        1.86665412 0.34220231  5.4548261  0.35023043  5.3297885\n#> month.L            -0.14330949 0.18044542 -0.7941986  0.18210027 -0.7869812\n#> month.Q            -0.02448267 0.18034926 -0.1357514  0.18329974 -0.1335663\n#> month.C            -0.23187407 0.18073662 -1.2829391  0.15929035 -1.4556693\n#> treatmenttreatment  1.28311415 0.33592099  3.8196903  0.35055323  3.6602548\n#> gendermale          0.11513183 0.41851611  0.2750953  0.44135628  0.2608592\n#> age                -0.01785399 0.01258158 -1.4190585  0.01299686 -1.3737157\n#> centre2             0.68481139 0.34010911  2.0135050  0.35681635  1.9192265\nsummary(resp_gee4)$coefficients # Marginalized model\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"Estimate\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Std.err\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Wald\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Pr(>|W|)\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"-0.90565577\",\"2\":\"0.46042559\",\"3\":\"3.86907740\",\"4\":\"4.918355e-02\",\"_rn_\":\"(Intercept)\"},{\"1\":\"1.86664028\",\"2\":\"0.35022955\",\"3\":\"28.40636763\",\"4\":\"9.834132e-08\",\"_rn_\":\"baselinegood\"},{\"1\":\"-0.14330937\",\"2\":\"0.18209975\",\"3\":\"0.61934188\",\"4\":\"4.312920e-01\",\"_rn_\":\"month.L\"},{\"1\":\"-0.02448266\",\"2\":\"0.18329922\",\"3\":\"0.01784004\",\"4\":\"8.937453e-01\",\"_rn_\":\"month.Q\"},{\"1\":\"-0.23187385\",\"2\":\"0.15928992\",\"3\":\"2.11898053\",\"4\":\"1.454834e-01\",\"_rn_\":\"month.C\"},{\"1\":\"1.28310331\",\"2\":\"0.35055239\",\"3\":\"13.39730286\",\"4\":\"2.519864e-04\",\"_rn_\":\"treatmenttreatment\"},{\"1\":\"0.11513002\",\"2\":\"0.44135474\",\"3\":\"0.06804584\",\"4\":\"7.942036e-01\",\"_rn_\":\"gendermale\"},{\"1\":\"-0.01785382\",\"2\":\"0.01299683\",\"3\":\"1.88706809\",\"4\":\"1.695330e-01\",\"_rn_\":\"age\"},{\"1\":\"0.68481801\",\"2\":\"0.35681558\",\"3\":\"3.68351745\",\"4\":\"5.495281e-02\",\"_rn_\":\"centre2\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nThe significance of variables are similar in both variables, but the estimated coefficients are larger in generalized mixed effect model. However, it does not mean the estimated coefficients are inconsistent. Instead, two models are estimating different parameters. Remember, the mixed effect model is conditional on random effects, while the GEE is a marginalized model.\n\n### Video content (optional)\n\n::: callout-tip\nFor those who prefer a video walkthrough, feel free to watch the video below, which offers a description of an earlier version of the above content.\n:::\n\n::: {style=\"position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;\"}\n<iframe src=\"https://www.youtube.com/embed/rF8pgvfMqo0\" style=\"position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;\" allowfullscreen>\n\n</iframe>\n:::\n\n### Reference\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}