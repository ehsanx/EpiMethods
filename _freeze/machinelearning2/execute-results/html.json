{
  "hash": "aa7c4777d22ea31d218758fdef862354",
  "result": {
    "engine": "knitr",
    "markdown": "## Data spliting {.unnumbered}\n\n::: callout-important\nThis tutorial is very similar to one of the [previous tutorials](predictivefactors5.html), but uses a different data (we used [RHC data](researchquestion1.html) here). We are revisiting concepts related to [prediction](predictivefactors.html) before introducing ideas related to machine learning.\n:::\n\n\n\n\n\n### Load dataset\n\n\n::: {.cell}\n\n```{.r .cell-code}\nObsData <- readRDS(file = \"Data/machinelearning/rhcAnalytic.RDS\")\nhead(ObsData)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"Disease.category\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Cancer\"],\"name\":[2],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Death\"],\"name\":[3],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Cardiovascular\"],\"name\":[4],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Congestive.HF\"],\"name\":[5],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Dementia\"],\"name\":[6],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Psychiatric\"],\"name\":[7],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Pulmonary\"],\"name\":[8],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Renal\"],\"name\":[9],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Hepatic\"],\"name\":[10],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"GI.Bleed\"],\"name\":[11],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Tumor\"],\"name\":[12],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Immunosupperssion\"],\"name\":[13],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Transfer.hx\"],\"name\":[14],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"MI\"],\"name\":[15],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"age\"],\"name\":[16],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"sex\"],\"name\":[17],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"edu\"],\"name\":[18],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"DASIndex\"],\"name\":[19],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"APACHE.score\"],\"name\":[20],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Glasgow.Coma.Score\"],\"name\":[21],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"blood.pressure\"],\"name\":[22],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"WBC\"],\"name\":[23],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Heart.rate\"],\"name\":[24],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Respiratory.rate\"],\"name\":[25],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Temperature\"],\"name\":[26],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"PaO2vs.FIO2\"],\"name\":[27],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Albumin\"],\"name\":[28],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Hematocrit\"],\"name\":[29],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Bilirubin\"],\"name\":[30],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Creatinine\"],\"name\":[31],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Sodium\"],\"name\":[32],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Potassium\"],\"name\":[33],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"PaCo2\"],\"name\":[34],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"PH\"],\"name\":[35],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Weight\"],\"name\":[36],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"DNR.status\"],\"name\":[37],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Medical.insurance\"],\"name\":[38],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Respiratory.Diag\"],\"name\":[39],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Cardiovascular.Diag\"],\"name\":[40],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Neurological.Diag\"],\"name\":[41],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Gastrointestinal.Diag\"],\"name\":[42],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Renal.Diag\"],\"name\":[43],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Metabolic.Diag\"],\"name\":[44],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Hematologic.Diag\"],\"name\":[45],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Sepsis.Diag\"],\"name\":[46],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Trauma.Diag\"],\"name\":[47],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Orthopedic.Diag\"],\"name\":[48],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"race\"],\"name\":[49],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"income\"],\"name\":[50],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Length.of.Stay\"],\"name\":[51],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"RHC.use\"],\"name\":[52],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Other\",\"2\":\"Localized (Yes)\",\"3\":\"0\",\"4\":\"0\",\"5\":\"0\",\"6\":\"0\",\"7\":\"0\",\"8\":\"1\",\"9\":\"0\",\"10\":\"0\",\"11\":\"0\",\"12\":\"1\",\"13\":\"0\",\"14\":\"0\",\"15\":\"0\",\"16\":\"[70,80)\",\"17\":\"Male\",\"18\":\"12.000000\",\"19\":\"23.50000\",\"20\":\"46\",\"21\":\"0\",\"22\":\"41\",\"23\":\"22.09765620\",\"24\":\"124\",\"25\":\"10\",\"26\":\"38.69531\",\"27\":\"68.0000\",\"28\":\"3.500000\",\"29\":\"58.00000\",\"30\":\"1.0097656\",\"31\":\"1.1999512\",\"32\":\"145\",\"33\":\"4.000000\",\"34\":\"40\",\"35\":\"7.359375\",\"36\":\"64.69995\",\"37\":\"No\",\"38\":\"Medicare\",\"39\":\"Yes\",\"40\":\"Yes\",\"41\":\"No\",\"42\":\"No\",\"43\":\"No\",\"44\":\"No\",\"45\":\"No\",\"46\":\"No\",\"47\":\"No\",\"48\":\"No\",\"49\":\"white\",\"50\":\"Under $11k\",\"51\":\"9\",\"52\":\"0\",\"_rn_\":\"1\"},{\"1\":\"MOSF\",\"2\":\"None\",\"3\":\"1\",\"4\":\"1\",\"5\":\"1\",\"6\":\"0\",\"7\":\"0\",\"8\":\"0\",\"9\":\"0\",\"10\":\"0\",\"11\":\"0\",\"12\":\"0\",\"13\":\"1\",\"14\":\"1\",\"15\":\"0\",\"16\":\"[70,80)\",\"17\":\"Female\",\"18\":\"12.000000\",\"19\":\"14.75195\",\"20\":\"50\",\"21\":\"0\",\"22\":\"63\",\"23\":\"28.89843750\",\"24\":\"137\",\"25\":\"38\",\"26\":\"38.89844\",\"27\":\"218.3125\",\"28\":\"2.599609\",\"29\":\"32.50000\",\"30\":\"0.6999512\",\"31\":\"0.5999756\",\"32\":\"137\",\"33\":\"3.299805\",\"34\":\"34\",\"35\":\"7.329102\",\"36\":\"45.69998\",\"37\":\"No\",\"38\":\"Private & Medicare\",\"39\":\"No\",\"40\":\"No\",\"41\":\"No\",\"42\":\"No\",\"43\":\"No\",\"44\":\"No\",\"45\":\"No\",\"46\":\"Yes\",\"47\":\"No\",\"48\":\"No\",\"49\":\"white\",\"50\":\"Under $11k\",\"51\":\"45\",\"52\":\"1\",\"_rn_\":\"2\"},{\"1\":\"MOSF\",\"2\":\"Localized (Yes)\",\"3\":\"0\",\"4\":\"0\",\"5\":\"0\",\"6\":\"0\",\"7\":\"0\",\"8\":\"0\",\"9\":\"0\",\"10\":\"0\",\"11\":\"0\",\"12\":\"1\",\"13\":\"1\",\"14\":\"0\",\"15\":\"0\",\"16\":\"[-Inf,50)\",\"17\":\"Female\",\"18\":\"14.069916\",\"19\":\"18.13672\",\"20\":\"82\",\"21\":\"0\",\"22\":\"57\",\"23\":\"0.04999542\",\"24\":\"130\",\"25\":\"40\",\"26\":\"36.39844\",\"27\":\"275.5000\",\"28\":\"3.500000\",\"29\":\"21.09766\",\"30\":\"1.0097656\",\"31\":\"2.5996094\",\"32\":\"146\",\"33\":\"2.899902\",\"34\":\"16\",\"35\":\"7.359375\",\"36\":\"0.00000\",\"37\":\"No\",\"38\":\"Private\",\"39\":\"No\",\"40\":\"Yes\",\"41\":\"No\",\"42\":\"No\",\"43\":\"No\",\"44\":\"No\",\"45\":\"No\",\"46\":\"No\",\"47\":\"No\",\"48\":\"No\",\"49\":\"white\",\"50\":\"$25-$50k\",\"51\":\"60\",\"52\":\"1\",\"_rn_\":\"3\"},{\"1\":\"ARF\",\"2\":\"None\",\"3\":\"1\",\"4\":\"0\",\"5\":\"0\",\"6\":\"0\",\"7\":\"0\",\"8\":\"0\",\"9\":\"0\",\"10\":\"0\",\"11\":\"0\",\"12\":\"0\",\"13\":\"1\",\"14\":\"0\",\"15\":\"0\",\"16\":\"[70,80)\",\"17\":\"Female\",\"18\":\"9.000000\",\"19\":\"22.92969\",\"20\":\"48\",\"21\":\"0\",\"22\":\"55\",\"23\":\"23.29687500\",\"24\":\"58\",\"25\":\"26\",\"26\":\"35.79688\",\"27\":\"156.6562\",\"28\":\"3.500000\",\"29\":\"26.29688\",\"30\":\"0.3999634\",\"31\":\"1.6999512\",\"32\":\"117\",\"33\":\"5.799805\",\"34\":\"30\",\"35\":\"7.459961\",\"36\":\"54.59998\",\"37\":\"No\",\"38\":\"Private & Medicare\",\"39\":\"Yes\",\"40\":\"No\",\"41\":\"No\",\"42\":\"No\",\"43\":\"No\",\"44\":\"No\",\"45\":\"No\",\"46\":\"No\",\"47\":\"No\",\"48\":\"No\",\"49\":\"white\",\"50\":\"$11-$25k\",\"51\":\"37\",\"52\":\"0\",\"_rn_\":\"4\"},{\"1\":\"MOSF\",\"2\":\"None\",\"3\":\"1\",\"4\":\"0\",\"5\":\"0\",\"6\":\"0\",\"7\":\"0\",\"8\":\"0\",\"9\":\"0\",\"10\":\"0\",\"11\":\"0\",\"12\":\"0\",\"13\":\"0\",\"14\":\"0\",\"15\":\"0\",\"16\":\"[60,70)\",\"17\":\"Male\",\"18\":\"9.945259\",\"19\":\"21.05078\",\"20\":\"72\",\"21\":\"41\",\"22\":\"65\",\"23\":\"29.69921880\",\"24\":\"125\",\"25\":\"27\",\"26\":\"34.79688\",\"27\":\"478.0000\",\"28\":\"3.500000\",\"29\":\"24.00000\",\"30\":\"1.0097656\",\"31\":\"3.5996094\",\"32\":\"126\",\"33\":\"5.799805\",\"34\":\"17\",\"35\":\"7.229492\",\"36\":\"78.39996\",\"37\":\"Yes\",\"38\":\"Medicare\",\"39\":\"No\",\"40\":\"Yes\",\"41\":\"No\",\"42\":\"No\",\"43\":\"No\",\"44\":\"No\",\"45\":\"No\",\"46\":\"No\",\"47\":\"No\",\"48\":\"No\",\"49\":\"white\",\"50\":\"Under $11k\",\"51\":\"2\",\"52\":\"1\",\"_rn_\":\"5\"},{\"1\":\"Other\",\"2\":\"None\",\"3\":\"0\",\"4\":\"0\",\"5\":\"1\",\"6\":\"0\",\"7\":\"0\",\"8\":\"1\",\"9\":\"0\",\"10\":\"0\",\"11\":\"0\",\"12\":\"0\",\"13\":\"0\",\"14\":\"0\",\"15\":\"0\",\"16\":\"[80, Inf)\",\"17\":\"Female\",\"18\":\"8.000000\",\"19\":\"17.50000\",\"20\":\"38\",\"21\":\"0\",\"22\":\"115\",\"23\":\"18.00000000\",\"24\":\"134\",\"25\":\"36\",\"26\":\"39.19531\",\"27\":\"184.1875\",\"28\":\"3.099609\",\"29\":\"30.50000\",\"30\":\"1.0097656\",\"31\":\"1.3999023\",\"32\":\"138\",\"33\":\"5.399414\",\"34\":\"68\",\"35\":\"7.299805\",\"36\":\"54.89999\",\"37\":\"No\",\"38\":\"Medicare\",\"39\":\"Yes\",\"40\":\"No\",\"41\":\"No\",\"42\":\"No\",\"43\":\"No\",\"44\":\"No\",\"45\":\"No\",\"46\":\"No\",\"47\":\"No\",\"48\":\"No\",\"49\":\"white\",\"50\":\"Under $11k\",\"51\":\"7\",\"52\":\"0\",\"_rn_\":\"6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nSee [@datasplit; @datasplit2]\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Using a seed to randomize in a reproducible way \nset.seed(123)\nrequire(caret)\nsplit<-createDataPartition(y = ObsData$Length.of.Stay, \n                           p = 0.7, list = FALSE)\nstr(split)\n#>  int [1:4017, 1] 1 2 3 4 5 6 7 8 9 10 ...\n#>  - attr(*, \"dimnames\")=List of 2\n#>   ..$ : NULL\n#>   ..$ : chr \"Resample1\"\ndim(split)\n#> [1] 4017    1\ndim(ObsData)*.7 # approximate train data\n#> [1] 4014.5   36.4\ndim(ObsData)*(1-.7) # approximate train data\n#> [1] 1720.5   15.6\n```\n:::\n\n\n### Split the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# create train data\ntrain.data<-ObsData[split,]\ndim(train.data)\n#> [1] 4017   52\n# create test data\ntest.data<-ObsData[-split,]\ndim(test.data)\n#> [1] 1718   52\n```\n:::\n\n\n### Train the model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nout.formula1 <- readRDS(file = \"Data/machinelearning/form1.RDS\")\nout.formula1\n#> Length.of.Stay ~ Disease.category + Cancer + Cardiovascular + \n#>     Congestive.HF + Dementia + Psychiatric + Pulmonary + Renal + \n#>     Hepatic + GI.Bleed + Tumor + Immunosupperssion + Transfer.hx + \n#>     MI + age + sex + edu + DASIndex + APACHE.score + Glasgow.Coma.Score + \n#>     blood.pressure + WBC + Heart.rate + Respiratory.rate + Temperature + \n#>     PaO2vs.FIO2 + Albumin + Hematocrit + Bilirubin + Creatinine + \n#>     Sodium + Potassium + PaCo2 + PH + Weight + DNR.status + Medical.insurance + \n#>     Respiratory.Diag + Cardiovascular.Diag + Neurological.Diag + \n#>     Gastrointestinal.Diag + Renal.Diag + Metabolic.Diag + Hematologic.Diag + \n#>     Sepsis.Diag + Trauma.Diag + Orthopedic.Diag + race + income + \n#>     RHC.use\nfit.train1<-lm(out.formula1, data = train.data)\n# summary(fit.train1)\n```\n:::\n\n\n### Function that gives performance measures\n\n\n::: {.cell}\n\n```{.r .cell-code}\nperform <- function(new.data,\n                    model.fit,model.formula=NULL, \n                    y.name = \"Y\",\n                    digits=3){\n  # data dimension\n  p <- dim(model.matrix(model.fit))[2]\n  # predicted value\n  pred.y <- predict(model.fit, new.data)\n  # sample size\n  n <- length(pred.y)\n  # outcome\n  new.data.y <- as.numeric(new.data[,y.name])\n  # R2\n  R2 <- caret:::R2(pred.y, new.data.y)\n  # adj R2 using alternate formula\n  df.residual <- n-p\n  adjR2 <- 1-(1-R2)*((n-1)/df.residual)\n  # RMSE\n  RMSE <-  caret:::RMSE(pred.y, new.data.y)\n  # combine all of the results\n  res <- round(cbind(n,p,R2,adjR2,RMSE),digits)\n  # returning object\n  return(res)\n}\n```\n:::\n\n\n### Extract performance measures\n\n\n::: {.cell}\n\n```{.r .cell-code}\nperform(new.data=train.data,\n        y.name = \"Length.of.Stay\",\n        model.fit=fit.train1)\n#>         n  p    R2 adjR2   RMSE\n#> [1,] 4017 64 0.081 0.067 24.647\nperform(new.data=test.data,\n        y.name = \"Length.of.Stay\",\n        model.fit=fit.train1)\n#>         n  p    R2 adjR2   RMSE\n#> [1,] 1718 64 0.056  0.02 25.488\nperform(new.data=ObsData,\n        y.name = \"Length.of.Stay\",\n        model.fit=fit.train1)\n#>         n  p    R2 adjR2   RMSE\n#> [1,] 5735 64 0.073 0.063 24.902\n```\n:::\n\n\n### Video content (optional)\n\n::: callout-tip\nFor those who prefer a video walkthrough, feel free to watch the video below, which offers a description of an earlier version of the above content.\n:::\n\n::: {style=\"position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;\"}\n<iframe src=\"https://www.youtube.com/embed/PdrjcM_dTlw\" style=\"position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;\" allowfullscreen>\n\n</iframe>\n:::\n\n### References\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}