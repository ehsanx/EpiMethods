{
  "hash": "30b04e142cb0fe0a10cf89ec00833f25",
  "result": {
    "markdown": "## Continuous outcome {.unnumbered}\n\nLet us focus on issues related to predictive modeling for continuous outcomes in 4 steps:\n\n- Diagnosis Phase: Identifies outliers, leverage points, and residuals that could affect the model.\n\n- Cleaning Phase: Deletes problematic data based on predefined conditions.\n\n- Modeling Phase: Various models are fitted including polynomial models and a comprehensive model with multiple predictors.\n\n- Colinearity Check: A rule of thumb is used to check for multicollinearity in the comprehensive model, and problematic variables are flagged.\n\n### Explore relationships for continuous outcome variable\n\nFirst, load several R packages for statistical modeling, data manipulation, and visualization.\n\n\n\n::: {.cell hash='predictivefactors2_cache/pdf/setup_94a2e72c85cd9602f507892a5722fff8'}\n\n```{.r .cell-code}\n# Load required packages\nlibrary(rms)\nlibrary(Hmisc)\nlibrary(dplyr)\nlibrary(Publish)\nlibrary(car)\nlibrary(corrplot)\nlibrary(olsrr)\n```\n:::\n\n\n\n#### Load data\n\nHere, a dataset is loaded into the R environment from an RData file.\n\n\n\n::: {.cell hash='predictivefactors2_cache/pdf/load_5fb59e8f7f41a00ab68754ee3428b09a'}\n\n```{.r .cell-code}\nload(file = \"Data/predictivefactors/cholesterolNHANES15.RData\")\n```\n:::\n\n\n\n#### Correlation plot\n\n::: callout-tip\nWe can use the `cor` function to see the correlation between numeric variables and then use the `corrplot` function to plot the `cor` object. The plot helps in understanding the linear or nonlinear relationships between different numerical variables.\n:::\n\n\n\n::: {.cell hash='predictivefactors2_cache/pdf/corr_ed9f2ab341ca5a428d55b70c8f3b33b2'}\n\n```{.r .cell-code}\nrequire(corrplot)\nnumeric.names <- c(\"age\", \"diastolicBP\", \"systolicBP\", \n                   \"bodyweight\", \"bodyheight\", \"bmi\", \"waist\", \"alcohol\", \n                   \"cholesterol\", \"triglycerides\", \"uric.acid\", \n                   \"protein\", \"bilirubin\", \"phosphorus\", \"sodium\", \"potassium\", \n                   \"globulin\", \"calcium\")\ncorrelationMatrix <- cor(analytic[numeric.names])\nmat.num <- round(correlationMatrix,2)\nmat.num[mat.num>0.8 & mat.num < 1]\n#> [1] 0.89 0.90 0.89 0.91 0.90 0.91\ncorrplot(correlationMatrix, method=\"number\", type=\"upper\")\n```\n\n::: {.cell-output-display}\n![](predictivefactors2_files/figure-pdf/corr-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n#### Examine descriptive associations\n\nLet us examine the descriptive associations with the dependent variable by stratifying separately by key predictors\n\n::: callout-tip\nThere are multiple ways to examine the descriptive associations by strata/groups, e.g., `summarize`, `aggregate`, `describeBy`, `tapply`, `summary`\n:::\n\nThe code calculates and explores various ways to describe the cholesterol levels, stratified by key predictors such as gender.\n\n\n\n::: {.cell hash='predictivefactors2_cache/pdf/desc_42709910aad49fc5521b0cd474753062'}\n\n```{.r .cell-code}\nmean(analytic$cholesterol)\n#> [1] 193.1002\n\n# Process 1\nmean(analytic$cholesterol[analytic$gender == \"Male\"])\n#> [1] 190.7626\nmean(analytic$cholesterol[analytic$gender == \"Female\"])\n#> [1] 196.7339\n\n# Process 2\nlibrary(dplyr)\nanalytic %>%\n  group_by(gender) %>%\n  summarize(mean.ch=mean(cholesterol), .groups = 'drop') \n#> # A tibble: 2 x 2\n#>   gender mean.ch\n#>   <chr>    <dbl>\n#> 1 Female    197.\n#> 2 Male      191.\n\n# process 3\nwith(analytic, aggregate( analytic$cholesterol, by=list(gender) , FUN=summary))\n#>   Group.1   x.Min. x.1st Qu. x.Median   x.Mean x.3rd Qu.   x.Max.\n#> 1  Female 100.0000  166.7500 194.5000 196.7339  220.2500 358.0000\n#> 2    Male  81.0000  161.0000 188.0000 190.7626  215.0000 545.0000\n\n# process 4\npsych::describeBy(analytic$cholesterol, analytic$gender)\n#> \n#>  Descriptive statistics by group \n#> group: Female\n#>    vars   n   mean    sd median trimmed   mad min max range skew kurtosis   se\n#> X1    1 496 196.73 43.26  194.5  194.44 40.77 100 358   258 0.57     0.56 1.94\n#> ------------------------------------------------------------ \n#> group: Male\n#>    vars   n   mean    sd median trimmed   mad min max range skew kurtosis   se\n#> X1    1 771 190.76 43.06    188  188.54 40.03  81 545   464  1.1     5.76 1.55\n\n# process 5\ntapply(analytic$cholesterol, analytic$gender, summary)\n#> $Female\n#>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#>   100.0   166.8   194.5   196.7   220.2   358.0 \n#> \n#> $Male\n#>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#>    81.0   161.0   188.0   190.8   215.0   545.0\n\n# A general process\nsel.names <- c(\"gender\", \"age\", \"born\", \"race\", \"education\", \"married\", \n               \"income\", \"diastolicBP\", \"systolicBP\", \n               \"bodyweight\", \"bodyheight\", \"bmi\", \"waist\", \"smoke\", \"alcohol\", \n               \"cholesterol\", \"triglycerides\", \"uric.acid\", \n               \"protein\", \"bilirubin\", \"phosphorus\", \"sodium\", \"potassium\", \n               \"globulin\", \"calcium\", \"physical.work\", \"physical.recreational\", \n               \"diabetes\")\nvar.summ <- summary(cholesterol~ ., data = analytic[sel.names])\nvar.summ\n#> cholesterol      N= 1267  \n#> \n#> +---------------------+--------------------------------+----+-----------+\n#> |                     |                                |   N|cholesterol|\n#> +---------------------+--------------------------------+----+-----------+\n#> |               gender|                          Female| 496|   196.7339|\n#> |                     |                            Male| 771|   190.7626|\n#> +---------------------+--------------------------------+----+-----------+\n#> |                  age|                         [20,37)| 342|   182.4854|\n#> |                     |                         [37,52)| 313|   200.1661|\n#> |                     |                         [52,64)| 315|   199.7873|\n#> |                     |                         [64,80]| 297|   190.7845|\n#> +---------------------+--------------------------------+----+-----------+\n#> |                 born|Born in 50 US states or Washingt| 991|   190.9253|\n#> |                     |                          Others| 276|   200.9094|\n#> +---------------------+--------------------------------+----+-----------+\n#> |                 race|                           Black| 246|   187.3740|\n#> |                     |                        Hispanic| 337|   193.5490|\n#> |                     |                           Other| 132|   191.8561|\n#> |                     |                           White| 552|   195.6757|\n#> +---------------------+--------------------------------+----+-----------+\n#> |            education|                         College| 648|   192.5478|\n#> |                     |                     High.School| 523|   193.4532|\n#> |                     |                          School|  96|   194.9062|\n#> +---------------------+--------------------------------+----+-----------+\n#> |              married|                         Married| 751|   194.0306|\n#> |                     |                   Never.married| 226|   182.8761|\n#> |                     |              Previously.married| 290|   198.6586|\n#> +---------------------+--------------------------------+----+-----------+\n#> |               income|                            <25k| 344|   191.9564|\n#> |                     |                Between.25kto54k| 435|   191.9310|\n#> |                     |                Between.55kto99k| 297|   195.7508|\n#> |                     |                        Over100k| 191|   193.7016|\n#> +---------------------+--------------------------------+----+-----------+\n#> |          diastolicBP|                        [ 0, 64)| 336|   186.7649|\n#> |                     |                        [64, 72)| 321|   189.3458|\n#> |                     |                        [72, 80)| 319|   195.7085|\n#> |                     |                        [80,112]| 291|   201.6976|\n#> +---------------------+--------------------------------+----+-----------+\n#> |           systolicBP|                       [ 84,116)| 340|   186.2765|\n#> |                     |                       [116,126)| 317|   190.6372|\n#> |                     |                       [126,138)| 335|   196.9881|\n#> |                     |                       [138,236]| 275|   199.6400|\n#> +---------------------+--------------------------------+----+-----------+\n#> |           bodyweight|                    [39.7, 69.8)| 319|   193.8903|\n#> |                     |                    [69.8, 81.5)| 316|   197.1424|\n#> |                     |                    [81.5, 97.2)| 317|   192.4984|\n#> |                     |                    [97.2,178.4]| 315|   188.8508|\n#> +---------------------+--------------------------------+----+-----------+\n#> |           bodyheight|                       [144,163)| 317|   198.7003|\n#> |                     |                       [163,169)| 320|   193.7750|\n#> |                     |                       [169,176)| 314|   189.8790|\n#> |                     |                       [176,201]| 316|   190.0000|\n#> +---------------------+--------------------------------+----+-----------+\n#> |                  bmi|                     [16.3,24.9)| 322|   188.8043|\n#> |                     |                     [24.9,28.7)| 315|   198.5016|\n#> |                     |                     [28.7,33.4)| 317|   197.5016|\n#> |                     |                     [33.4,64.5]| 313|   187.6262|\n#> +---------------------+--------------------------------+----+-----------+\n#> |                waist|                   [ 65.0, 90.7)| 320|   188.9688|\n#> |                     |                   [ 90.7,100.4)| 315|   199.6413|\n#> |                     |                   [100.4,111.3)| 316|   197.3892|\n#> |                     |                   [111.3,161.5]| 316|   186.4747|\n#> +---------------------+--------------------------------+----+-----------+\n#> |                smoke|                       Every.day| 448|   191.5938|\n#> |                     |                      Not.at.all| 665|   194.6451|\n#> |                     |                       Some.days| 154|   190.8117|\n#> +---------------------+--------------------------------+----+-----------+\n#> |              alcohol|                               1| 336|   191.0387|\n#> |                     |                               2| 371|   192.0809|\n#> |                     |                          [3, 5)| 295|   195.9356|\n#> |                     |                          [5,15]| 265|   193.9849|\n#> +---------------------+--------------------------------+----+-----------+\n#> |        triglycerides|                      [ 18,  85)| 320|   172.2344|\n#> |                     |                      [ 85, 128)| 319|   185.6834|\n#> |                     |                      [128, 203)| 314|   199.4140|\n#> |                     |                      [203,3061]| 314|   215.5860|\n#> +---------------------+--------------------------------+----+-----------+\n#> |            uric.acid|                      [1.6, 4.7)| 348|   188.9310|\n#> |                     |                      [4.7, 5.6)| 305|   191.8033|\n#> |                     |                      [5.6, 6.6)| 307|   195.7720|\n#> |                     |                      [6.6,18.0]| 307|   196.4430|\n#> +---------------------+--------------------------------+----+-----------+\n#> |              protein|                       [5.7,6.9)| 336|   189.8631|\n#> |                     |                       [6.9,7.2)| 328|   192.3201|\n#> |                     |                       [7.2,7.5)| 310|   193.4258|\n#> |                     |                       [7.5,9.0]| 293|   197.3413|\n#> +---------------------+--------------------------------+----+-----------+\n#> |            bilirubin|                       [0.0,0.5)| 506|   195.7391|\n#> |                     |                             0.5| 212|   192.2264|\n#> |                     |                       [0.6,0.8)| 310|   192.0645|\n#> |                     |                       [0.8,3.3]| 239|   189.6318|\n#> +---------------------+--------------------------------+----+-----------+\n#> |           phosphorus|                       [1.8,3.4)| 362|   188.0387|\n#> |                     |                       [3.4,3.7)| 309|   192.5405|\n#> |                     |                       [3.7,4.1)| 323|   195.5542|\n#> |                     |                       [4.1,6.1]| 273|   197.5421|\n#> +---------------------+--------------------------------+----+-----------+\n#> |               sodium|                       [124,138)| 362|   191.9420|\n#> |                     |                       [138,140)| 495|   194.2929|\n#> |                     |                             140| 206|   191.7864|\n#> |                     |                       [141,148]| 204|   193.5882|\n#> +---------------------+--------------------------------+----+-----------+\n#> |            potassium|                     [2.60,3.79)| 320|   191.5375|\n#> |                     |                     [3.79,3.99)| 328|   192.3628|\n#> |                     |                     [3.99,4.20)| 308|   196.9643|\n#> |                     |                     [4.20,5.51]| 311|   191.6592|\n#> +---------------------+--------------------------------+----+-----------+\n#> |             globulin|                       [1.6,2.6)| 350|   189.9429|\n#> |                     |                       [2.6,2.9)| 388|   199.0052|\n#> |                     |                       [2.9,3.1)| 230|   193.3783|\n#> |                     |                       [3.1,5.5]| 299|   188.9197|\n#> +---------------------+--------------------------------+----+-----------+\n#> |              calcium|                      [8.4, 9.2)| 371|   186.0323|\n#> |                     |                      [9.2, 9.4)| 294|   188.3605|\n#> |                     |                      [9.4, 9.7)| 395|   197.4430|\n#> |                     |                      [9.7,11.1]| 207|   204.2126|\n#> +---------------------+--------------------------------+----+-----------+\n#> |        physical.work|                              No| 895|   194.0078|\n#> |                     |                             Yes| 372|   190.9167|\n#> +---------------------+--------------------------------+----+-----------+\n#> |physical.recreational|                              No|1002|   193.5359|\n#> |                     |                             Yes| 265|   191.4528|\n#> +---------------------+--------------------------------+----+-----------+\n#> |             diabetes|                              No|1064|   194.8036|\n#> |                     |                             Yes| 203|   184.1724|\n#> +---------------------+--------------------------------+----+-----------+\n#> |              Overall|                                |1267|   193.1002|\n#> +---------------------+--------------------------------+----+-----------+\nplot(var.summ)\n```\n\n::: {.cell-output-display}\n![](predictivefactors2_files/figure-pdf/desc-1.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\n\nsummary(analytic$diastolicBP)\n#>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#>    0.00   62.00   70.00   70.37   78.00  112.00\n\nanalytic$diastolicBP[analytic$diastolicBP == 0] <- NA\n\n# Bivariate Summaries Computed Separately by a Series of Predictors\nvar.summ2 <- spearman2(cholesterol~ ., data = analytic[sel.names])\nplot(var.summ2)\n```\n\n::: {.cell-output-display}\n![](predictivefactors2_files/figure-pdf/desc-2.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n#### Regression: Linear regression\n\nA linear regression model is fitted to explore the association between cholesterol levels and triglycerides. Various summary statistics are also generated for the model.\n\n::: callout-tip\nWe use `lm` function to fit the linear regression\n:::\n\n\n\n::: {.cell hash='predictivefactors2_cache/pdf/lm_926b3302fb831246a8be9e16c3683878'}\n\n```{.r .cell-code}\n# set up formula with just 1 variable\nformula0 <- as.formula(\"cholesterol~triglycerides\")\n\n# fitting regression on the analytic2 data\nfit0 <- lm(formula0,data = analytic2)\n\n# extract results\nsummary(fit0)\n#> \n#> Call:\n#> lm(formula = formula0, data = analytic2)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -111.651  -26.157   -2.661   22.549  166.752 \n#> \n#> Coefficients:\n#>                Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)   1.716e+02  1.127e+00  152.23   <2e-16 ***\n#> triglycerides 1.275e-01  5.456e-03   23.37   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 37.38 on 2632 degrees of freedom\n#> Multiple R-squared:  0.1718,\tAdjusted R-squared:  0.1715 \n#> F-statistic:   546 on 1 and 2632 DF,  p-value: < 2.2e-16\n\n# extract just the coefficients/estimates\ncoef(fit0)\n#>   (Intercept) triglycerides \n#>   171.6147531     0.1274909\n\n# extract confidence intervals\nconfint(fit0)\n#>                     2.5 %      97.5 %\n#> (Intercept)   169.4042284 173.8252779\n#> triglycerides   0.1167919   0.1381899\n\n# residual plots\nlayout(matrix(1:6, byrow = T, ncol = 3))\nplot(fit0, which = 1:6)\n```\n\n::: {.cell-output-display}\n![](predictivefactors2_files/figure-pdf/lm-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n#### Diagnosis\n\n##### Identifying problematic data\n\n**Outliers**: We can begin by plotting cholesterol against triglycerides to visualize any potential outliers. We can then identify data points where triglycerides are high.\n\n**Leverage**: It calculates and plots leverage points. Leverage points that have values greater than 0.05 are isolated for inspection.\n\n**Residuals**: Studentized residuals are computed for each data point to identify potential outliers. Those with values less than -5 are identified.\n\n\n\n::: {.cell hash='predictivefactors2_cache/pdf/diag_22eb5e86aeeb2632ab27d461551aec55'}\n\n```{.r .cell-code}\nrequire(olsrr)\n# Outlier\nplot(cholesterol ~ triglycerides, data = analytic2)\n```\n\n::: {.cell-output-display}\n![](predictivefactors2_files/figure-pdf/diag-1.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nsubset(analytic2, triglycerides > 1500)\n#>         ID gender age                             born  race education married\n#> 4287 88018   Male  48 Born in 50 US states or Washingt White   College Married\n#> 4845 88576   Male  33 Born in 50 US states or Washingt Black   College Married\n#>                income    weight psu strata diastolicBP systolicBP bodyweight\n#> 4287         Over100k 166919.97   2    121          78        128       90.4\n#> 4845 Between.55kto99k  25026.18   2    129          64        120      103.6\n#>      bodyheight  bmi waist alcohol cholesterol cholesterolM2 triglycerides\n#> 4287      181.1 27.6  96.5       2         545         14.09          3061\n#> 4845      179.9 32.0 108.0       1         433         11.20          1605\n#>      uric.acid protein bilirubin phosphorus sodium potassium globulin calcium\n#> 4287       5.3     6.7       0.5        3.1    134      4.16      2.5     9.1\n#> 4845       6.5     7.7       0.8        3.5    133      3.69      3.1    10.2\n#>      physical.work physical.recreational diabetes\n#> 4287           Yes                   Yes       No\n#> 4845            No                   Yes      Yes\n\n# leverage\nols_plot_resid_lev(fit0)\n```\n\n::: {.cell-output-display}\n![](predictivefactors2_files/figure-pdf/diag-2.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nanalytic2$lev <- hat(model.matrix(fit0))\nplot(analytic2$lev)\n```\n\n::: {.cell-output-display}\n![](predictivefactors2_files/figure-pdf/diag-3.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nsummary(analytic2$lev)\n#>      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. \n#> 0.0003796 0.0004062 0.0004773 0.0007593 0.0005831 0.1800021\nwhich(analytic2$lev > 0.05)\n#> [1] 1102\nsubset(analytic2, lev > 0.05)\n#>         ID gender age                             born  race education married\n#> 4287 88018   Male  48 Born in 50 US states or Washingt White   College Married\n#>        income weight psu strata diastolicBP systolicBP bodyweight bodyheight\n#> 4287 Over100k 166920   2    121          78        128       90.4      181.1\n#>       bmi waist alcohol cholesterol cholesterolM2 triglycerides uric.acid\n#> 4287 27.6  96.5       2         545         14.09          3061       5.3\n#>      protein bilirubin phosphorus sodium potassium globulin calcium\n#> 4287     6.7       0.5        3.1    134      4.16      2.5     9.1\n#>      physical.work physical.recreational diabetes       lev\n#> 4287           Yes                   Yes       No 0.1800021\n\n# Residual\nanalytic2$rstudent.values <- rstudent(fit0)\nplot(analytic2$rstudent.values)\n```\n\n::: {.cell-output-display}\n![](predictivefactors2_files/figure-pdf/diag-4.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nwhich(analytic2$rstudent.values < -5)\n#> integer(0)\n# Heteroskedasticity: Test for constant variance\n#ols_test_breusch_pagan(fit0, rhs = TRUE)\n```\n:::\n\n\n\n##### Deleting suspicious data\n\nWe then delete observations based on two conditions: triglycerides > 1500 and leverage > 0.05.\n\n\n\n::: {.cell hash='predictivefactors2_cache/pdf/del_1bddcac74fc6d001eb7e50243ce6fe99'}\n\n```{.r .cell-code}\n# condition 1: triglycerides above 1500 needs deleting\nanalytic2b <- subset(analytic2, triglycerides < 1500)\ndim(analytic2b)\n#> [1] 2632   34\n\n# condition 2: leverage above 0.05 needs deleting\nanalytic3 <- subset(analytic2b, lev < 0.05)\ndim(analytic3)\n#> [1] 2632   34\n\n# Check how many observations are deleted\nnrow(analytic2)-nrow(analytic3)\n#> [1] 2\n```\n:::\n\n\n\n##### Refitting in cleaned data\n\nWe refit the linear model on this cleaned data, and diagnostic plots are generated.\n\n\n\n::: {.cell hash='predictivefactors2_cache/pdf/refit1_9a524001dcc67527ea2eb9098818b560'}\n\n```{.r .cell-code}\n### Re-fit in data analytic3 (without problematic data)\nformula0\n#> cholesterol ~ triglycerides\nfit0 <- lm(formula0,data = analytic3)\n\nrequire(Publish)\npublish(fit0)\n#>       Variable Units Coefficient           CI.95 p-value \n#>    (Intercept)            171.74 [169.37;174.11] < 1e-04 \n#>  triglycerides              0.13     [0.11;0.14] < 1e-04\nlayout(matrix(1:6, byrow = T, ncol = 3))\nplot(fit0, which = 1:6)\n```\n\n::: {.cell-output-display}\n![](predictivefactors2_files/figure-pdf/refit1-1.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\n\nrequire(car)\n# component+residual plot or partial-residual plot\ncrPlots(fit0)\n```\n\n::: {.cell-output-display}\n![](predictivefactors2_files/figure-pdf/refit1-2.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n##### polynomial order 2\n\nWe fit polynomial models of orders 2 and 3 to explore non-linear relationships between cholesterol and triglycerides.\n\n\n\n::: {.cell hash='predictivefactors2_cache/pdf/refit2_62d7038d4fa5b2b4d763c1f8925d117f'}\n\n```{.r .cell-code}\nformula1 <- as.formula(\"cholesterol~poly(triglycerides,2)\")\nformula1 <- as.formula(\"cholesterol~triglycerides^2\")\nfit1 <- lm(formula1,data = analytic3)\npublish(fit1)\n#>       Variable Units Coefficient           CI.95 p-value \n#>    (Intercept)            171.74 [169.37;174.11] < 1e-04 \n#>  triglycerides              0.13     [0.11;0.14] < 1e-04\n\n# Partial Residual Plots\ncrPlots(fit1)\n```\n\n::: {.cell-output-display}\n![](predictivefactors2_files/figure-pdf/refit2-1.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\n\n# compare fit0 and fit1 models\nanova(fit0,fit1)\n#> Analysis of Variance Table\n#> \n#> Model 1: cholesterol ~ triglycerides\n#> Model 2: cholesterol ~ triglycerides^2\n#>   Res.Df     RSS Df Sum of Sq F Pr(>F)\n#> 1   2630 3673461                      \n#> 2   2630 3673461  0         0\n```\n:::\n\n\n\n##### polynomial order 3\n\n\n\n::: {.cell hash='predictivefactors2_cache/pdf/refit3_9c34bd7d075f1ca86c89ce5edfcf567a'}\n\n```{.r .cell-code}\n# Fit a polynomial of order 3\nformula2 <- as.formula(\"cholesterol~poly(triglycerides,3)\")\nformula2 <- as.formula(\"cholesterol~triglycerides^3\")\nfit2 <- lm(formula2,data = analytic3)\npublish(fit2)\n#>       Variable Units Coefficient           CI.95 p-value \n#>    (Intercept)            171.74 [169.37;174.11] < 1e-04 \n#>  triglycerides              0.13     [0.11;0.14] < 1e-04\n\n# Partial Residual Plots\ncrPlots(fit2)\n```\n\n::: {.cell-output-display}\n![](predictivefactors2_files/figure-pdf/refit3-1.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\n\n# compare fit1 and fit2 models\nanova(fit1,fit2)\n#> Analysis of Variance Table\n#> \n#> Model 1: cholesterol ~ triglycerides^2\n#> Model 2: cholesterol ~ triglycerides^3\n#>   Res.Df     RSS Df Sum of Sq F Pr(>F)\n#> 1   2630 3673461                      \n#> 2   2630 3673461  0         0\n```\n:::\n\n\n\n##### Multiple covariates\n\nWe add more covariates.\n\n\n\n::: {.cell hash='predictivefactors2_cache/pdf/refit4_1f5ca18589ca0b1d38f9665228b9ebf9'}\n\n```{.r .cell-code}\n# include everything!\nformula3 <- as.formula(\"cholesterol~gender + age + born + \n             race + education + married + \n             income + diastolicBP + systolicBP + \n             bmi + bodyweight + bodyheight + waist +  \n             triglycerides + uric.acid + \n             protein + bilirubin + phosphorus + sodium + potassium + \n             globulin + calcium + physical.work + physical.recreational + \n             diabetes\")\nfit3 <- lm(formula3, data = analytic3)\npublish(fit3)\n#>               Variable                            Units Coefficient           CI.95     p-value \n#>            (Intercept)                                       280.02 [133.42;426.62]   0.0001852 \n#>                 gender                           Female         Ref                             \n#>                                                    Male      -11.99  [-16.41;-7.57]     < 1e-04 \n#>                    age                                         0.35     [0.23;0.47]     < 1e-04 \n#>                   born Born in 50 US states or Washingt         Ref                             \n#>                                                  Others        7.52    [3.68;11.36]   0.0001270 \n#>                   race                            Black         Ref                             \n#>                                                Hispanic       -6.15  [-10.87;-1.44]   0.0106253 \n#>                                                   Other       -5.37   [-10.92;0.18]   0.0579281 \n#>                                                   White       -0.95    [-5.21;3.30]   0.6603698 \n#>              education                          College         Ref                             \n#>                                             High.School        2.90    [-0.28;6.08]   0.0743132 \n#>                                                  School       -2.54    [-8.61;3.54]   0.4134016 \n#>                married                          Married         Ref                             \n#>                                           Never.married       -5.72   [-9.63;-1.81]   0.0041887 \n#>                                      Previously.married        0.31    [-3.54;4.17]   0.8730460 \n#>                 income                             <25k         Ref                             \n#>                                        Between.25kto54k       -0.97    [-4.87;2.93]   0.6261315 \n#>                                        Between.55kto99k        2.29    [-1.98;6.56]   0.2928564 \n#>                                                Over100k        2.44    [-2.27;7.14]   0.3099380 \n#>            diastolicBP                                         0.38     [0.25;0.50]     < 1e-04 \n#>             systolicBP                                         0.02    [-0.08;0.12]   0.6668119 \n#>                    bmi                                        -2.55   [-4.29;-0.81]   0.0041392 \n#>             bodyweight                                         0.82     [0.19;1.45]   0.0105518 \n#>             bodyheight                                        -0.89   [-1.55;-0.24]   0.0074286 \n#>                  waist                                        -0.02    [-0.29;0.26]   0.9020424 \n#>          triglycerides                                         0.12     [0.11;0.14]     < 1e-04 \n#>              uric.acid                                         1.27     [0.08;2.47]   0.0369190 \n#>                protein                                         4.99   [-0.77;10.74]   0.0897748 \n#>              bilirubin                                        -5.43  [-10.53;-0.33]   0.0370512 \n#>             phosphorus                                        -0.18    [-2.81;2.45]   0.8939361 \n#>                 sodium                                        -0.97   [-1.66;-0.29]   0.0052516 \n#>              potassium                                         1.04    [-3.44;5.52]   0.6487979 \n#>               globulin                                        -2.25    [-8.22;3.71]   0.4591138 \n#>                calcium                                        12.02    [6.98;17.07]     < 1e-04 \n#>          physical.work                               No         Ref                             \n#>                                                     Yes       -0.45    [-3.68;2.79]   0.7858787 \n#>  physical.recreational                               No         Ref                             \n#>                                                     Yes        1.35    [-1.94;4.65]   0.4210703 \n#>               diabetes                               No         Ref                             \n#>                                                     Yes      -19.11 [-23.37;-14.85]     < 1e-04\n```\n:::\n\n\n\n##### Colinearity\n\nWe finally check for multicollinearity among predictors using the Variance Inflation Factor (VIF). \n\n::: column-margin\nRule of thumb: variables with VIF \\> 4 needs further investigation\n:::\n\n\n\n::: {.cell hash='predictivefactors2_cache/pdf/vif_ae68434c4c9832824002d9ad7b9f0f1a'}\n\n```{.r .cell-code}\ncar::vif(fit3)\n#>                             GVIF Df GVIF^(1/(2*Df))\n#> gender                  2.694171  1        1.641393\n#> age                     2.164388  1        1.471186\n#> born                    1.611478  1        1.269440\n#> race                    2.463445  3        1.162137\n#> education               1.435876  2        1.094660\n#> married                 1.481141  2        1.103187\n#> income                  1.402249  3        1.057964\n#> diastolicBP             1.271126  1        1.127442\n#> systolicBP              1.594986  1        1.262928\n#> bmi                    81.811969  1        9.044997\n#> bodyweight            101.102349  1       10.054966\n#> bodyheight             21.863188  1        4.675809\n#> waist                  11.913719  1        3.451626\n#> triglycerides           1.219331  1        1.104233\n#> uric.acid               1.603290  1        1.266211\n#> protein                 3.622385  1        1.903256\n#> bilirubin               1.185035  1        1.088593\n#> phosphorus              1.116982  1        1.056874\n#> sodium                  1.120920  1        1.058735\n#> potassium               1.178381  1        1.085533\n#> globulin                3.371211  1        1.836086\n#> calcium                 1.591677  1        1.261617\n#> physical.work           1.087315  1        1.042744\n#> physical.recreational   1.226830  1        1.107624\n#> diabetes                1.210715  1        1.100325\ncollinearity <- ols_vif_tol(fit3)\ncollinearity\n#>                    Variables   Tolerance        VIF\n#> 1                 genderMale 0.371171648   2.694171\n#> 2                        age 0.462024352   2.164388\n#> 3                 bornOthers 0.620548521   1.611478\n#> 4               raceHispanic 0.398271889   2.510848\n#> 5                  raceOther 0.514996433   1.941761\n#> 6                  raceWhite 0.418431280   2.389879\n#> 7       educationHigh.School 0.818384646   1.221919\n#> 8            educationSchool 0.752526988   1.328856\n#> 9       marriedNever.married 0.760566978   1.314809\n#> 10 marriedPreviously.married 0.805388372   1.241637\n#> 11    incomeBetween.25kto54k 0.547265531   1.827267\n#> 12    incomeBetween.55kto99k 0.528356768   1.892661\n#> 13            incomeOver100k 0.485459308   2.059905\n#> 14               diastolicBP 0.786704109   1.271126\n#> 15                systolicBP 0.626964572   1.594986\n#> 16                       bmi 0.012223150  81.811969\n#> 17                bodyweight 0.009890967 101.102349\n#> 18                bodyheight 0.045738984  21.863188\n#> 19                     waist 0.083936847  11.913719\n#> 20             triglycerides 0.820121824   1.219331\n#> 21                 uric.acid 0.623717352   1.603290\n#> 22                   protein 0.276061222   3.622385\n#> 23                 bilirubin 0.843856689   1.185035\n#> 24                phosphorus 0.895269366   1.116982\n#> 25                    sodium 0.892124045   1.120920\n#> 26                 potassium 0.848621797   1.178381\n#> 27                  globulin 0.296629287   3.371211\n#> 28                   calcium 0.628268255   1.591677\n#> 29          physical.workYes 0.919696951   1.087315\n#> 30  physical.recreationalYes 0.815108557   1.226830\n#> 31               diabetesYes 0.825958210   1.210715\n\n# VIF > 4\ncollinearity[collinearity$VIF>4,]\n#>     Variables   Tolerance       VIF\n#> 16        bmi 0.012223150  81.81197\n#> 17 bodyweight 0.009890967 101.10235\n#> 18 bodyheight 0.045738984  21.86319\n#> 19      waist 0.083936847  11.91372\n```\n:::\n\n::: {.cell hash='predictivefactors2_cache/pdf/refit5_7a62f5a10679f5eb141eac6111950380'}\n\n```{.r .cell-code}\nformula4 <- as.formula(\"cholesterol~gender + age + born + \n             race + education + married + \n             income + diastolicBP + systolicBP + \n             bmi + # bodyweight + bodyheight + waist +  \n             triglycerides + uric.acid + \n             protein + bilirubin + phosphorus + sodium + potassium + \n             globulin + calcium + physical.work + physical.recreational + \n             diabetes\")\nfit4 <- lm(formula4, data = analytic3)\npublish(fit4)\n#>               Variable                            Units Coefficient           CI.95    p-value \n#>            (Intercept)                                       136.87  [34.96;238.79]   0.008533 \n#>                 gender                           Female         Ref                            \n#>                                                    Male      -13.06  [-16.60;-9.53]    < 1e-04 \n#>                    age                                         0.35     [0.24;0.46]    < 1e-04 \n#>                   born Born in 50 US states or Washingt         Ref                            \n#>                                                  Others        7.88    [4.06;11.69]    < 1e-04 \n#>                   race                            Black         Ref                            \n#>                                                Hispanic       -5.79  [-10.34;-1.24]   0.012740 \n#>                                                   Other       -4.88   [-10.33;0.57]   0.079497 \n#>                                                   White       -0.85    [-5.02;3.33]   0.690720 \n#>              education                          College         Ref                            \n#>                                             High.School        2.85    [-0.32;6.02]   0.078008 \n#>                                                  School       -2.45    [-8.49;3.60]   0.427694 \n#>                married                          Married         Ref                            \n#>                                           Never.married       -5.74   [-9.65;-1.83]   0.004088 \n#>                                      Previously.married        0.34    [-3.52;4.20]   0.861981 \n#>                 income                             <25k         Ref                            \n#>                                        Between.25kto54k       -0.87    [-4.77;3.03]   0.663123 \n#>                                        Between.55kto99k        2.46    [-1.79;6.71]   0.256585 \n#>                                                Over100k        2.63    [-2.07;7.32]   0.272886 \n#>            diastolicBP                                         0.37     [0.25;0.50]    < 1e-04 \n#>             systolicBP                                         0.03    [-0.07;0.13]   0.544971 \n#>                    bmi                                        -0.31   [-0.54;-0.08]   0.009302 \n#>          triglycerides                                         0.12     [0.11;0.14]    < 1e-04 \n#>              uric.acid                                         1.36     [0.16;2.55]   0.025926 \n#>                protein                                         4.77   [-0.98;10.51]   0.104059 \n#>              bilirubin                                        -6.06  [-11.14;-0.98]   0.019519 \n#>             phosphorus                                        -0.08    [-2.71;2.55]   0.954561 \n#>                 sodium                                        -1.03   [-1.71;-0.35]   0.003175 \n#>              potassium                                         0.89    [-3.58;5.37]   0.695615 \n#>               globulin                                        -2.20    [-8.15;3.75]   0.469150 \n#>                calcium                                        12.20    [7.16;17.25]    < 1e-04 \n#>          physical.work                               No         Ref                            \n#>                                                     Yes       -0.44    [-3.68;2.80]   0.790297 \n#>  physical.recreational                               No         Ref                            \n#>                                                     Yes        1.24    [-2.03;4.51]   0.457666 \n#>               diabetes                               No         Ref                            \n#>                                                     Yes      -19.03 [-23.26;-14.80]    < 1e-04\n\n# check if there is still any problematic variable\n# with high collinearity problem\ncollinearity <- ols_vif_tol(fit4)\ncollinearity[collinearity$VIF>4,]\n#> [1] Variables Tolerance VIF      \n#> <0 rows> (or 0-length row.names)\n```\n:::\n\n\n\n### Save data\n\n\n\n::: {.cell hash='predictivefactors2_cache/pdf/save_fd6618472e0060782cfd6a8b312b8f3b'}\n\n```{.r .cell-code}\nsave.image(file = \"Data/predictivefactors/cholesterolNHANES15part1.RData\")\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}