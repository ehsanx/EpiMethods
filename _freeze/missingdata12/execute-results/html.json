{
  "hash": "75616b1bb27f6d820b48275f1c72f452",
  "result": {
    "engine": "knitr",
    "markdown": "## Survival Analysis {.unnumbered}\n\n::: callout-tip\nWe are going to use the data from a published article [@karim2025examining]. The reproducible analysis codes are available [here](https://ehsanx.github.io/Reproducible-NHANES-Analysis/). The authors performed a complete-case analysis in that article, which was appropriate since only a very small number of participants (0.5%) were excluded due to missing data on the exposure or outcome variables before the final cohort was established.\n::: \n\nThis tutorial demonstrates how to perform a survey-weighted survival analysis using NHANES data when there are missing values in the predictors. Instead of relying on a complete-case analysis, which can lose statistical power and introduce bias, we will use **multiple imputation** with the `mice` package in R.\n\nThe workflow follows the structure of a standard epidemiological analysis:\n\n1.  **Data Preparation**: Load and clean the raw data to create analytic variables and remove unnecessary columns.\n2.  **Multiple Imputation**: Use `mice` to create multiple complete datasets, correctly specifying the imputation model for survival data.\n3.  **Analysis & Pooling**: Run the survey-weighted survival model on each imputed dataset and pool the results for a final estimate.\n\n***\n\n## Setup\n\nFirst, we load the necessary R packages. We then load the `dat.full.with.mortality.RDS` file (from [here](https://ehsanx.github.io/Reproducible-NHANES-Analysis/)), which contains the merged NHANES and mortality data from 1999-2018.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load all necessary packages for the analysis\nlibrary(dplyr)\nlibrary(car)\nlibrary(survival)\nlibrary(mice)         # For imputation\nlibrary(survey)       # For survey analysis (svydesign, svyglm, etc.)\nlibrary(mitools)      # FOR imputationList() and other MI tools\nlibrary(Publish)\nlibrary(DataExplorer)\nlibrary(knitr)\nlibrary(kableExtra)\n# devtools::install_github(\"ehsanx/svyTable1\", build_vignettes = TRUE, dependencies = TRUE)\nlibrary(svyTable1) # for svypooled\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set survey option for compatibility\noptions(survey.want.obsolete = TRUE)\n\n# Load the full, merged dataset with mortality information\ndat.full.with.mortality <- readRDS(\"Data/missingdata/dat.full.with.mortality.RDS\")\n```\n:::\n\n\n***\n\n## Data Preparation and Cleaning\n\nBefore imputation, we must create the final analytic variables and clean the dataset. This includes creating the exposure, survival time, and status variables, and then dropping all unnecessary raw or intermediate columns.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# --- Create Analytic Variables ---\n\n# 1. Exposure Variable ('exposure.cat')\ndat.full.with.mortality$exposure.cat <- car::recode(\n  dat.full.with.mortality$smoking.age,\n  \"0 = 'Never smoked'; 1:9 = 'Started before 10';\n   10:14 = 'Started at 10-14'; 15:17 = 'Started at 15-17';\n   18:20 = 'Started at 18-20'; 21:80 = 'Started after 20';\n   else = NA\",\n  as.factor = TRUE\n)\ndat.full.with.mortality$exposure.cat <- factor(\n  dat.full.with.mortality$exposure.cat,\n  levels = c(\"Never smoked\", \"Started before 10\", \"Started at 10-14\",\n             \"Started at 15-17\", \"Started at 18-20\", \"Started after 20\")\n)\n\n# 2. Survival Time ('stime.since.birth') and Status ('status_all')\ndat.full.with.mortality$stime.since.birth <-\n  ((dat.full.with.mortality$age * 12) + dat.full.with.mortality$mort_permth_int) / 12\n# 'status_all' is our event indicator, derived from 'mort_stat'. It's essential for the Surv() object.\ndat.full.with.mortality$status_all <- dat.full.with.mortality$mort_stat\n\n# 3. Categorical Year ('year.cat')\ndat.full.with.mortality$year.cat <- dat.full.with.mortality$year\nlevels(dat.full.with.mortality$year.cat) <- c(\n  \"1999-2000\", \"2001-2002\", \"2003-2004\", \"2005-2006\", \"2007-2008\",\n  \"2009-2010\", \"2011-2012\", \"2013-2014\", \"2015-2016\", \"2017-2018\"\n)\n\n# --- Define the Analytic Cohort & Drop Unnecessary Variables ---\n\n# 4. Apply age restriction (20-79 years)\ndat.analytic <- subset(dat.full.with.mortality, age >= 20 & age < 80)\n\n# 5. Drop all raw, intermediate, or unused columns\nvars_to_drop <- c(\n  \"age\", \"born\", \"smoking.age\", \"smoked.while.child\", \"smoking\", \"year\",\n  \"mort_eligstat\", \"mort_stat\", \"mort_ucod_leading\", \"mort_diabetes\",\n  \"mort_hyperten\", \"mort_permth_int\", \"mort_permth_exm\"\n)\ndat.analytic[vars_to_drop] <- NULL\n\n# Verify the cleaned data\ncat(\"Remaining columns for analysis:\\n\")\n#> Remaining columns for analysis:\nnames(dat.analytic)\n#>  [1] \"id\"                \"sex\"               \"race\"             \n#>  [4] \"psu\"               \"strata\"            \"survey.weight.new\"\n#>  [7] \"exposure.cat\"      \"stime.since.birth\" \"status_all\"       \n#> [10] \"year.cat\"\nplot_missing(dat.analytic)\n#> Warning: `aes_string()` was deprecated in ggplot2 3.0.0.\n#> â„¹ Please use tidy evaluation idioms with `aes()`.\n#> â„¹ See also `vignette(\"ggplot2-in-packages\")` for more information.\n#> â„¹ The deprecated feature was likely used in the DataExplorer package.\n#>   Please report the issue at\n#>   <https://github.com/boxuancui/DataExplorer/issues>.\n```\n\n::: {.cell-output-display}\n![](missingdata12_files/figure-html/variable-creation-and-cleaning-1.png){width=672}\n:::\n\n```{.r .cell-code}\nprofile_missing(dat.analytic)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"feature\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"num_missing\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"pct_missing\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"id\",\"2\":\"0\",\"3\":\"0.000000000\"},{\"1\":\"sex\",\"2\":\"0\",\"3\":\"0.000000000\"},{\"1\":\"race\",\"2\":\"0\",\"3\":\"0.000000000\"},{\"1\":\"psu\",\"2\":\"0\",\"3\":\"0.000000000\"},{\"1\":\"strata\",\"2\":\"0\",\"3\":\"0.000000000\"},{\"1\":\"survey.weight.new\",\"2\":\"0\",\"3\":\"0.000000000\"},{\"1\":\"exposure.cat\",\"2\":\"143\",\"3\":\"0.002813631\"},{\"1\":\"stime.since.birth\",\"2\":\"134\",\"3\":\"0.002636550\"},{\"1\":\"status_all\",\"2\":\"134\",\"3\":\"0.002636550\"},{\"1\":\"year.cat\",\"2\":\"0\",\"3\":\"0.000000000\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n***\n\n## Multiple Imputation with `mice` ðŸª„\n\nWe will impute the missing values in `dat.analytic` before running the final models.\n\n### Preparing for Imputation\n\nWe must include the survival outcome information in the imputation model. The best way to do this is by creating and including the **Nelson-Aalen cumulative hazard** estimate [@white2009imputing].\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create the Nelson-Aalen cumulative hazard estimate\n# It's a more informative summary of survival than time alone\ndat.analytic$nelson_aalen <- nelsonaalen(\n  dat.analytic,\n  time = stime.since.birth,\n  status = status_all\n)\nsummary(dat.analytic$nelson_aalen)\n#>     Min.  1st Qu.   Median     Mean  3rd Qu.     Max.     NA's \n#> 0.000000 0.006434 0.026145 0.122797 0.112218 2.763365      134\nsummary(dat.analytic$stime.since.birth)\n#>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n#>   21.08   43.67   57.08   57.22   70.58   99.42     134\ntable(dat.analytic$status_all)\n#> \n#>     0     1 \n#> 44475  6215\nhist(dat.analytic$nelson_aalen)\n```\n\n::: {.cell-output-display}\n![](missingdata12_files/figure-html/mice-prep-1.png){width=672}\n:::\n:::\n\n\n### Configuring the Predictor Matrix\n\nThe `predictorMatrix` tells `mice` what to do. Hereâ€™s the logic for our setup:\n\n* **What variable are we imputing?**\n    * `exposure.cat`\n\nSince `exposure.cat` is the only **predictor** with missing data, it's the only variable we will actively impute in this tutorial.\n\n* **What about the missing outcome data?**\n    * Data shows that `stime.since.birth` and `status_all` also have missing values.\n    * It is standard practice not to impute the outcome variables in a survival analysis. \n\n* **What variables will help the imputation (i.e., act as predictors)?**\n    * **Outcome Information**: `status_all` and `nelson_aalen`. These are crucial for making the imputation model compatible with the survival analysis.\n    * **Confounders**: `sex`, `race`, `year.cat`.\n    * **Auxiliary Variables**: `psu`, `strata`, and `survey.weight.new`. Including the survey design variables makes the imputation \"survey-aware\" and more accurate.\n\n* **What variables will we ignore as predictors?**\n    * `id` (it's just an identifier).\n    * `stime.since.birth` (its information is better and more simply captured by `nelson_aalen`).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Initialize the predictor matrix\npred_matrix <- make.predictorMatrix(dat.analytic)\n\n# --- DO NOT use these variables AS PREDICTORS ---\n# We exclude the raw survival time and identifier variables from being predictors.\npred_matrix[, c(\"id\", \"stime.since.birth\")] <- 0\n\n# --- DO NOT IMPUTE these variables ---\n# These variables are complete, identifiers, or part of the outcome.\npred_matrix[c(\"id\", \"sex\", \"race\", \"psu\", \"strata\", \"survey.weight.new\",\n              \"stime.since.birth\", \"status_all\", \"year.cat\",\n              \"nelson_aalen\"), ] <- 0\n\n# Run the imputation. m and maxit are low for demonstration\nimputed_data <- mice(\n  dat.analytic,\n  m = 2,              # Number of imputed datasets\n  maxit = 2,         # Number of iterations per imputation\n  predictorMatrix = pred_matrix,\n  method = 'pmm',     # Predictive Mean Matching is a good default\n  seed = 123          # For reproducibility\n)\n#> \n#>  iter imp variable\n#>   1   1  exposure.cat*  stime.since.birth  status_all  nelson_aalen\n#>   1   2  exposure.cat*  stime.since.birth  status_all  nelson_aalen\n#>   2   1  exposure.cat*  stime.since.birth  status_all  nelson_aalen\n#>   2   2  exposure.cat*  stime.since.birth  status_all  nelson_aalen\n#> Warning: Number of logged events: 8\n```\n:::\n\n\n***\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkable(pred_matrix)\n```\n\n::: {.cell-output-display}\n\n\n|                  | id| sex| race| psu| strata| survey.weight.new| exposure.cat| stime.since.birth| status_all| year.cat| nelson_aalen|\n|:-----------------|--:|---:|----:|---:|------:|-----------------:|------------:|-----------------:|----------:|--------:|------------:|\n|id                |  0|   0|    0|   0|      0|                 0|            0|                 0|          0|        0|            0|\n|sex               |  0|   0|    0|   0|      0|                 0|            0|                 0|          0|        0|            0|\n|race              |  0|   0|    0|   0|      0|                 0|            0|                 0|          0|        0|            0|\n|psu               |  0|   0|    0|   0|      0|                 0|            0|                 0|          0|        0|            0|\n|strata            |  0|   0|    0|   0|      0|                 0|            0|                 0|          0|        0|            0|\n|survey.weight.new |  0|   0|    0|   0|      0|                 0|            0|                 0|          0|        0|            0|\n|exposure.cat      |  0|   1|    1|   1|      1|                 1|            0|                 0|          1|        1|            1|\n|stime.since.birth |  0|   0|    0|   0|      0|                 0|            0|                 0|          0|        0|            0|\n|status_all        |  0|   0|    0|   0|      0|                 0|            0|                 0|          0|        0|            0|\n|year.cat          |  0|   0|    0|   0|      0|                 0|            0|                 0|          0|        0|            0|\n|nelson_aalen      |  0|   0|    0|   0|      0|                 0|            0|                 0|          0|        0|            0|\n\n\n:::\n:::\n\n\n\n## Survival Analysis on Imputed Data ðŸ“Š\n\nWith our `m=2` complete datasets, we follow the \"analyze then pool\" procedure:\n\n1.  **Analyze**: Run the `svycoxph` model on each of the 2 datasets.\n2.  **Pool**: Combine the 2 sets of results into a single, final estimate using `pool()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# --- 5. Survival Analysis on Imputed Data  ---\n\n# --- Step 5.1: Re-integrate Ineligible Subjects for Correct Survey Variance ---\n\n# First, extract the 'm' imputed datasets into a single long-format data frame.\n# Add a flag to identify this group as our analytic/eligible sample.\nimputed_analytic_data <- complete(imputed_data, \"long\", include = FALSE)\nimputed_analytic_data$eligible <- 1\n\n# Next, identify the subjects from the original full dataset who were NOT in our analytic sample.\n# The analytic sample was defined as age >= 20 & age < 80.\ndat_ineligible <- subset(dat.full.with.mortality, !(age >= 20 & age < 80))\n\n# Replicate this ineligible dataset 'm' times, once for each imputation.\nineligible_list <- lapply(1:imputed_data$m, function(i) {\n  df <- dat_ineligible\n  df$.imp <- i # Add the imputation number\n  return(df)\n})\nineligible_stacked <- do.call(rbind, ineligible_list)\n\n# Now, align the columns. Add columns that exist in the imputed data (like 'nelson_aalen')\n# to the ineligible data, filling them with NA.\ncols_to_add <- setdiff(names(imputed_analytic_data), names(ineligible_stacked))\nineligible_stacked[, cols_to_add] <- NA\n\n# Set the eligibility flag for this group to 0.\nineligible_stacked$eligible <- 0\n\n# CRITICAL: Ensure the column order is identical before row-binding.\nineligible_final <- ineligible_stacked[, names(imputed_analytic_data)]\n\n# Finally, combine the imputed analytic data with the prepared ineligible data.\nimputed_full_data <- rbind(imputed_analytic_data, ineligible_final)\n\n\n# --- Step 5.2: Create Survey Design and Run Pooled Analysis ---\n\n# Create the complex survey design object using an `imputationList`.\n# This tells the survey package how to handle the 'm' imputed datasets.\n# The design is specified on the *full* data to capture the total population structure.\ndesign_full <- svydesign(ids = ~psu,\n                         strata = ~strata,\n                         weights = ~survey.weight.new,\n                         nest = TRUE,\n                         data = imputationList(split(imputed_full_data, imputed_full_data$.imp)))\n\n# Subset the design object to include only the eligible participants for the analysis.\n# This ensures variance is calculated correctly based on the full sample design.\ndesign_analytic <- subset(design_full, eligible == 1)\n\n# Fit the Cox model across all 'm' imputed datasets using the `with()` function.\n# This is more efficient than a for-loop.\nfit_pooled <- with(design_analytic,\n                   svycoxph(Surv(stime.since.birth, status_all) ~ exposure.cat + sex + race + year.cat))\n\n# Pool the results from the list of model fits using Rubin's Rules.\npooled_results <- pool(fit_pooled)\n#> Stratified 1 - level Cluster Sampling design (with replacement)\n#> With (301) clusters.\n#> svydesign(ids = ids, probs = probs, strata = strata, variables = variables, \n#>     fpc = fpc, nest = nest, check.strata = check.strata, weights = weights, \n#>     data = d, pps = pps, calibrate.formula = calibrate.formula, \n#>     ...)\n#> Stratified 1 - level Cluster Sampling design (with replacement)\n#> With (301) clusters.\n#> svydesign(ids = ids, probs = probs, strata = strata, variables = variables, \n#>     fpc = fpc, nest = nest, check.strata = check.strata, weights = weights, \n#>     data = d, pps = pps, calibrate.formula = calibrate.formula, \n#>     ...)\n#> Stratified 1 - level Cluster Sampling design (with replacement)\n#> With (301) clusters.\n#> svydesign(ids = ids, probs = probs, strata = strata, variables = variables, \n#>     fpc = fpc, nest = nest, check.strata = check.strata, weights = weights, \n#>     data = d, pps = pps, calibrate.formula = calibrate.formula, \n#>     ...)\n\n# Display the final, pooled results.\nprint(\"--- Final Adjusted Cox Model Results (from Pooled Imputed Data) ---\")\n#> [1] \"--- Final Adjusted Cox Model Results (from Pooled Imputed Data) ---\"\nsummary(pooled_results, conf.int = TRUE, exponentiate = TRUE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"term\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"estimate\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"std.error\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"statistic\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"df\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"p.value\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"2.5 %\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"97.5 %\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"conf.low\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"conf.high\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"exposure.catStarted before 10\",\"2\":\"2.7132093\",\"3\":\"0.14218609\",\"4\":\"7.0199005\",\"5\":\"6219.9920\",\"6\":\"2.456235e-12\",\"7\":\"2.0531975\",\"8\":\"3.5853856\",\"9\":\"2.0531975\",\"10\":\"3.5853856\",\"_rn_\":\"1\"},{\"1\":\"exposure.catStarted at 10-14\",\"2\":\"2.3729495\",\"3\":\"0.06178717\",\"4\":\"13.9856489\",\"5\":\"6217.4341\",\"6\":\"8.740575e-44\",\"7\":\"2.1022527\",\"8\":\"2.6785025\",\"9\":\"2.1022527\",\"10\":\"2.6785025\",\"_rn_\":\"2\"},{\"1\":\"exposure.catStarted at 15-17\",\"2\":\"1.9520100\",\"3\":\"0.05083865\",\"4\":\"13.1565182\",\"5\":\"3664.7456\",\"6\":\"1.159042e-38\",\"7\":\"1.7668261\",\"8\":\"2.1566033\",\"9\":\"1.7668261\",\"10\":\"2.1566033\",\"_rn_\":\"3\"},{\"1\":\"exposure.catStarted at 18-20\",\"2\":\"1.4848906\",\"3\":\"0.05251209\",\"4\":\"7.5285735\",\"5\":\"6214.5479\",\"6\":\"5.859236e-14\",\"7\":\"1.3396378\",\"8\":\"1.6458928\",\"9\":\"1.3396378\",\"10\":\"1.6458928\",\"_rn_\":\"4\"},{\"1\":\"exposure.catStarted after 20\",\"2\":\"1.5384734\",\"3\":\"0.05204472\",\"4\":\"8.2773173\",\"5\":\"6091.8314\",\"6\":\"1.533768e-16\",\"7\":\"1.3892508\",\"8\":\"1.7037244\",\"9\":\"1.3892508\",\"10\":\"1.7037244\",\"_rn_\":\"5\"},{\"1\":\"sexFemale\",\"2\":\"0.7422948\",\"3\":\"0.03388866\",\"4\":\"-8.7937633\",\"5\":\"6217.1190\",\"6\":\"1.847172e-18\",\"7\":\"0.6945839\",\"8\":\"0.7932829\",\"9\":\"0.6945839\",\"10\":\"0.7932829\",\"_rn_\":\"6\"},{\"1\":\"raceBlack\",\"2\":\"1.5999718\",\"3\":\"0.04250218\",\"4\":\"11.0579265\",\"5\":\"6159.5795\",\"6\":\"3.688747e-28\",\"7\":\"1.4720661\",\"8\":\"1.7389911\",\"9\":\"1.4720661\",\"10\":\"1.7389911\",\"_rn_\":\"7\"},{\"1\":\"raceHispanic\",\"2\":\"1.0393926\",\"3\":\"0.05638290\",\"4\":\"0.6852517\",\"5\":\"4325.4721\",\"6\":\"4.932218e-01\",\"7\":\"0.9306212\",\"8\":\"1.1608771\",\"9\":\"0.9306212\",\"10\":\"1.1608771\",\"_rn_\":\"8\"},{\"1\":\"raceOthers\",\"2\":\"1.1318173\",\"3\":\"0.08567645\",\"4\":\"1.4452574\",\"5\":\"6092.8281\",\"6\":\"1.484370e-01\",\"7\":\"0.9568280\",\"8\":\"1.3388093\",\"9\":\"0.9568280\",\"10\":\"1.3388093\",\"_rn_\":\"9\"},{\"1\":\"year.cat2001-2002\",\"2\":\"0.9657954\",\"3\":\"0.05654342\",\"4\":\"-0.6155135\",\"5\":\"5564.0764\",\"6\":\"5.382408e-01\",\"7\":\"0.8644598\",\"8\":\"1.0790100\",\"9\":\"0.8644598\",\"10\":\"1.0790100\",\"_rn_\":\"10\"},{\"1\":\"year.cat2003-2004\",\"2\":\"0.8432566\",\"3\":\"0.05851261\",\"4\":\"-2.9136281\",\"5\":\"5745.5781\",\"6\":\"3.586331e-03\",\"7\":\"0.7518708\",\"8\":\"0.9457498\",\"9\":\"0.7518708\",\"10\":\"0.9457498\",\"_rn_\":\"11\"},{\"1\":\"year.cat2005-2006\",\"2\":\"0.7582547\",\"3\":\"0.05807648\",\"4\":\"-4.7650270\",\"5\":\"6210.8836\",\"6\":\"1.931244e-06\",\"7\":\"0.6766603\",\"8\":\"0.8496881\",\"9\":\"0.6766603\",\"10\":\"0.8496881\",\"_rn_\":\"12\"},{\"1\":\"year.cat2007-2008\",\"2\":\"0.7756197\",\"3\":\"0.07740580\",\"4\":\"-3.2826084\",\"5\":\"6183.3338\",\"6\":\"1.034225e-03\",\"7\":\"0.6664200\",\"8\":\"0.9027130\",\"9\":\"0.6664200\",\"10\":\"0.9027130\",\"_rn_\":\"13\"},{\"1\":\"year.cat2009-2010\",\"2\":\"0.6749195\",\"3\":\"0.07113388\",\"4\":\"-5.5270687\",\"5\":\"6212.8529\",\"6\":\"3.388636e-08\",\"7\":\"0.5870714\",\"8\":\"0.7759130\",\"9\":\"0.5870714\",\"10\":\"0.7759130\",\"_rn_\":\"14\"},{\"1\":\"year.cat2011-2012\",\"2\":\"0.6290043\",\"3\":\"0.10030431\",\"4\":\"-4.6221071\",\"5\":\"3819.2505\",\"6\":\"3.924127e-06\",\"7\":\"0.5167106\",\"8\":\"0.7657021\",\"9\":\"0.5167106\",\"10\":\"0.7657021\",\"_rn_\":\"15\"},{\"1\":\"year.cat2013-2014\",\"2\":\"0.5831552\",\"3\":\"0.09316711\",\"4\":\"-5.7885435\",\"5\":\"6219.9920\",\"6\":\"7.446203e-09\",\"7\":\"0.4858081\",\"8\":\"0.7000089\",\"9\":\"0.4858081\",\"10\":\"0.7000089\",\"_rn_\":\"16\"},{\"1\":\"year.cat2015-2016\",\"2\":\"0.3549490\",\"3\":\"0.13456071\",\"4\":\"-7.6975015\",\"5\":\"527.6311\",\"6\":\"6.881639e-14\",\"7\":\"0.2724986\",\"8\":\"0.4623464\",\"9\":\"0.2724986\",\"10\":\"0.4623464\",\"_rn_\":\"17\"},{\"1\":\"year.cat2017-2018\",\"2\":\"0.1965730\",\"3\":\"0.19942493\",\"4\":\"-8.1570611\",\"5\":\"255.7995\",\"6\":\"1.553944e-14\",\"7\":\"0.1327291\",\"8\":\"0.2911264\",\"9\":\"0.1327291\",\"10\":\"0.2911264\",\"_rn_\":\"18\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Option A: Fallacy-safe table showing only the main exposure\nsvypooled(\n  pooled_model = pooled_results,\n  main_exposure = \"exposure.cat\",\n  adj_var_names = c(\"sex\", \"race\", \"year.cat\"),\n  measure = \"HR\",\n  title = \"Adjusted Hazard Ratios for All-Cause Mortality\"\n)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;\">\n<caption>Adjusted Hazard Ratios for All-Cause Mortality</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Characteristic </th>\n   <th style=\"text-align:center;\"> HR (95% CI) </th>\n   <th style=\"text-align:center;\"> p-value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr grouplength=\"5\"><td colspan=\"3\" style=\"border-bottom: 1px solid;\"><strong>exposure.cat</strong></td></tr>\n<tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> Started before 10 </td>\n   <td style=\"text-align:center;\"> 2.71 (2.05, 3.59) </td>\n   <td style=\"text-align:center;\"> &lt;0.001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> Started at 10-14 </td>\n   <td style=\"text-align:center;\"> 2.37 (2.10, 2.68) </td>\n   <td style=\"text-align:center;\"> &lt;0.001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> Started at 15-17 </td>\n   <td style=\"text-align:center;\"> 1.95 (1.77, 2.16) </td>\n   <td style=\"text-align:center;\"> &lt;0.001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> Started at 18-20 </td>\n   <td style=\"text-align:center;\"> 1.48 (1.34, 1.65) </td>\n   <td style=\"text-align:center;\"> &lt;0.001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> Started after 20 </td>\n   <td style=\"text-align:center;\"> 1.54 (1.39, 1.70) </td>\n   <td style=\"text-align:center;\"> &lt;0.001 </td>\n  </tr>\n</tbody>\n<tfoot><tr><td style=\"padding: 0; \" colspan=\"100%\">\n<span style=\"font-style: italic;\"> </span> <sup></sup> Adjusted for: sex, race, year.cat</td></tr></tfoot>\n</table>\n\n`````\n:::\n\n```{.r .cell-code}\n\n# Option B: Full table for an appendix\nsvypooled(\n  pooled_model = pooled_results,\n  main_exposure = \"exposure.cat\",\n  adj_var_names = c(\"sex\", \"race\", \"year.cat\"),\n  measure = \"HR\",\n  title = \"Full Adjusted Model Results (for Appendix)\",\n  fallacy_safe = FALSE\n)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>Full Adjusted Model Results (for Appendix)</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Characteristic </th>\n   <th style=\"text-align:center;\"> HR (95% CI) </th>\n   <th style=\"text-align:center;\"> p-value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr grouplength=\"5\"><td colspan=\"3\" style=\"border-bottom: 1px solid;\"><strong>exposure.cat</strong></td></tr>\n<tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> Started before 10 </td>\n   <td style=\"text-align:center;\"> 2.71 (2.05, 3.59) </td>\n   <td style=\"text-align:center;\"> &lt;0.001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> Started at 10-14 </td>\n   <td style=\"text-align:center;\"> 2.37 (2.10, 2.68) </td>\n   <td style=\"text-align:center;\"> &lt;0.001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> Started at 15-17 </td>\n   <td style=\"text-align:center;\"> 1.95 (1.77, 2.16) </td>\n   <td style=\"text-align:center;\"> &lt;0.001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> Started at 18-20 </td>\n   <td style=\"text-align:center;\"> 1.48 (1.34, 1.65) </td>\n   <td style=\"text-align:center;\"> &lt;0.001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> Started after 20 </td>\n   <td style=\"text-align:center;\"> 1.54 (1.39, 1.70) </td>\n   <td style=\"text-align:center;\"> &lt;0.001 </td>\n  </tr>\n  <tr grouplength=\"1\"><td colspan=\"3\" style=\"border-bottom: 1px solid;\"><strong>sex</strong></td></tr>\n<tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> Female </td>\n   <td style=\"text-align:center;\"> 0.74 (0.69, 0.79) </td>\n   <td style=\"text-align:center;\"> &lt;0.001 </td>\n  </tr>\n  <tr grouplength=\"3\"><td colspan=\"3\" style=\"border-bottom: 1px solid;\"><strong>race</strong></td></tr>\n<tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> Black </td>\n   <td style=\"text-align:center;\"> 1.60 (1.47, 1.74) </td>\n   <td style=\"text-align:center;\"> &lt;0.001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> Hispanic </td>\n   <td style=\"text-align:center;\"> 1.04 (0.93, 1.16) </td>\n   <td style=\"text-align:center;\"> 0.493 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> Others </td>\n   <td style=\"text-align:center;\"> 1.13 (0.96, 1.34) </td>\n   <td style=\"text-align:center;\"> 0.148 </td>\n  </tr>\n  <tr grouplength=\"9\"><td colspan=\"3\" style=\"border-bottom: 1px solid;\"><strong>year.cat</strong></td></tr>\n<tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> 2001-2002 </td>\n   <td style=\"text-align:center;\"> 0.97 (0.86, 1.08) </td>\n   <td style=\"text-align:center;\"> 0.538 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> 2003-2004 </td>\n   <td style=\"text-align:center;\"> 0.84 (0.75, 0.95) </td>\n   <td style=\"text-align:center;\"> 0.004 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> 2005-2006 </td>\n   <td style=\"text-align:center;\"> 0.76 (0.68, 0.85) </td>\n   <td style=\"text-align:center;\"> &lt;0.001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> 2007-2008 </td>\n   <td style=\"text-align:center;\"> 0.78 (0.67, 0.90) </td>\n   <td style=\"text-align:center;\"> 0.001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> 2009-2010 </td>\n   <td style=\"text-align:center;\"> 0.67 (0.59, 0.78) </td>\n   <td style=\"text-align:center;\"> &lt;0.001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> 2011-2012 </td>\n   <td style=\"text-align:center;\"> 0.63 (0.52, 0.77) </td>\n   <td style=\"text-align:center;\"> &lt;0.001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> 2013-2014 </td>\n   <td style=\"text-align:center;\"> 0.58 (0.49, 0.70) </td>\n   <td style=\"text-align:center;\"> &lt;0.001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> 2015-2016 </td>\n   <td style=\"text-align:center;\"> 0.35 (0.27, 0.46) </td>\n   <td style=\"text-align:center;\"> &lt;0.001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> 2017-2018 </td>\n   <td style=\"text-align:center;\"> 0.20 (0.13, 0.29) </td>\n   <td style=\"text-align:center;\"> &lt;0.001 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n## Conclusion\n\nThis tutorial demonstrated how to replace a complete-case analysis with a multiple imputation workflow for a survey-weighted survival analysis. By correctly preparing the data, configuring `mice` with survival-specific information, and pooling the final results, we can generate valid estimates that properly account for missing data.\n\n## References\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}