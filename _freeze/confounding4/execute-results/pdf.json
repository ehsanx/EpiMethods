{
  "hash": "53876979ea0b4867d5165e795239cc56",
  "result": {
    "markdown": "## Z-bias {.unnumbered}\n\nZ-bias occurs in the context of causal inference, specifically when using instrumental variables to estimate causal effects. Instrumental variables (IVs) are used to isolate the variation in the treatment variable that is unrelated to the confounding factors, thus providing a pathway to estimate causal effects. \n\n\n\n::: {.cell hash='confounding4_cache/pdf/setup_931abb7d5c88579329c1a21ae376383c'}\n\n```{.r .cell-code}\n# Load required packages\nlibrary(simcausal)\n```\n:::\n\n\n\n### Continuous Y\n\n-   U is unmeasured continuous variable\n-   Z is an instrumental variable\n-   A is binary treatment\n-   Y is continuous outcome\n\n#### Non-null effect\n\n-   True treatment effect = 1.3\n\n##### Data generating process\n\n\n\n::: {.cell hash='confounding4_cache/pdf/dgm10_48918d10861a85570a4a80e3acf0ab15'}\n\n```{.r .cell-code}\nrequire(simcausal)\nD <- DAG.empty()\nD <- D + \n  node(\"age\", distr = \"rnorm\", mean = 2, sd = 1) + \n  node(\"gender\", distr = \"rbern\", prob = plogis(0.25)) +\n  node(\"education\", distr = \"rbern\", prob = plogis(3 + 5* age)) +\n  node(\"diet\", distr = \"rbern\", prob = plogis(13 + 7 * education)) +\n  node(\"income\", distr = \"rbern\", prob = plogis(2 + 1.4 * education + 2 * age)) +\n  node(\"smoking\", distr = \"rbern\", prob = plogis(1 + 1.2 * gender + 2 * age)) +\n  node(\"hypertension\", distr = \"rnorm\", mean = 3 * diet + 1.3 * age + 2 * smoking + 0.5 * gender, sd = .1)\nDset <- set.DAG(D)\n```\n:::\n\n\n\n##### Generate DAG\n\n\n\n::: {.cell hash='confounding4_cache/pdf/dag10_0c583d31084b5cb9a0eb546afd3bb7bb'}\n\n```{.r .cell-code}\nplotDAG(Dset, xjitter = 0.1, yjitter = .9,\n        edge_attrs = list(width = 0.5, arrow.width = 0.4, arrow.size = 0.7),\n        vertex_attrs = list(size = 12, label.cex = 0.8))\n```\n\n::: {.cell-output-display}\n![](confounding4_files/figure-pdf/dag10-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n##### Generate Data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(simcausal)\nObs.Data <- sim(DAG = Dset, n = 1000000, rndseed = 123)\nhead(Obs.Data)\n#>   ID      age gender education diet income smoking hypertension\n#> 1  1 1.439524      1         1    1      1       1     7.337567\n#> 2  2 1.769823      1         1    1      1       1     7.795008\n#> 3  3 3.558708      0         1    1      1       1     9.789988\n#> 4  4 2.070508      0         1    1      1       1     7.784983\n#> 5  5 2.129288      1         1    1      1       1     8.222064\n#> 6  6 3.715065      0         1    1      1       1     9.873938\n```\n:::\n\n\n\n##### Estimate effect\n\n\n\n::: {.cell hash='confounding4_cache/pdf/est10_11ff086f59ba25a0386414336bdf0a0a'}\n\n```{.r .cell-code}\nObs.Data$income <- as.factor(Obs.Data$income)\n# True data generating mechanism \n# (unattainable as U is unmeasured)\nfit0 <- glm(hypertension ~ diet + age + smoking + gender, family=\"gaussian\", data=Obs.Data)\nround(coef(fit0),2)\n#> (Intercept)        diet         age     smoking      gender \n#>  -2024169.9   2024172.9         1.3         2.0         0.5\n\nrequire(Publish)\nfit1 <- glm(hypertension ~ diet + age + smoking*income + gender, family=\"gaussian\", data=Obs.Data)\npublish(fit1)\n#>            Variable Units Coefficient                     CI.95  p-value \n#>         (Intercept)       -2024807.39 [-13733931.24;9684316.46]   0.7347 \n#>                diet        2024810.39 [-9684313.46;13733934.24]   0.7347 \n#>                 age              1.30               [1.30;1.30]   <1e-04 \n#>              gender              0.50               [0.50;0.50]   <1e-04 \n#>  smoking: income(0)              2.00               [1.99;2.00]   <1e-04 \n#>  smoking: income(1)              2.00               [2.00;2.00]   <1e-04\n```\n:::\n\n\n\n### Binary Y\n\n-   U is unmeasured continuous variable\n-   Z is an instrumental variable\n-   A is binary treatment\n-   Y is binary outcome\n\n#### Non-null effect\n\n-   True treatment effect = 1.3\n\n##### Data generating process\n\n\n\n::: {.cell hash='confounding4_cache/pdf/dgm11_4da31af9eb097620b64c3fcebb17cf6b'}\n\n```{.r .cell-code}\nrequire(simcausal)\nD <- DAG.empty()\nD <- D + \n  node(\"U\", distr = \"rnorm\", mean = 2, sd = 1) + \n  node(\"Z\", distr = \"rnorm\", mean = 2, sd = 1) + \n  node(\"A\", distr = \"rbern\", prob = plogis(-1 + 2*U + 2*Z)) +\n  node(\"Y\", distr = \"rbern\", prob = plogis(-1 + 3 * U + 1.3 * A))\nDset <- set.DAG(D)\n```\n:::\n\n\n\n##### Generate DAG\n\n\n\n::: {.cell hash='confounding4_cache/pdf/dag11_b096feceb7ef8c35f0fc38a3972f4ac3'}\n\n```{.r .cell-code}\nplotDAG(Dset, xjitter = 0.1, yjitter = .9,\n        edge_attrs = list(width = 0.5, arrow.width = 0.4, arrow.size = 0.7),\n        vertex_attrs = list(size = 12, label.cex = 0.8))\n```\n\n::: {.cell-output-display}\n![](confounding4_files/figure-pdf/dag11-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n##### Generate Data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(simcausal)\nObs.Data <- sim(DAG = Dset, n = 1000000, rndseed = 123)\nhead(Obs.Data)\n#>   ID        U         Z A Y\n#> 1  1 1.439524 0.9919293 1 1\n#> 2  2 1.769823 3.3549394 1 1\n#> 3  3 3.558708 1.5310251 1 1\n#> 4  4 2.070508 3.4681936 1 1\n#> 5  5 2.129288 2.4425564 1 1\n#> 6  6 3.715065 2.1462031 1 1\n```\n:::\n\n\n\n##### Estimate effect\n\n\n\n::: {.cell hash='confounding4_cache/pdf/est11_906f2c2352a673bc5b66c063d4aa8f2b'}\n\n```{.r .cell-code}\n# True data generating mechanism (unattainable as U is unmeasured)\nfit0 <- glm(Y ~ A + U, family=\"binomial\", data=Obs.Data)\nround(coef(fit0),2)\n#> (Intercept)           A           U \n#>       -0.99        1.30        3.01\n\n# Unadjusted effect (Z not controlled)\nfit1 <- glm(Y ~ A, family=\"binomial\", data=Obs.Data)\nround(coef(fit1),2)\n#> (Intercept)           A \n#>        0.40        3.02\n\n# Bias fit 1\ncoef(fit1)[\"A\"] - 1.3\n#>        A \n#> 1.716482\n\n# Adjusted effect (Z  controlled)\nfit2 <- glm(Y ~ A + Z, family=\"binomial\", data=Obs.Data)\nround(coef(fit2),2)\n#> (Intercept)           A           Z \n#>        0.51        3.29       -0.18\n\n# Bias from fit 2\ncoef(fit2)[\"A\"] - 1.3\n#>        A \n#> 1.991396\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}