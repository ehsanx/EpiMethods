{
  "hash": "33d7eea67100f6190b0bb35bdc749143",
  "result": {
    "markdown": "## Z-bias {.unnumbered}\n\n\n::: {.cell hash='confounding4_cache/html/setup_96dcb0abbd875703ca886ba41d9e1cd9'}\n\n```{.r .cell-code}\n# Load required packages\nlibrary(simcausal)\n```\n:::\n\n\n### Continuous Y\n\n-   U is unmeasured continuous variable\n-   Z is an instrumental variable\n-   A is binary treatment\n-   Y is continuous outcome\n\n#### Non-null effect\n\n-   True treatment effect = 1.3\n\n##### Data generating process\n\n\n::: {.cell hash='confounding4_cache/html/dgm10_37f3bbf5aa9648110be33309e1671ccf'}\n\n```{.r .cell-code}\nrequire(simcausal)\nD <- DAG.empty()\nD <- D + \n  node(\"age\", distr = \"rnorm\", mean = 2, sd = 1) + \n  node(\"gender\", distr = \"rbern\", prob = plogis(0.25)) +\n  node(\"education\", distr = \"rbern\", prob = plogis(3 + 5* age)) +\n  node(\"diet\", distr = \"rbern\", prob = plogis(13 + 7 * education)) +\n  node(\"income\", distr = \"rbern\", prob = plogis(2 + 1.4 * education + 2 * age)) +\n  node(\"smoking\", distr = \"rbern\", prob = plogis(1 + 1.2 * gender + 2 * age)) +\n  node(\"hypertension\", distr = \"rnorm\", mean = 3 * diet + 1.3 * age + 2 * smoking + 0.5 * gender, sd = .1)\nDset <- set.DAG(D)\n```\n:::\n\n\n##### Generate DAG\n\n\n::: {.cell hash='confounding4_cache/html/dag10_82c0af345f4224499501b71117872376'}\n\n```{.r .cell-code}\nplotDAG(Dset, xjitter = 0.1, yjitter = .9,\n        edge_attrs = list(width = 0.5, arrow.width = 0.4, arrow.size = 0.7),\n        vertex_attrs = list(size = 12, label.cex = 0.8))\n```\n\n::: {.cell-output-display}\n![](confounding4_files/figure-html/dag10-1.png){width=672}\n:::\n:::\n\n\n##### Generate Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(simcausal)\nObs.Data <- sim(DAG = Dset, n = 1000000, rndseed = 123)\nhead(Obs.Data)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"ID\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"age\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"gender\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"education\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"diet\"],\"name\":[5],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"income\"],\"name\":[6],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"smoking\"],\"name\":[7],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"hypertension\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"1.439524\",\"3\":\"1\",\"4\":\"1\",\"5\":\"1\",\"6\":\"1\",\"7\":\"1\",\"8\":\"7.337567\",\"_rn_\":\"1\"},{\"1\":\"2\",\"2\":\"1.769823\",\"3\":\"1\",\"4\":\"1\",\"5\":\"1\",\"6\":\"1\",\"7\":\"1\",\"8\":\"7.795008\",\"_rn_\":\"2\"},{\"1\":\"3\",\"2\":\"3.558708\",\"3\":\"0\",\"4\":\"1\",\"5\":\"1\",\"6\":\"1\",\"7\":\"1\",\"8\":\"9.789988\",\"_rn_\":\"3\"},{\"1\":\"4\",\"2\":\"2.070508\",\"3\":\"0\",\"4\":\"1\",\"5\":\"1\",\"6\":\"1\",\"7\":\"1\",\"8\":\"7.784983\",\"_rn_\":\"4\"},{\"1\":\"5\",\"2\":\"2.129288\",\"3\":\"1\",\"4\":\"1\",\"5\":\"1\",\"6\":\"1\",\"7\":\"1\",\"8\":\"8.222064\",\"_rn_\":\"5\"},{\"1\":\"6\",\"2\":\"3.715065\",\"3\":\"0\",\"4\":\"1\",\"5\":\"1\",\"6\":\"1\",\"7\":\"1\",\"8\":\"9.873938\",\"_rn_\":\"6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n##### Estimate effect\n\n\n::: {.cell hash='confounding4_cache/html/est10_b0baebc7a3b1822d225b960d52670a1f'}\n\n```{.r .cell-code}\nObs.Data$income <- as.factor(Obs.Data$income)\n# True data generating mechanism \n# (unattainable as U is unmeasured)\nfit0 <- glm(hypertension ~ diet + age + smoking + gender, family=\"gaussian\", data=Obs.Data)\nround(coef(fit0),2)\n#> (Intercept)        diet         age     smoking      gender \n#>  -2024169.9   2024172.9         1.3         2.0         0.5\n\nrequire(Publish)\nfit1 <- glm(hypertension ~ diet + age + smoking*income + gender, family=\"gaussian\", data=Obs.Data)\npublish(fit1)\n#>            Variable Units Coefficient                     CI.95  p-value \n#>         (Intercept)       -2024807.39 [-13733931.24;9684316.46]   0.7347 \n#>                diet        2024810.39 [-9684313.46;13733934.24]   0.7347 \n#>                 age              1.30               [1.30;1.30]   <1e-04 \n#>              gender              0.50               [0.50;0.50]   <1e-04 \n#>  smoking: income(0)              2.00               [1.99;2.00]   <1e-04 \n#>  smoking: income(1)              2.00               [2.00;2.00]   <1e-04\n```\n:::\n\n\n### Binary Y\n\n-   U is unmeasured continuous variable\n-   Z is an instrumental variable\n-   A is binary treatment\n-   Y is binary outcome\n\n#### Non-null effect\n\n-   True treatment effect = 1.3\n\n##### Data generating process\n\n\n::: {.cell hash='confounding4_cache/html/dgm11_41cd92e942cbb2536e30724302d929b7'}\n\n```{.r .cell-code}\nrequire(simcausal)\nD <- DAG.empty()\nD <- D + \n  node(\"U\", distr = \"rnorm\", mean = 2, sd = 1) + \n  node(\"Z\", distr = \"rnorm\", mean = 2, sd = 1) + \n  node(\"A\", distr = \"rbern\", prob = plogis(-1 + 2*U + 2*Z)) +\n  node(\"Y\", distr = \"rbern\", prob = plogis(-1 + 3 * U + 1.3 * A))\nDset <- set.DAG(D)\n```\n:::\n\n\n##### Generate DAG\n\n\n::: {.cell hash='confounding4_cache/html/dag11_b98693fbe3a8eab9e2918638dbb9a2e6'}\n\n```{.r .cell-code}\nplotDAG(Dset, xjitter = 0.1, yjitter = .9,\n        edge_attrs = list(width = 0.5, arrow.width = 0.4, arrow.size = 0.7),\n        vertex_attrs = list(size = 12, label.cex = 0.8))\n```\n\n::: {.cell-output-display}\n![](confounding4_files/figure-html/dag11-1.png){width=672}\n:::\n:::\n\n\n##### Generate Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(simcausal)\nObs.Data <- sim(DAG = Dset, n = 1000000, rndseed = 123)\nhead(Obs.Data)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"ID\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"U\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Z\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"A\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Y\"],\"name\":[5],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"1.439524\",\"3\":\"0.9919293\",\"4\":\"1\",\"5\":\"1\",\"_rn_\":\"1\"},{\"1\":\"2\",\"2\":\"1.769823\",\"3\":\"3.3549394\",\"4\":\"1\",\"5\":\"1\",\"_rn_\":\"2\"},{\"1\":\"3\",\"2\":\"3.558708\",\"3\":\"1.5310251\",\"4\":\"1\",\"5\":\"1\",\"_rn_\":\"3\"},{\"1\":\"4\",\"2\":\"2.070508\",\"3\":\"3.4681936\",\"4\":\"1\",\"5\":\"1\",\"_rn_\":\"4\"},{\"1\":\"5\",\"2\":\"2.129288\",\"3\":\"2.4425564\",\"4\":\"1\",\"5\":\"1\",\"_rn_\":\"5\"},{\"1\":\"6\",\"2\":\"3.715065\",\"3\":\"2.1462031\",\"4\":\"1\",\"5\":\"1\",\"_rn_\":\"6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n##### Estimate effect\n\n\n::: {.cell hash='confounding4_cache/html/est11_4ae712fc00f3ddd990e5f1fe18094913'}\n\n```{.r .cell-code}\n# True data generating mechanism (unattainable as U is unmeasured)\nfit0 <- glm(Y ~ A + U, family=\"binomial\", data=Obs.Data)\nround(coef(fit0),2)\n#> (Intercept)           A           U \n#>       -0.99        1.30        3.01\n\n# Unadjusted effect (Z not controlled)\nfit1 <- glm(Y ~ A, family=\"binomial\", data=Obs.Data)\nround(coef(fit1),2)\n#> (Intercept)           A \n#>        0.40        3.02\n\n# Bias fit 1\ncoef(fit1)[\"A\"] - 1.3\n#>        A \n#> 1.716482\n\n# Adjusted effect (Z  controlled)\nfit2 <- glm(Y ~ A + Z, family=\"binomial\", data=Obs.Data)\nround(coef(fit2),2)\n#> (Intercept)           A           Z \n#>        0.51        3.29       -0.18\n\n# Bias from fit 2\ncoef(fit2)[\"A\"] - 1.3\n#>        A \n#> 1.991396\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}