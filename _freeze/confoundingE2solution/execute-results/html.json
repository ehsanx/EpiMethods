{
  "hash": "f4cf520bfcc07ed3bbe224edcaf37b35",
  "result": {
    "engine": "knitr",
    "markdown": "## Exercise 2 Solution (R) {.unnumbered}\n\n\n\n## About the data\n\nThe following lab builds upon the `RHC` data used previously.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create nested directories if they don't exist\nif (!dir.exists(\"data/confounding\")) {\n  dir.create(\"data/confounding\", recursive = TRUE)\n}\n\n# Importing and transforming RHC data\nrhc_data <- \n  read.csv(\"https://hbiostat.org/data/repo/rhc.csv\", header = TRUE) |>\n\n  # Generating `age_category`\n  transform(age_category = cut(age,\n                          breaks = c(0, 50, 60, 70, 80, Inf),\n                          include.lowest = TRUE, right = FALSE)) |>\n  \n  # Factoring `race`\n  transform(race = factor(race,\n                          levels = c('white', 'black', 'other'),\n                          labels = c('White', 'Black', 'Other'))) |>\n  \n  # Factoring `sex`\n  transform(sex = factor(sex, levels = c('Male', 'Female'))) |>\n  \n  # Factoring `primary_diagnosis`\n  transform(primary_diagnosis = factor(cat1)) |>\n  within(levels(primary_diagnosis) <- list(ARF = 'ARF',\n                                           CHF = 'CHF',\n                                           MOSF = c('MOSF w/Malignancy', 'MOSF w/Sepsis'),\n                                           Other = c('Cirrhosis', 'Colon Cancer', 'Coma', \n                                                     'COPD', 'Lung Cancer'))) |>\n  \n  # Factoring `cancer_status`\n  transform(cancer_status = factor(ca,\n                                   levels = c('No', 'Yes', 'Metastatic'),\n                                   labels = c('None', 'Localized (Yes)', 'Metastatic'))) |>\n  \n  # Generating `num_comorbidities`\n  {\\(.x) transform(.x, num_comorbidities = rowSums(subset(.x, select = \n                                                            cardiohx:amihx)))}() |>\n  \n  # Factoring `rhc_status`\n  transform(rhc_status = factor(swang1, levels = c('No RHC', 'RHC'))) |>\n  \n  # Converting `death` to logical\n  transform(death_status = ifelse(death == 'Yes', TRUE, FALSE)) |>\n  \n  # Renaming other variables to be more meaningful\n  rename(dnr_status = dnr1,\n         aps_score = aps1,\n         two_month_survival_probability = surv2md1,\n         activities_of_daily_living = adld3p,\n         duke_activity_status_index = das2d3pc,\n         temperature = temp1,\n         heart_rate = hrt1,\n         mean_blood_pressure = meanbp1,\n         respiratory_rate = resp1,\n         white_blood_cell_count = wblc1,\n         pafi_ratio = pafi1,\n         partial_pressure_of_co2 = paco21,\n         blood_ph = ph1,\n         creatinine = crea1,\n         albumin = alb1,\n         glasgow_coma_scale = scoma1) |>\n  \n  # Subsetting relevant columns\n  subset(select = c(age_category, sex, race, primary_diagnosis, \n                    cancer_status, dnr_status, aps_score, \n                    two_month_survival_probability, activities_of_daily_living, \n                    duke_activity_status_index, temperature, heart_rate, \n                    mean_blood_pressure, respiratory_rate, white_blood_cell_count, \n                    pafi_ratio, partial_pressure_of_co2, blood_ph, creatinine, \n                    albumin, glasgow_coma_scale, \n                    rhc_status, death_status, num_comorbidities)) |>\n  \n  # Subsetting complete case observations\n  na.omit()\n\n# Save the transformed dataset\nsaveRDS(rhc_data, \"data/confounding/rhc_data.rds\")\n```\n:::\n\n\nWe begin by importing the `RHC` data, which has already been prepared for this assignment. What is different in this exercise is that we are changing the reference levels of RHC and DNR variables to `No RHC` and `No`, respectively.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Loading the RHC data\nrhc_data <- readRDS(\"data/confounding/rhc_data.rds\")\n# Convert 'rhc_status' to binary (1 for 'No RHC', 0 for 'RHC')\nrhc_data$no_rhc_status <- ifelse(rhc_data$rhc_status == \"No RHC\", 1, 0)\n# Convert 'dnr_status' to binary (1 for 'No', 0 for 'Yes')\nrhc_data$no_dnr_status <- ifelse(rhc_data$dnr_status == \"No\", 1, 0)\n```\n:::\n\n\nThe variables included within this data extract are:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(rhc_data)\n#> 'data.frame':\t1439 obs. of  26 variables:\n#>  $ age_category                  : Factor w/ 5 levels \"[0,50)\",\"[50,60)\",..: 4 5 1 1 1 3 1 4 3 2 ...\n#>  $ sex                           : Factor w/ 2 levels \"Male\",\"Female\": 1 2 2 1 1 1 2 1 2 1 ...\n#>  $ race                          : Factor w/ 3 levels \"White\",\"Black\",..: 1 1 1 2 3 1 2 1 1 1 ...\n#>  $ primary_diagnosis             : Factor w/ 4 levels \"ARF\",\"CHF\",\"MOSF\",..: 4 4 3 3 2 2 1 2 3 1 ...\n#>  $ cancer_status                 : Factor w/ 3 levels \"None\",\"Localized (Yes)\",..: 2 1 1 1 1 1 1 1 1 2 ...\n#>  $ dnr_status                    : chr  \"No\" \"No\" \"No\" \"No\" ...\n#>  $ aps_score                     : int  46 38 55 60 30 26 46 35 48 103 ...\n#>  $ two_month_survival_probability: num  0.641 0.665 0.672 0.777 0.889 ...\n#>  $ activities_of_daily_living    : int  0 0 0 2 0 2 0 5 0 3 ...\n#>  $ duke_activity_status_index    : num  23.5 17.5 13.5 21 22 13 29 11 17 12 ...\n#>  $ temperature                   : num  38.7 39.2 35.7 39 36.9 ...\n#>  $ heart_rate                    : int  124 134 110 130 122 115 104 54 65 170 ...\n#>  $ mean_blood_pressure           : num  41 115 77 53 47 63 144 77 41 35 ...\n#>  $ respiratory_rate              : num  10 36 40 12 20 22 8 42 20 42 ...\n#>  $ white_blood_cell_count        : num  22.1 18 7.3 5.4 10.1 ...\n#>  $ pafi_ratio                    : num  68 184 171 390 333 ...\n#>  $ partial_pressure_of_co2       : num  40 68 25 31 40 40 39 42 40 35 ...\n#>  $ blood_ph                      : num  7.36 7.3 7.47 7.32 7.4 ...\n#>  $ creatinine                    : num  1.2 1.4 1.9 15 1.3 ...\n#>  $ albumin                       : num  3.5 3.1 3.5 3.4 4.5 ...\n#>  $ glasgow_coma_scale            : int  0 0 37 9 0 0 0 0 0 9 ...\n#>  $ rhc_status                    : Factor w/ 2 levels \"No RHC\",\"RHC\": 1 1 1 1 2 1 2 1 2 1 ...\n#>  $ death_status                  : logi  FALSE FALSE TRUE FALSE TRUE TRUE ...\n#>  $ num_comorbidities             : num  2 2 1 1 1 2 0 2 2 2 ...\n#>  $ no_rhc_status                 : num  1 1 1 1 0 1 0 1 0 1 ...\n#>  $ no_dnr_status                 : num  1 1 1 1 1 1 1 1 1 1 ...\n#>  - attr(*, \"na.action\")= 'omit' Named int [1:4296] 2 3 4 5 7 8 9 10 11 12 ...\n#>   ..- attr(*, \"names\")= chr [1:4296] \"2\" \"3\" \"4\" \"5\" ...\n```\n:::\n\n\nFor information regarding the variables included in the data, review the variable descriptions [here](https://hbiostat.org/data/repo/rhc) and [here](https://pubmed.ncbi.nlm.nih.gov/8782638/).\n\nThe Duke Activity Status Index (DASI) is a self-administered questionnaire that measures a patient's functional capacity or physical activity level. It is commonly used in cardiology to assess a patient's ability to perform daily activities and is predictive of cardiovascular outcomes. The DASI score ranges from 0 to 58.2, with higher scores indicating better physical functioning and higher activity levels. The DASI score in this dataset ranges from 11 to 33. The median value of 19 and the mean value of 20.36 suggest that the typical person in this dataset has a moderate activity level. In this exercise, we will only work with the subset of the data where the DASI score is greater than 20.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Subset the data\nhigh_dasi_data <- rhc_data[rhc_data$duke_activity_status_index > 20, ]\n```\n:::\n\n\n## About the assignment\n\n**Effect Modification** refers to how the effect of an exposure on an outcome differs across levels of a third variable (the effect modifier). It focuses on how the association between the exposure and the outcome changes based on this modifying factor. This lab adapts exercises from the following tutorial on [\"Interaction in Epidemiology\"](https://ehsanx.github.io/interaction/interaction-1.html).\n\nFor **Problem Set #1**, we will explore in the `high_dasi_data` dataset whether the association between right-heart-catheterization (`no_rhc_status`; treatment or exposure) on mortality (`death_status`; outcome) is modified by whether a participant signed a do-not-resuscitate order (`no_dnr_status`; potential effect modifier).\n\nNote that we will assume that confounders for RHC and Mortality are the following:\n\n-   Age Category (`age_category`)\n-   APS Score (`aps_score`)\n-   Cancer Status (`cancer_status`)\n-   Number of Comorbidities (`num_comorbidities`)\n-   Glasgow Coma Scale (`glasgow_coma_scale`)\n-   Heart Rate (`heart_rate`)\n-   Mean Blood Pressure (`mean_blood_pressure`)\n-   Primary Diagnosis (`primary_diagnosis`)\n-   Sex (`sex`)\n-   Respiratory Rate (`respiratory_rate`)\n-   White Blood Cell Count (`white_blood_cell_count`)\n\n**Interaction**, particularly in the statistical context, often refers to a departure from multiplicativity when using models like logistic regression. It examines how the combined effect of two exposures differs from what would be expected if their effects were simply multiplied. Interaction is typically tested on a multiplicative scale (e.g., odds ratios) and is interpreted through synergy (super-multiplicative) or antagonism (sub-multiplicative).\n\nFor **Problem Set #2**, we will explore in the `high_dasi_data` dataset whether binary DNR status (\"Do Not Resuscitate\": `no_dnr_status`) interacts with right-heart-catheterization (`no_rhc_status`) in its association with mortality (`death_status`).\n\nNote that we will assume that confounders for DNR Status and Mortality are the following:\n\n-   Age Category (`age_category`)\n-   APS Score (`aps_score`)\n-   Cancer Status (`cancer_status`)\n-   Number of Comorbidities (`num_comorbidities`)\n-   Glasgow Coma Scale (`glasgow_coma_scale`)\n-   Heart Rate (`heart_rate`)\n-   Mean Blood Pressure (`mean_blood_pressure`)\n-   Primary Diagnosis (`primary_diagnosis`)\n-   White Blood Cell Count (`white_blood_cell_count`)\n-   Activities of Daily Living (`activities_of_daily_living`)\n\n## Problem #1: Exploring Effect Modification\n\n### 1(a) Fit the effect modification model\n\nGenerate a multivariable logistic regression model (`effect_modification_model`), adhering to the following specifications:\n\n-   Set the outcome as death.\n-   Set the exposure as no RHC.\n-   Include a multiplicative interaction term of the exposure by no DNR status.\n-   Adjust for the stated confounders in the relationship (no RHC vs death) in the model.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Logistic regression with interaction between no_rhc_status and no_dnr_status in the subset data\neffect_modification_model <- glm(death_status ~ no_rhc_status * no_dnr_status + \n                                  age_category + aps_score + cancer_status +\n                                  num_comorbidities + glasgow_coma_scale + \n                                  heart_rate + mean_blood_pressure + \n                                  primary_diagnosis + sex + \n                                  respiratory_rate + white_blood_cell_count, \n                                data = high_dasi_data, \n                                family = binomial)\nsummary(effect_modification_model)\n#> \n#> Call:\n#> glm(formula = death_status ~ no_rhc_status * no_dnr_status + \n#>     age_category + aps_score + cancer_status + num_comorbidities + \n#>     glasgow_coma_scale + heart_rate + mean_blood_pressure + primary_diagnosis + \n#>     sex + respiratory_rate + white_blood_cell_count, family = binomial, \n#>     data = high_dasi_data)\n#> \n#> Coefficients:\n#>                                Estimate Std. Error z value Pr(>|z|)    \n#> (Intercept)                  -2.3712376  1.4019207  -1.691 0.090756 .  \n#> no_rhc_status                 3.4969691  1.6575046   2.110 0.034877 *  \n#> no_dnr_status                 0.6228925  1.3008762   0.479 0.632063    \n#> age_category[50,60)           0.5615264  0.3007867   1.867 0.061921 .  \n#> age_category[60,70)           1.0150295  0.2615213   3.881 0.000104 ***\n#> age_category[70,80)           0.6505600  0.2780222   2.340 0.019286 *  \n#> age_category[80,Inf]          0.8609830  0.3498095   2.461 0.013844 *  \n#> aps_score                    -0.0032209  0.0070546  -0.457 0.647977    \n#> cancer_statusLocalized (Yes)  0.6516821  0.2753557   2.367 0.017948 *  \n#> cancer_statusMetastatic       1.8068081  0.4031984   4.481 7.42e-06 ***\n#> num_comorbidities             0.2526729  0.0888800   2.843 0.004471 ** \n#> glasgow_coma_scale           -0.0006699  0.0053385  -0.125 0.900136    \n#> heart_rate                   -0.0030546  0.0026816  -1.139 0.254659    \n#> mean_blood_pressure          -0.0049564  0.0027455  -1.805 0.071034 .  \n#> primary_diagnosisCHF          0.7685691  0.3003703   2.559 0.010505 *  \n#> primary_diagnosisMOSF         0.4425051  0.2653825   1.667 0.095430 .  \n#> primary_diagnosisOther        0.6229054  0.2796315   2.228 0.025908 *  \n#> sexFemale                    -0.1207658  0.1982125  -0.609 0.542343    \n#> respiratory_rate              0.0119828  0.0085488   1.402 0.161005    \n#> white_blood_cell_count        0.0153771  0.0081258   1.892 0.058442 .  \n#> no_rhc_status:no_dnr_status  -3.2992008  1.6709649  -1.974 0.048333 *  \n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> (Dispersion parameter for binomial family taken to be 1)\n#> \n#>     Null deviance: 839.22  on 622  degrees of freedom\n#> Residual deviance: 712.15  on 602  degrees of freedom\n#> AIC: 754.15\n#> \n#> Number of Fisher Scoring iterations: 5\n```\n:::\n\n\n### 1(b) Calculate Relative Excess Risk due to Interaction (RERI)\n\nEffect modification looks at how the effect of one exposure on an outcome changes based on the level of another exposure or factor (the effect modifier). RERI is useful in this context because it quantifies the additive interaction (whether the combined effect is larger or smaller than expected based on individual effects).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Extract the coefficients\nbeta_rhc <- as.numeric(effect_modification_model$coefficients['no_rhc_status'])   # Coefficient for no_rhc_status\nbeta_dnr <- as.numeric(effect_modification_model$coefficients['no_dnr_status'])   # Coefficient for no_dnr_status\nbeta_interaction <- as.numeric(effect_modification_model$coefficients['no_rhc_status:no_dnr_status'])  # Interaction term\n\n# Calculate the Odds Ratios\nOR_rhc_only <- exp(beta_rhc)         # OR when no_rhc_status = 1, no_dnr_status = 0\nOR_dnr_only <- exp(beta_dnr)         # OR when no_rhc_status = 0, no_dnr_status = 1\nOR_both <- exp(beta_rhc + beta_dnr + beta_interaction)  \n# OR when both no_rhc_status and no_dnr_status are 1\n\n# Calculate RERI (Relative Excess Risk due to Interaction)\nRERI <- OR_both - OR_rhc_only - OR_dnr_only + 1\n\n# Output the results\ncat(\"OR for no RHC only (no_rhc_status = 1, no_dnr_status = 0):\", OR_rhc_only, \"\\n\")\n#> OR for no RHC only (no_rhc_status = 1, no_dnr_status = 0): 33.01524\ncat(\"OR for no DNR only (no_rhc_status = 0, no_dnr_status = 1):\", OR_dnr_only, \"\\n\")\n#> OR for no DNR only (no_rhc_status = 0, no_dnr_status = 1): 1.864313\ncat(\"OR for both no RHC and no DNR (no_rhc_status = 1, no_dnr_status = 1):\", OR_both, \"\\n\")\n#> OR for both no RHC and no DNR (no_rhc_status = 1, no_dnr_status = 1): 2.272001\ncat(\"Relative Excess Risk due to Interaction (RERI):\", RERI, \"\\n\")\n#> Relative Excess Risk due to Interaction (RERI): -31.60755\n```\n:::\n\n\n**Interpretation of RERI in Effect Modification:**\n\n-   **RERI \\> 0**: Indicates a positive additive interaction, meaning the combined effect of two exposures (e.g., no RHC and no DNR) is greater than the sum of their individual effects. In other words, there is an excess risk attributable to the interaction between the two exposures.\n-   **RERI = 0**: Indicates no additive interaction. The combined effect of the two exposures is equal to the sum of their individual effects. There is no additional risk due to their interaction.\n-   **RERI \\< 0**: Indicates a negative additive interaction (also known as antagonism), meaning the combined effect of the two exposures is less than the sum of their individual effects. This suggests that the exposures may be protective when combined, compared to when considered separately.\n\n### 1(c) Exploring Effect Modification using `interactionR` \\[15%\\] and `Publish` (optional)\n\nBased on the output of the above regression, implement the following:\n\n-   Use `interactionR::interactionR()` to obtain a complete reporting of effect modification estimates.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load the necessary package\nlibrary(interactionR)\n\n# Obtain the interaction effect modification estimates\ninteraction_result <- interactionR(effect_modification_model, \n                                   exposure_names = c(\"no_rhc_status\", \"no_dnr_status\"), \n                                   ci.type = \"delta\",  # Confidence interval method\n                                   em = TRUE,          # Effect modification estimates\n                                   recode = FALSE)     # Do not recode the exposure variables\n# Display the complete effect modification report\ninteraction_result$dframe\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Measures\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Estimates\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"CI.ll\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"CI.ul\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"p\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"OR00\",\"2\":\"1.00000000\",\"3\":\"NA\",\"4\":\"NA\",\"5\":\"NA\"},{\"1\":\"OR01\",\"2\":\"1.86431287\",\"3\":\"1.456166e-01\",\"4\":\"23.8685802\",\"5\":\"0.63206\"},{\"1\":\"OR10\",\"2\":\"33.01523593\",\"3\":\"1.281870e+00\",\"4\":\"850.3248138\",\"5\":\"0.03488\"},{\"1\":\"OR11\",\"2\":\"2.27200086\",\"3\":\"1.805680e-01\",\"4\":\"28.5875023\",\"5\":\"0.53619\"},{\"1\":\"OR(no_dnr_status on outcome [no_rhc_status==0]\",\"2\":\"1.86431287\",\"3\":\"1.456166e-01\",\"4\":\"23.8685802\",\"5\":\"0.63206\"},{\"1\":\"OR(no_dnr_status on outcome [no_rhc_status==1]\",\"2\":\"0.06881674\",\"3\":\"8.668353e-03\",\"4\":\"0.5463257\",\"5\":\"0.01131\"},{\"1\":\"Multiplicative scale\",\"2\":\"0.03691266\",\"3\":\"1.395878e-03\",\"4\":\"0.9761200\",\"5\":\"0.04833\"},{\"1\":\"RERI\",\"2\":\"-31.60754793\",\"3\":\"-1.380687e+02\",\"4\":\"74.8536260\",\"5\":\"0.71968\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n-   Use `Publish::publish()` to obtain stratum-specific estimates of the main effect. **NOTE**: Only return those quantities requested (i.e., not the full regression table).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load the necessary package\nlibrary(Publish)\n\n# Recode variables for better interpretation\nhigh_dasi_data$no_dnr_factor <- factor(high_dasi_data$no_dnr_status, levels = c(1, 0), labels = c(\"No\", \"Yes\"))\nhigh_dasi_data$no_dnr_factor <- relevel(high_dasi_data$no_dnr_factor, ref = \"Yes\")\nhigh_dasi_data$no_rhc_factor <- factor(high_dasi_data$no_rhc_status, levels = c(1, 0), labels = c(\"No RHC\", \"RHC\"))\nhigh_dasi_data$no_rhc_factor <- relevel(high_dasi_data$no_rhc_factor, ref = \"RHC\")\n\n# Fit the model with recoded factors\neffect_modification_model2 <- glm(death_status ~ no_rhc_factor * no_dnr_factor + \n                                  age_category + aps_score + cancer_status +\n                                  num_comorbidities + glasgow_coma_scale + \n                                  heart_rate + mean_blood_pressure + \n                                  primary_diagnosis + sex + \n                                  respiratory_rate + white_blood_cell_count, \n                                data = high_dasi_data, \n                                family = binomial)\n\n# Obtain stratum-specific estimates from the model\nstratum_estimates <- publish(effect_modification_model2)\n#>                                          Variable           Units OddsRatio         CI.95     p-value \n#>                                      age_category          [0,50)       Ref                           \n#>                                                           [50,60)      1.75   [0.97;3.16]   0.0619213 \n#>                                                           [60,70)      2.76   [1.65;4.61]   0.0001039 \n#>                                                           [70,80)      1.92   [1.11;3.31]   0.0192860 \n#>                                                          [80,Inf]      2.37   [1.19;4.70]   0.0138438 \n#>                                         aps_score                      1.00   [0.98;1.01]   0.6479771 \n#>                                     cancer_status            None       Ref                           \n#>                                                   Localized (Yes)      1.92   [1.12;3.29]   0.0179479 \n#>                                                        Metastatic      6.09  [2.76;13.42]     < 1e-04 \n#>                                 num_comorbidities                      1.29   [1.08;1.53]   0.0044712 \n#>                                glasgow_coma_scale                      1.00   [0.99;1.01]   0.9001364 \n#>                                        heart_rate                      1.00   [0.99;1.00]   0.2546595 \n#>                               mean_blood_pressure                      1.00   [0.99;1.00]   0.0710337 \n#>                                 primary_diagnosis             ARF       Ref                           \n#>                                                               CHF      2.16   [1.20;3.89]   0.0105053 \n#>                                                              MOSF      1.56   [0.93;2.62]   0.0954302 \n#>                                                             Other      1.86   [1.08;3.23]   0.0259076 \n#>                                               sex            Male       Ref                           \n#>                                                            Female      0.89   [0.60;1.31]   0.5423427 \n#>                                  respiratory_rate                      1.01   [1.00;1.03]   0.1610054 \n#>                            white_blood_cell_count                      1.02   [1.00;1.03]   0.0584416 \n#>      no_rhc_factor(RHC): no_dnr_factor(No vs Yes)                      1.86  [0.15;23.87]   0.6320628 \n#>   no_rhc_factor(No RHC): no_dnr_factor(No vs Yes)                      0.07   [0.01;0.55]   0.0113453 \n#>  no_dnr_factor(Yes): no_rhc_factor(No RHC vs RHC)                     33.02 [1.28;850.32]   0.0348774 \n#>   no_dnr_factor(No): no_rhc_factor(No RHC vs RHC)                      1.22   [0.79;1.87]   0.3682362\n\n# Print only the relevant stratum-specific estimates (for no_rhc_status and no_dnr_status)\ntail(stratum_estimates$rawTable,2)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"Variable\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Units\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"OddsRatio\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Lower\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Upper\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Pvalue\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"no_dnr_factor(Yes): no_rhc_factor(No RHC vs RHC)\",\"2\":\"\",\"3\":\"33.01524\",\"4\":\"1.2818699\",\"5\":\"850.324814\",\"6\":\"0.03487735\",\"_rn_\":\"24\"},{\"1\":\"no_dnr_factor(No): no_rhc_factor(No RHC vs RHC)\",\"2\":\"\",\"3\":\"1.21868\",\"4\":\"0.7921349\",\"5\":\"1.874909\",\"6\":\"0.36823622\",\"_rn_\":\"25\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n**Note**: Effect modification occurs when the effect of an exposure on an outcome differs across levels of a third variable (the effect modifier). It does not require the interaction term (`no_rhc_status:no_dnr_status`) to be statistically significant; rather, we are looking at whether the association between the primary exposure (RHC) and the outcome (death) changes depending on the level of the effect modifier (DNR).\n\n## Problem #2: Exploring Interaction\n\n### 2(a) Interaction Model\n\nGenerate a multivariable logistic regression model, adhering to the following specifications:\n\n-   Set the outcome as death.\n-   Set two exposures as RHC and DNR status.\n-   Include a multiplicative interaction term of the exposures.\n-   Adjust for the stated confounders in the relationship (no RHC vs death, as well as no DNR vs death) in the model. That means the union of the two confounder sets.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Logistic regression with interaction between no_rhc_status and no_dnr_status in the subset data\ninteraction_model <- glm(death_status ~ no_rhc_status * no_dnr_status + \n                         age_category + aps_score + cancer_status +\n                         num_comorbidities + glasgow_coma_scale + \n                         heart_rate + mean_blood_pressure + \n                         primary_diagnosis + sex + \n                         respiratory_rate + white_blood_cell_count + \n                         activities_of_daily_living, \n                       data = high_dasi_data, \n                       family = binomial)\nsummary(interaction_model)\n#> \n#> Call:\n#> glm(formula = death_status ~ no_rhc_status * no_dnr_status + \n#>     age_category + aps_score + cancer_status + num_comorbidities + \n#>     glasgow_coma_scale + heart_rate + mean_blood_pressure + primary_diagnosis + \n#>     sex + respiratory_rate + white_blood_cell_count + activities_of_daily_living, \n#>     family = binomial, data = high_dasi_data)\n#> \n#> Coefficients:\n#>                                Estimate Std. Error z value Pr(>|z|)    \n#> (Intercept)                  -2.2800128  1.4080440  -1.619 0.105388    \n#> no_rhc_status                 3.3958648  1.6658528   2.039 0.041499 *  \n#> no_dnr_status                 0.5238144  1.3076850   0.401 0.688740    \n#> age_category[50,60)           0.5760202  0.3013259   1.912 0.055925 .  \n#> age_category[60,70)           1.0173738  0.2632735   3.864 0.000111 ***\n#> age_category[70,80)           0.6498421  0.2793077   2.327 0.019986 *  \n#> age_category[80,Inf]          0.8040125  0.3523068   2.282 0.022481 *  \n#> aps_score                    -0.0037222  0.0070865  -0.525 0.599411    \n#> cancer_statusLocalized (Yes)  0.6443974  0.2770866   2.326 0.020039 *  \n#> cancer_statusMetastatic       1.8888507  0.4064679   4.647 3.37e-06 ***\n#> num_comorbidities             0.2408454  0.0895108   2.691 0.007131 ** \n#> glasgow_coma_scale           -0.0008445  0.0053673  -0.157 0.874971    \n#> heart_rate                   -0.0032735  0.0026971  -1.214 0.224856    \n#> mean_blood_pressure          -0.0050871  0.0027627  -1.841 0.065575 .  \n#> primary_diagnosisCHF          0.7932514  0.3007341   2.638 0.008347 ** \n#> primary_diagnosisMOSF         0.3831509  0.2685658   1.427 0.153679    \n#> primary_diagnosisOther        0.5884193  0.2812664   2.092 0.036435 *  \n#> sexFemale                    -0.1391314  0.1993885  -0.698 0.485308    \n#> respiratory_rate              0.0123729  0.0086003   1.439 0.150246    \n#> white_blood_cell_count        0.0159359  0.0081423   1.957 0.050326 .  \n#> activities_of_daily_living    0.2249761  0.1006831   2.234 0.025450 *  \n#> no_rhc_status:no_dnr_status  -3.2074335  1.6793158  -1.910 0.056138 .  \n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> (Dispersion parameter for binomial family taken to be 1)\n#> \n#>     Null deviance: 839.22  on 622  degrees of freedom\n#> Residual deviance: 707.11  on 601  degrees of freedom\n#> AIC: 751.11\n#> \n#> Number of Fisher Scoring iterations: 5\n```\n:::\n\n\n**Note**: Check if the interaction term (`no_rhc_status:no_dnr_status`) has a low p-value. If this p-value is below the acceptable cutpoint (commonly used significance threshold of 0.05 or something reasonable/justifiable), we could conclude that the interaction between RHC and DNR status on the outcome (death) is statistically significant. This could suggest that the association between RHC status and death depends on DNR status.\n\n### 2(b) Exploring Interaction using `interactionR`\n\nBased on the output of the above regression, implement the following:\n\n-   Use `interactionR::interactionR()` to obtain a complete reporting of interaction estimates.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load the necessary package\nlibrary(interactionR)\n\n# Obtain the interaction estimates\ninteraction_result <- interactionR(interaction_model, \n                                   exposure_names = c(\"no_rhc_status\", \"no_dnr_status\"), \n                                   ci.type = \"delta\",  # Confidence interval method\n                                   em = FALSE,         # Interaction estimates\n                                   recode = FALSE)     # Do not recode the exposure variables\n# Display the complete interaction report\ninteraction_result$dframe\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Measures\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Estimates\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"CI.ll\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"CI.ul\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"p\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"OR00\",\"2\":\"1.00000000\",\"3\":\"NA\",\"4\":\"NA\",\"5\":\"NA\"},{\"1\":\"OR01\",\"2\":\"1.68845581\",\"3\":\"1.301326e-01\",\"4\":\"21.9075196\",\"5\":\"0.68874\"},{\"1\":\"OR10\",\"2\":\"29.84044953\",\"3\":\"1.139801e+00\",\"4\":\"781.2353281\",\"5\":\"0.04150\"},{\"1\":\"OR11\",\"2\":\"2.03856425\",\"3\":\"1.598416e-01\",\"4\":\"25.9991484\",\"5\":\"0.59557\"},{\"1\":\"OR(no_dnr_status on outcome [no_rhc_status==0]\",\"2\":\"1.68845581\",\"3\":\"1.301326e-01\",\"4\":\"21.9075196\",\"5\":\"0.68874\"},{\"1\":\"OR(no_dnr_status on outcome [no_rhc_status==1]\",\"2\":\"0.06831547\",\"3\":\"8.527455e-03\",\"4\":\"0.5472915\",\"5\":\"0.01144\"},{\"1\":\"OR(no_rhc_status on outcome [no_dnr_status==0]\",\"2\":\"29.84044953\",\"3\":\"1.139801e+00\",\"4\":\"781.2353281\",\"5\":\"0.04150\"},{\"1\":\"OR(no_rhc_status on outcome [no_dnr_status==1]\",\"2\":\"1.20735423\",\"3\":\"7.830534e-01\",\"4\":\"1.8615643\",\"5\":\"0.40083\"},{\"1\":\"Multiplicative scale\",\"2\":\"0.04046032\",\"3\":\"1.505196e-03\",\"4\":\"1.0875909\",\"5\":\"0.05614\"},{\"1\":\"RERI\",\"2\":\"-28.49034108\",\"3\":\"-1.252338e+02\",\"4\":\"68.2531425\",\"5\":\"0.71810\"},{\"1\":\"AP\",\"2\":\"-13.97568951\",\"3\":\"-4.446125e+01\",\"4\":\"16.5098749\",\"5\":\"0.18445\"},{\"1\":\"SI\",\"2\":\"0.03517111\",\"3\":\"1.546207e-03\",\"4\":\"0.8000268\",\"5\":\"0.98213\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n### 2(c) Calculate RERI, AP, and SI\n\nBased on the output of the above regression, calculate RERI, the attributable proportion due to interaction (AP), and the synergy index (SI).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Extract the coefficients\nbeta_rhc <- coef(interaction_model)[\"no_rhc_status\"]\nbeta_dnr <- coef(interaction_model)[\"no_dnr_status\"]\nbeta_interaction <- coef(interaction_model)[\"no_rhc_status:no_dnr_status\"]\n\n# Calculate the odds ratios\nOR_rhc_only <- exp(beta_rhc)  # OR when no_rhc_status = 1, no_dnr_status = 0\nOR_dnr_only <- exp(beta_dnr)  # OR when no_rhc_status = 0, no_dnr_status = 1\nOR_both <- exp(beta_rhc + beta_dnr + beta_interaction)  \n# OR when both no_rhc_status and no_dnr_status are 1\n\n# Calculate RERI\nRERI <- OR_both - OR_rhc_only - OR_dnr_only + 1\n\n# Calculate AP\nAP <- RERI / OR_both\n\n# Calculate SI\nSI <- (OR_both - 1) / ((OR_rhc_only - 1) + (OR_dnr_only - 1))\n\n# Output the results\ncat(\"Relative Excess Risk due to Interaction (RERI):\", RERI, \"\\n\")\n#> Relative Excess Risk due to Interaction (RERI): -28.49034\ncat(\"Attributable Proportion (AP):\", AP, \"\\n\")\n#> Attributable Proportion (AP): -13.97569\ncat(\"Synergy Index (SI):\", SI, \"\\n\")\n#> Synergy Index (SI): 0.03517111\n```\n:::\n\n\n**Interpretation of Results:**\n\n-   **RERI**: A positive RERI indicates an excess risk due to the interaction between RHC and DNR. A negative RERI suggests antagonism.\n-   **AP**: Represents the proportion of the risk due to the interaction.\n    -   AP\\>0: A positive proportion of the risk is due to the interaction.\n    -   AP=0: No additional risk is due to the interaction.\n    -   AP\\<0: A negative interaction, indicating antagonism between the two exposures.\n-   **SI**: A synergy index greater than 1 indicates a synergistic effect, while an SI less than 1 indicates antagonism.\n    -   SI\\>1: Synergistic effect. The combined effect of the two exposures is greater than expected based on multiplicative effects.\n    -   SI=1: No multiplicative interaction.\n    -   SI\\<1: Antagonism. The combined effect of the two exposures is less than expected based on multiplicative effects.\n\n**Note**: If the p-values for the interaction term, RERI, AP, and SI are all greater than a reasonable cut-point (e.g., 0.05 is one example), that indicates no statistically significant interaction. In that case, this would mean we do not have strong evidence to claim that the combined effects of RHC and DNR on mortality are significantly different from their individual effects.\n",
    "supporting": [
      "confoundingE2solution_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}