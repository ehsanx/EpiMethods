{
  "hash": "3d99d9305a34146c6ea321a6089d623b",
  "result": {
    "markdown": "## Importing CCHS to R {.unnumbered}\n\n\n::: {.cell hash='accessing2_cache/html/setup_9acd6eb48c53aab73d58cb69f204b45a'}\n\n```{.r .cell-code}\n# Load required packages\nlibrary(knitr)\n```\n:::\n\n\nThis section provides comprehensive instructions on how to import the Canadian Community Health Survey (CCHS) dataset from the UBC library site to the RStudio environment. The process starts with downloading the CCHS data from the UBC library site and includes step-by-step visual guides for each stage. Three primary options are provided to process and format the data:\n\n1. Using the commercial software SAS.\n2. Utilizing the free software PSPP, an alternative to SPSS.\n3. Directly processing the data in R.\n\nFor each option, users are guided on how to download, install, access, read, save, and check the dataset. The objective is to help users acquire, visualize, and manipulate the CCHS dataset seamlessly using various software applications.\n\n### Downloading CCHS data from UBC\n\n-   **Step 1**: Go to [dvn.library.ubc.ca](http://dvn.library.ubc.ca), and press 'log-in'\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacusX1.png){width=65%}\n:::\n:::\n\n\n-   **Step 2**: Select 'UBC' from the dropdown menu\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacusX2.png){width=65%}\n:::\n:::\n\n\n-   **Step 3**: Enter your CWL or UBC library authentication information\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus3.png){width=65%}\n:::\n:::\n\n\n-   **Step 4**: Once you log-in, search the term 'cchs' in the search-box\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacusX4.png){width=65%}\n:::\n:::\n\n\n-   **Step 5**: For illustrative purposes, let us work with the Cycle 3.1 of the CCHS dataset from the list of results. In that case, type 'cchs 3.1'\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacusX5.png){width=65%}\n:::\n:::\n\n\n-   **Step 6**: CCHS Cycle 3.1 information\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus6X.png){width=65%}\n:::\n:::\n\n\n-   **Step 7**: Choose the 'Data: CD' from the menu\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacusX7.png){width=65%}\n:::\n:::\n\n\n-   **Step 8**: Download the entire data (about 159 MB) as a zip file\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacusX8.png){width=65%}\n:::\n:::\n\n\n-   **Step 9**: Accept the 'terms of use'\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacusX9.png){width=65%}\n:::\n:::\n\n\n-   **Step 10**: Select a directory to download the zip file. The path of the download directory is important (we need to use this `path` exactly later). For example, below we are in `\"C:\\CCHS\\\"` folder, but we will create a \"Data\" folder there, so that the download path is `\"C:\\CCHS\\Data\\\"`.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacusX10.png){width=65%}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacusX10b.png){width=65%}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacusX10c.png){width=65%}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacusX10d.png){width=65%}\n:::\n:::\n\n\n-   **Step 11**: Extract the zip file\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus11.png){width=65%}\n:::\n:::\n\n\n-   **Step 12**: Be patient with the extraction\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus12.png){width=65%}\n:::\n:::\n\n\n-   **Step 13**: Once extraction is complete, take a look at the folders inside. You will see that there is a folder named 'SAS_SPSS'\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus13.png){width=65%}\n:::\n:::\n\n\n### Reading and Formatting the data\n\n#### Option 1: Processing data using SAS\n\nSAS is a commercial software. You may be able to get access to educational version. In case you don't have access to it, later we outline how to use free packages to read these datasets.\n\n-   **Step 1**: Inside that 'SAS_SPSS' folder, find the file *hs_pfe.sas*. It is a long file, but we are going to work on part of it. First thing we want to do it to change all the directory names to where you have unzipped the downloaded file (for example, here the zip file was extracted to C:/CCHS/Data/cchs_cycle3-1CD/). We only need the first part of the code (as shown below; only related to data 'hs'). Delete the rest of the codes for now. The resulting code should like like this:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n%include \"C:\\CCHS\\Data\\cchs_cycle3-1CD\\SAS_SPSS\\Layouts\\hs\\hs_pfe.sas\";\n\ndata hs;\n        %let datafid=\"C:\\CCHS\\Data\\cchs_cycle3-1CD\\Data\\hs.txt\";\n\t\t%include \"C:\\CCHS\\Data\\cchs_cycle3-1CD\\SAS_SPSS\\Layouts\\hs\\hs_i.sas\";\n        %include \"C:\\CCHS\\Data\\cchs_cycle3-1CD\\SAS_SPSS\\Layouts\\hs\\hs_fmt.sas\";\n        %include \"C:\\CCHS\\Data\\cchs_cycle3-1CD\\SAS_SPSS\\Layouts\\hs\\hs_lbe.sas\";\nrun;\n```\n:::\n\n\nOnce the modifications are done, submit the codes in SAS. Note that, the name of the data is 'hs'.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus14.png){width=65%}\n:::\n:::\n\n\n-   **Step 2**: Once you submit the code, you can check the log window in SAS to see how the code submission went. It should tell you how many observations and variables were read.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus15.png){width=65%}\n:::\n:::\n\n\n-   **Step 3**: If you one to view the dataset, you can go to 'Explorer' window within SAS.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus16.png){width=65%}\n:::\n:::\n\n\n-   **Step 4**: Generally, if you haven't specified where to load the files, SAS will by default save the data into a library called 'Work'\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus17.png){width=65%}\n:::\n:::\n\n\n-   **Step 5**: Open that folder, and you will be able to find the dataset 'Hs'.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus18.png){width=65%}\n:::\n:::\n\n\n-   **Step 6**: Right click on the data, and click 'open' to view the datafile.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus19.png){width=65%}\n:::\n:::\n\n\n-   **Step 7**: To export the data into a CSV format data (so that we can read this data into other software packages), ckick 'Menu'.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus20.png){width=65%}\n:::\n:::\n\n\n-   **Step 8**: then press 'Export Data'.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus21.png){width=65%}\n:::\n:::\n\n\n-   **Step 9**: choose the library and the data.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus22.png){width=65%}\n:::\n:::\n\n\n-   **Step 10**: choose the format in which you may want to save the existing data.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus23.png){width=65%}\n:::\n:::\n\n\n-   **Step 11**: also specify where you want to save the csv file and the name of that file (e.g., cchs3.csv).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus24.png){width=65%}\n:::\n:::\n\n\n-   **Step 12**: go to that directory to see the file cchs3.csv\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus25.png){width=65%}\n:::\n:::\n\n\n-   **Step 13**: If you want to save the file in SAS format, you can do so by writing the following sas code into the 'Editor' window. Here we are saving the data Hs within the Work library in to a data called cchs3 within the SASLib library. Note that, the directory name has to be where you want to save the output file.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nLIBNAME SASLib \"C:\\CCHS\\Data\";\nDATA SASLib.cchs3;\n    set Work.Hs;\nrun;\n```\n:::\n\n\nSubmit these codes into SAS:\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus26.png){width=65%}\n:::\n:::\n\n\n-   **Step 13**: go to that directory to see the file cchs3.sas7dbat\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus27.png){width=65%}\n:::\n:::\n\n\n#### Option 2: Processing data using PSPP (Free)\n\nPSPP is a free package; alternative to commercial software SPSS. We can use the same SPSS codes to read the datafile into PSPP, and save.\n\n-   **Step 1**: Get the free PSPP software from the website: [www.gnu.org/software/pspp/](http://www.gnu.org/software/pspp/)\n\nPSPP is available for GNU/Hurd, GNU/Linux, Darwin (Mac OS X), OpenBSD, NetBSD, FreeBSD, and Windows\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus30.png){width=65%}\n:::\n:::\n\n\nFor windows, download appropriate version.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/psppdownload0.png){width=65%}\n:::\n:::\n\n\nDownload the file\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/psppdownload.png){width=25%}\n:::\n:::\n\n\nInstall\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/psppinstall.png){width=65%}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/psppinstall2.png){width=65%}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/psppinstall3.png){width=65%}\n:::\n:::\n\n\nClick the icon shorcut after installing\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/psppicon.png){width=25%}\n:::\n:::\n\n\n-   **Step 2**: Open PSPP\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus31.png){width=65%}\n:::\n:::\n\n\n-   **Step 3**: Go to 'file' menu and click 'open'\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus32.png){width=65%}\n:::\n:::\n\n\n-   **Step 4**: Specify the *readfile.sps* file from the 'SAS_SPSS' folder.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus33.png){width=65%}\n:::\n:::\n\n\nYou will see the following file:\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacusX33.png){width=65%}\n:::\n:::\n\n\n-   **Step 5**: Similar to before, change the directories as appropriate. Get rid of the extra lines of codes. Resulting codes are as follows (you can copy and replace the code in the file with the following codes):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfile handle infile/name = 'C:\\CCHS\\Data\\cchs_cycle3-1CD\\DATA\\hs.txt'.\ndata list file = infile notable/.\ninclude file = \"C:\\CCHS\\Data\\cchs_cycle3-1CD\\SAS_SPSS\\Layouts\\hs\\hs_i.sps\".\ninclude file = \"C:\\CCHS\\Data\\cchs_cycle3-1CD\\SAS_SPSS\\Layouts\\hs\\hsvale.sps\".\ninclude file = \"C:\\CCHS\\Data\\cchs_cycle3-1CD\\SAS_SPSS\\Layouts\\hs\\hsvare.sps\".\ninclude file = \"C:\\CCHS\\Data\\cchs_cycle3-1CD\\SAS_SPSS\\Layouts\\hs\\hsmiss.sps\".\nexecute.\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacusX34.png){width=65%}\n:::\n:::\n\n\nFor Mac users, it should be as follows (e.g., `username` should be your user name, if you are saving under the path `\"/Users/username/CCHS/Data/\"`):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfile handle infile/name =\"/Users/username/CCHS/Data/cchs_cycle3-1CD/Data/hs.txt\".\ndata list file = infile notable/.\ninclude file = \"/Users/username/CCHS/Data/cchs_cycle3-1CD/SAS_SPSS/Layouts/hs/hs_i.sps\".\ninclude file = \"/Users/username/CCHS/Data/cchs_cycle3-1CD/SAS_SPSS/Layouts/hs/hsvale.sps\".\ninclude file = \"/Users/username/CCHS/Data/cchs_cycle3-1CD/SAS_SPSS/Layouts/hs/hsvare.sps\".\ninclude file = \"/Users/username/CCHS/Data/cchs_cycle3-1CD/SAS_SPSS/Layouts/hs/hsmiss.sps\".\n\nexecute.\n```\n:::\n\n\n-   **Step 6**: Run the codes.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus35.png){width=65%}\n:::\n:::\n\n\n-   **Step 7**: This is a large data, and will take some time to load the data into the PSPP data editor. **Be patient**.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/waitX.png){width=65%}\n:::\n:::\n\n\nOnce loading is complete, it will show the 'output' and 'data view'.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacusNew.png){width=65%}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus36.png){width=65%}\n:::\n:::\n\n\nNote that, you will get error message, if your files were not in the correct path. In our example, the path was `\"C:\\CCHS\\Data\\\"` for the zip file content (see the previous steps).\n\n-   **Step 7**: You can also check the 'variable view'.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus37.png){width=65%}\n:::\n:::\n\n\n-   **Step 8**: Save the data by clicking 'File' and then 'save as ...'\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus38.png){width=65%}\n:::\n:::\n\n\n-   **Step 9**: Specify the name of the datafile and the location / folder to save the data file.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus39.png){width=65%}\n:::\n:::\n\n\n-   **Step 10**: See the SAV file saved in the directory.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus40.png){width=65%}\n:::\n:::\n\n\n-   **Step 11**: To save CSV format data, use the following syntax.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nSAVE TRANSLATE\n  /OUTFILE=\"C:/CCHS/Data/cchs3b.csv\"  \n  /TYPE=CSV\n  /FIELDNAMES      \n  /CELLS=VALUES.\n```\n:::\n\n\nNote that, for categorical data, you can either save values or labels. For our purpose, we prefer values, and hence saved with values here.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus41.png){width=65%}\n:::\n:::\n\n\n-   **Step 12**: See the CSV file saved in the directory extracted from PSPP.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus42.png){width=65%}\n:::\n:::\n\n\n#### Option 3: Processing data using SPSS\n\nLog into [ubc.onthehub.com](https://ubc.onthehub.com) to download SPSS. With your CWL account, UBC students should be able to download it. UBC [IT website for SPSS](https://it.ubc.ca/services/desktop-print-services/software-licensing/spss) says:\n\n`The SPSS software license with UBC specifies that SPSS must only be used by UBC Faculty, Students, and Research Staff and only for Teaching and non-commercial Research purposes related to UBC.`\n\nBoth network (for UBC owened devices) or standalone / home versions (for non-UBC owened devices) should be available. Once downloaded, same process of importing CCHS data in PSPP can also be applied on SPSS (same syntax files should work). Let me know if that is not the case.\n\n### Processing data in R\n\n#### Download software\n\n-   **Step 1**: Download either 'R' from CRAN [www.r-project.org](https://www.r-project.org/) or 'R open' from Microsoft [mran.microsoft.com/open](https://mran.microsoft.com/open)\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/R03.png){width=65%}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/R01.png){width=65%}\n:::\n:::\n\n\n-   **Step 2**: Download RStudio from [www.rstudio.com/](https://www.rstudio.com/)\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/R02.png){width=65%}\n:::\n:::\n\n\n-   **Step 3**: Open RStudio\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/R04.png){width=65%}\n:::\n:::\n\n\n#### Import, export and load data into R\n\n-   **Step 1**: Set working directory\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsetwd(\"C:/CCHS/Data/\") # or something appropriate\n```\n:::\n\n\n-   **Step 2**: Read the dataset created from PSPP with cell values. We can also do a small check to see if the cell values are visible. For example, we choose a variable 'CCCE_05A', and tabulate it.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nHs <- read.csv(\"cchs3b.csv\", header = TRUE)\ntable(Hs$CCCE_05A)\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus46.png){width=65%}\n:::\n:::\n\n\n-   **Step 3**: Save the RData file from R into a folder `SurveyData`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsave(Hs, file = \"SurveyData/cchs3.RData\")\n```\n:::\n\n\n-   **Step 4**: See the RData file saved in the directory extracted from R.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus43.png){width=65%}\n:::\n:::\n\n\n-   **Step 5**: Close R / RStudio and restart it. Environment window within RStudio should be empty.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus44.png){width=65%}\n:::\n:::\n\n\n-   **Step 6**: Load the saved RData into R. Environment window within RStudio should have 'Hs' dataset.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nload(\"SurveyData/cchs3.RData\")\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](Images/accessing/abacus45.png){width=65%}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}